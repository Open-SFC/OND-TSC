cscope 15 $HOME/tsc-app/src               0000478713
	@include/dobhash.h

29 #ide
_DOBHASH_H_


30 
	#_DOBHASH_H_


	)

31 #ifde
__lulus


35 
	#CNTLR_DOBBS_MIX
(
a
,
b
,
c
) \

37 
a
 -
b
; -
c
; ^= (c>>13); \

38 
b
 -
c
; b -
a
; b ^= (a<<8); \

39 
c
 -
a
; c -
b
; c ^= (b>>13); \

40 
a
 -
b
; -
c
; ^= (c>>12); \

41 
b
 -
c
; b -
a
; b ^= (a<<16); \

42 
c
 -
a
; c -
b
; c ^= (b>>5); \

43 
a
 -
b
; -
c
; ^= (c>>3); \

44 
b
 -
c
; b -
a
; b ^= (a<<10); \

45 
c
 -
a
; c -
b
; c ^= (b>>15); \

46 }

	)

50 
	#CNTLR_DOBBS_HASH

pS
, 
ngth
, 
v
, 
hashmask
, 
hash
) \

53 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
,
mp_n
; \

54 
T_UCHAR8
 *
k
 = 
pS
; \

57 
mp_n
 = 
ngth
;\

58 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

59 
mp_c
 = 
v
; \

62 
mp_n
 >= 12) \

64 
mp_a
 +(
k
[0] +((
ut32_t
)k[1]<<8) +((uint32_t)k[2]<<16) +\

65 ((
ut32_t
)
k
[3]<<24));\

66 
mp_b
 +(
k
[4] +((
ut32_t
)k[5]<<8) +((uint32_t)k[6]<<16) +\

67 ((
ut32_t
)
k
[7]<<24));\

68 
mp_c
 +(
k
[8] +((
ut32_t
)k[9]<<8) +((uint32_t)k[10]<<16) +\

69 ((
ut32_t
)
k
[11]<<24));\

70 
	`CNTLR_DOBBS_MIX
(
mp_a
,
mp_b
,
mp_c
);\

71 
k
 +12; 
mp_n
 -= 12;\

75 
mp_c
 +
ngth
;\

76 
mp_n
) \

78 11: 
mp_c
+=((
ut32_t
)
k
[10]<<24);\

79 10: 
mp_c
+=((
ut32_t
)
k
[9]<<16);\

80 9 : 
mp_c
+=((
ut32_t
)
k
[8]<<8);\

82 8 : 
mp_b
+=((
ut32_t
)
k
[7]<<24);\

83 7 : 
mp_b
+=((
ut32_t
)
k
[6]<<16);\

84 6 : 
mp_b
+=((
ut32_t
)
k
[5]<<8);\

85 5 : 
mp_b
+=
k
[4];\

86 4 : 
mp_a
+=((
ut32_t
)
k
[3]<<24);\

87 3 : 
mp_a
+=((
ut32_t
)
k
[2]<<16);\

88 2 : 
mp_a
+=((
ut32_t
)
k
[1]<<8);\

89 1 : 
mp_a
+=
k
[0];\

92 
	`CNTLR_DOBBS_MIX
(
mp_a
,
mp_b
,
mp_c
);\

94 
hash
 = 
mp_c
 & (
hashmask
-1);\

95 }

	)

99 
	#CNTLR_DOBBS_HASH_WORDS4
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
,
pS
, 
ngth
, 
v
, 
hashmask
, 
hash
) \

102 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
,
mp_n
; \

103 
T_UCHAR8
 *
k
 = 
pS
; \

106 
mp_n
 = 
ngth
;\

107 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

108 
mp_c
 = 
v
; \

111 
mp_n
 >= 12) \

113 
mp_a
 +(
k
[0] +((
ut32_t
)k[1]<<8) +((uint32_t)k[2]<<16) +\

114 ((
ut32_t
)
k
[3]<<24));\

115 
mp_b
 +(
k
[4] +((
ut32_t
)k[5]<<8) +((uint32_t)k[6]<<16) +\

116 ((
ut32_t
)
k
[7]<<24));\

117 
mp_c
 +(
k
[8] +((
ut32_t
)k[9]<<8) +((uint32_t)k[10]<<16) +\

118 ((
ut32_t
)
k
[11]<<24));\

119 
	`CNTLR_DOBBS_MIX
(
mp_a
,
mp_b
,
mp_c
);\

120 
k
 +12; 
mp_n
 -= 12;\

124 
mp_c
 +
ngth
;\

125 
mp_n
) \

127 11: 
mp_c
+=((
ut32_t
)
k
[10]<<24);\

128 10: 
mp_c
+=((
ut32_t
)
k
[9]<<16);\

129 9 : 
mp_c
+=((
ut32_t
)
k
[8]<<8);\

131 8 : 
mp_b
+=((
ut32_t
)
k
[7]<<24);\

132 7 : 
mp_b
+=((
ut32_t
)
k
[6]<<16);\

133 6 : 
mp_b
+=((
ut32_t
)
k
[5]<<8);\

134 5 : 
mp_b
+=
k
[4];\

135 4 : 
mp_a
+=((
ut32_t
)
k
[3]<<24);\

136 3 : 
mp_a
+=((
ut32_t
)
k
[2]<<16);\

137 2 : 
mp_a
+=((
ut32_t
)
k
[1]<<8);\

138 1 : 
mp_a
+=
k
[0];\

141 
	`CNTLR_DOBBS_MIX
(
mp_a
,
mp_b
,
mp_c
);\

143 
mp_a
 +
wd_a
; \

144 
mp_b
 +
wd_b
; \

145 
mp_c
 +
wd_c
; \

146 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

148 
mp_a
 +
wd_d
; \

149 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

152 
hash
 = 
mp_c
 & (
hashmask
-1);\

153 }

	)

156 
	#CNTLR_DOBBS_WORDS2
(
wd_a
, 
wd_b
, 
v
, \

157 
hashmask
, 
hash
) \

159 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

160 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

161 
mp_c
 = 
v
; \

163 
mp_a
 +
wd_a
; \

164 
mp_b
 +
wd_b
; \

166 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

168 
hash
 = 
mp_c
 & (
hashmask
-1); \

169 }

	)

171 
	#CNTLR_DOBBS_WORDS3
(
wd_a
, 
wd_b
, 
wd_c
, 
v
, \

172 
hashmask
, 
hash
) \

174 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

175 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

176 
mp_c
 = 
v
; \

178 
mp_a
 +
wd_a
; \

179 
mp_b
 +
wd_b
; \

180 
mp_c
 +
wd_c
; \

182 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

184 
hash
 = 
mp_c
 & (
hashmask
-1); \

185 }

	)

187 
	#CNTLR_DOBBS_WORDS4
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
v
, \

188 
hashmask
, 
hash
) \

190 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

191 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

192 
mp_c
 = 
v
; \

194 
mp_a
 +
wd_a
; \

195 
mp_b
 +
wd_b
; \

196 
mp_c
 +
wd_c
; \

198 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

200 
mp_a
 +
wd_d
; \

201 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

203 
hash
 = 
mp_c
 & (
hashmask
-1); \

204 }

	)

206 
	#CNTLR_DOBBS_WORDS5
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
wd_e
, 
v
, \

207 
hashmask
, 
hash
) \

209 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

210 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

211 
mp_c
 = 
v
; \

213 
mp_a
 +
wd_a
; \

214 
mp_b
 +
wd_b
; \

215 
mp_c
 +
wd_c
; \

217 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

219 
mp_a
 +
wd_d
; \

220 
mp_b
 +
wd_e
; \

221 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

223 
hash
 = 
mp_c
 & (
hashmask
-1); \

224 }

	)

226 
	#CNTLR_DOBBS_WORDS6
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
wd_e
, 
wd_f
, \

227 
v
, 
hashmask
, 
hash
) \

229 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

230 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

231 
mp_c
 = 
v
; \

233 
mp_a
 +
wd_a
; \

234 
mp_b
 +
wd_b
; \

235 
mp_c
 +
wd_c
; \

237 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

239 
mp_a
 +
wd_d
; \

240 
mp_b
 +
wd_e
; \

241 
mp_c
 +
wd_f
; \

242 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

244 
hash
 = 
mp_c
 & (
hashmask
-1); \

245 }

	)

247 
	#CNTLR_DOBBS_WORDS7
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
wd_e
, 
wd_f
, \

248 
wd_g
, 
v
, 
hashmask
, 
hash
) \

250 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

251 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

252 
mp_c
 = 
v
; \

254 
mp_a
 +
wd_a
; \

255 
mp_b
 +
wd_b
; \

256 
mp_c
 +
wd_c
; \

258 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

260 
mp_a
 +
wd_d
; \

261 
mp_b
 +
wd_e
; \

262 
mp_c
 +
wd_f
; \

263 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

265 
mp_a
 +
wd_g
; \

266 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

268 
hash
 = 
mp_c
 & (
hashmask
-1); \

269 }

	)

271 
	#CNTLR_DOBBS_WORDS8
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
wd_e
, 
wd_f
, 
wd_g
, 
wd_h
, \

272 
v
, 
hashmask
, 
hash
) \

274 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

275 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

276 
mp_c
 = 
v
; \

278 
mp_a
 +
wd_a
; \

279 
mp_b
 +
wd_b
; \

280 
mp_c
 +
wd_c
; \

282 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

284 
mp_a
 +
wd_d
; \

285 
mp_b
 +
wd_e
; \

286 
mp_c
 +
wd_f
; \

287 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

289 
mp_a
 +
wd_g
; \

290 
mp_b
 +
wd_h
; \

291 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

293 
hash
 = 
mp_c
 & (
hashmask
-1); \

294 }

	)

296 
	#CNTLR_DOBBS_WORDS12
(
wd_a
, 
wd_b
, 
wd_c
, 
wd_d
, 
wd_e
, 
wd_f
, 
wd_g
, 
wd_h
, \

297 
wd_i
, 
wd_j
,
wd_k
,
wd_l
,
v
, 
hashmask
, 
hash
) \

299 
ut32_t
 
mp_a
, 
mp_b
, 
mp_c
; \

300 
mp_a
 = 
mp_b
 = 0x9e3779b9; \

301 
mp_c
 = 
v
; \

303 
mp_a
 +
wd_a
; \

304 
mp_b
 +
wd_b
; \

305 
mp_c
 +
wd_c
; \

307 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

309 
mp_a
 +
wd_d
; \

310 
mp_b
 +
wd_e
; \

311 
mp_c
 +
wd_f
; \

312 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

314 
mp_a
 +
wd_g
; \

315 
mp_b
 +
wd_h
; \

316 
mp_c
 +
wd_i
; \

317 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

319 
mp_a
 +
wd_j
; \

320 
mp_b
 +
wd_k
; \

321 
mp_b
 +
wd_l
; \

322 
	`CNTLR_DOBBS_MIX
(
mp_a
, 
mp_b
, 
mp_c
); \

324 
hash
 = 
mp_c
 & (
hashmask
-1); \

325 }

	)

327 #ifde
__lulus


	@include/nicira_tun_ext.h

17 #ide
OPENFLOW_NICIRA_EXT_H


18 
	#OPENFLOW_NICIRA_EXT_H
 1

	)

20 
	#OF_OXM_HDR_LEN
 (4)

	)

21 
	#OF_NXM_HDR_LEN
 (4)

	)

23 
	#OF_SET_FIELD_ACTION_PADDING_LEN
(
nxm_n
((xm_n+ 7)/8*8 - (nxm_n))

	)

25 
	#NXM_HEADER__
(
VENDOR
, 
FIELD
, 
HASMASK
, 
LENGTH
) \

26 (((
VENDOR
<< 16| ((
FIELD
<< 9| ((
HASMASK
<< 8| (
LENGTH
))

	)

27 
	#NXM_HEADER
(
VENDOR
, 
FIELD
, 
LENGTH
) \

28 
	`NXM_HEADER__
(
VENDOR
, 
FIELD
, 0, 
LENGTH
)

	)

29 
	#NXM_HEADER_W
(
VENDOR
, 
FIELD
, 
LENGTH
) \

30 
	`NXM_HEADER__
(
VENDOR
, 
FIELD
, 1, (
LENGTH
* 2)

	)

31 
	#NXM_VENDOR
(
HEADER
((HEADER>> 16)

	)

32 
	#NXM_FIELD
(
HEADER
(((HEADER>> 9& 0x7f)

	)

33 
	#NXM_TYPE
(
HEADER
(((HEADER>> 9& 0x7fffff)

	)

34 
	#NXM_HASMASK
(
HEADER
(((HEADER>> 8& 1)

	)

35 
	#NXM_LENGTH
(
HEADER
((HEADER& 0xff)

	)

37 
	#NXM_MAKE_WILD_HEADER
(
HEADER
) \

38 
	`NXM_HEADER_W
(
	`NXM_VENDOR
(
HEADER
), 
	`NXM_FIELD
(HEADER), 
	`NXM_LENGTH
(HEADER))

	)

40 
	#NXM01_TUN_ID
 16

	)

41 
	#NXM01_TUN_IPV4_SRC
 31

	)

42 
	#NXM01_TUN_IPV4_DST
 32

	)

43 
	#NXM01_TUN_NW_TYPE


	)

44 
	#NXM01_TUN_PKT_ORIG


	)

46 
	#NXM_NX_TUN_ID
 
	`NXM_HEADER
 (0x0001, 
NXM01_TUN_ID
, 8)

	)

47 
	#NXM_NX_TUN_ID_W
 
	`NXM_HEADER_W
(0x0001, 
NXM01_TUN_ID
, 8)

	)

49 
	#NXM_NX_TUN_IPV4_SRC
 
	`NXM_HEADER
 (0x0001, 
NXM01_TUN_IPV4_SRC
, 4)

	)

50 
	#NXM_NX_TUN_IPV4_SRC_W
 
	`NXM_HEADER_W
(0x0001, 
NXM01_TUN_IPV4_SRC
, 4)

	)

51 
	#NXM_NX_TUN_IPV4_DST
 
	`NXM_HEADER
 (0x0001, 
NXM01_TUN_IPV4_DST
, 4)

	)

52 
	#NXM_NX_TUN_IPV4_DST_W
 
	`NXM_HEADER_W
(0x0001, 
NXM01_TUN_IPV4_DST
, 4)

	)

54 
	#NXM_NX_REG0
 
	`NXM_HEADER
 (0x0001, 
NXM01_REG1
,4)

	)

55 
	#NXM_NX_REG0_W
 
	`NXM_HEADER_W
(0x0001, 
NXM01_REG1
,4)

	)

58 
t32_t


59 
ofu_g_tun_id_fld
(
of_msg
 *
msg
,

60 *
mch_flds
,

61 
ut16_t
 
mch_flds_n
,

62 
ut64_t
 *
tun_id
);

64 
t32_t


65 
ofu_g_tun_c_fld
(
of_msg
 *
msg
,

66 *
mch_flds
,

67 
ut16_t
 
mch_flds_n
,

68 
ut32_t
 *
tun_c
);

70 
t32_t


71 
ofu_g_tun_d_fld
(
of_msg
 *
msg
,

72 *
mch_flds
,

73 
ut16_t
 
mch_flds_n
,

74 
ut32_t
 *
tun_d
);

77 
t32_t


78 
of_t_v4_tun_c
(
of_msg
 *
msg
,

79 
v4_addr_t
 *
v4_addr
,

80 
ut8_t
 
is_mask_t
,

81 
v4_addr_t
 *
v4_addr_mask
);

82 
t32_t


83 
of_t_v4_tun_d
(
of_msg
 *
msg
,

84 
v4_addr_t
 *
v4_addr
,

85 
ut8_t
 
is_mask_t
,

86 
v4_addr_t
 *
v4_addr_mask
);

88 
t32_t


89 
ofu_push_t_v4_tun_c_addr__t_fld_ai
(
of_msg
 *
msg
,

90 
v4_addr_t
 *
v4_addr
);

92 
t32_t


93 
ofu_push_t_v4_tun_d_addr__t_fld_ai
(
of_msg
 *
msg
,

94 
v4_addr_t
 *
v4_addr
);

	@include/tsc_controller.h

25 #ide
__TSC_CONTROLLER__


26 
	#__TSC_CONTROLLER__


	)

28 
	#TSC_APP_CLASSIFY_TABLE_ID_0
 0

	)

29 
	#TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
 1

	)

30 
	#TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
 2

	)

31 
	#TSC_APP_UNICAST_TABLE_ID_3
 3

	)

32 
	#TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
 4

	)

33 
	#TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
 5

	)

36 
	#NW_TYPE_OFFSET
 60

	)

37 
	#PKT_ORIGIN_OFFSET
 56

	)

38 
	#PKT_ORIGIN_MASK
 0x0F00000000000000

	)

39 
	#EMPTY
 51

	)

40 
	#TSC_SWITCH_NAME_LEN
 64

	)

42 
	#NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
 
	`offtof
(
nscha_posy_y
,
nscha_posy_tbl_lk
)

	)

43 
	#NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
 
	`offtof
(
upkt_out_posy_y
,
upkt_out_posy_tbl_lk
)

	)

45 
	#PSP_CACHE_LINE_SIZE
 64

	)

47 
	#CACHE_ALIGN
 
	`__ibu__
((
	`igd
(
PSP_CACHE_LINE_SIZE
)))

	)

48 
	#PAD_CACHE_LINE
 
uch8_t
 
chad
[0] 
CACHE_ALIGN
;

	)

50 
	~"tsc_nsc_ce.h
"

52 
	stsc_ofv_ug_i


54 
ut32_t
 
	m_pt_id
;

55 
ut64_t
 
	mmada
;

56 
ut64_t
 
	mmada_mask
;

58 
ut8_t
 
	mnw_ty
;

60 
ut64_t
 
	mdp_hd
;

62 
	mlol_swch_me
[
TSC_SWITCH_NAME_LEN
];

63 
	mme_swch_me
[
TSC_SWITCH_NAME_LEN
];

65 
ut32_t
 
	mno_of_nwside_br_pts
;

66 
ut32_t
* 
	mnwside_br_pts_p
;

69 
ut32_t
 
	mvni
;

70 
ut64_t
 
	mtun_id
;

71 
ut16_t
 
	mrvipt
;

73 
t32_t
 
	mpkt_ig_e
;

74 
ut16_t
 
	mvn_id_
;

75 
ut16_t
 
	mvn_id_out
;

76 
ut8_t
 
	mow_mod_iܙy
;

77 
t32_t
 
	mpkt_ty_e
;

79 
ut32_t
 
	mout_pt_no
;

81 
ut8_t
 
	mxt_b_id
;

84 
	etsc_pkt_ty_e


86 
	mFCFM_PKT_TYPE_UNICAST
,

87 
	mFCFM_PKT_TYPE_BROADCAST
,

88 
	mFCFM_PKT_TYPE_MULTICAST
,

91 
	etsc_pkt_ig_e


93 
	mVM_APPLN
,

94 
	mVM_NS
,

95 
	mNW_UNICAST_SIDE
,

96 
	mNW_BROADCAST_SIDE


99 
	#PSP_CACHE_LINE_SIZE
 64

	)

101 
	#CACHE_ALIGN
 
	`__ibu__
((
	`igd
(
PSP_CACHE_LINE_SIZE
)))

	)

102 
	#PAD_CACHE_LINE
 
uch8_t
 
chad
[0] 
CACHE_ALIGN
;

	)

105 
	snscha_posy_y


107 
mchash_b_lk
 
	mnscha_posy_tbl_lk
;

108 
	mlol_swch_me_p
[
TSC_SWITCH_NAME_LEN
];

109 
ut64_t
 
	mdp_hd
;

110 
ut8_t
 
	mnw_ty
;

111 
ut32_t
 
	mnid
;

112 
ut16_t
 
	mrvipt
;

113 
ut32_t
 
	mme_swch_
;

114 
ut32_t
 
	m_pt_id
;

115 
ut64_t
 
	mmada
;

117 
ut64_t
 
	mmada_mask
;

118 
ut8_t
 
	mpkt_ig
;

120 
ut8_t
 
	mns_cha_b
;

121 
ut8_t
 
	mme_nf_b
;

122 
ut8_t
 
	mns_pt_b
;

124 
ut16_t
 
	mvn_id_pkt
;

125 
ut16_t
 
	mmch_vn_id
;

126 
ut16_t
 
	mxt_vn_id
;

128 
ut8_t
 
	mnw_pt_b
;

129 
ut32_t
 
	mout_pt_no
;

130 
ut32_t
 
	mtun_de_
;

131 
ut8_t
 
	mxt_b_id
;

133 
ut8_t
 
	mow_mod_iܙy
;

135 
ut8_t
 
	mrvi_chag_ty
;

136 
nsc__node
 
	m
;

138 
ut8_t
 
	mlol__mac
[6];

139 
ut8_t
 
	mlol_out_mac
[6];

141 
ut8_t
 
	mcy_lol_mac_addss_b
;

142 
ut8_t
 
	mcy_ig_mac_addss_b
;

145 
ut8_t
 
	mvm_d_rvi1_n__me_swch
;

147 
ut8_t
 
	msk_this_y
;

149 
ut32_t
 
	mdex
;

150 
ut32_t
 
	mmagic
;

151 
ut64_t
 
	m_n
;

152 
ut8_t
 
	mhp_b
;

153 
	mPAD_CACHE_LINE
;

154 }
	gCACHE_ALIGN
;

156 
	sm_pt_tsc_fo


158 
ut64_t
 
	mswch_hd
;

159 
ut64_t
 
	mdm_br1_f
;

160 
ut64_t
 
	mdm_pt_hd
;

162 
ut32_t
 
	mswch_
;

163 
ut32_t
 
	mpt_id
;

164 
ut8_t
 
	mpt_us
;

167 
	supkt_out_posy_y


169 
mchash_b_lk
 
	mupkt_out_posy_tbl_lk
;

170 
	mlol_swch_me_p
[
TSC_SWITCH_NAME_LEN
];

171 
	mme_swch_me_p
[
TSC_SWITCH_NAME_LEN
];

172 
ut64_t
 
	mdp_hd
;

173 
ut8_t
 
	mnw_ty
;

174 
ut8_t
 
	miܙy
;

175 
ut32_t
 
	mnid
;

176 
ut64_t
 
	mtun_id
;

177 
ut64_t
 
	mmada
;

179 
ut64_t
 
	mmada_mask
;

180 
ut16_t
 
	mrvipt
;

181 
ut16_t
 
	mid_time
;

182 
ut8_t
 
	md_mac
[6];

183 
ut32_t
 
	md_mac_high
;

184 
ut32_t
 
	md_mac_low
;

185 
ut8_t
 
	mnw_pt_b
;

186 
ut32_t
 
	mtun_de_
;

187 
ut8_t
 
	mpt_ty
;

188 
ut32_t
 
	mout_pt_no
;

189 
ut32_t
 
	mdex
;

190 
ut32_t
 
	mmagic
;

191 
ut64_t
 
	m_n
;

192 
ut8_t
 
	mhp_b
;

193 
	mPAD_CACHE_LINE
;

194 }
	gCACHE_ALIGN
;

196 
	svmpts_posy_y


198 
	mlol_swch_me_p
[
TSC_SWITCH_NAME_LEN
];

199 
ut8_t
 
	mnw_ty
;

200 
ut32_t
 
	mnid
;

201 
ut64_t
 
	mmada
;

203 
ut64_t
 
	mmada_mask
;

204 
ut32_t
 
	mno_of_vmside_pts
;

205 
ut32_t
* 
	mvmside_pts_p
;

208 
	snwpts_brd_posy_y


210 
	mlol_swch_me_p
[
TSC_SWITCH_NAME_LEN
];

211 
ut8_t
 
	mnw_ty
;

212 
ut32_t
 
	mnid
;

213 
ut64_t
 
	mmada
;

214 
ut64_t
 
	mmada_mask
;

216 
ut16_t
 
	mrvipt
;

217 
ut32_t
 
	mno_of_nwside_br_pts
;

218 
ut32_t
* 
	mnwside_br_pts_p
;

221 
t32_t
 
tsc_add_vmpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

222 * 
swme_p
,

223 
ut8_t
 
m_pt_ty
,

224 
ut32_t
 
pt_id
,

225 
ut16_t
 
vn_id_
,

226 
ut16_t
 
vn_id_out
,

227 
ut64_t
 
dp_hd


230 
t32_t
 
tsc_de_vmpt_ows_om_assify_b
(
ut8_t
 
m_pt_ty
,

231 
ut32_t
 
pt_id
,

232 
ut64_t
 
dp_hd


235 
t32_t


236 
tsc_assify_b_miss_y_pkt_rcvd
(
ut64_t
 
dh_hd
,

237 
of_msg
* 
msg
,

238 
o_ck_
* 
pkt_
,

239 
tsc_ofv_ug_i
* 
of_ms_p


241 
t32_t


242 
tsc_outbound_ns_cha_b_1_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

243 
o_ck_
* 
pkt_
,

244 
ut32_t
 
_pt_id
,

245 
ut64_t
 
mada
);

247 
t32_t
 
tsc_bound_ns_cha_b_2_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

248 
o_ck_
* 
pkt_
,

249 
ut32_t
 
_pt_id
,

250 
ut64_t
 
mada
);

252 
t32_t
 
tsc_add_t3_ive_ow_f_vm
(
ut64_t
 
m_pt_hd
,

253 
ut64_t
 
m_vn_hd
,

254 
ut64_t
 
dp_hd
);

256 
t32_t
 
tsc_uni_b_3_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

257 
o_ck_
* 
pkt_
,

258 
ut64_t
 
mada
,

259 
ut32_t
 
_pt
,

260 
ut32_t
 
tun_c_
);

262 
t32_t
 
tsc_brd_outbound_b_4_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

263 
o_ck_
* 
pkt_
,

264 
ut64_t
 
mada
,

265 
ut32_t
 
_pt_id
);

267 
t32_t
 
tsc_brd_bound_b_5_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

268 
o_ck_
* 
pkt_
,

269 
ut64_t
 
mada
,

270 
ut32_t
 
_pt_id
,

271 
ut32_t
 
tun_c_
);

273 
ut32_t
 
nsc_compu_hash_posy_b_1_2
(ut32_
ddr
,ut32_
daddr
,

274 
ut32_t
 
t
,ut32_
dpt
,

275 
ut32_t
 
oc
,

276 
ut32_t
 
ht_ty
,

277 
ut32_t
 
pt_id
,

278 
ut64_t
 
dp_hd
,

279 
ut16_t
 
vn_id
,

280 
ut32_t
 
hashmask


283 
ut32_t
 
nsc_compu_hash_posy_b_3
(
ut16_t
 
rvipt
,

284 
ut32_t
 
d_mac_high
,

285 
ut32_t
 
d_mac_low
,

286 
ut64_t
 
dp_hd
,

287 
ut32_t
 
hashmask
);

290 
t32_t
 
tsc_g_nscha_posy_y
(* 
swch_me_p
,

291 
ut64_t
 
dp_hd
,

292 
ut8_t
 
nw_ty
,

293 
ut32_t
 
nid
,

294 
ut32_t
 
_pt_id
,

295 
ut64_t
 
mada
,

296 
o_ck_
* 
pkt_
,

297 
ut8_t
 
pkt_ig
,

298 
ut8_t
 
pkt_d
,

299 
nsc__node
* 
_p
,

300 
ut32_t
 
hashmask
,

301 
nscha_posy_y
** 
nscha_posy_node_p_p
);

303 
t32_t
 
tsc_g_upkt_out_posy_y
(
ut64_t
 
dp_hd
,

304 * 
lol_swch_me_p
,

305 
ut8_t
 
nw_ty
,

306 
ut32_t
 
nid
,

307 
ut16_t
 
rvipt
,

308 
ut64_t
 
mada
,

309 
o_ck_
* 
pkt_
,

310 
upkt_out_posy_y
** 
upkt_out_posy_node_p_p
);

312 
t32_t
 
tsc_g_vmpts_posy_y
(* 
lol_swch_me_p
,

313 
ut8_t
 
nw_ty
,

314 
ut32_t
 
nid
,

315 
ut64_t
 
mada
,

316 
vmpts_posy_y
** 
vmpts_posy_node_p_p
);

318 
t32_t
 
tsc_g_nwpts_brd_posy_y
(* 
lol_swch_me_p
,

319 
ut8_t
 
nw_ty
,

320 
ut32_t
 
nid
,

321 
ut16_t
 
rvipt
,

322 
ut64_t
 
mada
,

323 
nwpts_brd_posy_y
** 
nwpts_brd_posy_node_p_p
);

325 
t32_t
 
tsc_ow_y_mov_msg_cvd_nscha_bs
(
ut64_t
 
dp_hd
,ut64_
mada
,

326 
ut64_t
 
cook
,
ut8_t
 
as
,ut8_
b_id
);

328 
t32_t
 
tsc_ow_y_mov_msg_cvd_b_3
(
ut64_t
 
dp_hd
,ut64_
mada
,

329 
ut64_t
 
h_d
,
ut8_t
 
as
);

331 
t32_t
 
tsc_de_nscha_posy_y
(
nscha_posy_y
* 
nscha_posy_node_p
,
ut8_t
 
nw_ty
,

332 
ut32_t
 
nid
,
ut8_t
 
b_id
);

334 
t32_t
 
tsc_de_nwpt_ows_om_assify_b
(
ut8_t
 
m_pt_ty
,

335 
ut32_t
 
pt_id
,

336 
ut64_t
 
dp_hd
);

338 
t32_t
 
tsc_de_nsc_bs_1_2_ows_f_rvi_vm_ded
(
ut64_t
 
f_vn
,ut64_
m_pt_hd
);

340 
t32_t
 
tsc_de_b_3_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
);

341 
t32_t
 
tsc_de_b_4_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
);

342 
t32_t
 
tsc_de_b_5_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
);

344 
t32_t
 
tsc_nd_l_ows_to_l_ts
(
nscha_posy_y
* 
nscha_posy_y_p
);

	@include/tsc_nsc_core.h

23 
	~"cڌr.h
"

24 
	~"mi.h
"

25 
	~"m_vn_i.h
"

27 
	#tsddr_t
 

	)

29 
	#OF_CNTLR_MACHDR_DSTMAC_OFFSET
 0

	)

30 
	#OF_CNTLR_MACHDR_SRCMAC_OFFSET
 6

	)

31 
	#OF_CNTLR_ETHERNET_TYPE_OFFSET
 12

	)

33 
	#NSC_ERROR_DUPLICATE_CN_BIND_NODE
 -2

	)

34 
	#NSC_CONNECTION_BIND_ENTRY_ALREADY_EXISTS
 -3

	)

35 
	#NSC_CONNECTION_BIND_ENTRY_NOT_PRESENT
 -4

	)

36 
	#NSC_ERROR_INVALID_CNBIND_HANDLE
 -5

	)

37 
	#NSC_FAILED_TO_ADD_SELECTOR
 -6

	)

38 
	#NSC_INVALID_NSCHAINSET_HANDLE
 -7

	)

39 
	#NSC_INVALID_NSCHAIN_HANDLE
 -8

	)

40 
	#NSC_NSRM_CONFIG_LOOKUP_NOT_REQUIRED_OR_FAILED
 - 9

	)

41 
	#NSC_INCOMPLETE_NSCHAIN_CONFIGURATION
 -10

	)

42 
	#NSC_NO_SELECTION_RULE_FOUND
 -11

	)

43 
	#NSC_NO_BYPASS_RULE_FOUND
 -12

	)

44 
	#NSC_CHAINSET_NOT_CONFIGURED
 -13

	)

45 
	#NSC_NO_NW_SERVICES_FOUND
 -14

	)

46 
	#NSC_INVALID_BYPASS_HANDLE
 -15

	)

47 
	#NSC_INVALID_NSCHAIN_NAME
 -16

	)

48 
	#NSC_FAILED_TO_ADD_REPOSITORY_ENTRY
 -17

	)

50 
	#NSC_CONNECTION_BIND_ENTRY_CREATED
 2

	)

51 
	#NSC_CONNECTION_BIND_ENTRY_FOUND
 3

	)

52 
	#NSC_NWSERVICES_CONFIGURED
 5

	)

53 
	#NSC_NWSERVICES_NOT_CONFIGURED
 6

	)

54 
	#NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN
 7

	)

55 
	#NSC_ADDED_REPOSITORY_ENTRY
 8

	)

57 
	#SERVICE_CHAINING_NONE
 0

	)

58 
	#SERVICE_CHAINING_L2
 1

	)

59 
	#SERVICE_CHAINING_L3
 2

	)

62 
	#NSC_SELECTOR_NODE_OFFSET
 
	`offtof
(
nsc__node
,
nsc__tbl_lk
)

	)

64 
	#NSC_MAX_CNBIND_TBL_ENTRIES
 512

	)

65 
	#NSC_MAX_CNBIND_TBL_STATIC_ENTRIES
 128

	)

67 
	#NSC_MAX_REPOSITORY_TBL_1_ENTRIES
 1024

	)

68 
	#NSC_MAX_REPOSITORY_TBL_1_STATIC_ENTRIES
 512

	)

70 
	#NSC_MAX_REPOSITORY_TBL_2_ENTRIES
 1024

	)

71 
	#NSC_MAX_REPOSITORY_TBL_2_STATIC_ENTRIES
 512

	)

73 
	#NSC_MAX_REPOSITORY_TBL_3_ENTRIES
 1024

	)

74 
	#NSC_MAX_REPOSITORY_TBL_3_STATIC_ENTRIES
 512

	)

77 
	#PACKET_NORMAL
 1

	)

78 
	#PACKET_REVERSE
 2

	)

80 
	#SELECTOR_PRIMARY
 1

	)

81 
	#SELECTOR_SECONDARY
 2

	)

84 
	#NSC_FW_DENIED
 0

	)

85 
	#NSC_FW_ALLOWED
 1

	)

88 
	snsc__node


90 
mchash_b_lk
 
	mnsc__tbl_lk
;

94 
ut32_t
 
	mc_mac_high
;

95 
ut32_t
 
	mc_mac_low
;

96 
ut32_t
 
	md_mac_high
;

97 
ut32_t
 
	md_mac_low
;

99 
ut8_t
 
	mc_mac
[6];

100 
ut8_t
 
	md_mac
[6];

102 
ut16_t
 
	mht_ty
;

104 
ut8_t
 
	moc
;

105 
ut16_t
 
	mc_pt
;

106 
ut16_t
 
	md_pt
;

107 
ut8_t
 
	micmp_ty
;

108 
ut8_t
 
	micmp_code
;

109 
ut32_t
 
	mc_
;

110 
ut32_t
 
	md_
;

112 
ut8_t
 
	m_ty
;

113 
ut32_t
 
	mhashkey
;

116 
ut32_t
 
	mdex
;

117 
ut32_t
 
	mmagic
;

118 
ut64_t
 
	m_n
;

121 
nsc__node
* 
	mh__p
;

123 
l2_ci_to_nsfo_bd_node
* 
	mbd_node_p
;

124 
ut16_t
 
	mvn_id_pkt
;

127 
	snw_rvis_to_y


129 
ut64_t
 
	mnscha_obje_hd
;

130 
ut64_t
 
	mnwrvi__hd
;

131 
ut64_t
 
	mnwrvi_obje_hd
;

134 
	sbd_nwrvi_fo


136 
ut8_t
 
	mcfig_lookup_u
;

138 
ut8_t
 
	mfw_ai
;

140 
mchash_b_lk
 
	mnsc_bd_tbl_lk
;

142 
ut64_t
 
	mnschat_obje_hd
;

143 
ut64_t
 
	mi_ru_hd
;

145 
ut64_t
 
	mnscha_obje_hd
;

146 
ut64_t
 
	mbyss_ru_hd
;

151 
nw_rvis_to_y
 *
	mnw_rvis_p
;

153 
ut8_t
 
	mno_of_nwrvi_s
;

158 
of_li_t
 
	ms_posy_y
;

166 
	sl2_ci_to_nsfo_bd_node


168 
nsc__node
 
	m_1
;

169 
nsc__node
 
	m_2
;

170 
bd_nwrvi_fo
 
	mnwrvi_fo
;

172 
ut8_t
 
	mlol__mac
[6];

173 
ut8_t
 
	mlol_out_mac
[6];

175 
ut32_t
 
	mno_of_ow_s_dedud
;

176 
ut8_t
 
	msk_this_y
;

177 
ut8_t
 
	me_y
;

178 
ut8_t
 
	mbd_l_ft
;

179 * 
	mnsc__bd_mempo_g
;

180 
r_lock_t
 
	mbd_node_lock
;

182 
ut32_t
 
	mnsc_cfig_us
;

184 
ut8_t
 
	mhp_b
;

187 
	svn_rvi_chag_fo


189 
ut8_t
 
	mrvi_chag_ty
;

198 
ut64_t
 
	mf_rvi_m_cd
;

199 
ut64_t
 
	mf_nschat_obje
;

201 
ut8_t
 
	mvn_nmdb_lookup_e
;

202 * 
	mnsc__bd_mempo_g
;

203 
mchash_b
* 
	ml2_ci_to_nsfo_bd_b_p
;

205 * 
	mnsc_posy_b_1_mempo_g
;

206 * 
	mnsc_posy_b_2_mempo_g
;

207 * 
	mnsc_posy_b_3_mempo_g
;

209 
mchash_b
* 
	mnsc_posy_b_1_p
;

210 
mchash_b
* 
	mnsc_posy_b_2_p
;

211 
mchash_b
* 
	mnsc_posy_b_3_p
;

219 
t32_t
 
nsc_lookup_l2_nschag_fo
(
o_ck_
* 
pkt_
,

220 
ut8_t
 
nw_ty
,

221 
ut32_t
 
nid
,

222 
l2_ci_to_nsfo_bd_node
* 
_bd_y_p_p
);

237 
t32_t
 
nm_g_mchg_nscha_obje
(
nsc__node
* 
_p
,

238 
ut32_t
 
nid
,

239 
ut64_t
* 
i_ru_hd_p
,

240 
ut64_t
* 
nscha_obje_hd_p
);

254 
t32_t
 
nm_g_mchg_byss_ru
(
nsc__node
* 
_p
,

255 
ut64_t
 
nscha_obje_hd
,

256 
ut64_t
* 
byss_ru_hd_p
);

270 
t32_t
 
nm_g_nwrvi_s
(
ut64_t
 
nscha_obje_hd
,

271 
ut64_t
 
byss_ru_hd
,

272 
ut8_t
* 
no_of_nwrvi_objes_p
,

273 
nw_rvis_to_y
** 
ns__p_p
);

275 
ut32_t
 
NSC_COMPUTE_HASH_CNBIND_ENTRY
(ut32_
ddr
,ut32_
daddr
,

276 
ut32_t
 
t
,ut32_
dpt
,

277 
ut32_t
 
oc
,

278 
ut32_t
 
ht_ty
,

279 
ut32_t
 
hashmask


281 
t32_t
 
nsc_add_s
(
mchash_b
* 
b_p
,* 
nsc__bd_mempo_g
,
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
);

282 
t32_t
 
nsc_exa_ck_flds
(
o_ck_
* 
pkt_
,
nsc__node
* 
_p
,
ut8_t
 
dei
,ut8_
nsc_cy_mac_addss_b
);

284 
t32_t
 
nsc_g_bd_y
(
o_ck_
* 
pkt_
,

285 
nsc__node
* 
pkt__p
,

286 
ut8_t
 
nw_ty
,

287 
ut32_t
 
nid
,

288 
l2_ci_to_nsfo_bd_node
** 
_bd_node_p_p
,

289 
ut8_t
 *
_ty_p
,

290 
ut8_t
 
cy_ig_mac_b


293 
tsc_mk__bd_y_as_e
(
mchash_b
* 
l2_ci_to_nsfo_bd_b_p
,* 
nsc__bd_mempo_g
,
ut32_t
 
dex
,ut32_
magic
);

295 
t32_t
 
nsc_gi_nm_nifitis
();

297 
t32_t
 
nsc_
();

298 
t32_t
 
nsc_un
();

299 
t32_t
 
nsc__vn_sours
(
m_vtu_twk
* 
vn_y_p
);

300 
t32_t
 
nsc_de_vn_sours
(
m_vtu_twk
* 
vn_y_p
);

	@include/tsc_nsc_iface.h

23 
	#TSC_PKT_OUTBOUND
 1

	)

24 
	#TSC_PKT_INBOUND
 2

	)

26 
	st_l_ows_membs


28 
ut8_t
 
	m_ty
;

29 
ut8_t
 
	mb_no
;

30 
ut8_t
 
	mpkt_ig
;

31 
ut64_t
 
	mdp_hd
;

32 
ut32_t
 
	mpt_id
;

33 
ut16_t
 
	mmch_vn_id
;

34 
ut16_t
 
	mxt_vn_id
;

35 
ut16_t
 
	mvn_id_pkt
;

36 
ut32_t
 
	mout_pt_no
;

37 
ut8_t
 
	mcy_lol_mac_addss_b
;

38 
ut8_t
 
	mcy_ig_mac_addss_b
;

39 
ut8_t
 
	mnw_pt_b
;

40 
ut32_t
 
	mme_
;

43 
t32_t
 
nsc_g_l2_nschag_fo
(
nscha_posy_y
* 
nscha_posy_y_p
,

44 
o_ck_
* 
pkt_
,

45 
ut8_t
 
pkt_ig
);

	@include/tsc_nvm_modules.h

23 
	~"tsc_nvm_vxn.h
"

24 
	~"m_pt_i.h
"

27 #ide
__TSC_NVM_MODULES__


28 
	#__TSC_NVM_MODULES__


	)

30 
	#TSC_NVM_MODULE_NAME_MAX_LENGTH
 8

	)

32 
	stsc_nvm_modu_fo


34 
	mnvm_modu_me
[
TSC_NVM_MODULE_NAME_MAX_LENGTH
 + 1];

35 
ut8_t
 
	mnw_ty
;

42 
t32_t
 (*
	ttsc_nvm_modu__p
)();

43 
	$t32_t
 (*
	ttsc_nvm_modu__vmpt_vws_p
)(
	tut64_t
,
	tut8_t
,uint64_t);

44 
	$t32_t
 (*
	ttsc_nvm_modu_de_vmpt_vws_p
)(
	tut64_t
,
	tut8_t
,uint64_t);

45 
	$t32_t
 (*
	ttsc_nvm_modu__nwpt_vws_p
)(
	tut64_t
,
	tut8_t
,*);

46 
	$t32_t
 (*
	ttsc_nvm_modu_de_nwpt_vws_p
)(
	tut64_t
,
	tut8_t
,*);

48 
	$t32_t
 (*
	ttsc_nvm_modu_g_uni_nwpt_p
)(*,
	tut16_t
,
	tut32_t
*);

49 
	$t32_t
 (*
	ttsc_nvm_modu_g_me_s_p
)(*, 
	tut32_t
,uint32_t,uint32_t*,uint32_t*);

50 
	$t32_t
 (*
	ttsc_nvm_modu_g_brd_nwpts_p
)(*, 
	tut32_t
,uint32_t,uint32_t*,uint32_t*,uint32_t);

51 
	$t32_t
 (*
	ttsc_nvm_modu_g_vmpt_by_dmac_nid_p
)(
	tut8_t
*,
	tut32_t
,
	tut64_t
*);

52 
	$t32_t
 (*
	ttsc_nvm_modu_g_vmpts_by_swme_nid_p
)(*,
	tut32_t
,uint32_t*,uint32_t*);

54 
	$t32_t
 (*
	ttsc_nvm_modu_add_vn_to_nid_vw_p
)(
	tut64_t
,
	tut32_t
);

55 
	$t32_t
 (*
	ttsc_nvm_modu_de_vn_om_nid_vw_p
)(
	tut64_t
,
	tut32_t
);

56 
	$t32_t
 (*
	ttsc_nvm_modu_g_vnhd_by_nid_p
)(
	tut32_t
,
	tut64_t
 *);

58 (*
	ttsc_nvm_modu_cڡru_mada_p
)(
	ttsc_ofv_ug_i
*,
	tut64_t
 
	tvn_hd
,
	tm_pt
* 
	tm_pt_p
);

60 
	stsc_nvm_modu_r


62 
tsc_nvm_modu__p
 
nvm_modu_
;

63 
tsc_nvm_modu__vmpt_vws_p
 
nvm_modu__vmpt_vws
;

64 
tsc_nvm_modu_de_vmpt_vws_p
 
nvm_modu_de_vmpt_vws
;

65 
tsc_nvm_modu__nwpt_vws_p
 
nvm_modu__nwpt_vws
;

66 
tsc_nvm_modu_de_nwpt_vws_p
 
nvm_modu_de_nwpt_vws
;

68 
tsc_nvm_modu_g_uni_nwpt_p
 
nvm_modu_g_uni_nwpt
;

69 
tsc_nvm_modu_g_me_s_p
 
nvm_modu_g_me_s
;

70 
tsc_nvm_modu_g_brd_nwpts_p
 
nvm_modu_g_brd_nwpts
;

71 
tsc_nvm_modu_g_vmpt_by_dmac_nid_p
 
nvm_modu_g_vmpt_by_dmac_nid
;

72 
tsc_nvm_modu_g_vmpts_by_swme_nid_p
 
nvm_modu_g_vmpts_by_swme_nid
;

74 
tsc_nvm_modu_add_vn_to_nid_vw_p
 
nvm_modu_add_vn_to_nid_vw
;

75 
tsc_nvm_modu_de_vn_om_nid_vw_p
 
nvm_modu_de_vn_om_nid_vw
;

76 
tsc_nvm_modu_g_vnhd_by_nid_p
 
nvm_modu_g_vnhd_by_nid
;

78 
tsc_nvm_modu_cڡru_mada_p
 
nvm_modu_cڡru_mada
;

83 
t32_t
 
	`tsc_gi_nvm_modu
(
tsc_nvm_modu_fo
* 
nvm_modu_fo_p
,

84 
tsc_nvm_modu_r
* 
nvm_modu_r_p
);

86 
t32_t
 
	`tsc_nvm_modu_
();

	@include/tsc_nvm_vxlan.h

21 
	#SERVICE_PORT_OFFSET
 32

	)

22 
	#VNI_OFFSET
 0

	)

24 
	#TUN_ID_MASK
 0x00000000FFFFFFFF

	)

26 
t32_t
 
tsc_nvm_vxn_
();

28 
t32_t
 
tsc_nvm_vxn__vmpt_vws
(
ut64_t
 
m_pt_hd
,
ut8_t
 
m_pt_ty
,ut64_
vn_hd
);

29 
t32_t
 
tsc_nvm_vxn_de_vmpt_vws
(
ut64_t
 
m_pt_hd
,
ut8_t
 
m_pt_ty
,ut64_
vn_hd
);

30 
t32_t
 
tsc_nvm_vxn__nwpt_vws
(
ut64_t
 
m_pt_hd
,
ut8_t
 
m_pt_ty
,* 
swme_p
);

31 
t32_t
 
tsc_nvm_vxn_de_nwpt_vws
(
ut64_t
 
m_pt_hd
,
ut8_t
 
m_pt_ty
,* 
swme_p
);

33 
tsc_nvm_vxn_cڡru_mada
(
tsc_ofv_ug_i
* 
tsc_ms_p
,
ut64_t
 
vn_hd
,
m_pt
* 
m_pt_p
);

35 
t32_t
 
tsc_vxn_add_nwpt_ows
(* 
swme_p
,
m_vxn_nw
* 
vxn_nw_p
,
ut8_t
 
nwpt_ty
,
ut32_t
 
pt_id
,
ut64_t
 
dp_hd
);

	@include/tsc_ofplugin_v1_3_ldef.h

23 
	#FLMOD_MSG_LEN_NW_PORT_OF_1_3
 \

24 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+ \

25 
OFU_IN_PORT_FIELD_LEN
+ \

26 
OFU_ETH_DST_MAC_ADDR_MASK_LEN
+ \

27 
OFU_VLAN_VID_FIELD_LEN
+ \

28 
OFU_TUNNEL_ID_FIELD_LEN
+ \

29 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+ \

30 
OFU_POP_VLAN_HEADER_ACTION_LEN
+ \

31 
OFU_WRITE_META_DATA_INSTRUCTION_LEN
+ \

32 
OFU_GOTO_TABLE_INSTRUCTION_LEN
 \

33 

	)

34 
	#FLMOD_MSG_LEN_VM_PORT_OF_1_3
 \

35 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+ \

36 
OFU_IN_PORT_FIELD_LEN
+ \

37 
OFU_ETH_DST_MAC_ADDR_MASK_LEN
+ \

38 
OFU_VLAN_VID_MASK_LEN
+ \

39 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+ \

40 
OFU_POP_VLAN_HEADER_ACTION_LEN
+ \

41 
OFU_WRITE_META_DATA_INSTRUCTION_LEN
+ \

42 
OFU_GOTO_TABLE_INSTRUCTION_LEN
 \

43 

	)

44 
	#FLMOD_MSG_LEN_VM_NS_PORT_OF_1_3
 \

45 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+ \

46 
OFU_IN_PORT_FIELD_LEN
+ \

47 
OFU_ETH_DST_MAC_ADDR_MASK_LEN
+ \

48 
OFU_VLAN_VID_MASK_LEN
+ \

49 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+ \

50 
OFU_POP_VLAN_HEADER_ACTION_LEN
+ \

51 
OFU_WRITE_META_DATA_INSTRUCTION_LEN
+ \

52 
OFU_GOTO_TABLE_INSTRUCTION_LEN
 \

53 

	)

54 
t32_t
 
tsc_olug_v1_3_
(
ut64_t
 
doma_hd
);

	@include/tsc_ofv1_3_plugin.h

23 
	~"of_uts.h
"

25 
t32_t
 
tsc_add_bs_to_doma
(
ut64_t
 
doma_hd
);

28 
t32_t
 
tsc_olug_v1_3_nd_ow_mod_assify_b_vmpts
(
ut64_t
 
dp_hd
,

29 
tsc_ofv_ug_i
* 
tsc_ms_p
,

30 
ut8_t
 
ow_mod_ݔi
);

32 
t32_t
 
tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
ut64_t
 
dp_hd
,

33 
tsc_ofv_ug_i
* 
tsc_ms_p
,

34 
ut8_t
 
ow_mod_ݔi
);

36 
t32_t
 
tsc_olug_v1_3_d_ows_om_b_3
(
ut64_t
 
dp_hd
,
ut8_t
 *
pt_maddr
);

38 
t32_t
 
tsc_nd_pktout_1_3_msg
(
ut64_t
 
dh_hd
,
ut32_t
 
_pt
,
o_ck_
 *
pkt_
);

40 
t32_t
 
tsc_e_wmod_1_3_msg_b_0
(
ut64_t
 
dp_hd
,

41 
ut16_t
 
msg_n
,

42 
ut32_t
 *
put_pt_id_p
,

43 
ut8_t
 
pkt_ty
,

44 
ut16_t
 *
vn_id_p
,

45 
ut8_t
 
vn_mask_q
,

46 
ut16_t
 *
vn_id_mask_p
,

47 
ut64_t
 
mada
,

48 
ut64_t
 
mada_mask
,

49 
ut8_t
 
go_b_id


52 
t32_t
 
tsc_add_wmod_1_3_msg_b_1
(
ut64_t
 
dp_hd
,
nscha_posy_y
* 
out_bound_nscha_posy_y_p
);

53 
t32_t
 
tsc_add_wmod_1_3_msg_b_2
(
ut64_t
 
dp_hd
,
nscha_posy_y
* 
_bound_nscha_posy_y_p
);

54 
t32_t
 
tsc_add_wmod_1_3_msg_b_3
(
ut64_t
 
dp_hd
,
upkt_out_posy_y
* 
upkt_out_posy_y_p
);

55 
t32_t
 
tsc_add_wmod_1_3_msg_b_4
(
ut64_t
 
dp_hd
,
vmpts_posy_y
* 
vmpts_posy_y_p
,

56 
nwpts_brd_posy_y
* 
nwpts_brd_posy_y_p
);

57 
t32_t
 
tsc_add_wmod_1_3_msg_b_5
(
ut64_t
 
dp_hd
,
vmpts_posy_y
* 
vmpts_posy_y_p
);

59 
t32_t


60 
tsc_olug_v1_3_b_0_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

61 
ut64_t
 
doma_hd
,

62 
ut64_t
 
dh_hd
,

63 
of_msg
 *
msg
,

64 
o_ck_
 *
pkt_
,

65 * 
cbk_g1
,

66 * 
cbk_g2
);

69 
t32_t


70 
tsc_olug_v1_3_b_1_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

71 
ut64_t
 
doma_hd
,

72 
ut64_t
 
dh_hd
,

73 
of_msg
 *
msg
,

74 
o_ck_
 *
pkt_
,

75 * 
cbk_g1
,

76 * 
cbk_g2
);

78 
t32_t


79 
tsc_olug_v1_3_nscha_b_1_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

80 
ut64_t
 
doma_hd
,

81 
ut64_t
 
dh_hd
,

82 
of_msg
 *
msg
,

83 
o_ow_moved
 *
ow
,

84 * 
cbk_g1
,

85 * 
cbk_g2
);

86 
t32_t


87 
tsc_olug_v1_3_b_2_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

88 
ut64_t
 
doma_hd
,

89 
ut64_t
 
dh_hd
,

90 
of_msg
 *
msg
,

91 
o_ck_
 *
pkt_
,

92 * 
cbk_g1
,

93 * 
cbk_g2
);

96 
t32_t


97 
tsc_olug_v1_3_nscha_b_2_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

98 
ut64_t
 
doma_hd
,

99 
ut64_t
 
dh_hd
,

100 
of_msg
 *
msg
,

101 
o_ow_moved
 *
ow
,

102 * 
cbk_g1
,

103 * 
cbk_g2
);

105 
t32_t


106 
tsc_olug_v1_3_b_3_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

107 
ut64_t
 
doma_hd
,

108 
ut64_t
 
dh_hd
,

109 
of_msg
 *
msg
,

110 
o_ck_
 *
pkt_
,

111 * 
cbk_g1
,

112 * 
cbk_g2
);

114 
t32_t


115 
tsc_olug_v1_3_fc_b_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

116 
ut64_t
 
doma_hd
,

117 
ut64_t
 
dh_hd
,

118 
of_msg
 *
msg
,

119 
o_ow_moved
 *
ow
,

120 * 
cbk_g1
,

121 * 
cbk_g2
);

123 
t32_t


124 
tsc_olug_v1_3_b_4_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

125 
ut64_t
 
doma_hd
,

126 
ut64_t
 
dh_hd
,

127 
of_msg
 *
msg
,

128 
o_ck_
 *
pkt_
,

129 * 
cbk_g1
,

130 * 
cbk_g2
);

132 
t32_t


133 
tsc_olug_v1_3_b_5_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

134 
ut64_t
 
doma_hd
,

135 
ut64_t
 
dh_hd
,

136 
of_msg
 *
msg
,

137 
o_ck_
 *
pkt_
,

138 * 
cbk_g1
,

139 * 
cbk_g2
);

140 
t32_t


141 
tsc_olug_v1_3_b_6_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

142 
ut64_t
 
doma_hd
,

143 
ut64_t
 
dh_hd
,

144 
of_msg
 *
msg
,

145 
o_ck_
 *
pkt_
,

146 * 
cbk_g1
,

147 * 
cbk_g2
);

149 
t32_t


150 
tsc_olug_v1_3_dp_ady_evt
(
ut64_t
 
cڌr_hd
,

151 
ut64_t
 
doma_hd
,

152 
ut64_t
 
dh_hd
,

153 * 
cbk_g1
,

154 * 
cbk_g2
);

157 
t32_t


158 
tsc_olug_v1_3_dp_dach_evt
(
ut64_t
 
cڌr_hd
,

159 
ut64_t
 
doma_hd
,

160 
ut64_t
 
dh_hd
,

161 *
cbk_g1
,

162 *
cbk_g2
);

165 
t32_t
 
tsc_olug_v1_3_d_ows_om_b_4_5
(
ut64_t
 
dp_hd
,

166 
tsc_ofv_ug_i
* 
tsc_ms_p
,

167 
ut8_t
 
b_id
);

169 
t32_t
 
tsc_olug_v1_3_d_ows_om_b_1_2
(
ut64_t
 
dp_hd
,
ut32_t
 *
pt_id_p
,
ut8_t
 
b_id
);

171 
t32_t
 
tsc_olug_v1_3_d_b_1_2_bd_ow_s
(
nscha_posy_y
* 
nscha_posy_node_p
,

172 
ut8_t
 
b_id
);

174 
t32_t
 
tsc_d_owmod_1_3_l_ows__a_b
(
ut64_t
 
dp_hd
,
ut8_t
 
b_id
);

	@include/tsc_vxn_views.h

26 #ide
__TSCVXNINTRVIEW_H


27 
	#__TSCVXNINTRVIEW_H


	)

29 
	#TSC_VXN_TUNNID_VIEW_OF_VN
 "vxn-vni-VN"

	)

30 
	#TSC_VXN_DSTMAC_VIEW_OF_VMPORTS
 "vxn-dmac-VMPORTS"

	)

31 
	#TSC_VXN_SWNAME_VIEW_OF_VMPORTS
 "vxn-swme-VMPORTS"

	)

32 
	#TSC_VXN_SWNAME_VIEW_OF_UNICAST_NWPORTS
 "vxn-swme-UCASTNWPORTS"

	)

33 
	#TSC_VXN_SWNAME_VIEW_OF_BROADCAST_NWPORTS
 "vxn-swme-BCASTNWPORTS"

	)

34 
	#TSC_VXN_VIEW_RESERVED
 "rved"

	)

37 
	#TSC_VXN_MAX_VIEW_NODE_ENTRIES
 64

	)

38 
	#TSC_VXN_MAX_VIEW_STATIC_NODE_ENTRIES
 16

	)

41 
	stsc_vxn_dmac_vmpt_daba_vw


43 
	mvw
[64];

44 
mchash_b
* 
	mdb_vwtbl_p
;

45 * 
	mdb_vwmempo_p
;

46 
ut32_t
 
	mno_of_vw_node_bucks_g
;

50 
	stsc_vxn_dmac_vmpt_vw_node


52 
mchash_b_lk
 
	mvw_tbl_k
;

53 
ut8_t
 
	md_mac
[6];

54 
ut32_t
 
	mnid
;

55 
ut64_t
 
	mpt_hd
;

56 
t32_t
 
	mdex
;

57 
t32_t
 
	mmagic
;

58 
ut8_t
 
	mhp_b
;

60 
	#TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
 
	`offtof
(
tsc_vxn_dmac_vmpt_vw_node
, 
vw_tbl_k
)

	)

63 
	stsc_vxn_swme_vmpt_daba_vw


65 
	mvw
[64];

66 
mchash_b
* 
	mdb_vwtbl_p
;

67 * 
	mdb_vwmempo_p
;

68 
ut32_t
 
	mno_of_vw_node_bucks_g
;

69 
ut8_t
 
	muniquess_ag
;

70 
ut8_t
 
	mvid_b
;

73 
	stsc_vxn_swme_vmpt_vw_node


75 
mchash_b_lk
 
	mvw_tbl_k
;

76 
	mswme
[64];

77 
ut32_t
 
	mnid
;

78 
ut64_t
 
	mpt_hd
;

79 
t32_t
 
	mdex
;

80 
t32_t
 
	mmagic
;

81 
ut8_t
 
	mhp_b
;

83 
	#TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
 
	`offtof
(
tsc_vxn_swme_vmpt_vw_node
, 
vw_tbl_k
)

	)

86 
	stsc_vxn_swme_uni_nwpt_daba_vw


88 
	mvw
[64];

89 
mchash_b
* 
	mdb_vwtbl_p
;

90 * 
	mdb_vwmempo_p
;

91 
ut32_t
 
	mno_of_vw_node_bucks_g
;

92 
ut8_t
 
	muniquess_ag
;

93 
ut8_t
 
	mvid_b
;

96 
	stsc_vxn_swme_uni_nwpt_vw_node


98 
mchash_b_lk
 
	mvw_tbl_k
;

99 
	mswme
[64];

100 
ut16_t
 
	mrvi_pt
;

101 
ut64_t
 
	mpt_hd
;

102 
t32_t
 
	mdex
;

103 
t32_t
 
	mmagic
;

104 
ut8_t
 
	mhp_b
;

106 
	#TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
 
	`offtof
(
tsc_vxn_swme_uni_nwpt_vw_node
, 
vw_tbl_k
)

	)

109 
	stsc_vxn_swme_brd_nwpt_daba_vw


111 
	mvw
[64];

112 
mchash_b
* 
	mdb_vwtbl_p
;

113 * 
	mdb_vwmempo_p
;

114 
ut32_t
 
	mno_of_vw_node_bucks_g
;

115 
ut8_t
 
	muniquess_ag
;

116 
ut8_t
 
	mvid_b
;

118 
	stsc_vxn_swme_brd_nwpt_vw_node


120 
mchash_b_lk
 
	mvw_tbl_k
;

121 
	mswme
[64];

122 
ut16_t
 
	mrvipt
;

123 
ut32_t
 
	mme_
;

124 
ut32_t
 
	mnid
;

125 
ut64_t
 
	mpt_hd
;

126 
t32_t
 
	mdex
;

127 
t32_t
 
	mmagic
;

128 
ut8_t
 
	mhp_b
;

130 
	#TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
 
	`offtof
(
tsc_vxn_swme_brd_nwpt_vw_node
, 
vw_tbl_k
)

	)

132 
	stsc_vxn_nid_vn_daba_vw


134 
	mvw
[64];

135 
mchash_b
 *
	mdb_vwtbl_p
;

136 * 
	mdb_vwmempo_p
;

137 
ut32_t
 
	mno_of_vw_node_bucks_g
;

138 
ut8_t
 
	muniquess_ag
;

139 
ut8_t
 
	mvid_b
;

142 
	stsc_vxn_nid_vn_vw_node


144 
mchash_b_lk
 
	mvw_tbl_k
;

145 
ut32_t
 
	mnid
;

146 
ut64_t
 
	mvn_hd
;

147 
t32_t
 
	mdex
;

148 
t32_t
 
	mmagic
;

149 
ut8_t
 
	mhp_b
;

151 
	#TSC_VXN_TUNID_VN_VIEW_NODE_TBL_OFFSET
 
	`offtof
(
tsc_vxn_nid_vn_vw_node
, 
vw_tbl_k
)

	)

153 
	#RCUNODE_OFFSET_IN_MCHASH_TBLLNK
 
	`offtof

mchash_b_lk
, 
rcu_hd
)

	)

156 
tsc_vxn_g_vw_node_mempoޒs
(
ut32_t
* 
vw_node_s_max
,ut32_t* 
vw_node_ic_s
);

158 
t32_t
 
tsc_vxn_vmpt_ptmac_vw_
(*
vw_me_p
);

159 
t32_t
 
tsc_vxn_vmpt_ptmac_vw_un
();

160 
t32_t
 
tsc_vxn_add_vmpt_to_ptmac_vw
(
ut64_t
 
m_pt_hd
,
ut32_t
 
nid
);

161 
t32_t
 
tsc_vxn_d_vmpt_om_ptmac_vw
(
ut64_t
 
m_pt_hd
, 
ut32_t
 
nid
);

162 
t32_t
 
tsc_vxn_g_vmpt_by_dmac_nid
(
ut8_t
* 
d_mac_p
, 
ut32_t
 
nid
, 
ut64_t
* 
m_pt_hd_p
);

164 
t32_t
 
tsc_vxn_vmpt_swme_vw_
(*
vw_me_p
);

165 
t32_t
 
tsc_vxn_vmpt_swme_vw_un
();

166 
t32_t
 
tsc_vxn_add_vmpt_to_swme_vw
(
ut64_t
 
m_pt_hd
, 
ut32_t
 
nid
);

167 
t32_t
 
tsc_vxn_d_vmpt_om_swme_vw
(
ut64_t
 
m_pt_hd
,
ut32_t
 
nid
);

168 
t32_t
 
tsc_vxn_g_vmpts_by_swme_nid
(*
swch_me_p
,
ut32_t
 
nid
,ut32_t* 
no_of_vmside_pts_p
,ut32_t* 
vmside_pts_p
);

170 
t32_t
 
tsc_vxn_uni_nwpt_swme_vw_
(*
vw_me_p
);

171 
t32_t
 
tsc_vxn_uni_nwpt_swme_vw_un
();

172 
t32_t
 
tsc_vxn_add_uni_nwpt_to_swme_vw
(
ut64_t
 
m_pt_hd
, 
ut16_t
 
rvi_pt
);

173 
t32_t
 
tsc_vxn_d_uni_nwpt_om_swme_vw
(
ut64_t
 
m_pt_hd
,
ut16_t
 
rvi_pt
);

174 
t32_t
 
tsc_vxn_g_uni_nwpt_by_swme_
(* 
swch_me_p
, 
ut16_t
 
rvipt
, 
ut32_t
* 
out_pt_no_p
);

176 
t32_t
 
tsc_vxn_brd_nwpt_swme_vw_
(*
vw_me_p
);

177 
t32_t
 
tsc_vxn_brd_nwpt_swme_vw_un
();

178 
t32_t
 
tsc_vxn_add_brd_nwpt_to_swme_vw
(
ut64_t
 
m_pt_hd
,
ut16_t
 
rvi_pt
,
ut32_t
 
nid
,ut32_
me_
);

179 
t32_t
 
tsc_vxn_d_brd_nwpt_om_swme_vw
(
ut64_t
 
m_pt_hd
,
ut16_t
 
rvi_pt
,
ut32_t
 
nid
,ut32_
me_
);

180 
t32_t
 
tsc_vxn_g_me_s_by_swme_nid_
(* 
swch_me_p
,
ut32_t
 
rvi_pt
,ut32_
nid
,ut32_t* 
no_of_me_s_p
,ut32_t* 
me_s_p
);

182 
t32_t
 
tsc_vxn_g_brd_nwpts_by_swme_nid_
(* 
swch_me_p
,
ut32_t
 
rvi_pt
,ut32_
nid
,ut32_t* 
no_of_nwside_br_pts_p
, ut32_t* 
nwside_br_pts_p
,ut32_
me_
);

184 
t32_t
 
tsc_vxn_vn_nid_vw_
(*
vw_me_p
);

185 
t32_t
 
tsc_vxn_vn_nid_vw_un
();

186 
t32_t
 
tsc_vxn_add_vn_to_nid_vw
(
ut64_t
 
m_vn_hd
,
ut32_t
 
nid
);

187 
t32_t
 
tsc_vxn_de_vn_om_nid_vw
(
ut64_t
 
m_vn_hd
, 
ut32_t
 
nid
);

188 
t32_t
 
tsc_vxn_g_vnhd_by_nid
(
ut32_t
 
nid
,
ut64_t
* 
vn_hd_p
);

190 
tsc_vxn_dmac_vmpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
);

191 
tsc_vxn_swme_vmpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
);

192 
tsc_vxn_swme_uni_nwpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
);

193 
tsc_vxn_swme_brd_nwpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
);

194 
tsc_vxn_nid_vn__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
);

196 
ut32_t
 
tsc_vxn_g_hashv_bymac
(
ut8_t
 *
mac_p
,ut32_
no_of_bucks
);

197 
ut32_t
 
tsc_vxn_g_hashv_byme
(* 
me_p
,ut32_
no_of_bucks
);

198 
ut32_t
 
tsc_vxn_g_hashv_by_nid
(ut32_
nid
,ut32_
no_of_bucks
);

	@list_repository.c

1 
	~"cڌr.h
"

2 
	~"dm.h
"

3 
	~"nm.h
"

4 
	~"mi.h
"

5 
	~"m_vn_i.h
"

6 
	~"nmldef.h
"

7 
	~"r_l.h
"

8 
	~"l_queue.h
"

9 
	~"of_uts.h
"

10 
	~"of_msgi.h
"

11 
	~"of_muɝt.h
"

12 
	~"r_s.h
"

13 
	~"r_.h
"

14 
	~"r_evt.h
"

15 
	~"dmldef.h
"

16 
	~"of_vw.h
"

17 
	~"tsc_i.h
"

18 
	~"tsc_cڌr.h
"

20 
mchash_b
 *
	gnsc_posy_b_g
 = 
NULL
;

22 
nsc_posy_key
 *
	gglob_posy_key_p
 = 
NULL
;

24 
mchash_b
 *
	gnsc_b_3_posy_b_g
 = 
NULL
;

26 
nsc_posy_key
 *
	gglob_b_3_posy_key_p
 = 
NULL
;

28 
t32_t
 
	gag_1_2
 = 0;

29 
t32_t
 
	gag_3
 = 0;

31 
t32_t
 
	$nsc_add_posy_y
(
nsc_posy_key
 *
key
)

33 
glob_posy_key_p
 = 
key
;

34 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Addinghe KEYemporarilyo scanhe database");

35 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nwm: %s",
glob_posy_key_p
->
vn_me
);

37  
TSC_SUCCESS
;

38 
	}
}

42 
t32_t
 
	$nsc_g_f_posy_y
(
nsc_posy_key
 *
key
 ,
ut64_t
 *
mch_f
, 
nsc_posy_y
 *
nsc_posy_y_p
)

44 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

45 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

46 
nscha_posy_y
 *
nsc_posy_sn_node_p
 = 
NULL
;

48 
ut64_t
 
hashkey
,
vn_hd
;

49 
ut32_t
 
offt
;

50 
t32_t
 
tv
;

52 
key
 = 
glob_posy_key_p
;

54 
tv
 = 
	`m_g_vn_hd
(
key
->
vn_me
,&
vn_hd
);

55 if(
tv
 !
NSRM_SUCCESS
)

57 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

58  
TSC_FAILURE
;

61 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

62 if(
tv
 !
NSRM_SUCCESS
)

64 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

65  
TSC_FAILURE
;

68 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

69 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"b id ikey :%d",
key
->
b_id
);

70 if(
key
->
b_id
 == 1)

72 
nsc_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

74 if(
key
->
b_id
 == 2)

76 
nsc_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

80 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidable ID");

81  
TSC_FAILURE
;

83 if(
nsc_posy_b_g
 =
NULL
)

85 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Nontries inableepository");

86  
TSC_FAILURE
;

89 
offt
 = 0;

90 
	`CNTLR_RCU_READ_LOCK_TAKE
();

91 
	`MCHASH_TABLE_SCAN
(
nsc_posy_b_g
,
hashkey
)

93 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_g
,
hashkey
,
nsc_posy_sn_node_p
,

94 
nscha_posy_y
*,
offt
)

96 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_swch_m: %s",
nsc_posy_sn_node_p
->
lol_swch_me_p
);

97 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
 , 
nsc_posy_sn_node_p
->local_switch_name_p);

98 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_swch_m: %s",
nsc_posy_y_p
->
lol_swch_me_p
);

99 
nsc_posy_y_p
->
dp_hd
 = 
nsc_posy_sn_node_p
->dp_handle;

100 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"dphd : %x",
nsc_posy_sn_node_p
->
dp_hd
);

101 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"dphd : %x",
nsc_posy_y_p
->
dp_hd
);

102 
nsc_posy_y_p
->
nid
 = 
nsc_posy_sn_node_p
->nid;

103 
nsc_posy_y_p
->
rvipt
 = 
nsc_posy_sn_node_p
->serviceport;

104 
nsc_posy_y_p
->
me_swch_
 = 
nsc_posy_sn_node_p
->remote_switch_ip;

105 
nsc_posy_y_p
->
_pt_id
 = 
nsc_posy_sn_node_p
->in_port_id;

106 
nsc_posy_y_p
->
ns_cha_b
 = 
nsc_posy_sn_node_p
->ns_chain_b;

107 
nsc_posy_y_p
->
me_nf_b
 = 
nsc_posy_sn_node_p
->more_nf_b;

108 
nsc_posy_y_p
->
vn_id_pkt
 = 
nsc_posy_sn_node_p
->vlan_id_pkt;

109 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vk: %d",
nsc_posy_sn_node_p
->
vn_id_pkt
);

110 
nsc_posy_y_p
->
mch_vn_id
 = 
nsc_posy_sn_node_p
->match_vlan_id;

112 
nsc_posy_y_p
->
mch_vn_id
 = (nsc_repository_entry_p->match_vlan_id & 0x0fff);

114 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vmch : %d",
nsc_posy_y_p
->
mch_vn_id
);

115 
nsc_posy_y_p
->
xt_vn_id
 = 
nsc_posy_sn_node_p
->next_vlan_id;

116 
nsc_posy_y_p
->
xt_vn_id
 = (nsc_repository_entry_p->next_vlan_id & 0x0fff);

117 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xv: %d",
nsc_posy_y_p
->
xt_vn_id
);

118 
nsc_posy_y_p
->
nw_pt_b
 = 
nsc_posy_sn_node_p
->nw_port_b;

119 
nsc_posy_y_p
->
out_pt_no
 = 
nsc_posy_sn_node_p
->out_port_no;

120 
nsc_posy_y_p
->
xt_b_id
 = 
nsc_posy_sn_node_p
->next_table_id;

121 
	`memy
(
nsc_posy_y_p
->
lol__mac
, 
nsc_posy_sn_node_p
->local_in_mac , 6);

122 
	`memy
(
nsc_posy_y_p
->
lol_out_mac
, 
nsc_posy_sn_node_p
->local_out_mac ,6);

123 
nsc_posy_y_p
->
c_mac_high
 = 
nsc_posy_sn_node_p
->

.src_mac_high;

124 
nsc_posy_y_p
->
c_mac_low
 = 
nsc_posy_sn_node_p
->

.src_mac_low;

125 
nsc_posy_y_p
->
d_mac_high
 = 
nsc_posy_sn_node_p
->

.dst_mac_high;

126 
nsc_posy_y_p
->
d_mac_low
 = 
nsc_posy_sn_node_p
->

.dst_mac_low;

127 
	`memy
(
nsc_posy_y_p
->
c_mac
,
nsc_posy_sn_node_p
->

.src_mac ,6);

128 
	`memy
(
nsc_posy_y_p
->
d_mac
,
nsc_posy_sn_node_p
->

.dst_mac ,6);

129 
nsc_posy_y_p
->
ht_ty
 = 
nsc_posy_sn_node_p
->

.ethernet_type;

130 
nsc_posy_y_p
->
oc
 = 
nsc_posy_sn_node_p
->

.protocol;

131 
nsc_posy_y_p
->
c_pt
 = 
nsc_posy_sn_node_p
->

.src_port;

132 
nsc_posy_y_p
->
d_pt
 = 
nsc_posy_sn_node_p
->

.dst_port;

133 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"dp܈: %d",
nsc_posy_sn_node_p
->

.
d_pt
);

134 
nsc_posy_y_p
->
c_
 = 
nsc_posy_sn_node_p
->

.src_ip;

135 
nsc_posy_y_p
->
d_
 = 
nsc_posy_sn_node_p
->

.dst_ip;

137 
nsc_posy_y_p
->
_n
 = 
nsc_posy_sn_node_p
->safe_reference;

139 *
mch_f
 = 
nsc_posy_sn_node_p
->
_n
;

141 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_b_id = %d",
nsc_posy_sn_node_p
->
xt_b_id
);

142 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_swch_m: %s",
nsc_posy_y_p
->
lol_swch_me_p
);

143 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successful");

144 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

145  
TSC_SUCCESS
;

148 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

149  
TSC_FAILURE
;

150 
	}
}

152 
t32_t
 
	$nsc_g_xt_posy_y
(
nsc_posy_key
 *
key
 ,
ut64_t
 
tive_f
,ut64_*
xt_f
, 
nsc_posy_y
 *
nsc_posy_y_p
)

154 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

155 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

156 
nscha_posy_y
 *
nsc_posy_sn_node_p
 = 
NULL
;

158 
ut64_t
 
hashkey
,
vn_hd
;

159 
ut8_t
 
node_found_b
 = 
FALSE
 , 
tive_node_found
 = FALSE;

160 
ut32_t
 
offt
;

161 
t32_t
 
tv
;

163 
key
 = 
glob_posy_key_p
;

165 
tv
 = 
	`m_g_vn_hd
(
key
->
vn_me
,&
vn_hd
);

166 if(
tv
 !
NSRM_SUCCESS
)

168 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

169  
TSC_FAILURE
;

172 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

173 if(
tv
 !
NSRM_SUCCESS
)

175 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

176  
TSC_FAILURE
;

179 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

181 if(
key
->
b_id
 == 1)

183 
nsc_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

185 if(
key
->
b_id
 == 2)

187 
nsc_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

191 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidable ID");

192  
TSC_FAILURE
;

195 if(
nsc_posy_b_g
 =
NULL
)

197 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Nontries inable 1epository");

198  
TSC_FAILURE
;

201 
offt
 = 0;

202 
	`CNTLR_RCU_READ_LOCK_TAKE
();

203 
	`MCHASH_TABLE_SCAN
(
nsc_posy_b_g
,
hashkey
)

205 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_g
,
hashkey
,
nsc_posy_sn_node_p
,

206 
nscha_posy_y
*,
offt
)

208 if(
node_found_b
 =
FALSE
)

210 if(
nsc_posy_sn_node_p
->
_n
 =
tive_f
)

212 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"s: %x,tive_: %x",
nsc_posy_sn_node_p
->
_n
,
tive_f
);

213 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Relativeode found");

214 
node_found_b
 = 
TRUE
;

218 
tive_node_found
 = 
TRUE
;

219 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
 , 
nsc_posy_sn_node_p
->local_switch_name_p);

220 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"swcham: %s",
nsc_posy_y_p
->
lol_swch_me_p
);

221 
nsc_posy_y_p
->
dp_hd
 = 
nsc_posy_sn_node_p
->dp_handle;

222 
nsc_posy_y_p
->
nid
 = 
nsc_posy_sn_node_p
->nid;

223 
nsc_posy_y_p
->
rvipt
 = 
nsc_posy_sn_node_p
->serviceport;

224 
nsc_posy_y_p
->
me_swch_
 = 
nsc_posy_sn_node_p
->remote_switch_ip;

225 
nsc_posy_y_p
->
_pt_id
 = 
nsc_posy_sn_node_p
->in_port_id;

226 
nsc_posy_y_p
->
ns_cha_b
 = 
nsc_posy_sn_node_p
->ns_chain_b;

227 
nsc_posy_y_p
->
me_nf_b
 = 
nsc_posy_sn_node_p
->more_nf_b;

228 
nsc_posy_y_p
->
vn_id_pkt
 = 
nsc_posy_sn_node_p
->vlan_id_pkt;

229 
nsc_posy_y_p
->
mch_vn_id
 = 
nsc_posy_sn_node_p
->match_vlan_id;

231 
nsc_posy_y_p
->
mch_vn_id
 = (nsc_repository_entry_p->match_vlan_id & 0x0fff);

232 
nsc_posy_y_p
->
xt_vn_id
 = 
nsc_posy_sn_node_p
->next_vlan_id;

234 
nsc_posy_y_p
->
xt_vn_id
 = (nsc_repository_entry_p->next_vlan_id & 0x0fff);

236 
nsc_posy_y_p
->
nw_pt_b
 = 
nsc_posy_sn_node_p
->nw_port_b;

237 
nsc_posy_y_p
->
out_pt_no
 = 
nsc_posy_sn_node_p
->out_port_no;

238 
nsc_posy_y_p
->
xt_b_id
 = 
nsc_posy_sn_node_p
->next_table_id;

239 
	`memy
(
nsc_posy_y_p
->
lol__mac
,
nsc_posy_sn_node_p
->local_in_mac , 6);

240 
	`memy
(
nsc_posy_y_p
->
lol_out_mac
,
nsc_posy_sn_node_p
->local_out_mac ,6);

241 
nsc_posy_y_p
->
c_mac_high
 = 
nsc_posy_sn_node_p
->

.src_mac_high;

242 
nsc_posy_y_p
->
c_mac_low
 = 
nsc_posy_sn_node_p
->

.src_mac_low;

243 
nsc_posy_y_p
->
d_mac_high
 = 
nsc_posy_sn_node_p
->

.dst_mac_high;

244 
nsc_posy_y_p
->
d_mac_low
 = 
nsc_posy_sn_node_p
->

.dst_mac_low;

245 
	`memy
(
nsc_posy_y_p
->
c_mac
,
nsc_posy_sn_node_p
->

.src_mac ,6);

246 
	`memy
(
nsc_posy_y_p
->
d_mac
,
nsc_posy_sn_node_p
->

.dst_mac ,6);

247 
nsc_posy_y_p
->
ht_ty
 = 
nsc_posy_sn_node_p
->

.ethernet_type;

248 
nsc_posy_y_p
->
oc
 = 
nsc_posy_sn_node_p
->

.protocol;

249 
nsc_posy_y_p
->
c_pt
 = 
nsc_posy_sn_node_p
->

.src_port;

250 
nsc_posy_y_p
->
d_pt
 = 
nsc_posy_sn_node_p
->

.dst_port;

251 
nsc_posy_y_p
->
c_
 = 
nsc_posy_sn_node_p
->

.src_ip;

252 
nsc_posy_y_p
->
d_
 = 
nsc_posy_sn_node_p
->

.dst_ip;

254 
nsc_posy_y_p
->
_n
 = 
nsc_posy_sn_node_p
->safe_reference;

256 *
xt_f
 = 
nsc_posy_sn_node_p
->
_n
;

257 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_b_id = %d",
nsc_posy_sn_node_p
->
xt_b_id
);

260 if(
node_found_b
 =
TRUE
 && 
tive_node_found
 == TRUE)

263 if(
node_found_b
 =
FALSE
 || 
tive_node_found
 == FALSE)

265 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noepository found oreachedast bucket");

266 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

267  
TSC_FAILURE
;

269 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Getextecord successful ! ");

270 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

271  
TSC_SUCCESS
;

272 
	}
}

275 
t32_t
 
	$nsc_g_exa_posy_y
()

278 if(
ag_1_2
 == 0)

280 
ag_1_2
++;

281  
TSC_FAILURE
;

284  
TSC_SUCCESS
;

285 
	}
}

288 
t32_t
 
	$nsc_add_b_3_posy_y
(
nsc_posy_key
 *
key
)

290 
glob_b_3_posy_key_p
 = 
key
;

291 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Addinghe KEYemporarilyo scanhe database");

292 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nwm: %s",
glob_b_3_posy_key_p
->
vn_me
);

294  
TSC_SUCCESS
;

295 
	}
}

298 
t32_t
 
	$nsc_g_f_b_3_posy_y
(
nsc_posy_key
 *
key
 ,

299 
ut64_t
 *
node_f
,

300 
upkt_posy_y
 *
nsc_posy_y_p
)

302 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

303 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

304 
upkt_out_posy_y
 *
nsc_posy_sn_node_p
 = 
NULL
;

306 
ut64_t
 
hashkey
,
vn_hd
;

307 
ut32_t
 
offt
;

308 
t32_t
 
tv
;

310 
key
 = 
glob_b_3_posy_key_p
;

312 
tv
 = 
	`m_g_vn_hd
(
key
->
vn_me
,&
vn_hd
);

313 if(
tv
 !
NSRM_SUCCESS
)

315 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

316  
TSC_FAILURE
;

319 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

320 if(
tv
 !
NSRM_SUCCESS
)

322 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

323  
TSC_FAILURE
;

326 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

328 
nsc_b_3_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

329 if(
nsc_b_3_posy_b_g
 =
NULL
)

331 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Nontries inable 3epository");

332  
TSC_FAILURE
;

335 
offt
 = 0;

336 
	`CNTLR_RCU_READ_LOCK_TAKE
();

337 
	`MCHASH_TABLE_SCAN
(
nsc_b_3_posy_b_g
,
hashkey
)

339 
	`MCHASH_BUCKET_SCAN
(
nsc_b_3_posy_b_g
,
hashkey
,
nsc_posy_sn_node_p
,

340 
upkt_out_posy_y
*,
offt
)

343 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
 , 
nsc_posy_sn_node_p
->local_switch_name_p);

345 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"loswch : %s",
nsc_posy_y_p
->
lol_swch_me_p
);

346 
	`ry
(
nsc_posy_y_p
->
me_swch_me_p
 , 
nsc_posy_sn_node_p
->remote_switch_name_p);

347 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mِswch : %s",
nsc_posy_y_p
->
me_swch_me_p
);

348 
nsc_posy_y_p
->
dp_hd
 = 
nsc_posy_sn_node_p
->dp_handle;

349 
nsc_posy_y_p
->
nid
 = 
nsc_posy_sn_node_p
->nid;

350 
nsc_posy_y_p
->
pt_ty
 = 
nsc_posy_sn_node_p
->port_type;

351 
nsc_posy_y_p
->
rvipt
 = 
nsc_posy_sn_node_p
->serviceport;

352 
nsc_posy_y_p
->
tun_de_
 = 
nsc_posy_sn_node_p
->tun_dest_ip;

353 
nsc_posy_y_p
->
nw_pt_b
 = 
nsc_posy_sn_node_p
->nw_port_b;

354 
nsc_posy_y_p
->
out_pt_no
 = 
nsc_posy_sn_node_p
->out_port_no;

355 
	`memy
(
nsc_posy_y_p
->
d_mac
,
nsc_posy_sn_node_p
->dst_mac ,6);

357 
nsc_posy_y_p
->
_n
 = 
nsc_posy_sn_node_p
->safe_reference;

359 *
node_f
 = 
nsc_posy_sn_node_p
->
_n
;

360 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

361  
TSC_SUCCESS
;

364 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

365  
TSC_FAILURE
;

366 
	}
}

368 
t32_t
 
	$nsc_g_xt_b_3_posy_y
(
nsc_posy_key
 *
key
 ,
ut64_t
 
tive_f
, ut64_*
mch_f
,

369 
upkt_posy_y
 *
nsc_posy_y_p
)

371 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

372 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

373 
upkt_out_posy_y
 *
nsc_posy_sn_node_p
 = 
NULL
;

375 
ut64_t
 
hashkey
,
vn_hd
;

376 
ut8_t
 
node_found_b
 = 
FALSE
 , 
tive_node_found
 = FALSE;

377 
ut32_t
 
offt
;

378 
t32_t
 
tv
;

380 
key
 = 
glob_b_3_posy_key_p
;

382 
tv
 = 
	`m_g_vn_hd
(
key
->
vn_me
,&
vn_hd
);

383 if(
tv
 !
NSRM_SUCCESS
)

385 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

386  
TSC_FAILURE
;

389 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

390 if(
tv
 !
NSRM_SUCCESS
)

392 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

393  
TSC_FAILURE
;

396 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

398 
nsc_b_3_posy_b_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

400 if(
nsc_b_3_posy_b_g
 =
NULL
)

402 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Nontries inable 1epository");

403  
TSC_FAILURE
;

406 
offt
 = 0;

407 
	`CNTLR_RCU_READ_LOCK_TAKE
();

408 
	`MCHASH_TABLE_SCAN
(
nsc_b_3_posy_b_g
,
hashkey
)

410 
	`MCHASH_BUCKET_SCAN
(
nsc_b_3_posy_b_g
,
hashkey
,
nsc_posy_sn_node_p
,

411 
upkt_out_posy_y
*,
offt
)

413 if(
node_found_b
 =
FALSE
)

415 if(
nsc_posy_sn_node_p
->
_n
 =
tive_f
)

417 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Relativeode found");

418 
node_found_b
 = 
TRUE
;

422 
tive_node_found
 = 
TRUE
;

423 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
 , 
nsc_posy_sn_node_p
->local_switch_name_p);

424 
	`ry
(
nsc_posy_y_p
->
me_swch_me_p
 , 
nsc_posy_sn_node_p
->remote_switch_name_p);

425 
nsc_posy_y_p
->
dp_hd
 = 
nsc_posy_sn_node_p
->dp_handle;

426 
nsc_posy_y_p
->
nid
 = 
nsc_posy_sn_node_p
->nid;

427 
nsc_posy_y_p
->
pt_ty
 = 
nsc_posy_sn_node_p
->port_type;

428 
nsc_posy_y_p
->
rvipt
 = 
nsc_posy_sn_node_p
->serviceport;

429 
nsc_posy_y_p
->
tun_de_
 = 
nsc_posy_sn_node_p
->tun_dest_ip;

430 
nsc_posy_y_p
->
nw_pt_b
 = 
nsc_posy_sn_node_p
->nw_port_b;

431 
nsc_posy_y_p
->
out_pt_no
 = 
nsc_posy_sn_node_p
->out_port_no;

432 
	`memy
(
nsc_posy_y_p
->
d_mac
,
nsc_posy_sn_node_p
->dst_mac ,6);

434 
nsc_posy_y_p
->
_n
 = 
nsc_posy_sn_node_p
->safe_reference;

435 *
mch_f
 = 
nsc_posy_sn_node_p
->
_n
;

438 if(
node_found_b
 =
TRUE
 && 
tive_node_found
 == TRUE)

441 if(
node_found_b
 =
FALSE
 || 
tive_node_found
 == FALSE)

443 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noepository found oreachedast bucket");

444 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

445  
TSC_FAILURE
;

447 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Getextecord successful ! ");

448 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

449  
TSC_SUCCESS
;

450 
	}
}

453 
t32_t
 
	$nsc_g_exa_b_3_posy_y
()

456 if(
ag_3
 == 0)

458 
ag_3
++;

459  
TSC_FAILURE
;

462  
TSC_SUCCESS
;

463 
	}
}

	@list_selectors.c

1 
	~"cڌr.h
"

2 
	~"dm.h
"

3 
	~"nm.h
"

4 
	~"mi.h
"

5 
	~"m_vn_i.h
"

6 
	~"nmldef.h
"

7 
	~"r_l.h
"

8 
	~"l_queue.h
"

9 
	~"of_uts.h
"

10 
	~"of_msgi.h
"

11 
	~"of_muɝt.h
"

12 
	~"r_s.h
"

13 
	~"r_.h
"

14 
	~"r_evt.h
"

15 
	~"dmldef.h
"

16 
	~"of_vw.h
"

17 
	~"tsc_i.h
"

18 
	~"tsc_nsc_ce.h
"

21 *
	gtsc_nwrvis_mempo_g
;

24 
	$bd_y_fo__y_rcu
(
rcu_hd
 *
li_y_p
)

26 
tsc_nwrvis
 *
p_fo_p
=
NULL
;

28 
t32_t
 
t_v
;

29 if(
li_y_p
)

31 
p_fo_p
 = (
tsc_nwrvis
 *)(((*)
li_y_p
 - (
of_li_node_t
)));

33 
t_v
 = 
	`mempo_a_mem_block
(
tsc_nwrvis_mempo_g
,

34 (
uch8_t
*)
p_fo_p
,p_fo_p->
hp_b
);

35 if(
t_v
 !
MEMPOOL_SUCCESS
)

37 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedoelease memory block.");

41 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Released memory block fromhe memoryool.");

46 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Nu΃ryػa",
__FUNCTION__
,
__LINE__
);

49  
TSC_SUCCESS
;

50 
	}
}

53 
mchash_b
 *
	gl2_ci_to_nsfo_bd_b_p
;

54 
mempo_ms
 
	gmempo_fo
={};

56 
nsc__node_key
 *
	g_key_p
 = 
NULL
;

57 
t32_t
 
	gag
 = 0;

59 
t32_t
 
	$tsc_add__key
(
nsc__node_key
 *
_key
)

61 
_key_p
 = 
_key
;

62 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Addinghe KEYemporarilyo scanhe database");

63 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nwm: %s",
_key_p
->
vn_me
);

65  
TSC_SUCCESS
;

66 
	}
}

68 
t32_t
 
	$tsc_g_f_mchg_bd_y
(
nsc__node_key
 *
_key
,

69 
ut64_t
 *
mched_node_f
,

70 
tsc_bd_y_fo
 *
bd_y_fo_p
)

72 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

73 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

74 
nsc__node
 *
_node_sn_p
 = 
NULL
;

75 
tsc_nwrvis
 *
tsc_nwrvis_p
 = 
NULL
;

76 
nm_nschat_obje
 *
nschat_obje_p
 = 
NULL
;

77 
nm_nscha_obje
 *
nscha_obje_p
 = 
NULL
;

78 
nm_nwrvi_obje
 *
nwrvi_obje_p
 = 
NULL
;

79 
nwrvi_
 *
nwrvi__p
 = 
NULL
;

81 
ut64_t
 
hashkey
,
node_f
,
ch_hd
,
vn_hd
;

82 
ut32_t
 
offt
;

83 
t32_t
 
ii
,
tv
;

84 
ut8_t
 
node_found_b
 = 
FALSE
 ,
hp_b
;

86 
_key
 = 
_key_p
;

88 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vm : %s",
_key
->
vn_me
);

89 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vm : %s",
_key_p
->
vn_me
);

90 
tv
 = 
	`m_g_vn_hd
(
_key
->
vn_me
,&
vn_hd
);

91 if(
tv
 !
NSRM_SUCCESS
)

93 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

94  
TSC_FAILURE
;

97 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

98 if(
tv
 !
NSRM_SUCCESS
)

100 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

101  
TSC_FAILURE
;

104 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vmfound : %s",
vn_y_p
->
nw_me
);

106 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

108 
l2_ci_to_nsfo_bd_b_p
 = 
vn_nsc_fo_p
->l2_connection_to_nsinfo_bind_table_p;

110 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

111 
mempo_fo
.
block_size
 = (
tsc_nwrvis
);

112 
mempo_fo
.
max_blocks
 = 64;

113 
mempo_fo
.
ic_blocks
 = 16;

114 
mempo_fo
.
thshd_m
 = 16/10;

115 
mempo_fo
.
thshd_max
 = 16/3;

116 
mempo_fo
.
ish_cou
 = 16/10;

117 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

118 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

119 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

121 
tv
 = 
	`mempo__po
("tsc_nwrvis_mempo", &
mempo_fo
,

122 &
tsc_nwrvis_mempo_g
 );

123 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"after mempool_create_pool");

124 if(
tv
 !
MEMPOOL_SUCCESS
)

126 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memy Po Ci faed %d", 
tv
);

127  
MEMPOOL_FAILURE
;

130 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

131 if(
l2_ci_to_nsfo_bd_b_p
 =
NULL
)

133 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Table isull");

134 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

135  
TSC_FAILURE
;

138 
	`CNTLR_RCU_READ_LOCK_TAKE
();

139 
	`MCHASH_TABLE_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
)

141 
	`MCHASH_BUCKET_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
,
_node_sn_p
,

142 
nsc__node
*,
offt
)

145 if(
_key
->
c_
 !=
ANY
 && se_key->c_ !
_node_sn_p
->src_ip)

147 if(
_key
->
d_
 !=
ANY
 && se_key->d_ !
_node_sn_p
->dst_ip)

149 if(
_key
->
d_pt
 !=
ANY
 && se_key->d_p܈!
_node_sn_p
->dst_port)

151 if(
_key
->
oc
 !=
ANY
 && se_key->oc !
_node_sn_p
->protocol)

154 
node_found_b
 = 
TRUE
;

157 if(
node_found_b
 =
TRUE
)

160 if(
node_found_b
 =
FALSE
)

162 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"No mataching selector found");

163 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

164  
TSC_FAILURE
;

167 
bd_y_fo_p
->
c_
 = 
_node_sn_p
->src_ip;

168 
bd_y_fo_p
->
d_
 = 
_node_sn_p
->dst_ip;

169 
bd_y_fo_p
->
d_pt
 = 
_node_sn_p
->dst_port;

170 
bd_y_fo_p
->
oc
 = 
_node_sn_p
->protocol;

172 
tv
 = 
	`nm_g_nschat_byhd
(
vn_nsc_fo_p
->
f_nschat_obje
,&
nschat_obje_p
);

173 if(
tv
 !
NSRM_SUCCESS
)

175 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NSCHAINSET invalid");

176 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

177 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

178  
TSC_FAILURE
;

182 
	`ry
(
bd_y_fo_p
->
nschat_me_p
 , 
nschat_obje_p
->
me_p
);

183 
node_f
 = 
_node_sn_p
->
_n
;

184 *
mched_node_f
 = 
node_f
;

186 if(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
 == 0)

188 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noetwork service instancesxist");

189 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

190  
TSC_SUCCESS
;

192 
tv
 = 
	`mempo_g_mem_block
(
tsc_nwrvis_mempo_g
,(
uch8_t
 **)&
tsc_nwrvis_p
, &
hp_b
);

194 
	`OF_LIST_INIT
(
bd_y_fo_p
->
nwrvis_fo
,
bd_y_fo__y_rcu
);

195 
ii
 = 0 ; i< 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
;ii++)

197 
tv
 = 
	`nm_g_nscha_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
 , &
nscha_obje_p
);

198 if(
tv
 !
NSRM_SUCCESS
)

200 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nschain object invalid");

201 
	`
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
);

202 
	`
(
tsc_nwrvis_p
->
nscha_me_p
);

203 
	`
(
tsc_nwrvis_p
->
nwrvi__me_p
);

204 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

205 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

206  
TSC_FAILURE
;

208 
tv
 = 
	`nm_g_nwrvi_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi_obje_hd
 , &
nwrvi_obje_p
);

209 if(
tv
 !
NSRM_SUCCESS
)

211 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice object invalid");

212 
	`
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
);

213 
	`
(
tsc_nwrvis_p
->
nscha_me_p
);

214 
	`
(
tsc_nwrvis_p
->
nwrvi__me_p
);

215 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

216 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

217  
TSC_FAILURE
;

219 
tv
 = 
	`nm_g_ched_nwrvi_hd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
 ,
nwrvi_obje_p
->
me_p
, &
ch_hd
);

220 if(
tv
 !
NSRM_SUCCESS
)

222 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice objectotttachedohis chain");

223 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

224 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

225  
TSC_FAILURE
;

228 
tv
 = 
	`nm_g_nwrvi__byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
,

229 
ch_hd
,

230 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi__hd
,

231 &
nwrvi__p
);

233 if(
tv
 !
NSRM_SUCCESS
)

235 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice instanceot valid");

236 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

237 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

238  
TSC_FAILURE
;

240 
tsc_nwrvis_p
 = (
tsc_nwrvis
 *
	`oc
(1,(tsc_nwservices));

241 
tsc_nwrvis_p
->
nwrvi_obje_me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

242 
tsc_nwrvis_p
->
nwrvi__me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

243 
tsc_nwrvis_p
->
nscha_me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

244 
	`ry
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
 , 
nwrvi_obje_p
->
me_p
);

245 
	`ry
(
tsc_nwrvis_p
->
nscha_me_p
 , 
nscha_obje_p
->
me_p
);

246 
	`ry
(
tsc_nwrvis_p
->
nwrvi__me_p
 , 
nwrvi__p
->
me_p
);

248 
	`OF_APPEND_NODE_TO_LIST
(
bd_y_fo_p
->
nwrvis_fo
 ,
tsc_nwrvis_p
,

249 
CNBIND_NWSERVICE_LIST_NODE_OFFSET
);

252 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

253  
TSC_SUCCESS
;

254 
	}
}

257 
t32_t
 
	$tsc_g_xt_mchg_bd_y
(
nsc__node_key
 *
_key
,

258 
ut64_t
 
tive_node_f
,

259 
ut64_t
 *
mched_node_f
,

260 
tsc_bd_y_fo
 *
bd_y_fo_p
)

262 
nsc__node
 *
_node_sn_p
 = 
NULL
;

263 
tsc_nwrvis
 *
tsc_nwrvis_p
 = 
NULL
;

264 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

265 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

266 
nm_nschat_obje
 *
nschat_obje_p
 = 
NULL
;

267 
nm_nscha_obje
 *
nscha_obje_p
 = 
NULL
;

268 
nm_nwrvi_obje
 *
nwrvi_obje_p
 = 
NULL
;

269 
nwrvi_
 *
nwrvi__p
 = 
NULL
;

271 
ut64_t
 
hashkey
,
node_f
,
ch_hd
,
vn_hd
;

272 
ut32_t
 
offt
;

273 
t32_t
 
ii
,
tv
;

274 
ut8_t
 
node_found_b
 = 
FALSE
 , 
tive_node_found_b
 = FALSE;

276 
_key
 = 
_key_p
;

278 
tv
 = 
	`m_g_vn_hd
(
_key
->
vn_me
,&
vn_hd
);

279 if(
tv
 !
NSRM_SUCCESS
)

281 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

282  
TSC_FAILURE
;

285 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

286 if(
tv
 !
NSRM_SUCCESS
)

288 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

289  
TSC_FAILURE
;

292 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vmfound : %s",
vn_y_p
->
nw_me
);

294 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

296 
l2_ci_to_nsfo_bd_b_p
 = 
vn_nsc_fo_p
->l2_connection_to_nsinfo_bind_table_p;

298 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

299 
	`CNTLR_RCU_READ_LOCK_TAKE
();

300 
	`MCHASH_TABLE_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
)

302 
	`MCHASH_BUCKET_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
,
_node_sn_p
,

303 
nsc__node
*,
offt
)

305 if(
tive_node_found_b
 =
FALSE
)

307 if(
tive_node_f
 =
_node_sn_p
->
_n
)

309 
tive_node_found_b
 = 
TRUE
;

310 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Relativeode found");

314 if(
tive_node_found_b
 =
FALSE
)

316 
node_found_b
 = 
FALSE
;

319 if(
_key
->
c_
 !=
ANY
 && se_key->c_ !
_node_sn_p
->src_ip)

321 if(
_key
->
d_
 !=
ANY
 && se_key->d_ !
_node_sn_p
->dst_ip)

323 if(
_key
->
d_pt
 !=
ANY
 && se_key->d_p܈!
_node_sn_p
->dst_port)

325 if(
_key
->
oc
 !=
ANY
 && se_key->oc !
_node_sn_p
->protocol)

327 
node_found_b
 = 
TRUE
;

330 if(
node_found_b
 =
TRUE
)

333 if(
node_found_b
 =
FALSE
)

335 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"No mataching selector found");

336 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

337  
TSC_FAILURE
;

340 
bd_y_fo_p
->
c_
 = 
_node_sn_p
->src_ip;

341 
bd_y_fo_p
->
d_
 = 
_node_sn_p
->dst_ip;

342 
bd_y_fo_p
->
d_pt
 = 
_node_sn_p
->dst_port;

343 
bd_y_fo_p
->
oc
 = 
_node_sn_p
->protocol;

345 
tv
 = 
	`nm_g_nschat_byhd
(
vn_nsc_fo_p
->
f_nschat_obje
,&
nschat_obje_p
);

346 if(
tv
 !
NSRM_SUCCESS
)

348 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NSCHAINSET invalid");

349 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

350 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

351  
TSC_FAILURE
;

354 
	`ry
(
bd_y_fo_p
->
nschat_me_p
 , 
nschat_obje_p
->
me_p
);

355 
node_f
 = 
_node_sn_p
->
_n
;

356 *
mched_node_f
 = 
node_f
;

358 if(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
 == 0)

360 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noetwork service instancesxist");

361 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

362  
TSC_FAILURE
;

364 
	`OF_LIST_INIT
(
bd_y_fo_p
->
nwrvis_fo
,
bd_y_fo__y_rcu
);

365 
ii
 = 0 ; i< 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
;ii++)

367 
tv
 = 
	`nm_g_nscha_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
 , &
nscha_obje_p
);

368 if(
tv
 !
NSRM_SUCCESS
)

370 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nschain object invalid");

371 
	`
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
);

372 
	`
(
tsc_nwrvis_p
->
nscha_me_p
);

373 
	`
(
tsc_nwrvis_p
->
nwrvi__me_p
);

374 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

375 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

376  
TSC_FAILURE
;

379 
tv
 = 
	`nm_g_nwrvi_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi_obje_hd
 , &
nwrvi_obje_p
);

380 if(
tv
 !
NSRM_SUCCESS
)

382 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice object invalid");

383 
	`
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
);

384 
	`
(
tsc_nwrvis_p
->
nscha_me_p
);

385 
	`
(
tsc_nwrvis_p
->
nwrvi__me_p
);

386 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

387 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

388  
TSC_FAILURE
;

390 
tv
 = 
	`nm_g_ched_nwrvi_hd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
 ,
nwrvi_obje_p
->
me_p
, &
ch_hd
);

391 if(
tv
 !
NSRM_SUCCESS
)

393 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice objectotttachedohis chain");

394 
	`
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
);

395 
	`
(
tsc_nwrvis_p
->
nscha_me_p
);

396 
	`
(
tsc_nwrvis_p
->
nwrvi__me_p
);

397 
	`mempo_de_po
(
tsc_nwrvis_mempo_g
);

398 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

399  
TSC_FAILURE
;

402 
tv
 = 
	`nm_g_nwrvi__byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
,

403 
ch_hd
,

404 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi__hd
,

405 &
nwrvi__p
);

407 if(
tv
 !
NSRM_SUCCESS
)

409 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice instanceot valid");

410 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

411  
TSC_FAILURE
;

413 
tsc_nwrvis_p
 = (
tsc_nwrvis
 *
	`oc
(1,(tsc_nwservices));

414 
tsc_nwrvis_p
->
nwrvi_obje_me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

415 
tsc_nwrvis_p
->
nwrvi__me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

416 
tsc_nwrvis_p
->
nscha_me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

417 
	`ry
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
 , 
nwrvi_obje_p
->
me_p
);

418 
	`ry
(
tsc_nwrvis_p
->
nwrvi__me_p
 , 
nwrvi__p
->
me_p
);

419 
	`ry
(
tsc_nwrvis_p
->
nscha_me_p
 , 
nscha_obje_p
->
me_p
);

421 
	`OF_APPEND_NODE_TO_LIST
(
bd_y_fo_p
->
nwrvis_fo
 ,
tsc_nwrvis_p
,

422 
CNBIND_NWSERVICE_LIST_NODE_OFFSET
);

425 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Getextecord successful ! ");

426 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

427  
TSC_SUCCESS
;

428 
	}
}

430 
t32_t
 
	$tsc_g_exa_mchg_bd_y
(
nsc__node_key
 *
_key
,

431 
tsc_bd_y_fo
 *
bd_y_fo_p
)

433 
vn_rvi_chag_fo
 *
vn_nsc_fo_p
 = 
NULL
;

434 
m_vtu_twk
 *
vn_y_p
 = 
NULL
;

435 
nsc__node
 *
_node_sn_p
 = 
NULL
;

436 
tsc_nwrvis
 *
tsc_nwrvis_p
 = 
NULL
;

437 
nm_nschat_obje
 *
nschat_obje_p
 = 
NULL
;

438 
nm_nscha_obje
 *
nscha_obje_p
 = 
NULL
;

439 
nm_nwrvi_obje
 *
nwrvi_obje_p
 = 
NULL
;

440 
nwrvi_
 *
nwrvi__p
 = 
NULL
;

442 
ut64_t
 
hashkey
,
ch_hd
,
vn_hd
;

443 
ut32_t
 
offt
;

444 
t32_t
 
ii
,
tv
;

445 
ut8_t
 
node_found_b
 = 
FALSE
;

447 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

449 if(
ag
 == 0)

451 
ag
++;

452  
TSC_FAILURE
;

455  
TSC_SUCCESS
;

457 if(
_key_p
 =
NULL
)

459 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"selector keyull");

460  
TSC_FAILURE
;

463 if(
	`rcmp
(
_key
->
vn_me
,
_key_p
->vn_name) == 0)

465 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Key found ");

466  
TSC_SUCCESS
;

469 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vm : %s",
_key
->
vn_me
);

470 
tv
 = 
	`m_g_vn_hd
(
_key
->
vn_me
,&
vn_hd
);

471 if(
tv
 !
NSRM_SUCCESS
)

473 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

474  
TSC_FAILURE
;

477 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
 , &
vn_y_p
);

478 if(
tv
 !
NSRM_SUCCESS
)

480 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn doesntxist");

481  
TSC_FAILURE
;

484 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vmfound : %s",
vn_y_p
->
nw_me
);

486 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

488 
l2_ci_to_nsfo_bd_b_p
 = 
vn_nsc_fo_p
->l2_connection_to_nsinfo_bind_table_p;

491 
	`MCHASH_TABLE_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
)

493 
	`MCHASH_BUCKET_SCAN
(
l2_ci_to_nsfo_bd_b_p
,
hashkey
,
_node_sn_p
,

494 
nsc__node
*,
offt
)

496 if((
_key
->
c_
 !
_node_sn_p
->src_ip)

498 (
_key
->
c_
 !
_node_sn_p
->
d_
)

500 (
_key
->
c_
 !
_node_sn_p
->
d_pt
)

502 (
_key
->
c_
 !
_node_sn_p
->
oc
))

506 
node_found_b
 = 
TRUE
;

509 if(
node_found_b
 =
TRUE
)

512 if(
node_found_b
 =
FALSE
)

514 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"No mataching selector found");

515  
TSC_FAILURE
;

517 
tv
 = 
	`nm_g_nschat_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nschat_obje_hd
 , &
nschat_obje_p
);

518 if(
tv
 !
NSRM_SUCCESS
)

520 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NSCHAINSET invalid");

521  
TSC_FAILURE
;

524 
tv
 = 
	`nm_g_nscha_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nscha_obje_hd
 , &
nscha_obje_p
);

525 if(
tv
 !
NSRM_SUCCESS
)

527 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NSCHAIN invalid");

528  
TSC_FAILURE
;

531 
	`ry
(
bd_y_fo_p
->
nschat_me_p
 , 
nschat_obje_p
->
me_p
);

533 if(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
 == 0)

535 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noetwork service instancesxist");

536  
TSC_SUCCESS
;

538 
	`OF_LIST_INIT
(
bd_y_fo_p
->
nwrvis_fo
,
bd_y_fo__y_rcu
);

539 
ii
 = 0 ; i< 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
no_of_nwrvi_s
;ii++)

541 
tv
 = 
	`nm_g_nwrvi_byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi_obje_hd
 , &
nwrvi_obje_p
);

542 if(
tv
 !
NSRM_SUCCESS
)

544 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice object invalid");

545  
TSC_FAILURE
;

547 
tv
 = 
	`nm_g_ched_nwrvi_hd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
 ,
nwrvi_obje_p
->
me_p
, &
ch_hd
);

548 if(
tv
 !
NSRM_SUCCESS
)

550 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice objectotttachedohis chain");

551  
TSC_FAILURE
;

554 
tv
 = 
	`nm_g_nwrvi__byhd
(
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nscha_obje_hd
,

555 
ch_hd
,

556 
_node_sn_p
->
bd_node_p
->
nwrvi_fo
.
nw_rvis_p
[
ii
].
nwrvi__hd
,

557 &
nwrvi__p
);

559 if(
tv
 !
NSRM_SUCCESS
)

561 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"nwservice instanceot valid");

562  
TSC_FAILURE
;

564 
tsc_nwrvis_p
 = (
tsc_nwrvis
 *
	`oc
(1,(tsc_nwservices));

565 
tsc_nwrvis_p
->
nwrvi_obje_me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

566 
tsc_nwrvis_p
->
nwrvi__me_p
 = (*
	`oc
(1,
NSRM_MAX_NAME_LENGTH
);

567 
	`ry
(
tsc_nwrvis_p
->
nwrvi_obje_me_p
 , 
nwrvi_obje_p
->
me_p
);

568 
	`ry
(
tsc_nwrvis_p
->
nwrvi__me_p
 , 
nwrvi__p
->
me_p
);

570 
	`OF_APPEND_NODE_TO_LIST
(
bd_y_fo_p
->
nwrvis_fo
 ,
tsc_nwrvis_p
,

571 
CNBIND_NWSERVICE_LIST_NODE_OFFSET
);

574  
TSC_SUCCESS
;

575 
	}
}

	@nicira_tun_ext.c

24 
	~"cڌr.h
"

25 
	~"of_uts.h
"

26 
	~"nica_tun_ext.h
"

29 
t32_t


30 
	$of_t_v4_tun_c
(
of_msg
 *
msg
,

31 
v4_addr_t
 *
v4_addr
,

32 
ut8_t
 
is_mask_t
,

33 
v4_addr_t
 *
v4_addr_mask
)

35 
of_msg_dest
 *
msg_desc
 = &
msg
->
desc
;

37 
	`r_as
(
msg
 !
NULL
);

38 
msg_desc
 = &
msg
->
desc
;

40 if(
is_mask_t
)

42 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_IPV4_SRC_MASK_LEN
) >

43 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

45 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

46  
OFU_NO_ROOM_IN_BUFFER
;

49 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1

	`htl
(
NXM_NX_TUN_IPV4_SRC_W
);

50 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

51 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 8
	`htl
(*
v4_addr_mask
);

52 
msg_desc
->
ngth1
 +
OFU_IPV4_SRC_MASK_LEN
;

57 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_IPV4_SRC_FIELD_LEN
) >

58 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

60 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

61  
OFU_NO_ROOM_IN_BUFFER
;

63 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1

	`htl
(
NXM_NX_TUN_IPV4_SRC
);

64 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

65 
msg_desc
->
ngth1
 +
OFU_IPV4_SRC_FIELD_LEN
;

67  
OFU_SET_FIELD_SUCCESS
;

68 
	}
}

70 
t32_t


71 
	$of_t_v4_tun_d
(
of_msg
 *
msg
,

72 
v4_addr_t
 *
v4_addr
,

73 
ut8_t
 
is_mask_t
,

74 
v4_addr_t
 *
v4_addr_mask
)

76 
of_msg_dest
 *
msg_desc
 = &
msg
->
desc
;

78 
	`r_as
(
msg
 !
NULL
);

79 
msg_desc
 = &
msg
->
desc
;

81 if(
is_mask_t
)

83 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_IPV4_DST_MASK_LEN
) >

84 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

86 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

87  
OFU_NO_ROOM_IN_BUFFER
;

90 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1

	`htl
(
NXM_NX_TUN_IPV4_DST_W
);

91 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

92 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 8
	`htl
(*
v4_addr_mask
);

93 
msg_desc
->
ngth1
 +
OFU_IPV4_SRC_MASK_LEN
;

98 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_IPV4_DST_FIELD_LEN
) >

99 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

101 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

102  
OFU_NO_ROOM_IN_BUFFER
;

104 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1

	`htl
(
NXM_NX_TUN_IPV4_DST
);

105 *(
ut32_t
*)(
msg_desc
->
r1
+msg_desc->
ngth1
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

106 
msg_desc
->
ngth1
 +
OFU_IPV4_DST_FIELD_LEN
;

108  
OFU_SET_FIELD_SUCCESS
;

109 
	}
}

111 
t32_t


112 
	$ofu_push_t_v4_tun_c_addr__t_fld_ai
(
of_msg
 *
msg
,

113 
v4_addr_t
 *
v4_addr
)

115 
of_msg_dest
 *
msg_desc
;

116 
o_ai_t_fld
 *
t_fld
;

117 
ut16_t
 
ddg_bys
 = 
	`OF_SET_FIELD_ACTION_PADDING_LEN
(4);

119 
	`r_as
(
msg
 !
NULL
);

120 
msg_desc
 = &
msg
->
desc
;

123 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_SET_FIELD_WITH_IPV4_SRC_FIELD_ACTION_LEN
) >

124 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

126 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

127  
OFU_NO_ROOM_IN_BUFFER
;

129 
t_fld
 = (
o_ai_t_fld
 *)(
msg_desc
->
r3
+msg_desc->
ngth3
);

130 
t_fld
->
ty
 = 
	`hts
(
OFPAT_SET_FIELD
);

131 
t_fld
->
n
 = 
	`hts
(
OFU_SET_FIELD_WITH_IPV4_SRC_FIELD_ACTION_LEN
 + 
ddg_bys
);

132 *(
ut32_t
*)
t_fld
->
fld
 = 
	`htl
(
NXM_NX_TUN_IPV4_SRC
);

133 *(
ut32_t
*)(
t_fld
->
fld
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

134 
	`memt
(
t_fld
->
fld
 + 
OFU_SET_FIELD_WITH_IPV4_SRC_FIELD_ACTION_LEN
),0,
ddg_bys
);

135 
msg_desc
->
ngth3
 +
OFU_SET_FIELD_WITH_IPV4_SRC_FIELD_ACTION_LEN
 + 
ddg_bys
;

136  
OFU_ACTION_PUSH_SUCCESS
;

137 
	}
}

139 
t32_t


140 
	$ofu_push_t_v4_tun_d_addr__t_fld_ai
(
of_msg
 *
msg
,

141 
v4_addr_t
 *
v4_addr
)

143 
of_msg_dest
 *
msg_desc
;

144 
o_ai_t_fld
 *
t_fld
;

145 
ut16_t
 
ddg_bys
 = 
	`OF_SET_FIELD_ACTION_PADDING_LEN
(4);

147 
	`r_as
(
msg
 !
NULL
);

148 
msg_desc
 = &
msg
->
desc
;

151 if(
msg_desc
->
r1
+msg_desc->
ngth1
+
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN
) >

152 (
msg
->
desc
.
t_of_da
 + 
msg_desc
->
bufr_n
) )

154 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_WARN
,"%%d :Lgth obufin sufficadd da\r\n",
__FUNCTION__
,
__LINE__
);

155  
OFU_NO_ROOM_IN_BUFFER
;

157 
t_fld
 = (
o_ai_t_fld
 *)(
msg_desc
->
r3
+msg_desc->
ngth3
);

158 
t_fld
->
ty
 = 
	`hts
(
OFPAT_SET_FIELD
);

159 
t_fld
->
n
 = 
	`hts
(
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN
 + 
ddg_bys
);

160 *(
ut32_t
*)
t_fld
->
fld
 = 
	`htl
(
NXM_NX_TUN_IPV4_DST
);

161 *(
ut32_t
*)(
t_fld
->
fld
 + 
OF_NXM_HDR_LEN

	`htl
(*
v4_addr
);

162 
	`memt
(
t_fld
->
fld
 + 
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN
),0,
ddg_bys
);

163 
msg_desc
->
ngth3
 +
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN
 + 
ddg_bys
;

164  
OFU_ACTION_PUSH_SUCCESS
;

165 
	}
}

167 
t32_t


168 
	$ofu_g_tun_id_fld
(
of_msg
 *
msg
,

169 *
mch_flds
,

170 
ut16_t
 
mch_flds_n
,

171 
ut64_t
 *
tun_id
)

173 
ut32_t
 
oxm_hd
;

174 
ut8_t
 *
r
;

175 
ut16_t
 
mch_fld_n
;

176 
ut16_t
 
rd_da_n
;

178 
	`r_as
(
mch_flds
 !
NULL
);

180 
r
 = (
ut8_t
*)
mch_flds
;

182 
mch_flds_n
)

184 
oxm_hd
 = 
	`ohl
(*(
ut32_t
*)
r
);

186 if((
	`NXM_VENDOR
(
oxm_hd
=0x0001&& (
	`OXM_FIELD
(oxm_hd=
NXM01_TUN_ID
))

188 *
tun_id
 = 
	`ohl
(*(
ut64_t
*)(
r
+
OF_OXM_HDR_LEN
));

189  
OFU_TUN_ID_FIELD_PRESENT
;

193 
rd_da_n
 = (
OF_OXM_HDR_LEN
 + 
	`OXM_LENGTH
(
oxm_hd
));

194 
mch_fld_n
 -
rd_da_n
;

195 
r
 +
rd_da_n
;

198  
OFU_TUN_ID_FIELD_NOT_PRESENT
;

199 
	}
}

201 
t32_t


202 
	$ofu_g_tun_c_fld
(
of_msg
 *
msg
,

203 *
mch_flds
,

204 
ut16_t
 
mch_flds_n
,

205 
ut32_t
 *
tun_c
)

207 
ut32_t
 
oxm_hd
;

208 
ut8_t
 *
r
;

209 
ut16_t
 
mch_fld_n
;

210 
ut16_t
 
rd_da_n
;

212 
	`r_as
(
mch_flds
 !
NULL
);

214 
r
 = (
ut8_t
*)
mch_flds
;

216 
mch_flds_n
)

218 
oxm_hd
 = 
	`ohl
(*(
ut32_t
*)
r
);

220 if((
	`NXM_VENDOR
(
oxm_hd
=0x0001&& (
	`OXM_FIELD
(oxm_hd=
NXM01_TUN_IPV4_SRC
))

222 *
tun_c
 = 
	`ohl
(*(
ut32_t
*)(
r
+
OF_OXM_HDR_LEN
));

223  
OFU_TUN_SRC_FIELD_PRESENT
;

227 
rd_da_n
 = (
OF_OXM_HDR_LEN
 + 
	`OXM_LENGTH
(
oxm_hd
));

228 
mch_fld_n
 -
rd_da_n
;

229 
r
 +
rd_da_n
;

232  
OFU_TUN_SRC_FIELD_NOT_PRESENT
;

233 
	}
}

235 
t32_t


236 
	$ofu_g_tun_d_fld
(
of_msg
 *
msg
,

237 *
mch_flds
,

238 
ut16_t
 
mch_flds_n
,

239 
ut32_t
 *
tun_d
)

241 
ut32_t
 
oxm_hd
;

242 
ut8_t
 *
r
;

243 
ut16_t
 
mch_fld_n
;

244 
ut16_t
 
rd_da_n
;

246 
	`r_as
(
mch_flds
 !
NULL
);

248 
r
 = (
ut8_t
*)
mch_flds
;

250 
mch_flds_n
)

252 
oxm_hd
 = 
	`ohl
(*(
ut32_t
*)
r
);

254 if((
	`NXM_VENDOR
(
oxm_hd
=0x0001&& (
	`OXM_FIELD
(oxm_hd=
NXM01_TUN_IPV4_DST
))

256 *
tun_d
 = 
	`ohl
(*(
ut32_t
*)(
r
+
OF_OXM_HDR_LEN
));

257  
OFU_TUN_DST_FIELD_PRESENT
;

261 
rd_da_n
 = (
OF_OXM_HDR_LEN
 + 
	`OXM_LENGTH
(
oxm_hd
));

262 
mch_fld_n
 -
rd_da_n
;

263 
r
 +
rd_da_n
;

266  
OFU_TUN_DST_FIELD_NOT_PRESENT
;

267 
	}
}

	@tsc_controller.c

24 
	~"cڌr.h
"

25 
	~"of_uts.h
"

26 
	~"of_muɝt.h
"

27 
	~"of_msgi.h
"

28 
	~"l_queue.h
"

29 
	~"r_s.h
"

30 
	~"r_.h
"

31 
	~"r_evt.h
"

32 
	~"dmldef.h
"

33 
	~"dm.h
"

35 
	~"mi.h
"

36 
	~"m_vn_i.h
"

37 
	~"m_pt_i.h
"

38 
	~"tsc_cڌr.h
"

39 
	~"tsc_ofv1_3_ug.h
"

40 
	~"tsc_nvm_modus.h
"

41 
	~"tsc_nvm_vxn.h
"

42 
	~"tsc_nsc_i.h
"

43 
	~"tsc_vxn_vws.h
"

46 
ut32_t
 
vn_nsc_fo_offt_g
;

47 
ut32_t
 
nsc_no_of_posy_b_1_bucks_g
;

48 
ut32_t
 
nsc_no_of_posy_b_2_bucks_g
;

49 
ut32_t
 
nsc_no_of_posy_b_3_bucks_g
;

51 
ut32_t
 
	gnwnode_dh_
 = 0;

53 
tsc_nvm_modu_r
 
	gtsc_nvm_modus
[
SUPPORTED_NW_TYPE_MAX
 + 1];

55 
t32_t
 
tsc_add_uni_nwpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

56 
ut8_t
 
nw_ty
,

57 * 
swme_p
,

58 
ut16_t
 
vn_id_
,

59 
ut16_t
 
vn_id_out
,

60 
ut64_t
 
dp_hd
);

62 
t32_t
 
tsc_add_brd_nwpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

63 
ut8_t
 
nw_ty
,

64 * 
swme_p
,

65 
ut16_t
 
vn_id_
,

66 
ut16_t
 
vn_id_out
,

67 
ut64_t
 
dp_hd
);

69 
tsc_brr_y_nifiti_
(
ut64_t
 
cڌr_hd
,

70 
ut64_t
 
doma_hd
,

71 
ut64_t
 
dh_hd
,

72 
of_msg
 *
msg
,

73 *
cbk_g1
,

74 *
cbk_g2
,

75 
ut8_t
 
us
);

78 
	sb_brr_msg


80 
ut64_t
 
	mdp_hd
;

81 
t32_t
 
	m_pt
;

82 
o_ck_
* 
	mpkt_
;

93 
t32_t
 
	$tsc_de_vmpt_ows_om_assify_b
(
ut8_t
 
m_pt_ty
,

94 
ut32_t
 
pt_id
,

95 
ut64_t
 
dp_hd
)

97 
t32_t
 
tv
;

98 
tsc_ofv_ug_i
* 
tsc_ms_vm_p
;

100 
tsc_ms_vm_p
 = (
tsc_ofv_ug_i
 *(
	`mloc
( (tsc_ofver_plugin_iface )));

101 if(
tsc_ms_vm_p
 =
NULL
)

102  
OF_FAILURE
;

104 
tsc_ms_vm_p
->
_pt_id
 = 
pt_id
;

107 
tsc_ms_vm_p
->
pkt_ig_e
 = 
m_pt_ty
;

110 
tv
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_vmpts
(
dp_hd
,

111 
tsc_ms_vm_p
,

112 
OFPFC_DELETE
);

113  
tv
;

114 
	}
}

126 
t32_t
 
	$tsc_add_vmpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

127 * 
swme_p
,

128 
ut8_t
 
m_pt_ty
,

129 
ut32_t
 
pt_id
,

130 
ut16_t
 
vn_id_
,

131 
ut16_t
 
vn_id_out
,

132 
ut64_t
 
dp_hd
)

134 
t32_t
 
tv
;

135 
m_vtu_twk
* 
vn_y_p
;

136 
tsc_ofv_ug_i
* 
tsc_ms_vm_p
;

137 
ut8_t
 
nw_ty
;

140 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

141 if(
tv
 !
CRM_SUCCESS
)

143 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"tsc_add_flows_classify_table - Unableo fetch vn_entry");

144  
OF_FAILURE
;

146 
nw_ty
 = 
vn_y_p
->nw_type;

148 
tsc_ms_vm_p
 = (
tsc_ofv_ug_i
 *(
	`mloc
( (tsc_ofver_plugin_iface )));

149 if(
tsc_ms_vm_p
 =
NULL
)

150  
OF_FAILURE
;

152 
tsc_ms_vm_p
->
_pt_id
 = 
pt_id
;

153 
	`ry
(
tsc_ms_vm_p
->
lol_swch_me
,
swme_p
);

156 
tsc_ms_vm_p
->
pkt_ig_e
 = 
m_pt_ty
;

158 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_cڡru_mada
(
tsc_ms_vm_p
,
vn_hd
,
NULL
);

160 
tsc_ms_vm_p
->
mada
 = (tsc_params_vm_p->metadata |

161 (((
ut64_t
)(
m_pt_ty
)<< 
PKT_ORIGIN_OFFSET
));

162 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA1 =%x",
tsc_ms_vm_p
->
mada
);

163 
tsc_ms_vm_p
->
mada_mask
 = 0xFFFFFFFFFFFFFFFF;

165 if(
m_pt_ty
 =
VM_NS
)

167 
tsc_ms_vm_p
->
vn_id_
 = vlan_id_in;

168 
tsc_ms_vm_p
->
vn_id_out
 = vlan_id_out;

172 
tsc_ms_vm_p
->
vn_id_
 = 0;

173 
tsc_ms_vm_p
->
vn_id_out
 = 0;

177 
tv
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_vmpts
(
dp_hd
,

178 
tsc_ms_vm_p
,

179 
OFPFC_ADD
);

180 if(
tv
 !
OF_SUCCESS
)

182 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, " Failedodd flows for vmort");

183  
tv
;

189 
tv
 = 
	`tsc_add_uni_nwpt_ows_to_assify_b
(
vn_hd
,

190 
nw_ty
,

191 
swme_p
,

192 
vn_id_
,

193 
vn_id_out
,

194 
dp_hd
);

198 
tv
 = 
	`tsc_add_brd_nwpt_ows_to_assify_b
(
vn_hd
,

199 
nw_ty
,

200 
swme_p
,

201 
vn_id_
,

202 
vn_id_out
,

203 
dp_hd
);

205  
tv
;

206 
	}
}

217 
t32_t
 
	$tsc_add_uni_nwpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

218 
ut8_t
 
nw_ty
,

219 * 
swme_p
,

220 
ut16_t
 
vn_id_
,

221 
ut16_t
 
vn_id_out
,

222 
ut64_t
 
dp_hd
)

224 
tsc_ofv_ug_i
* 
tsc_ms_p
;

225 
t32_t
 
tv
 = 
OF_SUCCESS
;

227 
ut8_t
 
m_pt_ty
 = 
NW_UNICAST_PORT
;

232 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"swcham%s",
swme_p
);

234 
tsc_ms_p
 = (
tsc_ofv_ug_i
 *
	`mloc
( (tsc_ofver_plugin_iface));

236 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_cڡru_mada
(
tsc_ms_p
,
vn_hd
,
NULL
);

237 
tsc_ms_p
->
mada
 = (tsc_ms_p->mad| (((
ut64_t
)(
m_pt_ty
)<< 
PKT_ORIGIN_OFFSET
));

239 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Callingvm_module_get_unicast_nwport");

240 
	`CNTLR_RCU_READ_LOCK_TAKE
();

241 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
swme_p
,

242 
tsc_ms_p
->
rvipt
,

243 &(
tsc_ms_p
->
_pt_id
)

245 if(
tv
 !
OF_SUCCESS
)

247 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"VxLan Unicastortot found");

248 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

249  
OF_FAILURE
;

251 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

253 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"VxLan Unicastort found");

254 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"uni܈id = %d",
tsc_ms_p
->
_pt_id
);

257 
	`ry
(
tsc_ms_p
->
lol_swch_me
,
swme_p
);

258 
tsc_ms_p
->
pkt_ig_e
 = 
NW_UNICAST_PORT
;

259 
tsc_ms_p
->
dp_hd
 = dp_handle;

260 
tsc_ms_p
->
mada_mask
 = 0xffffffffffffffff;

261 
tsc_ms_p
->
vn_id_
 = vlan_id_in;

262 
tsc_ms_p
->
vn_id_out
 = vlan_id_out;

264 
tv
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
dp_hd
,
tsc_ms_p
,
OFPFC_ADD
);

265 if(
tv
 !
OF_SUCCESS
)

267 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedadd flow f uni܈wh܈id = %d",
tsc_ms_p
->
_pt_id
);

269  
tv
;

271 
	}
}

282 
t32_t
 
	$tsc_add_brd_nwpt_ows_to_assify_b
(
ut64_t
 
vn_hd
,

283 
ut8_t
 
nw_ty
,

284 * 
swme_p
,

285 
ut16_t
 
vn_id_
,

286 
ut16_t
 
vn_id_out
,

287 
ut64_t
 
dp_hd
)

289 
tsc_ofv_ug_i
* 
tsc_ms_p
;

290 
ut32_t
* 
nwbr_pts_p
;

291 
ut32_t
 
ii
,
no_of_nwbr_pts
;

292 
t32_t
 
tv
 = 
OF_SUCCESS
;

294 
ut8_t
 
m_pt_ty
 = 
NW_BROADCAST_PORT
;

296 
tsc_ms_p
 = (
tsc_ofv_ug_i
 *
	`mloc
( (tsc_ofver_plugin_iface));

297 
	`ry
(
tsc_ms_p
->
lol_swch_me
,
swme_p
);

298 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_cڡru_mada
(
tsc_ms_p
,
vn_hd
,
NULL
);

299 
tsc_ms_p
->
mada
 = (tsc_params_p->metadata |

300 (((
ut64_t
)(
m_pt_ty
)<< 
PKT_ORIGIN_OFFSET
));

301 
tsc_ms_p
->
pkt_ig_e
 = 
NW_BROADCAST_PORT
;

302 
tsc_ms_p
->
dp_hd
 = dp_handle;

303 
tsc_ms_p
->
mada_mask
 = 0xffffffffffffffff;

305 
no_of_nwbr_pts
 = 50;

306 
nwbr_pts_p
 = (
ut32_t
 *)(
	`mloc
(( (ut32_t* 
no_of_nwbr_pts
)));

308 if(
nwbr_pts_p
 =
NULL
)

310 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedollocate memory forwbr_ports_p");

311  
OF_FAILURE
;

314 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Callingvm_module_get_broadcast_nwports");

315 
	`CNTLR_RCU_READ_LOCK_TAKE
();

316 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_brd_nwpts
(
swme_p
,

317 
tsc_ms_p
->
rvipt
,

319 &
no_of_nwbr_pts
,

320 
nwbr_pts_p
,

324 if(
tv
 !
OF_SUCCESS
)

326 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"VxLan Broadcastortsot found");

327 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

328  
OF_FAILURE
;

330 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

332 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"VxL Brd܈foundumb opt%d",
no_of_nwbr_pts
);

334 
ii
=0;ii< 
no_of_nwbr_pts
;ii++)

336 
tsc_ms_p
->
_pt_id
 = *
nwbr_pts_p
;

337 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Brd܈id = %d",
tsc_ms_p
->
_pt_id
);

338 
nwbr_pts_p
++;

339 
tsc_ms_p
->
vn_id_
 = vlan_id_in;

340 
tsc_ms_p
->
vn_id_out
 = vlan_id_out;

341 
tv
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
dp_hd
,
tsc_ms_p
,
OFPFC_ADD
);

342 if(
tv
 =
OF_FAILURE
)

344 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedadd flow f brd܈wh܈id = %d",
tsc_ms_p
->
_pt_id
);

348  
tv
;

349 
	}
}

360 
t32_t
 
	$tsc_de_nwpt_ows_om_assify_b
(
ut8_t
 
m_pt_ty
,

361 
ut32_t
 
pt_id
,

362 
ut64_t
 
dp_hd
)

364 
tsc_ofv_ug_i
* 
tsc_ms_p
;

365 
t32_t
 
tv
;

367 
tsc_ms_p
 = (
tsc_ofv_ug_i
 *
	`mloc
( (tsc_ofver_plugin_iface));

370 
tsc_ms_p
->
pkt_ig_e
 = 
m_pt_ty
;

371 
tsc_ms_p
->
dp_hd
 = dp_handle;

372 
tsc_ms_p
->
_pt_id
 = 
pt_id
;

375 
tv
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
dp_hd
,
tsc_ms_p
,
OFPFC_DELETE
);

376  
tv
;

377 
	}
}

389 
t32_t
 
	$tsc_outbound_ns_cha_b_1_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

390 
o_ck_
* 
pkt_
,

391 
ut32_t
 
_pt_id
,

392 
ut64_t
 
mada


395 
nscha_posy_y
schain_repository_entry;

396 
nscha_posy_y
* 
out_bound_nscha_posy_y_p
;

397 
b_brr_msg
* 
b_1_brr
 = 
NULL
;

399 * 
lol_swch_me_p
;

400 
ut8_t
 
nw_ty
;

401 
ut8_t
 
pkt_ig
,
nsc_cy_mac_addss_b
;

402 
ut32_t
 
nid
;

403 
ut32_t
 
tv
 = 
OF_FAILURE
;

404 
ut8_t
 
b_id
,
add_us
 = 
OF_FAILURE
;

406 
ut32_t
 
hashkey
,
hashmask
;

407 
nsc__node
 

;

408 
nsc__node
* 
_p
;

410 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Miss Packeteceived by Table_1");

411 
b_1_brr
 = (
b_brr_msg
*)
	`oc
(1,(table_barrier_msg));

413 
out_bound_nscha_posy_y_p
 = &
nscha_posy_y
;

416 
	`CNTLR_RCU_READ_LOCK_TAKE
();

417 
tv
 = 
	`g_swme_by_dphd
(
dp_hd
,&(
lol_swch_me_p
));

419 if(
tv
 !
DPRM_SUCCESS
)

421 
tv
 = 
OF_FAILURE
;

422 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

423  
tv
;

425 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

427 
pkt_ig
 = (
ut8_t
)((
mada
 & 
PKT_ORIGIN_MASK
>> 
PKT_ORIGIN_OFFSET
);

428 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

430 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_ig = %d",
pkt_ig
);

431 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_ty = %d",
nw_ty
);

433 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

435 
_p
 = &

;

437 
nsc_cy_mac_addss_b
 = 
TRUE
;

438 if(
pkt_ig
 =
VM_NS
)

439 
nsc_cy_mac_addss_b
 = 
FALSE
;

441 
tv
 = 
	`nsc_exa_ck_flds
(
pkt_
,
_p
,
PACKET_NORMAL
,
nsc_cy_mac_addss_b
);

442 if(
tv
 !
OF_SUCCESS
)

443  
tv
;

445 
hashmask
 = 
nsc_no_of_posy_b_1_bucks_g
;

446 
hashkey
 = 
	`nsc_compu_hash_posy_b_1_2
(
_p
->
c_
,_p->
d_
,

447 
_p
->
c_pt
,_p->
d_pt
,

448 
_p
->
oc
,

449 
_p
->
ht_ty
,

450 
_pt_id
,

451 
dp_hd
,

452 
_p
->
vn_id_pkt
,

453 
hashmask
);

455 
add_us
 = 
	`tsc_g_nscha_posy_y
(
lol_swch_me_p
,

456 
dp_hd
,

457 
nw_ty
,

458 
nid
,

459 
_pt_id
,

460 
mada
,

461 
pkt_
,

462 
pkt_ig
,

463 
TSC_PKT_OUTBOUND
,

464 
_p
,

465 
hashkey
,

466 &
out_bound_nscha_posy_y_p


469 if(
add_us
 !
OF_FAILURE
)

471 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_1
(
dp_hd
,
out_bound_nscha_posy_y_p
);

472 if(
tv
 =
OF_FAILURE
)

474 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo send Flow Mod messageo Table 1");

475 if(
add_us
 =
NSC_ADDED_REPOSITORY_ENTRY
)

478 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Deletingheschainepositoryntrydded justs failedo sendhe flowntryo switch");

479 
b_id
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

480 
	`tsc_de_nscha_posy_y
(
out_bound_nscha_posy_y_p
,
nw_ty
,
nid
,
b_id
);

486 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sending Packet out message for Table 1");

487 
b_1_brr
->
dp_hd
 = dp_handle;

488 
b_1_brr
->
_pt
 = 
_pt_id
;

489 
b_1_brr
->
pkt_
 =kt_in;

490 
tv
 = 
	`of_nd_brr_que_msg
(
dp_hd
,

491 
tsc_brr_y_nifiti_
,

492 
b_1_brr
,
NULL
);

494 if(
tv
 !
OF_SUCCESS
)

496 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"barrierequest forable 1 failed");

497 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
dp_hd
,
_pt_id
,
pkt_
);

498 if(
tv
 =
OF_FAILURE
)

499 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Packet out message for Table 1");

504 if((
out_bound_nscha_posy_y_p
->
pkt_ig
 =
VM_APPLN
&& (out_bound_nscha_posy_y_p->

.
_ty
 =
SELECTOR_PRIMARY
 ))

506 
tv
 = 
	`tsc_nd_l_ows_to_l_ts
(
out_bound_nscha_posy_y_p
);

507 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Calling Proactive flowushingoll switchesoutine.");

509 if(
tv
 =
OF_SUCCESS
)

511 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Proactive flowushing is successful.");

515 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Proactive flowushing failed.");

524  
tv
;

525 
	}
}

537 
t32_t
 
	$tsc_bound_ns_cha_b_2_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

538 
o_ck_
* 
pkt_
,

539 
ut32_t
 
_pt_id
,

540 
ut64_t
 
mada


543 
nscha_posy_y
schain_repository_entry;

544 
nscha_posy_y
* 
_bound_nscha_posy_y_p
;

545 
b_brr_msg
* 
b_2_brr
 = 
NULL
;

547 * 
lol_swch_me_p
;

548 
ut8_t
 
nw_ty
;

549 
ut8_t
 
pkt_ig
;

550 
ut32_t
 
hashkey
,
hashmask
,
nid
;

551 
ut16_t
 
rvipt
;

552 
ut32_t
 
tv
 = 
OF_FAILURE
;

554 
nsc__node
 

;

555 
nsc__node
* 
_p
;

556 
ut8_t
 
b_id
,
add_us
 = 
OF_FAILURE
;

558 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Miss Packeteceived by Table_2");

560 
b_2_brr
 = (
b_brr_msg
*)
	`oc
(1,(table_barrier_msg));

561 
_bound_nscha_posy_y_p
 = &
nscha_posy_y
;

564 
	`CNTLR_RCU_READ_LOCK_TAKE
();

565 
tv
 = 
	`g_swme_by_dphd
(
dp_hd
,&(
lol_swch_me_p
));

567 if(
tv
 !
DPRM_SUCCESS
)

569 
tv
 = 
OF_FAILURE
;

570 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

571  
tv
;

573 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

575 
pkt_ig
 = (
ut8_t
)((
mada
 & 
PKT_ORIGIN_MASK
>> 
PKT_ORIGIN_OFFSET
);

576 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

578 
pkt_ig
 = (
ut8_t
)((
mada
 & 
PKT_ORIGIN_MASK
>> 
PKT_ORIGIN_OFFSET
);

579 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

581 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_ig = %d",
pkt_ig
);

582 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_ty = %d",
nw_ty
);

584 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

585 
rvipt
 = (
ut16_t
)(
mada
 >> 
SERVICE_PORT_OFFSET
);

587 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nid = %d",
nid
);

588 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"rvip܈%d",
rvipt
);

590 
_p
 = &

;

592 
tv
 = 
	`nsc_exa_ck_flds
(
pkt_
,
_p
,
PACKET_NORMAL
,
TRUE
);

593 if(
tv
 !
OF_SUCCESS
)

594  
tv
;

596 
hashmask
 = 
nsc_no_of_posy_b_2_bucks_g
;

597 
hashkey
 = 
	`nsc_compu_hash_posy_b_1_2
(
_p
->
c_
,_p->
d_
,

598 
_p
->
c_pt
,_p->
d_pt
,

599 
_p
->
oc
,

600 
_p
->
ht_ty
,

601 
_pt_id
,

602 
dp_hd
,

603 
_p
->
vn_id_pkt
,

604 
hashmask
);

606 
add_us
 = 
	`tsc_g_nscha_posy_y
(
lol_swch_me_p
,

607 
dp_hd
,

608 
nw_ty
,

609 
nid
,

610 
_pt_id
,

611 
mada
,

612 
pkt_
,

613 
pkt_ig
,

614 
TSC_PKT_INBOUND
,

615 
_p
,

616 
hashkey
,

617 &
_bound_nscha_posy_y_p


620 if(
add_us
 !
OF_FAILURE
)

622 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_2
(
dp_hd
,
_bound_nscha_posy_y_p
);

624 if(
tv
 =
OF_FAILURE
)

626 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo send Flow Mod messageo Table 2");

627 if(
add_us
 =
NSC_ADDED_REPOSITORY_ENTRY
)

630 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Deletingheschainepositoryntrydded justs failedo sendhe flowntryo switch");

631 
b_id
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

632 
	`tsc_de_nscha_posy_y
(
_bound_nscha_posy_y_p
,
nw_ty
,
nid
,
b_id
);

639 
b_2_brr
->
dp_hd
 = dp_handle;

640 
b_2_brr
->
_pt
 = 
_pt_id
;

641 
b_2_brr
->
pkt_
 =kt_in;

642 
tv
 = 
	`of_nd_brr_que_msg
(
dp_hd
,

643 
tsc_brr_y_nifiti_
,

644 
b_2_brr
,
NULL
);

646 if(
tv
 !
OF_SUCCESS
)

648 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"barrierequest forable 2 failed");

649 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
dp_hd
,
_pt_id
,
pkt_
);

650 if(
tv
 =
OF_FAILURE
)

652 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo send Packet out message for Table 2");

661  
tv
;

662 
	}
}

673 
t32_t
 
	$tsc_de_nscha_posy_y
(
nscha_posy_y
* 
nscha_posy_node_p
,

674 
ut8_t
 
nw_ty
,
ut32_t
 
nid
,ut8_
b_id
)

676 
mchash_b
* 
nsc_posy_b_p
;

677 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

678 
m_vtu_twk
* 
vn_y_p
;

679 
ut64_t
 
vn_hd
;

680 
ut32_t
 
offt
,
dex
,
magic
;

681 
t32_t
 
tv
;

682 
ut8_t
 
us_b
 = 
FALSE
;

685 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

686 if(
tv
 !
OF_SUCCESS
)

688 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

689  
OF_FAILURE
;

692 
	`tf
("\r\n Enteredsc_delete_nschain_repository_entry. This is unwanted");

694 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

695 if(
tv
 !
OF_SUCCESS
)

697 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

698  
OF_FAILURE
;

701 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

703 if(
b_id
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

704 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

706 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

708 
dex
 = 
nscha_posy_node_p
->

.index;

709 
magic
 = 
nscha_posy_node_p
->

.magic;

711 
nscha_posy_node_p
->
sk_this_y
 = 1;

713 
	`CNTLR_RCU_READ_LOCK_TAKE
();

714 
	`tsc_mk__bd_y_as_e
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
,vn_nsc_fo_p->
nsc__bd_mempo_g
,
dex
,
magic
);

716 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

717 
	`MCHASH_DELETE_NODE_BY_REF
(
nsc_posy_b_p
,
nscha_posy_node_p
->
dex
,nscha_posy_node_p->
magic
,

718 
nscha_posy_y
 *,
offt
,
us_b
);

720 if(
us_b
 =
TRUE
)

722 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Rosyry ded sucssfuy fromab˄osy %d",
b_id
);

723 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

724 
tv
 = 
OF_SUCCESS
;

728 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Rosyry di faed fromab˄osy %d",
b_id
);

729 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

730 
tv
 = 
OF_FAILURE
;

732 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

733  
tv
;

734 
	}
}

739 
t32_t
 
	$tsc_g_nscha_posy_y
 (* 
swch_me_p
,

740 
ut64_t
 
dp_hd
,

741 
ut8_t
 
nw_ty
,

742 
ut32_t
 
nid
,

743 
ut32_t
 
_pt_id
,

744 
ut64_t
 
mada
,

745 
o_ck_
* 
pkt_
,

746 
ut8_t
 
pkt_ig
,

747 
ut8_t
 
pkt_d
,

748 
nsc__node
* 
_p
,

749 
ut32_t
 
hashkey
,

750 
nscha_posy_y
** 
nscha_posy_node_p_p


753 
nscha_posy_y
* 
nsc_posy_y_p
 = 
NULL
;

754 
nscha_posy_y
* 
nsc_posy_sn_node_p
;

755 
ut64_t
 
vn_hd
;

756 
ut32_t
 
offt
;

757 
ut32_t
 
dex
,
magic
;

758 
t32_t
 
us
 = 
FALSE
;

759 
ut8_t
 
hp_b
;

760 
mchash_b
* 
nsc_posy_b_p
;

761 * 
nsc_posy_mempo_g
;

763 
uch8_t
* 
hashobj_p
 = 
NULL
;

764 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

765 
m_vtu_twk
* 
vn_y_p
;

767 
t32_t
 
tv
 = 
OF_SUCCESS
;

769 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

770 if(
tv
 !
OF_SUCCESS
)

772 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

773  
OF_FAILURE
;

776 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

777 if(
tv
 !
OF_SUCCESS
)

779 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

780  
OF_FAILURE
;

783 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

785 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

787 
	`CNTLR_RCU_READ_LOCK_TAKE
();

788 if(
pkt_d
 =
TSC_PKT_OUTBOUND
)

790 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

791 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
;

795 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

796 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
;

798 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_sn_node_p
,
nscha_posy_y
 *, 
offt
)

800 if(
nsc_posy_sn_node_p
->
sk_this_y
 == 1)

804 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_p
->
c_
,
nsc_posy_sn_node_p
->

.src_ip);

805 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_p
->
d_
,
nsc_posy_sn_node_p
->

.dst_ip);

806 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_p
->
oc
,
nsc_posy_sn_node_p
->

.protocol);

807 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%d,%d",
_p
->
c_pt
,
nsc_posy_sn_node_p
->

.src_port);

808 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%d,%d",
_p
->
d_pt
,
nsc_posy_sn_node_p
->

.dst_port);

809 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_p
->
ht_ty
,
nsc_posy_sn_node_p
->

.ethernet_type);

810 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_pt_id
,
nsc_posy_sn_node_p
->in_port_id);

811 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
dp_hd
, 
nsc_posy_sn_node_p
->dp_handle);

812 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"%x,%x",
_p
->
vn_id_pkt
,
nsc_posy_sn_node_p
->vlan_id_pkt);

814 if(
_p
->
c_
 !
nsc_posy_sn_node_p
->

.src_ip ) ||

815 (
_p
->
d_
 !
nsc_posy_sn_node_p
->

.dst_ip ) ||

816 (
_p
->
oc
 !
nsc_posy_sn_node_p
->

.protocol) ||

817 (
_p
->
c_pt
 !
nsc_posy_sn_node_p
->

.src_port) ||

818 (
_p
->
d_pt
 !
nsc_posy_sn_node_p
->

.dst_port)

820 (
_p
->
ht_ty
 !
nsc_posy_sn_node_p
->

.ethernet_type)

822 ((
_pt_id
 !
nsc_posy_sn_node_p
->in_port_id))

824 ((
dp_hd
 !
nsc_posy_sn_node_p
->dp_handle))

826 ((
_p
->
vn_id_pkt
 !
nsc_posy_sn_node_p
->vlan_id_pkt))

830 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nscepositoryntry found");

831 *
nscha_posy_node_p_p
 = 
nsc_posy_sn_node_p
;

832 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

833  
OF_SUCCESS
;

836 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

838 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"getew mem block forscepositoryntry");

839 
tv
 = 
	`mempo_g_mem_block
(
nsc_posy_mempo_g
,(
uch8_t
 **)&
nsc_posy_y_p
,&
hp_b
);

840 if(
tv
 !
MEMPOOL_SUCCESS
)

842 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memory blockllocation forscepositoryntry failed");

843  
OF_FAILURE
;

846 
nsc_posy_y_p
->
hp_b
 = heap_b;

847 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
,
swch_me_p
);

849 
nsc_posy_y_p
->
sk_this_y
 = 0;

850 
nsc_posy_y_p
->
_pt_id
 = in_port_id;

851 
nsc_posy_y_p
->
mada
 = (metadata & 0xF0FFFFFFFFFFFFFF);

852 
nsc_posy_y_p
->
rvipt
 = (
ut16_t
)(
mada
 >> 
SERVICE_PORT_OFFSET
);

853 
nsc_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

854 
nsc_posy_y_p
->
pkt_ig
 =kt_origin;

856 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_ig = %d",
pkt_ig
);

857 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_ty = %d",
nw_ty
);

859 
nsc_posy_y_p
->
nw_ty
 =w_type;

860 
nsc_posy_y_p
->
nid
 =id;

861 
nsc_posy_y_p
->
dp_hd
 = dp_handle;

863 
nsc_posy_y_p
->
ow_mod_iܙy
 = 1;

864 
nsc_posy_y_p
->
xt_b_id
 = 3;

867 
nsc_posy_y_p
->
ns_cha_b
 = 
FALSE
;

868 
nsc_posy_y_p
->
me_nf_b
 = 
FALSE
;

870 
nsc_posy_y_p
->
xt_vn_id
 = 0;

871 
nsc_posy_y_p
->
mch_vn_id
 = 0;

872 
nsc_posy_y_p
->
xt_b_id
 = 0;

873 
nsc_posy_y_p
->
out_pt_no
 = 0;

875 
nsc_posy_y_p
->

 = *
_p
;

877 
nsc_posy_y_p
->
vn_id_pkt
 = 
_p
->vlan_id_pkt;

880 if(
vn_nsc_fo_p
->
rvi_chag_ty
 =
SERVICE_CHAINING_NONE
)

882 
nsc_posy_y_p
->
rvi_chag_ty
 = 
SERVICE_CHAINING_NONE
;

883 
tv
 = 
OF_SUCCESS
;

887 
nsc_posy_y_p
->
rvi_chag_ty
 = 
vn_nsc_fo_p
->service_chaining_type;

889 if((
pkt_ig
 !
VM_APPLN
&& (
nsc_posy_y_p
->
vn_id_pkt
 == 0))

892 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
," Aacket without VLAN-IDeached NSCHAIN Tables 1 or 2");

894 
tv
 = 
OF_FAILURE
;

898 
tv
 = 
	`nsc_g_l2_nschag_fo
(
nsc_posy_y_p
,
pkt_
,
pkt_ig
);

899 if(
tv
 =
OF_FAILURE
)

901 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get service chaining information");

902 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

903 (
uch8_t
 *)
nsc_posy_y_p
,

904 
nsc_posy_y_p
->
hp_b


906  
OF_FAILURE
;

909 
	`CNTLR_RCU_READ_LOCK_TAKE
();

913 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

914 
hashobj_p
 = (
uch8_t
 *)(
nsc_posy_y_p
+ 
offt
;

916 
	`MCHASH_APPEND_NODE
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_y_p
,
dex
,
magic
,
hashobj_p
,
us
);

917 if(
us
 =
FALSE
)

919 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoppendepositoryntry");

921 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

922 (
uch8_t
 *)
nsc_posy_y_p
,

923 
nsc_posy_y_p
->
hp_b


925 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoppendepositoryntrynd freeheepositoryntry memory");

926 
tv
 = 
OF_FAILURE
;

930 
tv
 = 
NSC_ADDED_REPOSITORY_ENTRY
;

932 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfullyppendedscepositoryntryo hashable");

933 
nsc_posy_y_p
->
magic
 = magic;

934 
nsc_posy_y_p
->
dex
 = index;

936 
nsc_posy_y_p
->
_n
 = 
magic
;

937 (
nsc_posy_y_p
->
_n
((sc_posy_y_p->_n<< 32| (
dex
));

939 
	`CNTLR_LOCK_TAKE
(
nsc_posy_y_p
->

.
bd_node_p
->
bd_node_lock
);

940 ++(
nsc_posy_y_p
->

.
bd_node_p
->
no_of_ow_s_dedud
);

942 
	`CNTLR_LOCK_RELEASE
(
nsc_posy_y_p
->

.
bd_node_p
->
bd_node_lock
);

945 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_pk = %d",
nsc_posy_y_p
->
vn_id_pkt
);

946 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mch_vn_id = %d",
nsc_posy_y_p
->
mch_vn_id
);

947 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_vn_id = %d",
nsc_posy_y_p
->
xt_vn_id
);

948 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"out_pt_n = %d",
nsc_posy_y_p
->
out_pt_no
);

949 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_b_id = %d",
nsc_posy_y_p
->
xt_b_id
);

952 *(
nscha_posy_node_p_p

nsc_posy_y_p
;

954 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

955  
tv
;

956 
	}
}

962 
t32_t
 
	$tsc_add_t3_ive_ow_f_vm
(
ut64_t
 
m_pt_hd
,ut64_
m_vn_hd
,ut64_
dp_hd
)

964 
upkt_out_posy_y
* 
upkt_out_posy_y_p
 = 
NULL
;

965 
m_pt
* 
m_pt_p
;

966 
ut32_t
 
nid
,
offt
,
dex
,
magic
,
hashkey
;

967 
ut8_t
 
hp_b
,
nw_ty
;

968 
mchash_b
* 
nsc_posy_b_p
;

969 * 
nsc_posy_mempo_g
;

971 
uch8_t
* 
hashobj_p
 = 
NULL
;

972 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

973 
m_vtu_twk
* 
vn_y_p
;

975 
ut64_t
 
mada
;

976 
ut16_t
 
rvipt
;

977 
t32_t
 
tv
 = 
OF_SUCCESS
;

978 
t32_t
 
us
 = 
OF_SUCCESS
;

979 
ut8_t
 
us_b
 = 
FALSE
;

981 
	`CNTLR_RCU_READ_LOCK_TAKE
();

985 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_p
);

986 if(
tv
 =
CRM_SUCCESS
)

988 
nw_ty
 = 
m_pt_p
->nw_type;

989 if(
nw_ty
 =
VXLAN_TYPE
)

991 
rvipt
 = (
m_pt_p
->
nw_ms
).
vxn_nw
.
rvi_pt
;

992 
nid
 = (
m_pt_p
->
nw_ms
).
vxn_nw
.nid;

994 if(
nw_ty
 =
NVGRE_TYPE
)

996 
rvipt
 = (
m_pt_p
->
nw_ms
).
nvg_nw
.
rvi_pt
;

997 
nid
 = (
m_pt_p
->
nw_ms
).
vxn_nw
.nid;

1002 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get crmort");

1003 
us
 = 
OF_FAILURE
;

1007 
tv
 = 
	`m_g_vn_byhd
(
m_vn_hd
,&
vn_y_p
);

1008 if(
tv
 !
OF_SUCCESS
)

1010 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1011 
us
 = 
OF_FAILURE
;

1015 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1017 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1019 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

1020 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
;

1022 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"getew mem block for ucastpkt outportepositoryntry");

1023 
tv
 = 
	`mempo_g_mem_block
(
nsc_posy_mempo_g
,(
uch8_t
 **)&
upkt_out_posy_y_p
,&
hp_b
);

1024 if(
tv
 !
MEMPOOL_SUCCESS
)

1026 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memory blockllocation for ucastpkt outportepositoryntry failed");

1027 
us
 = 
OF_FAILURE
;

1030 
	`ry
(
upkt_out_posy_y_p
->
lol_swch_me_p
,
m_pt_p
->
swch_me
);

1031 
upkt_out_posy_y_p
->
nw_ty
 =w_type;

1032 
upkt_out_posy_y_p
->
dp_hd
 = dp_handle;

1034 
upkt_out_posy_y_p
->
nid
 =id;

1035 
upkt_out_posy_y_p
->
rvipt
 = serviceport;

1036 
upkt_out_posy_y_p
->
id_time
 = 0;

1038 
mada
 = 0;

1039 
mada
 = (((
ut64_t
)(
rvipt
)<< 
SERVICE_PORT_OFFSET
);

1040 
mada
 = mad| (
nid
)

1041 | (((
ut64_t
)(
nw_ty
)<< 
NW_TYPE_OFFSET
);

1043 
upkt_out_posy_y_p
->
mada
 = (metadata & 0xF0FFFFFFFFFFFFFF);

1044 
upkt_out_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

1045 
upkt_out_posy_y_p
->
tun_id
 = (
mada
 & 0x0000000000FFFFFF);

1047 
upkt_out_posy_y_p
->
nw_pt_b
 = 
FALSE
;

1048 
upkt_out_posy_y_p
->
iܙy
 = 2;

1050 
	`memy
(
upkt_out_posy_y_p
->
d_mac
,
m_pt_p
->
vmInfo
.
vm_pt_mac
,6);

1051 
upkt_out_posy_y_p
->
d_mac_high
 = 
	`ohl
(*(
ut32_t
*)(upkt_out_posy_y_p->
d_mac
));

1052 
upkt_out_posy_y_p
->
d_mac_low
 = 
	`ohl
(*(
ut32_t
*)(upkt_out_posy_y_p->
d_mac
 + 2));

1054 
upkt_out_posy_y_p
->
out_pt_no
 = 
m_pt_p
->
pt_id
;

1056 
upkt_out_posy_y_p
->
pt_ty
 = 
m_pt_p
->
m_pt_ty
;

1059 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1060 
hashobj_p
 = (
uch8_t
 *)(
upkt_out_posy_y_p
+ 
offt
;

1062 
	`MCHASH_APPEND_NODE
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_y_p
,
dex
,
magic
,
hashobj_p
,
us_b
);

1063 if(
us_b
 =
FALSE
)

1065 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddable 3epositoryntry");

1067 
tv
 = 
NSC_FAILED_TO_ADD_REPOSITORY_ENTRY
;

1068 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1069 (
uch8_t
 *)
upkt_out_posy_y_p
,

1070 
upkt_out_posy_y_p
->
hp_b


1072 
us
 = 
OF_FAILURE
;

1076 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_3 Successfullyppended ucastpkt outportepositoryntryo hashable");

1077 
upkt_out_posy_y_p
->
magic
 = magic;

1078 
upkt_out_posy_y_p
->
dex
 = index;

1080 
upkt_out_posy_y_p
->
_n
 = 
magic
;

1081 (
upkt_out_posy_y_p
->
_n
(((upkt_out_posy_y_p->_n<< 32| (
dex
));

1083 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_3
(
dp_hd
,
upkt_out_posy_y_p
);

1084 if(
tv
 =
OF_FAILURE
)

1086 
us
 = 
OF_FAILURE
;

1087 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"sc_add_v3_proactive_flow failedo send Flow Mod messageo Table 3");

1091 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Successfully Sent Flow Mod messageo Table 3");

1093 
	`tf
("\r\n T3PF-S");

1097 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1098  
us
;

1099 
	}
}

1111 
t32_t
 
	$tsc_uni_b_3_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

1112 
o_ck_
* 
pkt_
,

1113 
ut64_t
 
mada
,

1114 
ut32_t
 
_pt
,

1115 
ut32_t
 
tun_c_
)

1117 
ut8_t
 
ii
,
nw_ty
;

1118 
ut32_t
 
nid
;

1119 
ut16_t
 
rvipt
;

1120 * 
lol_swch_me_p
;

1121 
ut8_t
* 
pkt_da
;

1122 
upkt_out_posy_y
* 
upkt_out_posy_y_p
 = 
NULL
;

1123 
b_brr_msg
* 
b_3_brr
 = 
NULL
;

1124 
t32_t
 
tv
 = 
OF_SUCCESS
;

1126 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Miss Packeteceived by Table_3");

1128 
b_3_brr
 = (
b_brr_msg
*)
	`oc
(1,(table_barrier_msg));

1129 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

1130 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

1131 
rvipt
 = (
ut16_t
)(
mada
 >> 
SERVICE_PORT_OFFSET
);

1133 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nid = %x",
nid
);

1137 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1138 
tv
 = 
	`g_swme_by_dphd
(
dp_hd
,&(
lol_swch_me_p
));

1139 if(
tv
 !
DPRM_SUCCESS
)

1141 
tv
 = 
OF_FAILURE
;

1142 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1143  
tv
;

1145 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1147 
tv
 = 
	`tsc_g_upkt_out_posy_y
(
dp_hd
,

1148 
lol_swch_me_p
,
nw_ty
,
nid
,

1149 
rvipt
,
mada
,

1150 
pkt_
,

1151 &
upkt_out_posy_y_p


1154 if(
tv
 !
OF_SUCCESS
)

1156 
	`tf
("\r\n TABLE_3 Failedo get ucastpkt_outport_repository_entry");

1157 
pkt_da
 = 
pkt_
->
ck
;

1158 
ii
=0;ii<36;ii++)

1159 
	`tf
(" %x",
pkt_da
[
ii
]);

1160  
OF_FAILURE
;

1162 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_3
(
dp_hd
,
upkt_out_posy_y_p
);

1164 if(
tv
 =
OF_FAILURE
)

1166 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Flow Mod messageo Table 3");

1170 
b_3_brr
->
dp_hd
 = dp_handle;

1171 
b_3_brr
->
_pt
 = in_port;

1172 
b_3_brr
->
pkt_
 =kt_in;

1173 
tv
 = 
	`of_nd_brr_que_msg
(
dp_hd
,

1174 
tsc_brr_y_nifiti_
,

1175 
b_3_brr
,
NULL
);

1177 if(
tv
 !
OF_SUCCESS
)

1179 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"barrierequest forable 3 failed");

1180 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
dp_hd
,
_pt
,
pkt_
);

1181 if(
tv
 =
OF_FAILURE
)

1183 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Packet out message for Table 2");

1189  
tv
;

1190 
	}
}

1195 
t32_t
 
	$tsc_g_upkt_out_posy_y
(
ut64_t
 
dp_hd
,

1196 * 
lol_swch_me_p
,

1197 
ut8_t
 
nw_ty
,

1198 
ut32_t
 
nid
,

1199 
ut16_t
 
rvipt
,

1200 
ut64_t
 
mada
,

1201 
o_ck_
* 
pkt_
,

1202 
upkt_out_posy_y
** 
upkt_out_posy_node_p_p


1205 
upkt_out_posy_y
* 
upkt_out_posy_y_p
 = 
NULL
;

1206 
upkt_out_posy_y
* 
upkt_out_posy_sn_node_p
 = 
NULL
;

1207 
ut8_t
* 
pkt_da
;

1208 
ut64_t
 
m_pt_hd
;

1209 
m_pt
* 
d_m_pt_p
;

1211 
ut64_t
 
vn_hd
;

1212 
ut32_t
 
offt
;

1213 
ut32_t
 
dex
,
magic
;

1214 
ut32_t
 
hashkey
,
hashmask
;

1215 
ut8_t
 
hp_b
;

1216 
mchash_b
* 
nsc_posy_b_p
;

1217 * 
nsc_posy_mempo_g
;

1219 
uch8_t
* 
hashobj_p
 = 
NULL
;

1220 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1221 
m_vtu_twk
* 
vn_y_p
;

1222 
ut32_t
 
d_mac_high
,
d_mac_low
;

1224 
dm_swch_fo
 
cfig_fo
;

1225 
dm_swch_ruime_fo
 
ruime_fo
;

1226 
ut64_t
 
swch_hd
;

1227 
ut32_t
 
ii
,
no_of_me_s
;

1228 
ut32_t
 *
me_s_p
 = 
NULL
;

1230 
t32_t
 
tv
 = 
OF_SUCCESS
;

1231 
ut8_t
 
us
 = 
FALSE
;

1233 
pkt_da
 = 
pkt_
->
ck
;

1235 
d_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
));

1236 
d_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
 + 2));

1238 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1239 if(
tv
 !
OF_SUCCESS
)

1241 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

1242  
OF_FAILURE
;

1245 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1246 if(
tv
 !
OF_SUCCESS
)

1248 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1249  
OF_FAILURE
;

1252 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1254 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1256 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1258 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

1259 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
;

1261 
hashmask
 = 
nsc_no_of_posy_b_3_bucks_g
;

1262 
hashkey
 = 
	`nsc_compu_hash_posy_b_3
(
rvipt
,

1263 
d_mac_high
,

1264 
d_mac_low
,

1265 
dp_hd
,

1266 
hashmask
);

1268 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_sn_node_p
,
upkt_out_posy_y
 *, 
offt
)

1270 if((
rvipt
 !
upkt_out_posy_sn_node_p
->serviceport) ||

1271 (
dp_hd
 !
upkt_out_posy_sn_node_p
->dp_handle) ||

1272 (
d_mac_high
 !
upkt_out_posy_sn_node_p
->dst_mac_high) ||

1273 (
d_mac_low
 !
upkt_out_posy_sn_node_p
->dst_mac_low)

1277 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_3 ucastpkt_outportepositoryntry found");

1279 *(
upkt_out_posy_node_p_p

upkt_out_posy_sn_node_p
;

1280 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1281  
OF_SUCCESS
;

1286 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1288 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"getew mem block for ucastpkt outportepositoryntry");

1289 
tv
 = 
	`mempo_g_mem_block
(
nsc_posy_mempo_g
,(
uch8_t
 **)&
upkt_out_posy_y_p
,&
hp_b
);

1290 if(
tv
 !
MEMPOOL_SUCCESS
)

1292 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memory blockllocation for ucastpkt outportepositoryntry failed");

1293  
OF_FAILURE
;

1295 
	`ry
(
upkt_out_posy_y_p
->
lol_swch_me_p
,local_switch_name_p);

1296 
upkt_out_posy_y_p
->
nw_ty
 =w_type;

1297 
upkt_out_posy_y_p
->
dp_hd
 = dp_handle;

1298 
upkt_out_posy_y_p
->
d_mac_high
 = dst_mac_high;

1299 
upkt_out_posy_y_p
->
d_mac_low
 = dst_mac_low;

1301 
upkt_out_posy_y_p
->
nid
 =id;

1302 
upkt_out_posy_y_p
->
rvipt
 = serviceport;

1303 
upkt_out_posy_y_p
->
id_time
 = 300;

1304 
upkt_out_posy_y_p
->
mada
 = (metadata & 0xF0FFFFFFFFFFFFFF);

1305 
upkt_out_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

1306 
upkt_out_posy_y_p
->
tun_id
 = (
mada
 & 0x0000000000FFFFFF);

1307 
upkt_out_posy_y_p
->
nw_pt_b
 = 
FALSE
;

1308 
upkt_out_posy_y_p
->
iܙy
 = 1;

1311 
	`memy
(
upkt_out_posy_y_p
->
d_mac
,
pkt_da
,6);

1316 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1318 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vmpt_by_dmac_nid
(
upkt_out_posy_y_p
->
d_mac
,

1319 
upkt_out_posy_y_p
->
nid
,

1320 &
m_pt_hd
);

1322 if(
tv
 =
OF_SUCCESS
)

1324 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
d_m_pt_p
);

1326 if(
tv
 =
OF_SUCCESS
)

1328 
upkt_out_posy_y_p
->
out_pt_no
 = 
d_m_pt_p
->
pt_id
;

1330 
upkt_out_posy_y_p
->
tun_de_
 = 
d_m_pt_p
->
swch_
;

1332 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"tun_de_ = %x",
d_m_pt_p
 ->
swch_
);

1333 
	`ry
(
upkt_out_posy_y_p
->
me_swch_me_p
,
d_m_pt_p
->
swch_me
);

1335 
upkt_out_posy_y_p
->
pt_ty
 = 
d_m_pt_p
->
m_pt_ty
;

1339 
tv
 = 
OF_FAILURE
;

1349 
upkt_out_posy_y_p
->
pt_ty
 = 
VM_GUEST_PORT
;

1350 
	`ry
(
upkt_out_posy_y_p
->
me_swch_me_p
,"nw_node");

1351 
no_of_me_s
 = 50;

1352 
me_s_p
 = (
ut32_t
 *)(
	`mloc
(( (ut32_t* 
no_of_me_s
)));

1354 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_me_s
(
lol_swch_me_p
,

1355 
rvipt
,0,

1356 &
no_of_me_s
,

1357 
me_s_p
);

1362 if(
tv
 !
OF_SUCCESS
)

1364 
tv
 = 
OF_FAILURE
;

1368 
tv
 = 
	`dm_g_f_swch
(&
cfig_fo
,&
ruime_fo
,&
swch_hd
);

1369 if(
tv
 =
DPRM_SUCCESS
)

1371 
ii
 = 0; i< 
no_of_me_s
;ii++)

1373 if(
cfig_fo
.
v4addr
.
addr
 =
me_s_p
[
ii
])

1375 
me_s_p
[
ii
] = 0;

1382 
tv
 = 
OF_FAILURE
;

1388 
tv
 = 
	`dm_g_xt_swch
(&
cfig_fo
,&
ruime_fo
,&
swch_hd
);

1389 if(
tv
 =
OF_SUCCESS
)

1391 
ii
 = 0; i< 
no_of_me_s
;ii++)

1393 if(
cfig_fo
.
v4addr
.
addr
 =
me_s_p
[
ii
])

1395 
me_s_p
[
ii
] = 0;

1400 if((
tv
 =
DPRM_ERROR_INVALID_SWITCH_HANDLE
|| (tv =
DPRM_ERROR_NO_MORE_ENTRIES
))

1406 if(
tv
 =
DPRM_ERROR_INVALID_SWITCH_HANDLE
)

1408 
tv
 = 
OF_FAILURE
;

1411 
upkt_out_posy_y_p
->
tun_de_
 = 0;

1412 
ii
 = 0; i< 
no_of_me_s
;ii++)

1414 if(
me_s_p
[
ii
] != 0)

1416 
upkt_out_posy_y_p
->
tun_de_
 = 
me_s_p
[
ii
];

1421 if(
upkt_out_posy_y_p
->
tun_de_
 == 0)

1423 
	`tf
("\r\n Failedo getwode ip");

1424 
tv
 = 
OF_FAILURE
;

1427 
upkt_out_posy_y_p
->
id_time
 = 1000;

1434 if((
upkt_out_posy_y_p
->
pt_ty
 =
VM_GUEST_PORT
)

1436 (
	`rcmp
((
upkt_out_posy_y_p
->
lol_swch_me_p
),

1437 (
upkt_out_posy_y_p
->
me_swch_me_p
)))

1445 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
lol_swch_me_p
,

1446 
rvipt
,

1447 &(
upkt_out_posy_y_p
->
out_pt_no
)

1450 if(
tv
 !
OF_SUCCESS
)

1452 
tv
 = 
OF_FAILURE
;

1455 
upkt_out_posy_y_p
->
nw_pt_b
 = 
TRUE
;

1459 if(
tv
 =
OF_FAILURE
)

1461 if(
me_s_p
 !
NULL
)

1463 
	`
(
me_s_p
);

1466 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1467 (
uch8_t
 *)
upkt_out_posy_y_p
,

1468 
upkt_out_posy_y_p
->
hp_b


1470 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1471  
OF_FAILURE
;

1475 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1476 
hashobj_p
 = (
uch8_t
 *)(
upkt_out_posy_y_p
+ 
offt
;

1478 
	`MCHASH_APPEND_NODE
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_y_p
,
dex
,
magic
,
hashobj_p
,
us
);

1479 if(
us
 =
FALSE
)

1481 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddable 3epositoryntry");

1483 
tv
 = 
NSC_FAILED_TO_ADD_REPOSITORY_ENTRY
;

1484 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1485 (
uch8_t
 *)
upkt_out_posy_y_p
,

1486 
upkt_out_posy_y_p
->
hp_b


1488 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1489  
tv
;

1492 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_3 Successfullyppended ucastpkt outportepositoryntryo hashable");

1493 
upkt_out_posy_y_p
->
magic
 = magic;

1494 
upkt_out_posy_y_p
->
dex
 = index;

1496 
upkt_out_posy_y_p
->
_n
 = 
magic
;

1497 (
upkt_out_posy_y_p
->
_n
(((upkt_out_posy_y_p->_n<< 32| (
dex
));

1499 *(
upkt_out_posy_node_p_p

upkt_out_posy_y_p
;

1501 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1502  
tv
;

1503 
	}
}

1515 
t32_t
 
	$tsc_brd_outbound_b_4_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

1516 
o_ck_
* 
pkt_
,

1517 
ut64_t
 
mada
,

1518 
ut32_t
 
_pt


1521 
vmpts_posy_y
* 
vmpts_posy_y_p
 = 
NULL
;

1522 
nwpts_brd_posy_y
* 
nwpts_brd_posy_y_p
 = 
NULL
;

1523 
ut8_t
 
nw_ty
;

1524 
ut32_t
 
nid
;

1525 
ut16_t
 
rvipt
;

1526 * 
lol_swch_me_p
;

1527 
ut32_t
 
tv
 = 
OF_SUCCESS
;

1541 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Miss Packeteceived by Table_4");

1542 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "PKT-IN METADATA3 =%x",
mada
);

1544 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

1546 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nw_ty =%d",
nw_ty
);

1548 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1550 
tv
 = 
	`g_swme_by_dphd
(
dp_hd
,&(
lol_swch_me_p
));

1551 if(
tv
 !
DPRM_SUCCESS
)

1553 
tv
 = 
OF_FAILURE
;

1554 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1555 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "switch isot found");

1556  
tv
;

1559 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1561 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

1562 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "vn=%x",
nid
);

1563 
rvipt
 = (
ut16_t
)(
mada
 >> 
SERVICE_PORT_OFFSET
);

1564 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "swcham=%s",
lol_swch_me_p
);

1566 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"mad%x",
mada
);

1567 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"swcham%s",
lol_swch_me_p
);

1569 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Entering brdcastepositoryntry");

1570 
tv
 = 
	`tsc_g_nwpts_brd_posy_y
(
lol_swch_me_p
,

1571 
nw_ty
,

1573 
rvipt
,

1574 
mada
,

1575 &
nwpts_brd_posy_y_p
);

1577 if(
tv
 !
OF_SUCCESS
)

1579 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Broadcast Portsot foundable 4");

1580  
OF_FAILURE
;

1582 
tv
 = 
	`tsc_g_vmpts_posy_y
(
lol_swch_me_p
,
nw_ty
,
nid
,

1583 
mada
,

1584 &
vmpts_posy_y_p


1586 if(
tv
 !
OF_SUCCESS
)

1588 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "VMortsot foundable 4");

1589 if(
nwpts_brd_posy_y_p
 !
NULL
)

1590 
	`
(
nwpts_brd_posy_y_p
);

1591  
OF_FAILURE
;

1593 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_4
(
dp_hd
,
vmpts_posy_y_p
,

1594 
nwpts_brd_posy_y_p
);

1596 if(
tv
 =
OF_FAILURE
)

1598 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Flow Mod messageo Table 4");

1602 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
dp_hd
,
_pt
,
pkt_
);

1603 if(
tv
 =
OF_FAILURE
)

1605 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Packet out message for Table 4");

1609 if(
vmpts_posy_y_p
->
vmside_pts_p
)

1610 
	`
(
vmpts_posy_y_p
->
vmside_pts_p
);

1611 if(
vmpts_posy_y_p
 !
NULL
)

1612 
	`
(
vmpts_posy_y_p
);

1613 if(
nwpts_brd_posy_y_p
->
nwside_br_pts_p
 !
NULL
 )

1614 
	`
(
nwpts_brd_posy_y_p
->
nwside_br_pts_p
);

1615 if(
nwpts_brd_posy_y_p
 !
NULL
)

1616 
	`
(
nwpts_brd_posy_y_p
);

1618  
tv
;

1619 
	}
}

1624 
t32_t
 
	$tsc_de_nsc_bs_1_2_ows_f_rvi_vm_ded
(
ut64_t
 
vn_hd
,ut64_
m_pt_hd
)

1626 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1627 
nscha_posy_y
* 
nsc_posy_node_p
;

1628 
mchash_b
* 
nsc_posy_b_p
;

1629 
ut8_t
 
sk_this_y
;

1630 
ut32_t
 
hashkey
,
offt
,
tv
;

1631 
ut16_t
 
vn_id_
,
vn_id_out
;

1632 
m_vtu_twk
* 
vn_y_p
;

1633 
m_pt
* 
m_pt_p
;

1635 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1636 if(
tv
 !
OF_SUCCESS
)

1638 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1639 
	`tf
("NSMDEL 02 ");

1640  
OF_FAILURE
;

1643 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_p
);

1644 if(
tv
 !
CRM_SUCCESS
)

1646 
	`tf
("NSMDEL 02A ");

1647  
tv
;

1650 
vn_id_
 = 
m_pt_p
->vlan_id_in;

1651 
vn_id_out
 = 
m_pt_p
->vlan_id_out;

1653 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1655 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

1656 
hashkey
 = 0;

1657 
sk_this_y
 = 1;

1659 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1661 
	`MCHASH_TABLE_SCAN
(
nsc_posy_b_p
,
hashkey
)

1663 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

1664 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_node_p
,
nscha_posy_y
 *,
offt
)

1666 if(((
nsc_posy_node_p
->
mch_vn_id
& 0xfff=
vn_id_
)

1668 (((
nsc_posy_node_p
->
mch_vn_id
& 0xfff=
vn_id_out
)

1670 (((
nsc_posy_node_p
->
xt_vn_id
& 0xfff=
vn_id_
 )

1672 (((
nsc_posy_node_p
->
xt_vn_id
& 0xfff=
vn_id_out
)

1675 
nsc_posy_node_p
->
sk_this_y
 = 1;

1678 if(
sk_this_y
)

1680 
	`CNTLR_LOCK_TAKE
(
nsc_posy_node_p
->

.
bd_node_p
->
bd_node_lock
);

1681 
nsc_posy_node_p
->

.
bd_node_p
->
sk_this_y
 = 1;

1682 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Markhe cn_bind_entrys skip_this_entry sohat it isot used further.");

1683 
	`CNTLR_LOCK_RELEASE
(
nsc_posy_node_p
->

.
bd_node_p
->
bd_node_lock
);

1685 
sk_this_y
 = 0;

1688 
	`tsc_olug_v1_3_d_b_1_2_bd_ow_s
(
nsc_posy_node_p
,
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
);

1693 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

1694 
hashkey
 = 0;

1696 
	`MCHASH_TABLE_SCAN
(
nsc_posy_b_p
,
hashkey
)

1698 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

1699 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_node_p
,
nscha_posy_y
 *,
offt
)

1701 if(((
nsc_posy_node_p
->
mch_vn_id
& 0xfff=
vn_id_
)

1703 (((
nsc_posy_node_p
->
mch_vn_id
& 0xfff=
vn_id_out
)

1705 (((
nsc_posy_node_p
->
xt_vn_id
& 0xfff=
vn_id_
 )

1707 (((
nsc_posy_node_p
->
xt_vn_id
& 0xfff=
vn_id_out
)

1710 
nsc_posy_node_p
->
sk_this_y
 = 1;

1712 
	`tsc_olug_v1_3_d_b_1_2_bd_ow_s
(
nsc_posy_node_p
,
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
);

1716 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1717 
	`tf
("NSMDEL 11 ");

1718  
OF_SUCCESS
;

1719 
	}
}

1724 
t32_t
 
	$tsc_ow_y_mov_msg_cvd_nscha_bs
(
ut64_t
 
dp_hd
,ut64_
mada
,

1725 
ut64_t
 
cook
,
ut8_t
 
as
,ut8_
b_id
)

1728 
ut8_t
 
nw_ty
;

1729 
ut32_t
 
nid
,
offt
;

1730 
ut64_t
 
vn_hd
;

1731 
m_vtu_twk
* 
vn_y_p
;

1732 
ut8_t
 
us_b
 = 
FALSE
;

1733 
ut32_t
 
dex
,
magic
;

1734 
mchash_b
* 
nsc_posy_b_p
;

1735 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1736 
nscha_posy_y
* 
nsc_posy_node_p
;

1737 
t32_t
 
tv
 = 
OF_SUCCESS
;

1739 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

1740 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

1742 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1743 if(
tv
 !
OF_SUCCESS
)

1745 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

1746  
OF_FAILURE
;

1749 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1750 if(
tv
 !
OF_SUCCESS
)

1752 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1753  
OF_FAILURE
;

1756 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1758 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

1760 if(
b_id
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

1761 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

1762 if(
b_id
 =
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
)

1763 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

1765  
OF_FAILURE
;

1767 
magic
 = (
ut32_t
)(
cook
 >>32);

1768 
dex
 = (
ut32_t
)
cook
;

1770 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1772 
	`MCHASH_ACCESS_NODE
(
nsc_posy_b_p
,
dex
,
magic
,
nsc_posy_node_p
,
us_b
);

1774 if(
us_b
 !
TRUE
)

1776 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Nػposyry found mchg whhowemov mesgived f܁ab = %d",
b_id
);

1777 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1778  
OF_FAILURE
;

1781 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

1785 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Deletingheschainepositoryntry found");

1787 
dex
 = 
nsc_posy_node_p
->

.index;

1788 
magic
 = 
nsc_posy_node_p
->

.magic;

1790 
nsc_posy_node_p
->
sk_this_y
 = 1;

1791 
	`tsc_mk__bd_y_as_e
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
,vn_nsc_fo_p->
nsc__bd_mempo_g
,
dex
,
magic
);

1793 
	`MCHASH_DELETE_NODE_BY_REF
(
nsc_posy_b_p
, 
nsc_posy_node_p
->
dex
,nsc_posy_node_p->
magic
,

1794 
nscha_posy_y
 *,
offt
,
us_b
);

1796 if(
us_b
 =
TRUE
)

1798 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Rosyry ded sucssfuy fromab˄osy dhd = %x,%d",
dp_hd
,
b_id
);

1802 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Rosyry di faed fromab˄osy dhd = %x,%d",
dp_hd
,
b_id
);

1803 
tv
 = 
OF_FAILURE
;

1806 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1808 if(
as
 =
OFPRR_DELETE
)

1810 if(
b_id
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

1811 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_1
(
dp_hd
,
nsc_posy_node_p
);

1813 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_2
(
dp_hd
,
nsc_posy_node_p
);

1815 if(
tv
 =
OF_FAILURE
)

1817 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedaddhowrythswch upڄeivg flowviiڃvom swchab = %d",
b_id
);

1821 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sucssfuyddedhowrythswch upڄeivg flowviiڃvom swchab = %d",
b_id
);

1825  
tv
;

1826 
	}
}

1830 
t32_t
 
	$tsc_ow_y_mov_msg_cvd_b_3
(
ut64_t
 
dp_hd
,ut64_
mada
,

1831 
ut64_t
 
cook
,
ut8_t
 
as
)

1833 
ut8_t
 
nw_ty
;

1834 
ut32_t
 
nid
;

1836 
ut64_t
 
vn_hd
;

1837 
m_vtu_twk
* 
vn_y_p
;

1838 
ut8_t
 
us_b
 = 
FALSE
;

1839 
ut32_t
 
dex
,
magic
,
offt
;

1840 
mchash_b
* 
nsc_posy_b_p
;

1842 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1843 
upkt_out_posy_y
* 
upkt_out_posy_y_p
;

1845 
t32_t
 
tv
 = 
OF_SUCCESS
;

1847 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

1848 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

1852 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1853 if(
tv
 !
OF_SUCCESS
)

1855 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

1856  
OF_FAILURE
;

1859 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1860 if(
tv
 !
OF_SUCCESS
)

1862 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1863  
OF_FAILURE
;

1866 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1868 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1869 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1871 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

1873 
magic
 = (
ut32_t
)(
cook
 >>32);

1874 
dex
 = (
ut32_t
)
cook
;

1876 
	`MCHASH_ACCESS_NODE
(
nsc_posy_b_p
,
dex
,
magic
,
upkt_out_posy_y_p
,
us_b
);

1881 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Deletinghe ucastpkt_outportepositoryntry found");

1883 
	`MCHASH_DELETE_NODE_BY_REF
(
nsc_posy_b_p
, 
upkt_out_posy_y_p
->
dex
,upkt_out_posy_y_p->
magic
,

1884 
upkt_out_posy_y
 *,
offt
,
us_b
);

1885 if(
us_b
 =
TRUE
)

1887 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Rosyry ded sucssfuy fromab_3osy dhd = %x",
dp_hd
);

1891 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Rosyry di faed fromab_3osy dhd = %x",
dp_hd
);

1892 
tv
 = 
OF_FAILURE
;

1895 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1897 if(
as
 =
OFPRR_DELETE
)

1900 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_3
(
dp_hd
,
upkt_out_posy_y_p
);

1901 if(
tv
 =
OF_FAILURE
)

1903 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddhe flowntryohe switch uponeceiving flowvictionvent from switch");

1907 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfullyddedhe flowntryohe switch uponeceiving flowvictionvent from switch");

1911  
OF_SUCCESS
;

1912 
	}
}

1917 
t32_t
 
	$tsc_de_b_3_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
)

1937 
ut8_t
 
pt_mac_addr
[6];

1938 
ut16_t
 
rvi_pt
 = 0;

1939 
ut32_t
 
d_mac_high
,
d_mac_low
;

1940 
ut64_t
 
vn_hd
;

1941 
m_pt
* 
m_pt_p
;

1942 
m_vtu_twk
* 
vn_y_p
;

1943 
m_compu_node
* 
m_compu_node_y_sn_p
;

1944 
ut8_t
 
us_b
 = 
FALSE
;

1945 
ut32_t
 
hashkey
,
hashmask
,
offt
;

1946 
mchash_b
* 
nsc_posy_b_p
;

1948 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1949 
upkt_out_posy_y
* 
upkt_out_posy_sn_node_p
;

1951 
t32_t
 
tv
 = 
OF_SUCCESS
;

1953 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_p
);

1954 if(
tv
 !
CRM_SUCCESS
)

1956  
tv
;

1959 if(
m_pt_p
->
nw_ty
 =
VXLAN_TYPE
)

1960 
rvi_pt
 = (
m_pt_p
->
nw_ms
).
vxn_nw
.service_port;

1961 if(
m_pt_p
->
nw_ty
 =
NVGRE_TYPE
)

1962 
rvi_pt
 = (
m_pt_p
->
nw_ms
).
nvg_nw
.service_port;

1964 
	`memy
(
pt_mac_addr
,
m_pt_p
->
vmInfo
.
vm_pt_mac
,6);

1965 
d_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pt_mac_addr
));

1966 
d_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pt_mac_addr
 + 2));

1968 
vn_hd
 = 
m_pt_p
->
f_vn
;

1970 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1971 if(
tv
 !
CRM_SUCCESS
)

1973 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unableo fetch vn_entry");

1974  
OF_FAILURE
;

1977 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1979 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1980 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1982 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

1985 
hashmask
 = 
nsc_no_of_posy_b_3_bucks_g
;

1987 
	`OF_LIST_SCAN
(
vn_y_p
->
m_compu_nodes
,

1988 
m_compu_node_y_sn_p
,

1989 
m_compu_node
*,

1990 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
)

1992 
dp_hd
 = 
m_compu_node_y_sn_p
->
dp_ns
[0].
f_logil_swch
;

1994 
hashkey
 = 
	`nsc_compu_hash_posy_b_3
(
rvi_pt
,

1995 
d_mac_high
,

1996 
d_mac_low
,

1997 
dp_hd
,

1998 
hashmask
);

2000 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_sn_node_p
,
upkt_out_posy_y
 *, 
offt
)

2002 if((
rvi_pt
 !
upkt_out_posy_sn_node_p
->
rvipt
) ||

2003 (
dp_hd
 !
upkt_out_posy_sn_node_p
->dp_handle) ||

2004 (
d_mac_high
 !
upkt_out_posy_sn_node_p
->dst_mac_high) ||

2005 (
d_mac_low
 !
upkt_out_posy_sn_node_p
->dst_mac_low)

2009 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Deletinghe ucastpkt_outportepositoryntry found");

2011 
	`MCHASH_DELETE_NODE_BY_REF
(
nsc_posy_b_p
, 
upkt_out_posy_sn_node_p
->
dex
,upkt_out_posy_sn_node_p->
magic
,

2012 
upkt_out_posy_y
 *,
offt
,
us_b
);

2013 if(
us_b
 =
TRUE
)

2015 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Rosyry ded sucssfuy fromab_3osy dhd = %x",
dp_hd
);

2019 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Rosyry di faed fromab_3osy dhd = %x",
dp_hd
);

2020 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2021 
tv
 = 
OF_FAILURE
;

2026 
	`tsc_olug_v1_3_d_ows_om_b_3
(
dp_hd
,
pt_mac_addr
);

2028 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2029  
tv
;

2030 
	}
}

2034 
t32_t
 
	$tsc_de_b_4_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
)

2067 
tsc_ofv_ug_i
* 
tsc_ms_vm_p
;

2068 
m_pt
* 
m_pt_p
;

2069 
ut8_t
 
nw_ty
,
b_id
;

2070 
t32_t
 
tv
;

2072 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_p
);

2073 if(
tv
 !
CRM_SUCCESS
)

2075  
tv
;

2079 
nw_ty
 = 
m_pt_p
->nw_type;

2081 
tsc_ms_vm_p
 = (
tsc_ofv_ug_i
 *(
	`mloc
( (tsc_ofver_plugin_iface )));

2082 if(
tsc_ms_vm_p
 =
NULL
)

2084  
OF_FAILURE
;

2087 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_cڡru_mada
(
tsc_ms_vm_p
,0,
m_pt_p
);

2089 if((
m_pt_ty
 =
VM_PORT
|| (m_pt_ty =
VMNS_PORT
))

2091 
tsc_ms_vm_p
->
mada
 &= 0xF000FFFFFFFFFFFF;

2092 
tsc_ms_vm_p
->
mada_mask
 = 0xF000FFFFFFFFFFFF;

2096 
tsc_ms_vm_p
->
mada
 &= 0xF000FFFF00000000;

2097 
tsc_ms_vm_p
->
mada_mask
 = 0xF000FFFF00000000;

2099 
b_id
 = 
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
;

2100 
	`tsc_olug_v1_3_d_ows_om_b_4_5
(
dp_hd
,
tsc_ms_vm_p
,
b_id
);

2102 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Ded flowomab_4 PKT-IN METADATA1 =%x",
tsc_ms_vm_p
->
mada
);

2103  
OF_SUCCESS
;

2104 
	}
}

2108 
t32_t
 
	$tsc_de_b_5_ow_s
(
ut8_t
 
m_pt_ty
,
ut64_t
 
m_pt_hd
,ut64_
dp_hd
)

2132 
tsc_ofv_ug_i
* 
tsc_ms_vm_p
;

2133 
m_pt
* 
m_pt_p
;

2134 
ut8_t
 
nw_ty
,
b_id
;

2135 
t32_t
 
tv
;

2137 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_p
);

2138 if(
tv
 !
CRM_SUCCESS
)

2140  
tv
;

2144 
nw_ty
 = 
m_pt_p
->nw_type;

2146 
tsc_ms_vm_p
 = (
tsc_ofv_ug_i
 *(
	`mloc
( (tsc_ofver_plugin_iface )));

2147 if(
tsc_ms_vm_p
 =
NULL
)

2149  
OF_FAILURE
;

2152 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_cڡru_mada
(
tsc_ms_vm_p
,0,
m_pt_p
);

2154 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA1 =%x",
tsc_ms_vm_p
->
mada
);

2156 if((
m_pt_ty
 =
VM_PORT
|| (m_pt_ty =
VMNS_PORT
))

2158 
tsc_ms_vm_p
->
mada
 &= 0xF000FFFFFFFFFFFF;

2159 
tsc_ms_vm_p
->
mada_mask
 = 0xF000FFFFFFFFFFFF;

2162 
b_id
 = 
TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
;

2163 
	`tsc_olug_v1_3_d_ows_om_b_4_5
(
dp_hd
,
tsc_ms_vm_p
,
b_id
);

2165 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Ded flowomab_5 PKT-IN METADATA1 =%x",
tsc_ms_vm_p
->
mada
);

2166  
OF_SUCCESS
;

2167 
	}
}

2179 
t32_t
 
	$tsc_brd_bound_b_5_miss_y_pkt_rcvd
(
ut64_t
 
dp_hd
,

2180 
o_ck_
* 
pkt_
,

2181 
ut64_t
 
mada
,

2182 
ut32_t
 
_pt
,

2183 
ut32_t
 
tun_c_


2186 
vmpts_posy_y
* 
vmpts_posy_y_p
 = 
NULL
;

2187 
ut8_t
 
nw_ty
;

2188 
ut32_t
 
nid
;

2189 
ut8_t
 
pt_ty
 = 0;

2190 * 
lol_swch_me_p
;

2191 
ut8_t
* 
ck
 = 
pkt_
->packet;

2192 
t32_t
 
tv
 = 
OF_SUCCESS
;

2194 
m_pt
* 
m_vmside_pt_p
;

2195 
ut64_t
 
m_pt_hd
;

2196 
ut64_t
 
ouut_m_pt_hd
;

2205 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Miss Packeteceived by Table_5");

2207 
nw_ty
 = (
ut8_t
)(
mada
 >> 
NW_TYPE_OFFSET
);

2212 
nid
 = (
ut32_t
)(
mada
 & 
TUN_ID_MASK
);

2217 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vmpt_by_dmac_nid
(&
ck
[6],
nid
,&
m_pt_hd
);

2218 if(
tv
 !
CRM_SUCCESS
)

2220 
tv
 = 
	`m_add_gue_m_vmpt
(&
ck
[6],
tun_c_
,&
ouut_m_pt_hd
);

2221 if(
tv
 =
CRM_SUCCESS
)

2223 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfullydded VM_GUEST_PORT");

2224 
pt_ty
 = 
VM_GUEST_PORT
;

2226 
tv
 = 
	`tsc_vxn_add_vmpt_to_ptmac_vw
(
ouut_m_pt_hd
,
nid
);

2227 if(
tv
 !
CRM_SUCCESS
)

2229 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedodd VM_GUEST_PORToheortmac view");

2233 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Added VM_GUEST_PORToheortmac view");

2238 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Error indding VM_GUEST_PORT");

2243 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_vmside_pt_p
);

2244 
pt_ty
 = 
m_vmside_pt_p
->
m_pt_ty
;

2247 if(
pt_ty
 =
VM_GUEST_PORT
)

2249 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"A VM_GUEST_PORT islreadyresent");

2253 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"A VM PORT islready configured")

2256 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"VNI = %x",
nid
);

2257 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"maadds","%x",
ck
[9],"%x",packet[10],"%x",packet[11]);

2259 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2262 
tv
 = 
	`g_swme_by_dphd
(
dp_hd
,&(
lol_swch_me_p
));

2263 if(
tv
 !
DPRM_SUCCESS
)

2265 
tv
 = 
OF_FAILURE
;

2266 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2267  
tv
;

2270 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2272 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn%x",
nid
);

2273 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nwy = %x",
nw_ty
);

2274 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"mad%x",
mada
);

2275 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"swcham%s",
lol_swch_me_p
);

2277 
tv
 = 
	`tsc_g_vmpts_posy_y
(
lol_swch_me_p
,

2278 
nw_ty
,

2279 
nid
,

2280 
mada
,

2281 &
vmpts_posy_y_p


2284 if(
tv
 !
OF_SUCCESS
)

2285  
OF_FAILURE
;

2288 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_5
(
dp_hd
,
vmpts_posy_y_p
);

2289 if(
tv
 =
OF_FAILURE
)

2291 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo send Flow Mod messageo Table 5");

2295 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
dp_hd
,
_pt
,
pkt_
);

2296 if(
tv
 =
OF_FAILURE
)

2298 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo send Packet out message for Table 5");

2301 if(
vmpts_posy_y_p
->
vmside_pts_p
)

2302 
	`
(
vmpts_posy_y_p
->
vmside_pts_p
);

2303 if(
vmpts_posy_y_p
 !
NULL
)

2304 
	`
(
vmpts_posy_y_p
);

2305  
tv
;

2306 
	}
}

2310 
t32_t
 
	$tsc_g_vmpts_posy_y
(* 
lol_swch_me_p
,

2311 
ut8_t
 
nw_ty
,

2312 
ut32_t
 
nid
,

2313 
ut64_t
 
mada
,

2314 
vmpts_posy_y
** 
vmpts_posy_node_p_p


2317 
vmpts_posy_y
* 
vmpts_posy_y_p
 = 
NULL
;

2318 
t32_t
 
tv
 = 
OF_SUCCESS
;

2320 
vmpts_posy_y_p
 = (
vmpts_posy_y
 *)

2321 (
	`mloc
( (
vmpts_posy_y
)));

2322 if(
vmpts_posy_y_p
 =
NULL
)

2324 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedolloc memory for vmportepositoryntry Table 4");

2325  
OF_FAILURE
;

2327 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Allocated memory for vmportepositoryntry Table 4");

2328 
	`ry
(
vmpts_posy_y_p
->
lol_swch_me_p
,local_switch_name_p);

2329 
vmpts_posy_y_p
->
nw_ty
 =w_type;

2330 
vmpts_posy_y_p
->
nid
 =id;

2331 
vmpts_posy_y_p
->
mada
 = metadata;

2332 
vmpts_posy_y_p
->
no_of_vmside_pts
 = 10;

2333 
vmpts_posy_y_p
->
vmside_pts_p
 =

2334 (
ut32_t
 *)(
	`mloc
( (ut32_t)* (
vmpts_posy_y_p
->
no_of_vmside_pts
) ));

2336 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2338 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vmpts_by_swme_nid
(

2339 
vmpts_posy_y_p
->
lol_swch_me_p
,

2340 
vmpts_posy_y_p
->
nid
,

2341 &(
vmpts_posy_y_p
->
no_of_vmside_pts
),

2342 
vmpts_posy_y_p
->
vmside_pts_p
);

2344 if(
tv
 !
OF_SUCCESS
)

2346 
tv
 = 
OF_FAILURE
;

2347 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo get vmports for broadcastngheacket");

2350 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2352 if(
tv
 =
OF_FAILURE
)

2354 if(
vmpts_posy_y_p
->
vmside_pts_p
)

2355 
	`
(
vmpts_posy_y_p
->
vmside_pts_p
);

2356 if(
vmpts_posy_y_p
)

2357 
	`
(
vmpts_posy_y_p
);

2358  
tv
;

2361 
vmpts_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

2362 
vmpts_posy_y_p
->
mada
 =

2363 (
vmpts_posy_y_p
->
mada
 & vmpts_posy_y_p->
mada_mask
);

2365 *(
vmpts_posy_node_p_p

vmpts_posy_y_p
;

2366  
OF_SUCCESS
;

2367 
	}
}

2371 
t32_t
 
	$tsc_g_nwpts_brd_posy_y
(* 
lol_swch_me_p
,

2372 
ut8_t
 
nw_ty
,

2373 
ut32_t
 
nid
,

2374 
ut16_t
 
rvipt
,

2375 
ut64_t
 
mada
,

2376 
nwpts_brd_posy_y
** 
nwpts_brd_posy_node_p_p
)

2378 
nwpts_brd_posy_y
* 
nwpts_brd_posy_y_p
 = 
NULL
;

2379 
t32_t
 
tv
 = 
OF_SUCCESS
;

2381 
nwpts_brd_posy_y_p
 = (
nwpts_brd_posy_y
 *)

2382 (
	`mloc
( (
nwpts_brd_posy_y
)));

2383 if(
nwpts_brd_posy_y_p
 =
NULL
)

2385  
tv
;

2387 
	`ry
(
nwpts_brd_posy_y_p
->
lol_swch_me_p
,local_switch_name_p);

2388 
nwpts_brd_posy_y_p
->
nw_ty
 =w_type;

2389 
nwpts_brd_posy_y_p
->
nid
 =id;

2390 
nwpts_brd_posy_y_p
->
rvipt
 = serviceport;

2391 
nwpts_brd_posy_y_p
->
mada
 = metadata;

2392 
nwpts_brd_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

2393 
nwpts_brd_posy_y_p
->
no_of_nwside_br_pts
 = 50;

2394 
nwpts_brd_posy_y_p
->
nwside_br_pts_p
 =

2395 (
ut32_t
 *)(
	`mloc
(( (uint32_t) *

2396 
nwpts_brd_posy_y_p
->
no_of_nwside_br_pts
)));

2398 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2400 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_brd_nwpts
(

2401 
nwpts_brd_posy_y_p
->
lol_swch_me_p
,

2402 
nwpts_brd_posy_y_p
->
rvipt
,

2403 
nwpts_brd_posy_y_p
->
nid
,

2404 &(
nwpts_brd_posy_y_p
->
no_of_nwside_br_pts
),

2405 
nwpts_brd_posy_y_p
->
nwside_br_pts_p
,0);

2407 if(
tv
 =
OF_FAILURE
)

2409 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get broadcastwarams");

2410 if(
nwpts_brd_posy_y_p
->
nwside_br_pts_p
 !
NULL
 )

2411 
	`
(
nwpts_brd_posy_y_p
->
nwside_br_pts_p
);

2412 if(
nwpts_brd_posy_y_p
 !
NULL
)

2413 
	`
(
nwpts_brd_posy_y_p
);

2414 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2415  
tv
;

2418 *(
nwpts_brd_posy_node_p_p

nwpts_brd_posy_y_p
;

2419 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2420  
OF_SUCCESS
;

2421 
	}
}

2425 
t32_t
 
	$tsc_gi_nvm_modu
(
tsc_nvm_modu_fo
* 
nvm_modu_fo_p
,

2426 
tsc_nvm_modu_r
* 
nvm_modu_r_p
)

2429 
t32_t
 
tv
 = 
OF_SUCCESS
;

2433 if((
nvm_modu_fo_p
 =
NULL
|| (
nvm_modu_r_p
 == NULL))

2435 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Invalid input");

2436 
tv
 = 
OF_FAILURE
;

2440 if(
nvm_modu_fo_p
->
nvm_modu_me
 =
NULL
)

2442 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NVM_MODULE_NAME isitherot specified");

2443 
tv
 = 
OF_FAILURE
;

2447 if((
nvm_modu_fo_p
->
nw_ty
 < 
SUPPORTED_NW_TYPE_MIN
|| (nvm_modu_fo_p->nw_ty > 
SUPPORTED_NW_TYPE_MAX
))

2449 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"NW_TYPE isot supported");

2450 
tv
 = 
OF_FAILURE
;

2454 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NVM MODULE NAME = %s",
nvm_modu_fo_p
->
nvm_modu_me
);

2455 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NW TYPE = %d",
nvm_modu_fo_p
->
nw_ty
);

2457 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_
 = 
nvm_modu_r_p
->nvm_module_init;

2459 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu__vmpt_vws
 = 
nvm_modu_r_p
->nvm_module_create_vmport_views;

2460 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_de_vmpt_vws
 = 
nvm_modu_r_p
->nvm_module_delete_vmport_views;

2461 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu__nwpt_vws
 = 
nvm_modu_r_p
->nvm_module_create_nwport_views;

2462 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_de_nwpt_vws
 = 
nvm_modu_r_p
->nvm_module_delete_nwport_views;

2464 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_uni_nwpt
 = 
nvm_modu_r_p
->nvm_module_get_unicast_nwport;

2465 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_me_s
 = 
nvm_modu_r_p
->nvm_module_get_remote_ips;

2466 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_brd_nwpts
 = 
nvm_modu_r_p
->nvm_module_get_broadcast_nwports;

2467 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_vmpt_by_dmac_nid
 = 
nvm_modu_r_p
->nvm_module_get_vmport_by_dmac_nid;

2468 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_vmpts_by_swme_nid
 = 
nvm_modu_r_p
->nvm_module_get_vmports_by_swname_nid;

2470 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_add_vn_to_nid_vw
 = 
nvm_modu_r_p
->nvm_module_add_vn_to_nid_view;

2471 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_de_vn_om_nid_vw
 = 
nvm_modu_r_p
->nvm_module_delete_vn_from_nid_view;

2472 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_g_vnhd_by_nid
 = 
nvm_modu_r_p
->nvm_module_get_vnhandle_by_nid;

2474 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
nvm_modu_cڡru_mada
 = 
nvm_modu_r_p
->nvm_module_construct_metadata;

2476 
tv
 = 
tsc_nvm_modus
[
nvm_modu_fo_p
->
nw_ty
].
	`nvm_modu_
();

2477  
tv
;

2480 if(
tv
 =
OF_SUCCESS
)

2482 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully Registered NVM Modules");

2484  
tv
;

2485 
	}
}

2487 
	$tsc_brr_y_nifiti_
(
ut64_t
 
cڌr_hd
,

2488 
ut64_t
 
doma_hd
,

2489 
ut64_t
 
dh_hd
,

2490 
of_msg
 *
msg
,

2491 *
cbk_g1
,

2492 *
cbk_g2
,

2493 
ut8_t
 
us
)

2495 
t32_t
 
tv
 = 
OF_FAILURE
;

2496 
b_brr_msg
* 
b_brr
;

2497 
b_brr
 = (
b_brr_msg
*
cbk_g1
;

2498 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"dp_hd : %x",
b_brr
->
dp_hd
);

2499 
tv
 = 
	`tsc_nd_pktout_1_3_msg
(
b_brr
->
dp_hd
,b_brr->
_pt
,b_brr->
pkt_
);

2500 if(
tv
 =
OF_FAILURE
)

2502 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Packet out message for Table 1");

2505 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sentkt outhrough callback in barrier wait");

2507 
	}
}

	@tsc_init.c

24 
	~"cڌr.h
"

25 
	~"of_uts.h
"

26 
	~"of_msgi.h
"

27 
	~"l_queue.h
"

28 
	~"r_s.h
"

29 
	~"r_.h
"

30 
	~"r_evt.h
"

31 
	~"dmldef.h
"

32 
	~"dc_vs_p.h
"

34 
	~"mi.h
"

35 
	~"mldef.h
"

36 
	~"m_vn_i.h
"

37 
	~"m_pt_i.h
"

38 
	~"nm.h
"

39 
	~"nmldef.h
"

40 
	~"pt_us_mgr.h
"

41 
	~"tsc_cڌr.h
"

42 
	~"tsc_olug_v1_3_ldef.h
"

43 
	~"tsc_ofv1_3_ug.h
"

44 
	~"tsc_nvm_modus.h
"

45 
	~"tsc_nvm_vxn.h
"

48 
tsc_nvm_modu_r
 
tsc_nvm_modus
[
SUPPORTED_NW_TYPE_MAX
 + 1];

50 
dm_diribud_fwdg_doma_fo
 
	gtsc_doma_fo
;

51 
ut64_t
 
	gtsc_doma_hd
;

53 
t32_t
 
tsc__p_
(
ut64_t
 
tsc_doma_hd
);

56 
tsc_doma_evt_back
(
ut32_t
 
nifiti_ty
,

57 
ut64_t
 
tsc_doma_hd
,

58 
dm_doma_nifiti_da
 
nifiti_da
,

59 *
back_g1
,

60 *
back_g2
);

62 
m_vn_nifitis_cbk
(
ut32_t
 
nifiti_ty
,

63 
ut64_t
 
vn_hd
,

64 
m_vn_nifiti_da
 
nifiti_da
,

65 *
back_g1
,

66 *
back_g2
);

68 
m_pt_nifitis_cbk
(
ut32_t
 
nifiti_ty
,

69 
ut64_t
 
vn_hd
,

70 
m_pt_nifiti_da
 
nifiti_da
,

71 *
back_g1
,

72 *
back_g2
);

74 
t32_t
 
tsc_hd_m_pt_addi
(
ut32_t
 
nifiti_ty
,

75 
ut64_t
 
vn_hd
,

76 
m_pt_nifiti_da
 
nifiti_da
,

77 *
back_g1
,

78 *
back_g2
);

80 
t32_t
 
tsc_hd_m_pt_di
(
ut32_t
 
nifiti_ty
,

81 
ut64_t
 
vn_hd
,

82 
m_pt_nifiti_da
 
nifiti_da
,

83 *
back_g1
,

84 *
back_g2
);

86 
t32_t
 
tsc__of_ugs
(
ut64_t
 
tsc_doma_hd
);

100 
t32_t
 
	$tsc_modu_
()

102 
t32_t
 
us
 = 
OF_SUCCESS
;

104 
	`dc_vs_p_
();

106 
us
 = 
	`dm_gi_fwdg_doma_nifitis
(
DPRM_DOMAIN_ALL_NOTIFICATIONS
,

107 
tsc_doma_evt_back
,

108 
NULL
, NULL);

109 if(
us
 !
OF_SUCCESS
)

111 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Registering callbacko forward domain failed....");

112  
OF_FAILURE
;

117 
	`ry
(
tsc_doma_fo
.
me
,"TSC_DOMAIN");

118 
	`ry
(
tsc_doma_fo
.
exed_subje_me_f_authtiti
,"tsc_domain@abc.com");

119 
	`ry
(
tsc_doma_fo
.
p_me
,"DATA_CENTER_VIRTUAL_SWITCH_TTP");

121 
us
 = 
	`dm__diribud_fwdg_doma
(&
tsc_doma_fo
,&
tsc_doma_hd
);

122 if(
us
 !
DPRM_SUCCESS
)

124 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"FaedAdd TSC_DOMAINthOF Cڌ˸aruu: stus=%d",
us
);

125  
OF_FAILURE
;

127 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Added TSC_DOMAINthOF Cڌ˸aruu: doma hd=%x ",
tsc_doma_hd
);

129  
OF_SUCCESS
;

130 
	}
}

140 
	$tsc_doma_evt_back
(
ut32_t
 
nifiti_ty
,

141 
ut64_t
 
tsc_doma_hd
,

142 
dm_doma_nifiti_da
 
nifiti_da
,

143 *
back_g1
,

144 *
back_g2
)

146 
t32_t
 
us
 = 
OF_SUCCESS
;

148 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ENTRY");

149 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nifiti_ty :%d",
nifiti_ty
);

150 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,

151 "Domaam%s", 
nifiti_da
.
doma_me
);

152 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,

153 "TTPam%s", 
nifiti_da
.
p_me
);

154 if(
	`rcmp
(
nifiti_da
.
p_me
, "DATA_CENTER_VIRTUAL_SWITCH_TTP"))

156 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"notification is NOT for data centertp.");

160 
nifiti_ty
)

162 
DPRM_DOMAIN_ADDED
:

164 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"FC DOMAIN ADDotificationvent ");

166 
us
 = 
	`tsc__of_ugs
(
tsc_doma_hd
);

167 if(
us
 !
OF_SUCCESS
)

169 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"FaedؚlizOFlowlugf Flow Cڌ Aliti: stus=%d",
us
);

172 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully initilized OF Plugins for Flow Control Application:");

175 
us
 = 
	`m_
();

176 if(
us
 !
OF_SUCCESS
)

178 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"\r\CRM modu inlizi faed: stus=%d",
us
);

181 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"CRM module initialization is successful");

183 
us
 = 
	`psm_modu_
();

184 if(
us
 !
OF_SUCCESS
)

186 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"\r\PSM modu inlizi faed: stus=%d",
us
);

189 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"PSM module initialization is successful");

192 
us
 = 
	`nm_
();

193 if(
us
 !
OF_SUCCESS
)

195 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"\r\NSRM modu inlizi faed: stus=%d",
us
);

198 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"NSRM module initialization is successful");

200 
us
 = 
	`tsc_nvm_modu_
();

201 if(
us
 !
OF_SUCCESS
)

203 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"\r\FaedؚlizNwk Vtuizi Modus: stus=%d",
us
);

206 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully initilized Network Virtualization Modules");

208 
us
 = 
	`m_gi_vn_nifitis
(
CRM_VN_ALL_NOTIFICATIONS
,

209 
m_vn_nifitis_cbk
,

210 (*)&
back_g1
,

211 (*)&
back_g2
);

212 if(
us
 !
OF_SUCCESS
)

214 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"\r\n Failedoegister with CRM moduleoeceive vnotifications");

217 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfullyegistered with CRM moduleoeceive vnotifications");

219 
us
 = 
	`m_gi_pt_nifitis
(
CRM_PORT_ALL_NOTIFICATIONS
,

220 
m_pt_nifitis_cbk
,

221 (*)&
back_g1
,

222 (*)&
back_g2
);

223 if(
us
 !
OF_SUCCESS
)

225 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"\r\n Failedoegister with CRM moduleoeceiveortotifications");

228 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfullyegistered with CRM moduleoeceiveortotifications");

230 
us
 = 
	`nsc_
();

231 if(
us
 !
OF_SUCCESS
)

233 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"\r\NSC modu inlizi faed: stus=%d",
us
);

236 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"NSC module initialization is successful");

244 
	}
}

252 
t32_t
 
	$tsc__of_ugs
(
ut64_t
 
tsc_doma_hd
)

254 
t32_t
 
us
;

257 
us
 = 
	`tsc_olug_v1_3_
(
tsc_doma_hd
);

258 if(
us
 !
OF_SUCCESS
)

260 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"OF ver 1.3lugin initialization failed ");

261  
OF_FAILURE
;

265 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"OF ver 1.3lugin initialization successful");

266  
OF_SUCCESS
;

268 
	}
}

278 
	$m_pt_nifitis_cbk
(
ut32_t
 
nifiti_ty
,

279 
ut64_t
 
m_pt_hd
,

280 
m_pt_nifiti_da
 
nifiti_da
,

281 *
back_g1
,

282 *
back_g2
)

284 
t32_t
 
tv
;

285 
ut32_t
 
mp_id
;

287 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"m_pt_nifitis_cbk(ied:ifitiځy = %d",
nifiti_ty
);

289 if(
nifiti_ty
 == 0)

291 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_PORT_ALL_NOTIFICATIONS");

295 if(
nifiti_ty
 =
CRM_PORT_MODIFIED
)

297 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_PORT_MODIFIED");

298 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈ty = %d",
nifiti_da
.
m_pt_ty
);

299 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈m = %s",
nifiti_da
.
pt_me
);

300 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwy = %d",
nifiti_da
.
nw_ty
);

301 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d܈id = %d",
nifiti_da
.
d_pt_id
);

302 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"w܈id = %d",
nifiti_da
.
w_pt_id
);

306 
mp_id
 = 
nifiti_da
.
w_pt_id
;

307 
nifiti_da
.
w_pt_id
 =ifiti_da.
d_pt_id
;

309 
tv
 = 
	`tsc_hd_m_pt_di
(
nifiti_ty
,

310 
m_pt_hd
,

311 
nifiti_da
,

312 
back_g1
,

313 
back_g2
);

314 if(
tv
 =
OF_SUCCESS
)

316 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfully handled CRM PORT DELETIONsart of CRM PORT modificastion.");

318 
nifiti_da
.
w_pt_id
 = 
mp_id
;

320 
tv
 = 
	`tsc_hd_m_pt_addi
(
nifiti_ty
,

321 
m_pt_hd
,

322 
nifiti_da
,

323 
back_g1
,

324 
back_g2
);

325 if(
tv
 =
OF_SUCCESS
)

327 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfully handled CRM PORT ADDITIONsart of CRM PORT modification.");

331 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Failedo Handle CRM PORT ADDITIONsart of CRM PORT modification.");

337 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Failedo handle CRM PORT DELETIONsart of CRM PORT modification.");

342 if(
nifiti_ty
 =
CRM_PORT_ADDED
)

344 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_PORT_ADDED");

345 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈ty = %d",
nifiti_da
.
m_pt_ty
);

346 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈m%s",
nifiti_da
.
pt_me
);

347 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwy = %d",
nifiti_da
.
nw_ty
);

348 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈id = %d",
nifiti_da
.
w_pt_id
);

350 if(
nifiti_da
.
w_pt_id
 == 0)

353 
tv
 = 
	`tsc_hd_m_pt_addi
(
nifiti_ty
,

354 
m_pt_hd
,

355 
nifiti_da
,

356 
back_g1
,

357 
back_g2
);

358 if(
tv
 =
OF_SUCCESS
)

360 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfully handled CRM PORT ADDITION.");

364 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Failedo handle CRM PORT ADDITION.");

369 if(
nifiti_ty
 =
CRM_PORT_DELETE
)

371 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_PORT_DELETE");

372 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈ty = %d",
nifiti_da
.
m_pt_ty
);

373 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈m%s",
nifiti_da
.
pt_me
);

374 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwy = %d",
nifiti_da
.
nw_ty
);

375 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈id = %d",
nifiti_da
.
w_pt_id
);

377 if(
nifiti_da
.
w_pt_id
 == 0)

380 
tv
 = 
	`tsc_hd_m_pt_di
(
nifiti_ty
,

381 
m_pt_hd
,

382 
nifiti_da
,

383 
back_g1
,

384 
back_g2
);

385 if(
tv
 =
OF_SUCCESS
)

387 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfully handled CRM PORT DELETION.");

391 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Failedo handle CRM PORT DELETION.");

395 
	}
}

409 
	$m_vn_nifitis_cbk
(
ut32_t
 
nifiti_ty
,

410 
ut64_t
 
vn_hd
,

411 
m_vn_nifiti_da
 
nifiti_da
,

412 *
back_g1
,

413 *
back_g2
)

415 
t32_t
 
tv
;

416 
m_vtu_twk
* 
vn_y_p
;

418 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"m_vn_nifitis_cbk(ied:ifitiځy = %d",
nifiti_ty
);

420 if(
nifiti_ty
 == 0)

422 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_ALL_NOTIFICATIONS");

426 if(
nifiti_ty
 =
CRM_VN_ADDED
)

428 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_ADDED");

430 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

431 if(
tv
 !
CRM_SUCCESS
)

433 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"crm_vn_notifications_cbk - Unableo fetch vn_entry");

438 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"tched vn_yw_ty = %d",
nifiti_da
.
nw_ty
);

439 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vnhdd MURTHY = %x",
vn_hd
);

441 
tv
 = 
tsc_nvm_modus
[
nifiti_da
.
nw_ty
].
	`nvm_modu_add_vn_to_nid_vw
(
vn_hd
,nifiti_da.
tun_id
);

442 if(
tv
 !
CRM_SUCCESS
)

444 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedodd vnoheunid view");

448 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Added vnoheunid view");

452 
tv
 = 
	`nsc__vn_sours
(
vn_y_p
);

454 if(
tv
 !
CRM_SUCCESS
)

456 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo initialize VNesources.");

460 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully initialized vnesources");

464 if(
nifiti_ty
 =
CRM_VN_DELETE
)

466 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_DELETE");

468 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

469 if(
tv
 !
CRM_SUCCESS
)

471 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"crm_vn_notifications_cbk - Unableo fetch vn_entry");

475 
tv
 = 
tsc_nvm_modus
[
nifiti_da
.
nw_ty
].
	`nvm_modu_de_vn_om_nid_vw
(
vn_hd
,nifiti_da.
tun_id
);

476 if(
tv
 !
CRM_SUCCESS
)

478 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo delete vn fromheunid view");

482 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Deleted vnoheunid view");

485 
tv
 = 
	`nsc_de_vn_sours
(
vn_y_p
);

487 if(
tv
 !
CRM_SUCCESS
)

489 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo uninitialize vnesources.");

493 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully uninitialized vnesources");

503 if(
nifiti_ty
 =
CRM_VN_MODIFIED
)

505 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_MODIFIED");

508 if(
nifiti_ty
 =
CRM_VN_VIEW_ADDED
)

510 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_VIEW_ADDED");

513 if(
nifiti_ty
 =
CRM_VN_VIEW_DELETE
)

515 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_VIEW_DELETE");

518 if(
nifiti_ty
 =
CRM_VN_ATTRIBUTE_ADDED
)

520 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_ATTRIBUTE_ADDED");

523 if(
nifiti_ty
 =
CRM_VN_ATTRIBUTE_DELETE
)

525 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_ATTRIBUTE_DELETE");

528 if(
nifiti_ty
 =
CRM_VN_SUBNET_ADDED
)

530 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_SUBNET_ADDED");

533 if(
nifiti_ty
 =
CRM_VN_SUBNET_DELETE
)

535 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"CRM_VN_SUBNET_DELETE");

538 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"crm_vn_notifications_cbk - End ofotifications");

540 
	}
}

552 
t32_t
 
	$tsc_hd_m_pt_addi
(
ut32_t
 
nifiti_ty
,

553 
ut64_t
 
m_pt_hd
,

554 
m_pt_nifiti_da
 
nifiti_da
,

555 *
back_g1
,

556 *
back_g2
)

559 
m_pt
* 
m_pt_node_p
;

561 
t32_t
 
tv
 = 
OF_FAILURE
;;

562 
ut8_t
 
nw_ty
;

564 
nw_ty
 = 
nifiti_da
.nw_type;

566 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_ty = %d",
nw_ty
);

567 if((
nw_ty
 < 
SUPPORTED_NW_TYPE_MIN
||w_ty > 
SUPPORTED_NW_TYPE_MAX
))

569 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Un Supported NW Type");

570  
OF_FAILURE
;

573 if((
nifiti_da
.
m_pt_ty
 =
VM_PORT
|| (nifiti_da.m_pt_ty =
VMNS_PORT
))

575 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Callingvm_module_create_vmport_views()");

576 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu__vmpt_vws
(
m_pt_hd
,

577 
nifiti_da
.
m_pt_ty
,

578 
nifiti_da
.
m_vn_hd
);

580 if(
tv
 !
OF_SUCCESS
)

582 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedadd vmp܈vwf܁hnwy = %d",
nw_ty
);

583  
OF_FAILURE
;

588 if(
nifiti_da
.
m_pt_ty
 =
VM_PORT
)

590 
tv
 = 
	`tsc_add_vmpt_ows_to_assify_b
(
nifiti_da
.
m_vn_hd
,

591 
nifiti_da
.
swme
,

592 
nifiti_da
.
m_pt_ty
,

593 
nifiti_da
.
w_pt_id
,

595 
nifiti_da
.
dp_hd
);

596 if(
tv
 !
OF_SUCCESS
)

598 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedadd vmp܈owtassifyab f܁hnwy = %d",
nw_ty
);

603 
tv
 = 
	`tsc_add_t3_ive_ow_f_vm
(
m_pt_hd
,
nifiti_da
.
m_vn_hd
,nifiti_da.
dp_hd
);

606 
	`tsc_de_b_4_ow_s
(
nifiti_da
.
m_pt_ty
,
m_pt_hd
,nifiti_da.
dp_hd
);

607 
	`tsc_de_b_5_ow_s
(
nifiti_da
.
m_pt_ty
,
m_pt_hd
,nifiti_da.
dp_hd
);

612 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Callingvm_module_create_nwport_views()");

613 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mwp܈hd = %x",
m_pt_hd
);

615 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_node_p
);

616 if(
tv
 !
OF_SUCCESS
)

618 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Invalid crmort handle");

619  
OF_FAILURE
;

622 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nw svi܈=%x", (
m_pt_node_p
->
nw_ms
).
vxn_nw
.
rvi_pt
);

623 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu__nwpt_vws
(
m_pt_hd
,

624 
nifiti_da
.
m_pt_ty
,

625 
nifiti_da
.
swme
);

627 if(
tv
 !
OF_SUCCESS
)

629 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedaddwp܈tnwp܈vws.t_ty = ",
nifiti_da
.
m_pt_ty
);

630  
OF_FAILURE
;

632 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sucssfuyddedhnwp܈tnwp܈vws.t_ty = ",
nifiti_da
.
m_pt_ty
);

635 
tv
 = 
	`tsc_vxn_add_nwpt_ows
(
nifiti_da
.
swme
,

636 &(
nifiti_da
.
nw_ms
.
vxn_nw
),

637 
nifiti_da
.
m_pt_ty
,

638 
nifiti_da
.
w_pt_id
,

639 
nifiti_da
.
dp_hd
);

641 if(
tv
 !
OF_SUCCESS
)

643 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedaddwp܈ows.t_ty = ",
nifiti_da
.
m_pt_ty
);

644  
OF_FAILURE
;

646 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sucssfuyddedwp܈ows.t_ty = ",
nifiti_da
.
m_pt_ty
);

648  
OF_SUCCESS
;

649 
	}
}

661 
t32_t
 
	$tsc_hd_m_pt_di
(
ut32_t
 
nifiti_ty
,

662 
ut64_t
 
m_pt_hd
,

663 
m_pt_nifiti_da
 
nifiti_da
,

664 *
back_g1
,

665 *
back_g2
)

667 
t32_t
 
tv
 = 
OF_FAILURE
;

668 
ut8_t
 
nw_ty
;

669 
ut8_t
 
b_id
;

671 
nw_ty
 = 
nifiti_da
.nw_type;

673 if((
nw_ty
 < 
SUPPORTED_NW_TYPE_MIN
||w_ty > 
SUPPORTED_NW_TYPE_MAX
))

675 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unsupported NW Type");

676  
OF_FAILURE
;

679 if((
nifiti_da
.
m_pt_ty
 =
VM_PORT
|| (nifiti_da.m_pt_ty =
VMNS_PORT
))

681 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Callingvm_module_delete_vmport_views()");

682 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_de_vmpt_vws
(
m_pt_hd
,

683 
nifiti_da
.
m_pt_ty
,

684 
nifiti_da
.
m_vn_hd
);

685 if(
tv
 !
OF_SUCCESS
)

687 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faeddvmp܈vwf܁hnwy = %d",
nw_ty
);

692 
tv
 = 
	`tsc_de_vmpt_ows_om_assify_b
(
nifiti_da
.
m_pt_ty
,

693 
nifiti_da
.
w_pt_id
,

694 
nifiti_da
.
dp_hd
);

695 if(
tv
 !
OF_SUCCESS
)

697 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faedd vmp܈owom cssifyab f܁hnwy = %d",
nw_ty
);

700 
	`tsc_de_b_4_ow_s
(
nifiti_da
.
m_pt_ty
,
m_pt_hd
,nifiti_da.
dp_hd
);

701 
	`tsc_de_b_5_ow_s
(
nifiti_da
.
m_pt_ty
,
m_pt_hd
,nifiti_da.
dp_hd
);

703 if(
nifiti_da
.
m_pt_ty
 =
VM_PORT
)

705 
b_id
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

706 
	`tsc_olug_v1_3_d_ows_om_b_1_2
(
nifiti_da
.
dp_hd
,&nifiti_da.
w_pt_id
,
b_id
);

708 
b_id
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

709 
	`tsc_olug_v1_3_d_ows_om_b_1_2
(
nifiti_da
.
dp_hd
,&nifiti_da.
w_pt_id
,
b_id
);

711 if(
nifiti_da
.
m_pt_ty
 =
VMNS_PORT
)

714 
tv
 = 
	`tsc_de_nsc_bs_1_2_ows_f_rvi_vm_ded
(
nifiti_da
.
m_vn_hd
,
m_pt_hd
);

715 if(
tv
 =
OF_SUCCESS
)

717 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "Successfully deletedllhe matching Table_1nd Table_2 flowntries");

718 
	`tf
("\r\nSuccessfully deletedllhe matching Table_1nd Table_2 flowntries");

722 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "Failedo delete some orll ofhe matching Table_1nd Table_2 flowntries");

723 
	`tf
("\r\nFailedo deletell or some ofhe matching Table_1nd Table_2 flowntries");

730 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Callingvm_module_delete_nwport_views()");

731 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_de_nwpt_vws
(
m_pt_hd
,

732 
nifiti_da
.
m_pt_ty
,

733 
nifiti_da
.
swme
);

735 if(
tv
 !
OF_SUCCESS
)

737 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faeddthnwp܈omwp܈vws.t_ty = ",
nifiti_da
.
m_pt_ty
);

738  
OF_FAILURE
;

740 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Sucssfuy dedhnwp܈omwp܈vws.t_ty = ",
nifiti_da
.
m_pt_ty
);

743 
tv
 = 
	`tsc_de_nwpt_ows_om_assify_b
(
nifiti_da
.
m_pt_ty
,

744 
nifiti_da
.
w_pt_id
,

745 
nifiti_da
.
dp_hd
);

746 if(
tv
 !
OF_SUCCESS
)

748 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Faeddthnwp܈ows.t_ty = ",
nifiti_da
.
m_pt_ty
);

752 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Sucssfuy dedhnwp܈ows.t_ty = ",
nifiti_da
.
m_pt_ty
);

755 
	`tsc_de_b_4_ow_s
(
nifiti_da
.
m_pt_ty
,
m_pt_hd
,nifiti_da.
dp_hd
);

757  
tv
;

758 
	}
}

766 
	$r_shed_lib_
()

768 
t32_t
 
tv
;

772 
tv
 = 
	`tsc_modu_
();

773 if(
tv
 !
OF_SUCCESS
)

775 
	`puts
("\r\n Flow Control Module Initialization failed");

779 
	`puts
("\r\n Flow Control Module Initialization is successful");

783 
	}
}

791 
	$r_shed_lib_de
()

796 
	}
}

	@tsc_nsc_cnbind.c

23 
	~"cڌr.h
"

24 
	~"dobhash.h
"

25 
	~"ϵcmn.h
"

26 
	~"dm.h
"

27 
	~"mi.h
"

28 
	~"m_vn_i.h
"

29 
	~"m_pt_i.h
"

30 
	~"tsc_cڌr.h
"

31 
	~"tsc_nvm_modus.h
"

33 
ut32_t
 
vn_nsc_fo_offt_g
;

34 
tsc_nvm_modu_r
 
tsc_nvm_modus
[
SUPPORTED_NW_TYPE_MAX
 + 1];

35 
ut32_t
 
nsc_no_of_bd_b_bucks_g
;

37 
r_lock_t
 
glob_mac_lock
;

38 
ut8_t
 
	glol__mac
[6] = {02,01,01,01,01,02};

39 
ut8_t
 
	glol_out_mac
[6] = {06,01,01,01,01,02};

60 
t32_t
 
	$nsc_g_bd_y
(
o_ck_
* 
pkt_
,

61 
nsc__node
* 
pkt__p
,

62 
ut8_t
 
nw_ty
,

63 
ut32_t
 
nid
,

64 
l2_ci_to_nsfo_bd_node
** 
_bd_node_p_p
,

65 
ut8_t
 *
_ty_p
,

66 
ut8_t
 
cy_ig_mac_b


69 
l2_ci_to_nsfo_bd_node
 *
_bd_node_y_p
;

70 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

71 
m_vtu_twk
* 
vn_y_p
;

73 
ut64_t
 
vn_hd
;

74 
ut32_t
 
hashmask
,
hashkey
,
offt
;

75 
ut8_t
 
y_found
 = 0,
ii
;

76 
t32_t
 
tv
;

77 
ut8_t
 
hp_b
;

78 
nsc__node
 *
_p
,*
2_p
,*
_node_sn_p
;

80 
hashmask
 = 
nsc_no_of_bd_b_bucks_g
;

82 
hashkey
 = 
	`NSC_COMPUTE_HASH_CNBIND_ENTRY
(
pkt__p
->
c_
,pkt__p->
d_
,

83 
pkt__p
->
c_pt
,pkt__p->
d_pt
,

84 
pkt__p
->
oc
,

85 
pkt__p
->
ht_ty
,

86 
hashmask


89 
	`CNTLR_RCU_READ_LOCK_TAKE
();

91 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

92 if(
tv
 =
OF_SUCCESS
)

93 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

95 if(
tv
 !
OF_SUCCESS
)

97 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

98  
OF_FAILURE
;

101 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

103 
tv
 = 
	`mempo_g_mem_block
(
vn_nsc_fo_p
->
nsc__bd_mempo_g
,(
uch8_t
 **)&
_bd_node_y_p
,&
hp_b
);

104 if(
tv
 !
MEMPOOL_SUCCESS
)

106 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

107 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo create mempoolntry for cn_bind_node_entry");

108  
OF_FAILURE
;

111 
_bd_node_y_p
->
hp_b
 = heap_b;

112 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

113 
	`MCHASH_BUCKET_SCAN
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
,
hashkey
,
_node_sn_p
,
nsc__node
 *, 
offt
)

115 if((
_node_sn_p
->
bd_node_p
->
e_y
 =1|| (_node_sn_p->bd_node_p->
sk_this_y
 == 1))

118 if((
pkt__p
->
c_
 !
_node_sn_p
->src_ip ) ||

119 (
pkt__p
->
d_
 !
_node_sn_p
->dst_ip ) ||

120 (
pkt__p
->
oc
 !
_node_sn_p
->protocol) ||

121 (
pkt__p
->
c_pt
 !
_node_sn_p
->src_port) ||

122 (
pkt__p
->
d_pt
 !
_node_sn_p
->dst_port) ||

124 (
pkt__p
->
ht_ty
 !
_node_sn_p
->ethernet_type)

127 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSM Se in mchg. se܁y 1:PRIMARY 2:SECONDARY = %d",
_node_sn_p
->
_ty
);

130 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSM A mchg Se ifound. se܁y 1:PRIMARY 2:SECONDARY = %d",
_node_sn_p
->
_ty
);

132 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_ = %x,%x",
pkt__p
->
c_
,
_node_sn_p
->src_ip);

133 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_ = %x,%x",
pkt__p
->
d_
,
_node_sn_p
->dst_ip);

134 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_oc = %x,%x",
pkt__p
->
oc
,
_node_sn_p
->protocol);

135 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_p܈ = %x,%x",
pkt__p
->
c_pt
,
_node_sn_p
->src_port);

136 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_p܈ = %x,%x",
pkt__p
->
d_pt
,
_node_sn_p
->dst_port);

139 *
_ty_p
 = 
_node_sn_p
->
_ty
;

140 *
_bd_node_p_p
 = 
_node_sn_p
->
bd_node_p
;

141 
y_found
 = 1;

143 if(
cy_ig_mac_b
 =
TRUE
)

145 
pkt__p
->
c_mac_low
 = (
_node_sn_p
->src_mac_low);

146 
pkt__p
->
c_mac_high
 = (
_node_sn_p
->src_mac_high);

148 
pkt__p
->
d_mac_low
 = (
_node_sn_p
->dst_mac_low);

149 
pkt__p
->
d_mac_high
 = (
_node_sn_p
->dst_mac_high);

151 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_low = %x",
_node_sn_p
->
c_mac_low
);

152 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_high = %x",
_node_sn_p
->
c_mac_high
);

153 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_low = %x",
_node_sn_p
->
d_mac_low
);

154 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_high = %x",
_node_sn_p
->
d_mac_high
);

156 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_low = %x",
pkt__p
->
c_mac_low
);

157 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_high = %x",
pkt__p
->
c_mac_high
);

158 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_low = %x",
pkt__p
->
d_mac_low
);

159 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_high = %x",
pkt__p
->
d_mac_high
);

161 
ii
=0;ii<6;ii++)

163 
pkt__p
->
c_mac
[
ii
] = 
_node_sn_p
->src_mac[ii];

164 
pkt__p
->
d_mac
[
ii
] = 
_node_sn_p
->dst_mac[ii];

167 
ii
=0;ii<6;ii++)

169 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_ma%x",
pkt__p
->
c_mac
[
ii
]);

170 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_ma%x",
pkt__p
->
d_mac
[
ii
]);

175 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

177 if(
y_found
 == 1)

179 
pkt__p
->
magic
 = 
_node_sn_p
->magic;

180 
pkt__p
->
dex
 = 
_node_sn_p
->index;

181 
pkt__p
->
_n
 = 
_node_sn_p
->safe_reference;

182 
pkt__p
->
bd_node_p
 = 
_node_sn_p
->cnbind_node_p;

184 
	`mempo_a_mem_block
(
vn_nsc_fo_p
->
nsc__bd_mempo_g
,(
uch8_t
*)
_bd_node_y_p
,_bd_node_y_p->
hp_b
);

185  
NSC_CONNECTION_BIND_ENTRY_FOUND
;

189 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No matching Selector is found.Populatinghe second selectorlso.");

191 
	`CNTLR_LOCK_INIT
(
_bd_node_y_p
->
bd_node_lock
);

193 
_bd_node_y_p
->
bd_l_ft
 = 0;

194 
_bd_node_y_p
->
no_of_ow_s_dedud
 = 0;

195 
_bd_node_y_p
->
nsc__bd_mempo_g
 = 
vn_nsc_fo_p
->nsc_cn_bind_mempool_g;

197 
_p
 = &(
_bd_node_y_p
->
_1
);

198 *
_p
 = *
pkt__p
;

199 
_p
->
_ty
 = *
_ty_p
 = (
ut8_t
)
SELECTOR_PRIMARY
;

200 
_p
->
hashkey
 = hashkey;

201 
_p
->
bd_node_p
 = 
_bd_node_y_p
;

202 
_p
->
bd_node_p
->
e_y
 = 0;

203 
_p
->
bd_node_p
->
sk_this_y
 = 0;

205 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"_ty : %d",
_p
->
_ty
);

208 
2_p
 = &(
_bd_node_y_p
->
_2
);

209 
	`nsc_exa_ck_flds
(
pkt_
,
2_p
,
PACKET_REVERSE
,
TRUE
);

211 if((
_p
->
oc
 =
OF_IPPROTO_ICMP
&& (_p->
c_pt
 =0x08&& (_p->
d_pt
 == 0x00))

213 
2_p
->
c_pt
 = 0x00;

214 
2_p
->
d_pt
 = 0x00;

217 
hashmask
 = 
nsc_no_of_bd_b_bucks_g
;

219 
hashkey
 = 
	`NSC_COMPUTE_HASH_CNBIND_ENTRY
(
2_p
->
c_
,2_p->
d_
,

220 
2_p
->
c_pt
,2_p->
d_pt
,

221 
2_p
->
oc
,

222 
2_p
->
ht_ty
,

223 
hashmask


226 
2_p
->
_ty
 = (
ut8_t
)
SELECTOR_SECONDARY
;

227 
2_p
->
hashkey
 = hashkey;

228 *
_bd_node_p_p
 = 
_bd_node_y_p
;

229 
2_p
->
bd_node_p
 = 
_bd_node_y_p
;

230 
_p
->
h__p
 = 
2_p
;

231 
2_p
->
h__p
 = 
_p
;

233 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"_ty : %d",
2_p
->
_ty
);

235 
	`CNTLR_LOCK_TAKE
(
glob_mac_lock
);

236 
lol__mac
[5]++;

237 if(
lol__mac
[5] == 0)

238 
lol__mac
[4]++;

240 
lol_out_mac
[5]++;

241 if(
lol_out_mac
[5] == 0)

242 
lol_out_mac
[4]++;

243 
	`CNTLR_LOCK_RELEASE
(
glob_mac_lock
);

245 
ii
=0;ii<6;ii++)

247 
_bd_node_y_p
->
lol__mac
[
ii
] =ocal_in_mac[ii];

248 
_bd_node_y_p
->
lol_out_mac
[
ii
] =ocal_out_mac[ii];

251 
ii
=0;ii<6;ii++)

253 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
_bd_node_y_p
->
lol_out_mac
[
ii
]);

254 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
_bd_node_y_p
->
lol__mac
[
ii
]);

256 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noxisting selector is matched.Bothhe Selectorsre filled butotddedohe hashable");

258  
NSC_CONNECTION_BIND_ENTRY_CREATED
;

260 
	}
}

271 
t32_t
 
	$nsc_add_s
(
mchash_b
* 
l2_ci_to_nsfo_bd_b_p
,

272 * 
nsc__bd_mempo_g
,

273 
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
)

275 
nsc__node
 *
1_p
,*
2_p
;

276 
uch8_t
* 
hashobj_p
 = 
NULL
;

277 
ut32_t
 
magic
,
dex
,
offt
;

278 
t32_t
 
tv_1
 = 
OF_SUCCESS
;

279 
t32_t
 
tv_2
 = 
OF_SUCCESS
;

280 
ut8_t
 
us_b
 = 
FALSE
;

285 
1_p
 = &(
_bd_y_p
->
_1
);

286 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

287 
hashobj_p
 = (
uch8_t
 *)
1_p
 + 
offt
;

289 
	`MCHASH_APPEND_NODE
(
l2_ci_to_nsfo_bd_b_p
,
1_p
->
hashkey
,1_p,
dex
,
magic
,
hashobj_p
,
us_b
);

290 if(
us_b
 =
FALSE
)

292 
tv_1
 = 
NSC_FAILED_TO_ADD_SELECTOR
;

295 
1_p
->
magic
 = magic;

296 
1_p
->
dex
 = index;

298 (
1_p
->
_n

magic
;

299 (
1_p
->
_n
(((1_p->_n<< 32| (
dex
));

302 
2_p
 = &(
_bd_y_p
->
_2
);

303 
hashobj_p
 = (
uch8_t
 *)
2_p
 + 
NSC_SELECTOR_NODE_OFFSET
;

304 
	`MCHASH_APPEND_NODE
(
l2_ci_to_nsfo_bd_b_p
,
2_p
->
hashkey
,2_p,
dex
,
magic
,
hashobj_p
,
us_b
);

305 if(
us_b
 =
FALSE
)

307 
tv_2
 = 
NSC_FAILED_TO_ADD_SELECTOR
;

310 
2_p
->
magic
 = magic;

311 
2_p
->
dex
 = index;

312 (
2_p
->
_n

magic
;

313 (
2_p
->
_n
(((2_p->_n<< 32| (
dex
));

316 if(
tv_2
 =
NSC_FAILED_TO_ADD_SELECTOR
)

319 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

320 
us_b
 = 
FALSE
;

321 
	`MCHASH_DELETE_NODE_BY_REF
(
l2_ci_to_nsfo_bd_b_p
,
1_p
->
dex
,1_p->
magic
,

322 
nsc__node
 *,
offt
,
us_b
);

325 if((
tv_1
 !
OF_SUCCESS
|| (
tv_2
 != OF_SUCCESS))

330 
_bd_y_p
->
nwrvi_fo
.
no_of_nwrvi_s
 = 0;

331 if(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
 !
NULL
)

332 
	`
(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
);

334 
tv_1
 = 
	`mempo_a_mem_block
(
nsc__bd_mempo_g
,(
uch8_t
*)
_bd_y_p
,_bd_y_p->
hp_b
);

335 if(
tv_1
 =
MEMPOOL_SUCCESS
)

337 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "cnbindntry memory blockeleased successfully!.");

341 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "failedoelease cnbindntry memory block");

343 
tv_1
 = 
OF_FAILURE
;

346 
tv_1
 = 
OF_SUCCESS
;

348  
tv_1
;

349 
	}
}

363 
t32_t
 
	$nsc_exa_ck_flds
(
o_ck_
* 
pkt_
,
nsc__node
* 
_p
,
ut8_t
 
dei
,ut8_
nsc_cy_mac_addss_b
)

365 
ut8_t
* 
pkt_da
 = 
pkt_
->
ck
;

366 
ut32_t
 
ii
,
v4_hdr_n
;

367 
ut32_t
 
mp
;

368 
ut16_t
 
offt
;

371 
t32_t
 
tv
 = 
OF_SUCCESS
;

373 if(
pkt_
->
ck_ngth
 < 34)

374  
OF_FAILURE
;

378 
offt
 = 
OF_CNTLR_ETHERNET_TYPE_OFFSET
;

379 
mp
 = (
	`ohl
(*(*)(
pkt_da
 + 
offt
)));

381 
_p
->
vn_id_pkt
 = 0;

382 (
mp
 & 0xff000000) == 0x81000000)

384 if(
offt
 =
OF_CNTLR_ETHERNET_TYPE_OFFSET
)

386 
_p
->
vn_id_pkt
 = ()(
mp
 & 0x00000fff);

387 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_pk%d\n",
_p
->
vn_id_pkt
);

389 
offt
 = offset + 4;

390 
mp
 = (
	`ohl
(*(*)(
pkt_da
 + 
offt
)));

392 
_p
->
ht_ty
 = (
mp
 >> 16);

394 if(
_p
->
ht_ty
 == 0x0806)

396 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Unexpected ARP Responseeceived");

397  
OF_FAILURE
;

400 
v4_hdr_n
 = 
	`OF_CNTLR_IPV4_HDR_LEN
((
pkt_da
 + 
offt
 - 
OF_CNTLR_ETHERNET_TYPE_OFFSET
));

402 
offt
 = offset + 2;

404 if(
dei
 =
PACKET_NORMAL
)

407 if((
nsc_cy_mac_addss_b
 =
FALSE
&& (
_p
->
vn_id_pkt
 != 0))

409 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Not Extracting MAC Addresses foracketseceived from VM_NS with VLAN ID");

413 
_p
->
d_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
));

414 
_p
->
d_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
 + 2));

415 
_p
->
c_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
));

416 
_p
->
c_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
 + 2));

418 
ii
=0;ii<6;ii++)

420 
_p
->
d_mac
[
ii
] = (
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
)[ii];

421 
_p
->
c_mac
[
ii
] = (
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
)[ii];

424 
_p
->
c_
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_SRC_IP_OFFSET
));

425 
_p
->
d_
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_DST_IP_OFFSET
));

426 
_p
->
oc
 = *(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_PROTO_OFFSET
);

428 if((
_p
->
oc
 =
OF_IPPROTO_TCP
|| (_p->oc =
OF_IPPROTO_UDP
 ))

430 
_p
->
c_pt
 = 
	`ohs
(*(
ut16_t
*)(
pkt_da
 + 
offt
 + 
v4_hdr_n
));

431 
_p
->
d_pt
 = 
	`ohs
(*(
ut16_t
*)(
pkt_da
 + 
offt
 + 
v4_hdr_n
+2));

433 if(
_p
->
oc
 =
OF_IPPROTO_ICMP
)

435 
_p
->
c_pt
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
);

436 
_p
->
d_pt
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
 + 
OF_CNTLR_ICMPV4_CODE_OFFSET
);

438 
_p
->
icmp_ty
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
);

439 
_p
->
icmp_code
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
 + 
OF_CNTLR_ICMPV4_CODE_OFFSET
);

443 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Unsu܋d IP Proc = %x",
_p
->
oc
);

444 
tv
 = 
OF_FAILURE
;

449 if((
nsc_cy_mac_addss_b
 =
FALSE
&& (
_p
->
vn_id_pkt
 != 0))

451 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Not Extracting MAC Addresses foracketseceived from VM_NS with VLAN ID");

455 
_p
->
c_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
));

456 
_p
->
c_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
 + 2));

457 
_p
->
d_mac_high
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
));

458 
_p
->
d_mac_low
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
 + 2));

460 
ii
=0;ii<6;ii++)

462 
_p
->
c_mac
[
ii
] = (
pkt_da
 + 
OF_CNTLR_MACHDR_DSTMAC_OFFSET
)[ii];

463 
_p
->
d_mac
[
ii
] = (
pkt_da
 + 
OF_CNTLR_MACHDR_SRCMAC_OFFSET
)[ii];

466 
_p
->
d_
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_SRC_IP_OFFSET
));

467 
_p
->
c_
 = 
	`ohl
(*(
ut32_t
*)(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_DST_IP_OFFSET
));

468 
_p
->
oc
 = *(
pkt_da
 + 
offt
 + 
OF_CNTLR_IPV4_PROTO_OFFSET
);

470 if((
_p
->
oc
 =
OF_IPPROTO_TCP
|| (_p->oc =
OF_IPPROTO_UDP
 ))

472 
_p
->
d_pt
 = 
	`ohs
(*(
ut16_t
*)(
pkt_da
 + 
offt
 + 
v4_hdr_n
));

473 
_p
->
c_pt
 = 
	`ohs
(*(
ut16_t
*)(
pkt_da
 + 
offt
 + 
v4_hdr_n
+2));

475 if(
_p
->
oc
 =
OF_IPPROTO_ICMP
)

477 
_p
->
c_pt
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
);

478 
_p
->
d_pt
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
 + 
OF_CNTLR_ICMPV4_CODE_OFFSET
);

480 
_p
->
icmp_ty
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
);

481 
_p
->
icmp_code
 = *(
pkt_da
 + 
offt
 + 
v4_hdr_n
 + 
OF_CNTLR_ICMPV4_CODE_OFFSET
);

485 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Unsu܋d IP Proc = %x",
_p
->
oc
);

486 
tv
 = 
OF_FAILURE
;

490 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ht_ty = %x",
_p
->
ht_ty
);

491 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"dst_mac_high = %x dst_mac_low = %x src_mac_high = %x src_mac_low = %x",

492 
_p
->
d_mac_high
,_p->
d_mac_low
,

493 
_p
->
c_mac_high
,_p->
c_mac_low
);

495 
ii
=0;ii<6;ii++)

497 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d ma%x",
_p
->
d_mac
[
ii
]);

499 
ii
=0;ii<6;ii++)

501 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ma%x",
_p
->
c_mac
[
ii
]);

504 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"src_ip = %x dst_ip = %x src_prt=%d dst_prt=%drotcolo=%d",

505 
_p
->
c_
,_p->
d_
,

506 
_p
->
c_pt
,_p->
d_pt
,

507 
_p
->
oc
);

509 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"icmp_ty = %d icmp_cod%d",
_p
->
icmp_ty
,_p->
icmp_code
);

513  
tv
;

514 
	}
}

527 
	$tsc_mk__bd_y_as_e
(
mchash_b
* 
l2_ci_to_nsfo_bd_b_p
,* 
nsc__bd_mempo_g
,
ut32_t
 
dex
,ut32_
magic
)

529 
nsc__node
* 
_p
;

530 
ut32_t
 
offt
;

531 
t32_t
 
us_b
 = 
FALSE
;

535 
	`MCHASH_ACCESS_NODE
(
l2_ci_to_nsfo_bd_b_p
,
dex
,
magic
,
_p
,
us_b
);

536 if(
us_b
 !
TRUE
)

538 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"No selectorntry found");

539 
	`tf
("\r\n NSMDEL 100 No selectorntry found ");

543 
	`CNTLR_LOCK_TAKE
(
_p
->
bd_node_p
->
bd_node_lock
);

544 if(
_p
->
bd_node_p
->
no_of_ow_s_dedud
 == 0)

546 
	`CNTLR_LOCK_RELEASE
(
_p
->
bd_node_p
->
bd_node_lock
);

550 if((--(
_p
->
bd_node_p
->
no_of_ow_s_dedud
)) == 0)

552 
_p
->
bd_node_p
->
e_y
 = 1;

553 
	`tf
(" \r\n Stalentry is marked");

554 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Markhe cn_bind_entrys stalentry sohat it isot used further.");

557 
	`tf
("od %d",
_p
->
bd_node_p
->
no_of_ow_s_dedud
);

559 if(
_p
->
bd_node_p
->
e_y
 == 1)

561 
	`CNTLR_LOCK_RELEASE
(
_p
->
bd_node_p
->
bd_node_lock
);

562 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

563 
us_b
 = 
FALSE
;

564 
	`MCHASH_DELETE_NODE_BY_REF
(
l2_ci_to_nsfo_bd_b_p
,
_p
->
h__p
->
dex
,_p->h__p->
magic
,

565 
nsc__node
 *,
offt
,
us_b
);

567 if(
us_b
 =
TRUE
)

569 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Secondary Selectorntry deleted successfully from cnbindable");

570 
	`tf
(" NSMDEL 104 ");

574 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Secondary Selectorntry deletion failed from cnbindable");

575 
	`tf
(" NSMDEL 105 ");

577 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

578 
us_b
 = 
FALSE
;

579 
	`MCHASH_DELETE_NODE_BY_REF
(
l2_ci_to_nsfo_bd_b_p
,
_p
->
dex
,_p->
magic
,

580 
nsc__node
 *,
offt
,
us_b
);

581 if(
us_b
 =
TRUE
)

583 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Primary Selectorntry deleted successfully from cnbindable");

584 
	`tf
(" NSMDEL 106 ");

588 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Primary Selectorntry deletion failed from cnbindable");

589 
	`tf
(" NSMDEL 107 ");

594 
	`CNTLR_LOCK_RELEASE
(
_p
->
bd_node_p
->
bd_node_lock
);

597 
	}
}

599 
	$tsc_nsc_bd_l_
(
rcu_hd
* 
l_p
)

602 
nsc__node
* 
_p
;

603 
l2_ci_to_nsfo_bd_node
* 
_bd_node_y_p
;

604 
ut32_t
 
offt
;

605 
t32_t
 
tv
;

607 
offt
 = 
NSC_SELECTOR_NODE_OFFSET
;

608 
_p
 = (
nsc__node
 *(((*)
l_p
 - (2*((
mchash_d_node
 *)))- 
offt
);

610 
_bd_node_y_p
 = 
_p
->
bd_node_p
;

612 if((++(
_bd_node_y_p
->
bd_l_ft
)) == 2)

616 
_bd_node_y_p
->
nwrvi_fo
.
no_of_nwrvi_s
 = 0;

617 if(
_bd_node_y_p
->
nwrvi_fo
.
nw_rvis_p
 !
NULL
)

618 
	`
(
_bd_node_y_p
->
nwrvi_fo
.
nw_rvis_p
);

620 
tv
 = 
	`mempo_a_mem_block
(
_bd_node_y_p
->
nsc__bd_mempo_g
,(
uch8_t
*)_bd_node_y_p,_bd_node_y_p->
hp_b
);

621 if(
tv
 =
MEMPOOL_SUCCESS
)

623 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "cnbindntry memory blockeleased succussfully!.");

624 
	`tf
("\r\ncnbindntry iseleased");

628 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedoelease cnbindntry memory block");

629 
	`tf
("\r\nFailedoelease cnbindntry memory block");

632 
	}
}

634 
ut32_t
 
	$NSC_COMPUTE_HASH_CNBIND_ENTRY
(
ut32_t
 
ddr
,ut32_
daddr
,

635 
ut32_t
 
t
,ut32_
dpt
,

636 
ut32_t
 
oc
,

637 
ut32_t
 
ht_ty
,

638 
ut32_t
 
hashmask


641 
ut32_t
 
hashkey
;

643 
	`CNTLR_DOBBS_WORDS4
(
ddr
,
daddr
,((
t
 << 16| 
dpt
),((
oc
 << 16| 
ht_ty
), 0x12345678,
hashmask
,
hashkey
);

644  
hashkey
;

645 
	}
}

647 
ut32_t
 
	$nsc_compu_hash_posy_b_1_2
(
ut32_t
 
ddr
,ut32_
daddr
,

648 
ut32_t
 
t
,ut32_
dpt
,

649 
ut32_t
 
oc
,

650 
ut32_t
 
ht_ty
,

651 
ut32_t
 
pt_id
,

652 
ut64_t
 
dp_hd
,

653 
ut16_t
 
vn_id
,

654 
ut32_t
 
hashmask


657 
ut32_t
 
hashkey
;

658 
ut32_t
 
dp_hd_low
 = (ut32_t)(
dp_hd
);

659 
ut32_t
 
dp_hd_high
 = (ut32_t)(
dp_hd
 >> 32);

660 
ut32_t
 
vnid
 = (ut32_t)
vn_id
;

662 
	`CNTLR_DOBBS_WORDS8
(
ddr
,
daddr
,((
t
 << 16| 
dpt
),((
oc
 << 16| 
ht_ty
),

663 
pt_id
,
dp_hd_low
,
dp_hd_high
,
vnid
,

664 0x12345678,
hashmask
,
hashkey
);

665  
hashkey
;

666 
	}
}

668 
ut32_t
 
	$nsc_compu_hash_posy_b_3
(
ut16_t
 
rvipt
,

669 
ut32_t
 
d_mac_high
,

670 
ut32_t
 
d_mac_low
,

671 
ut64_t
 
dp_hd
,

672 
ut32_t
 
hashmask
)

674 
ut32_t
 
hashkey
;

675 
ut32_t
 
dp_hd_low
 = (ut32_t)(
dp_hd
);

676 
ut32_t
 
dp_hd_high
 = (ut32_t)(
dp_hd
 >> 32);

677 
ut32_t
 
rvi_pt
 = (ut32_t)
rvipt
;

679 
	`CNTLR_DOBBS_WORDS5
(
d_mac_high
,
d_mac_low
,
rvi_pt
,

680 
dp_hd_low
,
dp_hd_high
,

681 0x12345678,
hashmask
,
hashkey
);

682  
hashkey
;

683 
	}
}

	@tsc_nsc_core.c

27 
	~"cڌr.h
"

28 
	~"tsc_cڌr.h
"

29 
	~"dobhash.h
"

30 
	~"ϵcmn.h
"

31 
	~"dm.h
"

32 
	~"mi.h
"

33 
	~"m_vn_i.h
"

34 
	~"m_pt_i.h
"

35 
	~"nm.h
"

36 
	~"nmldef.h
"

37 
	~"tsc_nvm_modus.h
"

39 
ut32_t
 
	gnsc_no_of_bd_b_bucks_g
;

40 
ut32_t
 
	gvn_nsc_fo_offt_g
;

41 
tsc_nvm_modu_r
 
tsc_nvm_modus
[
SUPPORTED_NW_TYPE_MAX
 + 1];

42 
ut32_t
 
	gnsc_no_of_posy_b_1_bucks_g
;

43 
ut32_t
 
	gnsc_no_of_posy_b_2_bucks_g
;

44 
ut32_t
 
	gnsc_no_of_posy_b_3_bucks_g
;

45 
nwrvi_
* 
	gnwrvi__p
;

47 
r_lock_t
 
	gglob_mac_lock
;

49 
t32_t
 
nsc_g_mchg_nscha_obje
(
nsc__node
* 
_p
,

50 
ut8_t
 
nw_ty
,

51 
ut32_t
 
nid
,

52 
ut64_t
* 
i_ru_hd_p
,

53 
ut64_t
* 
nscha_obje_hd_p
,

54 
ut64_t
* 
nschat_obje_hd_p
);

56 
t32_t
 
nsc_g_mchg_byss_ru
(
nsc__node
* 
_p
,

57 
ut64_t
 
nscha_obje_hd
,

58 
ut64_t
* 
byss_ru_hd_p
);

60 
t32_t
 
nsc_g_nwrvi_s
(
ut64_t
 
nscha_obje_hd
,

61 
ut64_t
 
byss_ru_hd
,

62 
ut8_t
* 
no_of_nwrvi_objes_p
,

63 
nw_rvis_to_y
** 
ns_s_p_p
);

65 
tsc_nsc_bd_l_
(
rcu_hd
* 
_p
);

66 
ut8_t
 
	gnmdb_cut_e_g
;

78 
t32_t
 
	$nsc_lookup_l2_nschag_fo
(
o_ck_
* 
pkt_
,

79 
ut8_t
 
nw_ty
,

80 
ut32_t
 
nid
,

81 
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
)

83 
ut8_t
 
vn_nmdb_lookup_e
;

84 
t32_t
 
tv
,
us
;

86 
us
 = 
OF_FAILURE
;

90 
vn_nmdb_lookup_e
 = 
nmdb_cut_e_g
;

92 
us
 = 
	`nsc_g_mchg_nscha_obje
(&
_bd_y_p
->
_1
,

93 
nw_ty
,

94 
nid
,

95 &(
_bd_y_p
->
nwrvi_fo
.
i_ru_hd
),

96 &(
_bd_y_p
->
nwrvi_fo
.
nscha_obje_hd
),

97 &(
_bd_y_p
->
nwrvi_fo
.
nschat_obje_hd
)

99 if(
us
 !
OF_SUCCESS
)

101 if(
vn_nmdb_lookup_e
 !
nmdb_cut_e_g
)

103 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Lookup failed.Look up for NSCHAIN OBJECTgains NSRM database changed");

108 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Lookup failed.Returns NSRM database isot changed");

125 
us
 = 
	`nsc_g_mchg_byss_ru
(&
_bd_y_p
->
_1
,

126 
_bd_y_p
->
nwrvi_fo
.
nscha_obje_hd
,

127 &(
_bd_y_p
->
nwrvi_fo
.
byss_ru_hd
)

130 if(
us
 !
OF_SUCCESS
)

132 if(
vn_nmdb_lookup_e
 !
nmdb_cut_e_g
 )

134 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Lookup failed.Returns NSRM database is changed")

139 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Lookup failed.Returns NSRM database isot changed");

154 
_bd_y_p
->
nwrvi_fo
.
no_of_nwrvi_s
 = 0;

155 if(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
 !
NULL
)

157 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Ifsc_get_nwservice_instances API is called secondime dueo database change, freehe memery before callinggain");

158 
	`
(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
);

161 
us
 = 
	`nsc_g_nwrvi_s
(
_bd_y_p
->
nwrvi_fo
.
nscha_obje_hd
,

162 
_bd_y_p
->
nwrvi_fo
.
byss_ru_hd
,

163 &(
_bd_y_p
->
nwrvi_fo
.
no_of_nwrvi_s
),

164 &(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
)

166 if(
us
 !
OF_SUCCESS
)

168 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nsrm_get_nwservice_instances()eturned otherhan OF_SUCCESS");

178 }
vn_nmdb_lookup_e
 !
nmdb_cut_e_g
);

180 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"_bd_y_p->nwrvi_fo.nw_rvis_: %p",
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
);

182 if(
us
 =
OF_SUCCESS
)

184 
_bd_y_p
->
nsc_cfig_us
 = 
NSC_NWSERVICES_CONFIGURED
;

185 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
," NSC_NWSERVICES_CONFIGURED - NSRM DB Lokup Successful");

186 
tv
 = 
OF_SUCCESS
;

188 if(
us
 =
NSC_NO_NW_SERVICES_FOUND
)

190 
_bd_y_p
->
nsc_cfig_us
 = 
NSC_NWSERVICES_NOT_CONFIGURED
;

191 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"NSC_NWSERVICES_NOT_CONFIGURED - NSRM DB Lokup Successful");

192 
tv
 = 
OF_SUCCESS
;

194 if(
us
 =
NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN
)

196 
_bd_y_p
->
nsc_cfig_us
 = 
NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN
;

197 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN - NSRM DB Lokup Successful");

198 
tv
 = 
OF_SUCCESS
;

202 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Either incompleteschain configuration or systemic failure");

203 if(
_bd_y_p
 !
NULL
)

205 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"cn_bind_entry_p isot NULL.");

206 
_bd_y_p
->
nsc_cfig_us
 = 
us
;

207 
_bd_y_p
->
nsc_cfig_us
 = 
NSC_INCOMPLETE_NSCHAIN_CONFIGURATION
;

216 
tv
 = 
OF_FAILURE
;

236  
tv
;

240 
	}
}

254 
t32_t
 
	$nsc_g_mchg_nscha_obje
(
nsc__node
* 
_p
,

255 
ut8_t
 
nw_ty
,

256 
ut32_t
 
nid
,

257 
ut64_t
* 
i_ru_hd_p
,

258 
ut64_t
* 
nscha_obje_hd_p
,

259 
ut64_t
* 
nschat_obje_hd_p
)

261 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

262 
m_vtu_twk
* 
vn_y_p
;

263 
ut64_t
 
vn_hd
;

264 
ut64_t
 
f_nschat_obje
;

266 
nm_nschat_obje
* 
nschat_obje_p
 = 
NULL
;

267 
nm_nscha_i_ru
* 
i_ru_sn_node_p
 = 
NULL
;

268 
nm_l2nw_rvi_m
* 
l2_rvi_m_cd_p
 = 
NULL
;

270 
nm_nscha_obje
* 
nscha_obje_p
;

271 
ut64_t
 
hashkey
,
offt
;

272 
ut8_t
 
mch_found_b
;

273 
t32_t
 
tv
;

275 
ut32_t
* 
u_c_mac_high_p
;

276 
ut32_t
* 
u_c_mac_low_p
;

277 
ut32_t
* 
u_d_mac_high_p
;

278 
ut32_t
* 
u_d_mac_low_p
;

282 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

283 if(
tv
 !
OF_SUCCESS
)

285 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn handle");

286  
OF_FAILURE
;

288 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

289 if(
tv
 !
OF_SUCCESS
)

291 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn handle");

292  
OF_FAILURE
;

294 
	`CNTLR_RCU_READ_LOCK_TAKE
();

296 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

298 if(
vn_nsc_fo_p
->
rvi_chag_ty
 =
SERVICE_CHAINING_NONE
)

300 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN");

301 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

302  
NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN
;

305 
tv
 = 
	`nm_g_nschat_byhd
(
vn_nsc_fo_p
->
f_nschat_obje
,&
nschat_obje_p
);

306 if(
tv
 =
NSRM_SUCCESS
)

309 
tv
 = 
	`nm_g_l2_sm_cd_byhd
(
vn_nsc_fo_p
->
f_rvi_m_cd
,&
l2_rvi_m_cd_p
);

310 if(
tv
 =
NSRM_SUCCESS
)

312 
f_nschat_obje
 = 
l2_rvi_m_cd_p
->
nschat_obje_f
;

313 
tv
 = 
	`nm_g_nschat_byhd
(
f_nschat_obje
,&
nschat_obje_p
);

314 if(
tv
 =
NSRM_SUCCESS
)

316 
vn_nsc_fo_p
->
f_nschat_obje
 = srf_nschainset_object;

317 *
nschat_obje_hd_p
 = 
f_nschat_obje
;

322 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No CHAINSET configured forheetwork.");

323 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

324  
NSC_CHAINSET_NOT_CONFIGURED
;

328 
mch_found_b
 = 
FALSE
;

329 
hashkey
 = 0;

330 
offt
 = 
NSRM_SELECTION_RULE_TBL_OFFSET
;

332 if(
nschat_obje_p
->
nscha_i_ru_t
 == 0)

334 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

335 
	`tf
("\r\nschainset_object_p->nschain_selection_rule_set is 0\r\n");

336  
NSC_CHAINSET_NOT_CONFIGURED
;

338 
	`MCHASH_TABLE_SCAN
(
nschat_obje_p
->
nscha_i_ru_t
,
hashkey
)

340 
	`MCHASH_BUCKET_SCAN
(
nschat_obje_p
->
nscha_i_ru_t
,
hashkey
,

341 
i_ru_sn_node_p
,

342 
nm_nscha_i_ru
*, 
offt
)

344 if((
i_ru_sn_node_p
->
s
.
_obje_ty_e
 !
IP_ANY
) &&

345 ((
_p
->
c_
 < (
i_ru_sn_node_p
->
s
.
addr_t
)) ||

346 (
_p
->
c_
 > (
i_ru_sn_node_p
->
s
.
addr_d
))

350 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"pkt_c_ : %x,: %x ,d : %x",
_p
->
c_
,
i_ru_sn_node_p
->
s
.
addr_t
,i_ru_sn_node_p->s.
addr_d
);

353 if((
i_ru_sn_node_p
->
d
.
_obje_ty_e
 !
IP_ANY
) &&

354 ((
_p
->
d_
 < (
i_ru_sn_node_p
->
d
.
addr_t
)) ||

355 (
_p
->
d_
 > (
i_ru_sn_node_p
->
d
.
addr_d
))

359 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"pkt_d_ : %x,: %x ,d : %x",
_p
->
d_
,
i_ru_sn_node_p
->
d
.
addr_t
,i_ru_sn_node_p->d.
addr_d
);

362 if((
i_ru_sn_node_p
->

.
pt_obje_ty_e
 !
PORT_ANY
) &&

363 ((
_p
->
c_pt
 < (
i_ru_sn_node_p
->

.
pt_t
)) ||

364 (
_p
->
c_pt
 > (
i_ru_sn_node_p
->

.
pt_d
))

368 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_p܈: %d , s : %d ,d : %d",
_p
->
c_pt
,
i_ru_sn_node_p
->

.
pt_t
,i_ru_sn_node_p->.
pt_d
);

372 if((
i_ru_sn_node_p
->
dp
.
pt_obje_ty_e
 !
PORT_ANY
) &&

373 ((
_p
->
d_pt
 < (
i_ru_sn_node_p
->
dp
.
pt_t
)) ||

374 (
_p
->
d_pt
 > (
i_ru_sn_node_p
->
dp
.
pt_d
))

378 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_p܈: %d , s : %d ,d : %d",
_p
->
d_pt
,
i_ru_sn_node_p
->
dp
.
pt_t
,i_ru_sn_node_p->dp.
pt_d
);

382 
u_c_mac_high_p
 = (
ut32_t
 *)(
i_ru_sn_node_p
->
c_mac
.
mac
 + 0);

383 
u_c_mac_low_p
 = (
ut32_t
 *)(
i_ru_sn_node_p
->
c_mac
.
mac
 + 2);

384 
u_d_mac_high_p
 = (
ut32_t
 *)(
i_ru_sn_node_p
->
d_mac
.
mac
 + 0);

385 
u_d_mac_low_p
 = (
ut32_t
 *)(
i_ru_sn_node_p
->
d_mac
.
mac
 + 2);

387 if((
i_ru_sn_node_p
->
c_mac
.
mac_addss_ty_e
 !
MAC_ANY
) &&

388 ((
_p
->
c_mac_low
 !(
ohl
)(*
u_c_mac_low_p
)) ||

389 (
_p
->
c_mac_high
 !(
ohl
)(*
u_c_mac_high_p
))

393 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_mac_low : %x ,u_c_mac_low : %x ", 
_p
->
c_mac_low
 ,*
u_c_mac_low_p
);

394 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_mac_high : %x ,u_c_mac_high : %x ", 
_p
->
c_mac_high
 ,*
u_c_mac_high_p
);

398 if((
i_ru_sn_node_p
->
d_mac
.
mac_addss_ty_e
 !
MAC_ANY
) &&

399 ((
_p
->
d_mac_low
 !(
ohl
)(*
u_d_mac_low_p
)) ||

400 (
_p
->
d_mac_high
 !(
ohl
)(*
u_d_mac_high_p
))

404 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_mac_low : %x ,u_d_mac_low : %x ", 
_p
->
d_mac_low
 ,*
u_d_mac_low_p
);

405 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_mac_high : %x ,u_d_mac_high : %x ", 
_p
->
d_mac_high
 ,*
u_d_mac_high_p
);

409 if(
_p
->
ht_ty
 !(
i_ru_sn_node_p
->
h_ty
.
hty
))

411 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"_p->ht_ty : %d ,hty : %d",
_p
->
ht_ty
 ,
i_ru_sn_node_p
->
h_ty
.
hty_ty_e
);

414 
mch_found_b
 = 
TRUE
;

415 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"iڄuˁh mched: %s",
i_ru_sn_node_p
->
me_p
);

421 if(
mch_found_b
 =
FALSE
)

423 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No matching selectionule found");

424 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

425  
NSC_NO_SELECTION_RULE_FOUND
;

428 
tv
 = 
	`nm_g_nscha_byhd
(
i_ru_sn_node_p
->
nscha_obje_f
,&
nscha_obje_p
);

429 if(
tv
 !
NSRM_SUCCESS
)

431 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"invalidscchain object handle.Lookupgain with itsame");

432 
tv
 = 
	`nm_g_nscha_obje_hd
(
i_ru_sn_node_p
->
nscha_obje_me_p
,&i_ru_sn_node_p->
nscha_obje_f
);

433 if(
tv
 !
OF_SUCCESS
)

435 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"A selectionule is configured with chainamendhe chain itselt isot configured or deleted");

436 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

437  
NSC_INVALID_NSCHAIN_NAME
;

440 *
i_ru_hd_p
 = 
i_ru_sn_node_p
->
i_ru_hd
;

441 *
nscha_obje_hd_p
 = 
i_ru_sn_node_p
->
nscha_obje_f
;

443 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Exa mchg seiڄu found i: %wh cha : %s",
i_ru_sn_node_p
->
me_p
,i_ru_sn_node_p->
nscha_obje_me_p
);

444 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

445  
OF_SUCCESS
;

446 
	}
}

458 
t32_t
 
	$nsc_g_mchg_byss_ru
(
nsc__node
* 
_p
,

459 
ut64_t
 
nscha_obje_hd
,

460 
ut64_t
* 
byss_ru_hd_p
)

462 
nm_nscha_obje
* 
nscha_obje_p
 = 
NULL
;

463 
nm_nwrvi_byss_ru
* 
byss_ru_sn_node_p
 = 
NULL
;

465 
ut64_t
 
hashkey
,
offt
;

466 
ut8_t
 
mch_found_b
;

467 
t32_t
 
tv
;

469 
ut32_t
* 
bu_c_mac_high_p
;

470 
ut32_t
* 
bu_c_mac_low_p
;

471 
ut32_t
* 
bu_d_mac_high_p
;

472 
ut32_t
* 
bu_d_mac_low_p
;

474 
	`CNTLR_RCU_READ_LOCK_TAKE
();

477 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Entered");

479 
tv
 = 
	`nm_g_nscha_byhd
(
nscha_obje_hd
, &
nscha_obje_p
);

480 if(
tv
 !
NSRM_SUCCESS
)

482 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No chainxists");

483 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

484  
NSC_INVALID_NSCHAIN_HANDLE
;

487 
mch_found_b
 = 
FALSE
;

488 
hashkey
 = 0;

489 
offt
 = 
NSRM_BYPASS_RULE_TBL_OFFSET
;

492 if(
nscha_obje_p
->
byss_ru_li
 =
NULL
)

494 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Bypass Rule List isot configured");

495 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

496 *
byss_ru_hd_p
 = 0;

497  
OF_SUCCESS
;

501 
	`MCHASH_TABLE_SCAN
(
nscha_obje_p
->
byss_ru_li
,
hashkey
)

503 
	`MCHASH_BUCKET_SCAN
(
nscha_obje_p
->
byss_ru_li
,
hashkey
,

504 
byss_ru_sn_node_p
,

505 
nm_nwrvi_byss_ru
*, 
offt
)

507 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"scanningext bypassule");

508 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"bysru beg sed : %s",
byss_ru_sn_node_p
->
me_p
);

510 if((
byss_ru_sn_node_p
->
s
.
_obje_ty_e
 !
IP_ANY
) &&

511 ((
_p
->
c_
 < (
byss_ru_sn_node_p
->
s
.
addr_t
)) ||

512 (
_p
->
c_
 > (
byss_ru_sn_node_p
->
s
.
addr_d
))

516 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"pkt_c_ : %x,: %x ,d : %x",
_p
->
c_
,
byss_ru_sn_node_p
->
s
.
addr_t
,byss_ru_sn_node_p->s.
addr_d
);

520 if((
byss_ru_sn_node_p
->
d
.
_obje_ty_e
 !
IP_ANY
) &&

521 ((
_p
->
d_
 < (
byss_ru_sn_node_p
->
d
.
addr_t
)) ||

522 (
_p
->
d_
 > (
byss_ru_sn_node_p
->
d
.
addr_d
))

526 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"pkt_d_ : %x,: %x ,d : %x",
_p
->
d_
,
byss_ru_sn_node_p
->
d
.
addr_t
,byss_ru_sn_node_p->d.
addr_d
);

530 if((
byss_ru_sn_node_p
->

.
pt_obje_ty_e
 !
PORT_ANY
) &&

531 ((
_p
->
c_pt
 < (
byss_ru_sn_node_p
->

.
pt_t
)) ||

532 (
_p
->
c_pt
 > (
byss_ru_sn_node_p
->

.
pt_d
))

536 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_p܈: %d , s : %d ,d : %d",
_p
->
c_pt
,
byss_ru_sn_node_p
->

.
pt_t
,byss_ru_sn_node_p->.
pt_d
);

540 if((
byss_ru_sn_node_p
->
dp
.
pt_obje_ty_e
 !
PORT_ANY
) &&

541 ((
_p
->
d_pt
 < (
byss_ru_sn_node_p
->
dp
.
pt_t
)) ||

542 (
_p
->
d_pt
 > (
byss_ru_sn_node_p
->
dp
.
pt_d
))

546 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_p܈: %d , s : %d ,d : %d",
_p
->
d_pt
,
byss_ru_sn_node_p
->
dp
.
pt_t
,byss_ru_sn_node_p->dp.
pt_d
);

550 
bu_c_mac_high_p
 = (
ut32_t
 *)(
byss_ru_sn_node_p
->
c_mac
.
mac
 + 0);

551 
bu_c_mac_low_p
 = (
ut32_t
 *)(
byss_ru_sn_node_p
->
c_mac
.
mac
 + 2);

552 
bu_d_mac_high_p
 = (
ut32_t
 *)(
byss_ru_sn_node_p
->
d_mac
.
mac
 + 0);

553 
bu_d_mac_low_p
 = (
ut32_t
 *)(
byss_ru_sn_node_p
->
d_mac
.
mac
 + 2);

556 if((
byss_ru_sn_node_p
->
c_mac
.
mac_addss_ty_e
 !
MAC_ANY
) &&

557 ((
_p
->
c_mac_low
 !(
ohl
)(*
bu_c_mac_low_p
)) ||

558 (
_p
->
c_mac_high
 !(
ohl
)(*
bu_c_mac_high_p
))

562 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_mac_low : %x ,bu_c_mac_low : %x ", 
_p
->
c_mac_low
 ,*
bu_c_mac_low_p
);

563 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"c_mac_high : %x ,bu_c_mac_high : %x ", 
_p
->
c_mac_high
 ,*
bu_c_mac_high_p
);

567 if((
byss_ru_sn_node_p
->
d_mac
.
mac_addss_ty_e
 !
MAC_ANY
) &&

568 ((
_p
->
d_mac_low
 !(
ohl
)(*
bu_d_mac_low_p
)) ||

569 (
_p
->
d_mac_high
 !(
ohl
)(*
bu_d_mac_high_p
))

573 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_mac_low : %x ,bu_d_mac_low : %x ", 
_p
->
d_mac_low
 ,*
bu_d_mac_low_p
);

574 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"d_mac_high : %x ,bu_d_mac_high : %x ", 
_p
->
d_mac_high
 ,*
bu_d_mac_high_p
);

578 if(
_p
->
ht_ty
 !(
byss_ru_sn_node_p
->
h_ty
.
hty
))

580 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"_p->ht_ty : %d ,hty : %d",
_p
->
ht_ty
,
byss_ru_sn_node_p
->
h_ty
.
hty_ty_e
);

583 
mch_found_b
 = 
TRUE
;

584 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"bysruˁh mched: %s",
byss_ru_sn_node_p
->
me_p
);

591 if(
mch_found_b
 =
FALSE
)

593 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No matching bypassule found");

594 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

595 *
byss_ru_hd_p
 = 0;

596  
OF_SUCCESS
;

599 *
byss_ru_hd_p
 = 
byss_ru_sn_node_p
->
byss_ru_hd
;

601 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Exact matching bypassule found");

602 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

603  
OF_SUCCESS
;

604 
	}
}

622 
t32_t
 
	$nsc_g_nwrvi_s
(
ut64_t
 
nscha_obje_hd
,

623 
ut64_t
 
byss_ru_hd
,

624 
ut8_t
* 
no_of_nwrvi_objes_p
,

625 
nw_rvis_to_y
** 
ns_s_p_p
)

627 
nm_nscha_obje
* 
nscha_obje_p
 = 
NULL
;

628 
nscha_nwrvi_obje
* 
nwrvi_obje_sn_node_p
 = 
NULL
;

629 
nwrvi_
* 
nwrvi__sn_node_p
 = 
NULL
;

631 
ut32_t
 
hashkey
,
offt
,
offt_nwrvi_obje
;

633 
t32_t
 
tv
 = 
OF_SUCCESS
;

634 
ut8_t
 
no_of_nwrvis_assigd
 = 0;

635 
ut64_t
 
nwrvi__hd_xt
 = 0;

637 
ut8_t
 
nw_rvi_byss
,
no_of_rvis_to_assign
,
no_of_nw_rvis_to_byss
;

638 
ut8_t
 
xt_rvi__t
;

639 
ut8_t
 
nwrvi__cou
;

641 
nwrvi_obje_sk_li
 *
nwrvi_sk_li_sn_p
 = 
NULL
;

642 
nm_nwrvi_byss_ru
* 
byss_ru_p
;

643 
nw_rvis_to_y
 *
nw_rvis_to_y_p
, *
nw_rvis_to_y_t_p
;

645 
	`CNTLR_RCU_READ_LOCK_TAKE
();

647 
tv
 = 
	`nm_g_nscha_byhd
(
nscha_obje_hd
, &
nscha_obje_p
);

648 if(
tv
 !
NSRM_SUCCESS
)

650 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No chainxists");

651 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

652  
NSC_INVALID_NSCHAIN_HANDLE
;

655 if(
nscha_obje_p
->
no_of_nw_rvi_objes
 == 0)

657 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

658 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"No Network Service objects found");

659  
NSC_NO_NW_SERVICES_FOUND
;

662 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"numb onw_rviobje = %d",
nscha_obje_p
->
no_of_nw_rvi_objes
);

664 
no_of_nw_rvis_to_byss
 = 0;

666 if(
byss_ru_hd
 !=0)

668 
tv
 = 
	`nm_g_byss_ru_byhd
(
nscha_obje_p
,
byss_ru_hd
,&
byss_ru_p
);

669 if(
tv
 !
OF_SUCCESS
)

671 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

672 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalid bypass handle");

673  
NSC_INVALID_BYPASS_HANDLE
;

677 
no_of_nw_rvis_to_byss
 = 
byss_ru_p
->
no_of_nwrvi_objes
;

678 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"numb onw_rvitbys%d",
no_of_nw_rvis_to_byss
);

681 
no_of_rvis_to_assign
 = (
nscha_obje_p
->
no_of_nw_rvi_objes
 - 
no_of_nw_rvis_to_byss
);

683 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"numb onw_rvitassig = %d",
no_of_rvis_to_assign
);

685 if(
no_of_rvis_to_assign
 == 0)

687 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

688 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nmber ofw servicesossign is 0");

689  
NSC_NO_NW_SERVICES_FOUND
;

693 
nw_rvis_to_y_p
 = (
nw_rvis_to_y
*)(
	`mloc
(( (nw_rvis_to_y* 
no_of_rvis_to_assign
 )));

694 if(
nw_rvis_to_y_p
 =
NULL
)

696 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

697 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"memoryllocation failure for service handlesoeturn");

698  
OF_FAILURE
;

700 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

702 
nw_rvis_to_y_t_p
 = 
nw_rvis_to_y_p
;

704 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_rvis_to_y_%p", 
nw_rvis_to_y_t_p
);

708 
hashkey
 = 0;

710 
	`CNTLR_RCU_READ_LOCK_TAKE
();

711 
	`MCHASH_TABLE_SCAN
(
nscha_obje_p
->
nwrvi_objes_li
,
hashkey
)

713 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwcha_objeam%s",
nscha_obje_p
->
me_p
);

714 
hashkey
 = 0;

715 
offt_nwrvi_obje
 = 
NSRM_NSCHAIN_NWSERVICE_OBJECT_TBL_OFFSET
;

716 
	`MCHASH_BUCKET_SCAN
(
nscha_obje_p
->
nwrvi_objes_li
,
hashkey
,

717 
nwrvi_obje_sn_node_p
,

718 
nscha_nwrvi_obje
*,
offt_nwrvi_obje
)

720 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"\r\nInsidewservice_object bucket scan");

722 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi_objeam%s", 
nwrvi_obje_sn_node_p
->
me_p
);

723 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"quumb = %d", 
nwrvi_obje_sn_node_p
->
qu_numb
);

724 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__cou = %d", 
nwrvi_obje_sn_node_p
->
nwrvi__cou
);

725 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_nwrvi__to_be_ud = %x", 
nwrvi_obje_sn_node_p
->
xt_nwrvi__to_be_ud
);

726 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi_obje svi_obje_%x", 
nwrvi_obje_sn_node_p
->
nwrvi_obje_f
);

728 if(
no_of_rvis_to_assign
 == 0)

731 if(
nwrvi_obje_sn_node_p
->
nwrvi__cou
 == 0)

733 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Noetwork servicesrettachedohewservice_object");

738 
nw_rvi_byss
 = 0;

740 if(
byss_ru_hd
 !=0)

742 
	`OF_LIST_SCAN
(
byss_ru_p
->
sk_nwrvi_objes
, 
nwrvi_sk_li_sn_p
,

743 
nwrvi_obje_sk_li
 *,

744 
NSRM_NWSERVICE_SKIP_LISTNODE_OFFSET
)

746 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"*** Check ifhe service objecto be bypassed***");

747 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"skam:%, sviam:%s",
nwrvi_sk_li_sn_p
->
nwrvi_obje_me_p
 , 
nwrvi_obje_sn_node_p
->
me_p
);

749 if(
nwrvi_sk_li_sn_p
->
nwrvi_obje_hd
 =
nwrvi_obje_sn_node_p
->
nwrvi_obje_f
)

751 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"It iso be bypassed.");

752 
nw_rvi_byss
 = 1;

757 if(
nw_rvi_byss
 == 1)

759 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Checkheextwservice_object");

763 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"It isoto be bypassed.");

765 
hashkey
 = 0;

766 
	`MCHASH_TABLE_SCAN
(
nwrvi_obje_sn_node_p
->
nwrvi__li
,
hashkey
)

768 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"\r\nInsidewservice instanceable scan");

769 
offt
 = 
NSRM_NWSERVICE_INSTANCE_TBL_OFFSET
;

770 
xt_rvi__t
 = 0;

771 
nwrvi__hd_xt
 = 
nwrvi_obje_sn_node_p
->
xt_nwrvi__to_be_ud
;

772 
nwrvi__cou
 = 
nwrvi_obje_sn_node_p
->nwservice_instance_count;

773 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nwrvi__cou = %x",
nwrvi__cou
);

774 
	`MCHASH_BUCKET_SCAN
(
nwrvi_obje_sn_node_p
->
nwrvi__li
,
hashkey
,

775 
nwrvi__sn_node_p
,

776 
nwrvi_
*,
offt
)

778 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Insidewservice instance bucket scan");

779 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Nwk svi inam%s",
nwrvi__sn_node_p
->
me_p
);

780 if(
xt_rvi__t
 == 0)

782 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"next_service_instance_set = 0");

783 if(
nwrvi__hd_xt
 == 0)

785 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwservice_instance_handle_next = 0");

786 
nwrvi__hd_xt
 = 
nwrvi__sn_node_p
->
f_nwrvi_
;

788 if(
nwrvi__sn_node_p
->
f_nwrvi_
 !
nwrvi__hd_xt
)

790 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," search forwservice_instanceo bessgned");

791 
nwrvi__cou
--;

794 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Assignhe service instance");

795 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_rvis_to_y_%p", 
nw_rvis_to_y_p
);

796 
nw_rvis_to_y_p
->
nwrvi__hd
 = 
nwrvi__hd_xt
;

797 
nw_rvis_to_y_p
->
nwrvi_obje_hd
 = 
nwrvi_obje_sn_node_p
->
nwrvi_obje_f
;

798 
nw_rvis_to_y_p
->
nscha_obje_hd
 =schain_object_handle;

800 
tv
 = 
	`nm_g_nwrvi__byhd
(
nw_rvis_to_y_p
->
nscha_obje_hd
,

801 
nw_rvis_to_y_p
->
nwrvi_obje_hd
,

802 
nw_rvis_to_y_p
->
nwrvi__hd
,

803 &
nwrvi__p
);

805 if(
tv
 =
OF_FAILURE
)

807 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo gethe service instance.Getheext service instance");

808 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

809  
OF_FAILURE
;

812 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_ = %d",
nwrvi__p
->
vn_id_
);

813 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_ou%d",
nwrvi__p
->
vn_id_out
);

814 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Svi In Nam%s",
nwrvi__p
->
me_p
);

815 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Swch Nam%s",
nwrvi__p
->
swch_me
);

817 
nw_rvis_to_y_p
++;

818 
no_of_nwrvis_assigd
++;

819 
nwrvi__cou
--;

820 
no_of_rvis_to_assign
--;

821 
xt_rvi__t
 = 1;

822 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"next_service_instance_set = 1");

823 if(
nwrvi__cou
 == 0)

825 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwservice_instance_count = 0");

827 
nwrvi_obje_sn_node_p
->
xt_nwrvi__to_be_ud
 = 0;

833 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"next service_instanceo bessigned is decided.Copiedowservice_object_scan_node_p->next_nwservice_instance_to_be_used");

834 
nwrvi_obje_sn_node_p
->
xt_nwrvi__to_be_ud
 = 
nwrvi__sn_node_p
->
f_nwrvi_
;

843 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

845 *
no_of_nwrvi_objes_p
 = 
no_of_nwrvis_assigd
;

846 if(
no_of_nwrvis_assigd
)

848 *
ns_s_p_p
 = 
nw_rvis_to_y_t_p
;

849 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_rvis_to_y_%p", 
nw_rvis_to_y_p
);

850 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"numb onw_rviassigd = %d",
no_of_nwrvis_assigd
);

851 
tv
 = 
OF_SUCCESS
;

855 
tv
 = 
NSC_NO_NW_SERVICES_FOUND
;

856 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"noetwork servicesre foundossign");

857 
	`
(
nw_rvis_to_y_p
);

859  
tv
;

864 
	}
}

866 
	$nsc_g__bd_b_mempoޒs
(
ut32_t
* 
_bd_s_max
, ut32_t* 
_bd_ic_s
)

868 *
_bd_s_max
 = 
NSC_MAX_CNBIND_TBL_ENTRIES
;

869 *
_bd_ic_s
 = 
NSC_MAX_CNBIND_TBL_STATIC_ENTRIES
;

870 
	}
}

872 
	$nsc_g_posy_b_1_mempoޒs
(
ut32_t
* 
nsc_posy_s_max
, ut32_t* 
nsc_posy_ic_s
)

874 *
nsc_posy_s_max
 = 
NSC_MAX_REPOSITORY_TBL_1_ENTRIES
;

875 *
nsc_posy_ic_s
 = 
NSC_MAX_REPOSITORY_TBL_1_STATIC_ENTRIES
;

876 
	}
}

878 
	$nsc_g_posy_b_2_mempoޒs
(
ut32_t
* 
nsc_posy_s_max
, ut32_t* 
nsc_posy_ic_s
)

880 *
nsc_posy_s_max
 = 
NSC_MAX_REPOSITORY_TBL_2_ENTRIES
;

881 *
nsc_posy_ic_s
 = 
NSC_MAX_REPOSITORY_TBL_2_STATIC_ENTRIES
;

882 
	}
}

884 
	$nsc_g_posy_b_3_mempoޒs
(
ut32_t
* 
nsc_posy_s_max
, ut32_t* 
nsc_posy_ic_s
)

886 *
nsc_posy_s_max
 = 
NSC_MAX_REPOSITORY_TBL_3_ENTRIES
;

887 *
nsc_posy_ic_s
 = 
NSC_MAX_REPOSITORY_TBL_3_STATIC_ENTRIES
;

888 
	}
}

890 
	$nsc__b_1_posy_y_rcu
(
rcu_hd
 *
nsc_posy_y_p
)

892 
nscha_posy_y
* 
nsc_posy_node_p
;

893 
ut8_t
 
nw_ty
;

894 
ut32_t
 
nid
,
offt
;

895 
ut64_t
 
vn_hd
;

896 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

897 
m_vtu_twk
* 
vn_y_p
;

898 
t32_t
 
tv
;

900 if(
nsc_posy_y_p
)

902 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Abouto freeable 1epositoryntry");

904 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

905 
nsc_posy_node_p
 = (
nscha_posy_y
 *(((*)
nsc_posy_y_p
 - (2*((
mchash_d_node
 *)))- 
offt
);

907 
nw_ty
 = 
nsc_posy_node_p
->nw_type;

908 
nid
 = 
nsc_posy_node_p
->nid;

910 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

911 if(
tv
 =
OF_SUCCESS
)

913 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

914 if(
tv
 =
OF_SUCCESS
)

916 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

917 
tv
 = 
	`mempo_a_mem_block
(
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
,(
uch8_t
*)
nsc_posy_node_p
,nsc_posy_node_p->
hp_b
);

918 if(
tv
 !
MEMPOOL_SUCCESS
)

920 
	`tf
("\r\n Failedo deleteable_1epositoryntry incu callback");

921 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo deleteable_1epositoryntry incu callback");

926 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Successfully deletedable_1epositoryntry incu callback");

932 
	`tf
("\r\n Failedo obtain vnntry for L2etworko freeable_1_repository_entry");

933 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo obtain vnntry for L2etworko freeable_1_repository_entry");

936 
	}
}

938 
	$nsc__b_2_posy_y_rcu
(
rcu_hd
 *
nsc_posy_y_p
)

940 
nscha_posy_y
* 
nsc_posy_node_p
;

941 
ut8_t
 
nw_ty
;

942 
ut32_t
 
nid
,
offt
;

943 
ut64_t
 
vn_hd
;

944 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

945 
m_vtu_twk
* 
vn_y_p
;

946 
t32_t
 
tv
;

948 if(
nsc_posy_y_p
)

950 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Abouto freeable 2epositoryntry");

952 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

953 
nsc_posy_node_p
 = (
nscha_posy_y
 *(((*)
nsc_posy_y_p
 - (2*((
mchash_d_node
 *)))- 
offt
);

955 
nw_ty
 = 
nsc_posy_node_p
->nw_type;

956 
nid
 = 
nsc_posy_node_p
->nid;

958 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

959 if(
tv
 =
OF_SUCCESS
)

961 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

962 if(
tv
 =
OF_SUCCESS
)

964 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

965 
tv
 = 
	`mempo_a_mem_block
(
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
,(
uch8_t
*)
nsc_posy_node_p
,nsc_posy_node_p->
hp_b
);

966 if(
tv
 !
MEMPOOL_SUCCESS
)

968 
	`tf
("\r\n Failedo deleteable_2epositoryntry incu callback");

969 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo deleteable_2epositoryntry incu callback");

974 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Successfully deletedable_2epositoryntry incu callback");

980 
	`tf
("\r\nFailedo obtain vnntry for L2etworko freeable_2_repository_entry");

981 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo obtain vnntry for L2etworko freeable_2_repository_entry");

984 
	}
}

986 
	$nsc__b_3_posy_y_rcu
(
rcu_hd
 *
upkt_out_posy_y_p
)

988 
upkt_out_posy_y
* 
upkt_out_posy_node_p
;

989 
ut8_t
 
nw_ty
;

990 
ut32_t
 
nid
,
offt
;

991 
ut64_t
 
vn_hd
;

992 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

993 
m_vtu_twk
* 
vn_y_p
;

994 
t32_t
 
tv
;

996 if(
upkt_out_posy_y_p
)

998 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Abouto freeable 3epositoryntry");

1000 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1001 
upkt_out_posy_node_p
 = (
upkt_out_posy_y
 *(((*)
upkt_out_posy_y_p
 - (2*((
mchash_d_node
 *)))- 
offt
);

1003 
nw_ty
 = 
upkt_out_posy_node_p
->nw_type;

1004 
nid
 = 
upkt_out_posy_node_p
->nid;

1006 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1007 if(
tv
 =
OF_SUCCESS
)

1009 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1010 if(
tv
 =
OF_SUCCESS
)

1012 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1013 
tv
 = 
	`mempo_a_mem_block
(
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
,(
uch8_t
*)
upkt_out_posy_node_p
,upkt_out_posy_node_p->
hp_b
);

1014 if(
tv
 !
MEMPOOL_SUCCESS
)

1016 
	`tf
("\r\n Failedo deleteable_3epositoryntry incu callback");

1017 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo deleteable_3epositoryntry incu callback");

1022 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Successfully deletedable_3epositoryntry incu callback");

1028 
	`tf
("\r\nFailedo obtain vnntry for L2etworko freeable_3_repository_entry");

1029 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo obtain vnntry for L2etworko freeable_3_repository_entry");

1032 
	}
}

1034 
t32_t
 
	$nsc__vn_sours
(
m_vtu_twk
* 
vn_y_p
)

1036 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1037 
mempo_ms
 
mempo_fo
={};

1038 
ut32_t
 
_bd_s_max
,
_bd_ic_s
;

1039 
ut32_t
 
nsc_posy_s_b_1_max
,
nsc_posy_ic_s_b_1
;

1040 
ut32_t
 
nsc_posy_s_b_2_max
,
nsc_posy_ic_s_b_2
;

1041 
ut32_t
 
upkt_out_posy_s_max
,
upkt_out_posy_ic_s
;

1042 
t32_t
 
tv
;

1044 *
mp_p
;

1046 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1048 
mp_p
 = (*)(
	`mloc
( (
vn_rvi_chag_fo
)));

1050 if(
mp_p
 =
NULL
)

1052 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1053 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"memoryllocation failure for vn_service_chaining_info");

1054  
OF_FAILURE
;

1057 *((
tsddr_t
 *)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
)sddr_t)
mp_p
;

1058 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)*((
tsddr_t
 *)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1059 
	`memt
(
vn_nsc_fo_p
,0, (
vn_rvi_chag_fo
));

1063 
	`nsc_g__bd_b_mempoޒs
(&
_bd_s_max
,&
_bd_ic_s
);

1064 
nsc_no_of_bd_b_bucks_g
 = (
_bd_s_max
 * 2 / 5) + 1;

1066 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

1067 
mempo_fo
.
block_size
 = (
l2_ci_to_nsfo_bd_node
);

1068 
mempo_fo
.
max_blocks
 = 
_bd_s_max
;

1069 
mempo_fo
.
ic_blocks
 = 
_bd_ic_s
;

1070 
mempo_fo
.
thshd_m
 = 
_bd_ic_s
/10;

1071 
mempo_fo
.
thshd_max
 = 
_bd_ic_s
/3;

1072 
mempo_fo
.
ish_cou
 = 
_bd_ic_s
/10;

1073 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

1074 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

1075 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

1077 
tv
 = 
	`mempo__po
("nsc_cnbind_pool",

1078 &
mempo_fo
,

1079 &(
vn_nsc_fo_p
->
nsc__bd_mempo_g
)

1082 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"debug2");

1083 if(
tv
 !
MEMPOOL_SUCCESS
)

1085 
tv
 = 
OF_FAILURE
;

1089 
tv
 = 
	`mchash_b_
(
nsc_no_of_bd_b_bucks_g
,

1090 
_bd_s_max
 * 2,

1091 
tsc_nsc_bd_l_
,

1092 &(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
)

1095 if(
tv
 !
MCHASHTBL_SUCCESS
)

1097 
tv
 = 
OF_FAILURE
;

1100 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"debug3");

1101 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"l2_ci_to_nsfo_bd_b_%p",
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
);

1102 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"debug4");

1107 
	`nsc_g_posy_b_1_mempoޒs
(&
nsc_posy_s_b_1_max
,&
nsc_posy_ic_s_b_1
);

1108 
nsc_no_of_posy_b_1_bucks_g
 = (
nsc_posy_s_b_1_max
 / 5) + 1;

1110 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

1111 
mempo_fo
.
block_size
 = (
nscha_posy_y
);

1112 
mempo_fo
.
max_blocks
 = 
nsc_posy_s_b_1_max
;

1113 
mempo_fo
.
ic_blocks
 = 
nsc_posy_ic_s_b_1
;

1114 
mempo_fo
.
thshd_m
 = 
nsc_posy_ic_s_b_1
/10;

1115 
mempo_fo
.
thshd_max
 = 
nsc_posy_ic_s_b_1
/3;

1116 
mempo_fo
.
ish_cou
 = 
nsc_posy_ic_s_b_1
/10;

1117 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

1118 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

1119 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

1122 
tv
 = 
	`mempo__po
("nsc_repository_table_1_pool",

1123 &
mempo_fo
,

1124 &(
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
)

1127 if(
tv
 !
MEMPOOL_SUCCESS
)

1129 
tv
 = 
OF_FAILURE
;

1133 
tv
 = 
	`mchash_b_
(
nsc_no_of_posy_b_1_bucks_g
,

1134 
nsc_posy_s_b_1_max
,

1135 
nsc__b_1_posy_y_rcu
,

1136 &(
vn_nsc_fo_p
->
nsc_posy_b_1_p
)

1139 if(
tv
 !
MCHASHTBL_SUCCESS
)

1141 
tv
 = 
OF_FAILURE
;

1147 
	`nsc_g_posy_b_2_mempoޒs
(&
nsc_posy_s_b_2_max
,&
nsc_posy_ic_s_b_2
);

1148 
nsc_no_of_posy_b_2_bucks_g
 = (
nsc_posy_s_b_2_max
 / 5) + 1;

1150 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

1151 
mempo_fo
.
block_size
 = (
nscha_posy_y
);

1152 
mempo_fo
.
max_blocks
 = 
nsc_posy_s_b_2_max
;

1153 
mempo_fo
.
ic_blocks
 = 
nsc_posy_ic_s_b_2
;

1154 
mempo_fo
.
thshd_m
 = 
nsc_posy_ic_s_b_2
/10;

1155 
mempo_fo
.
thshd_max
 = 
nsc_posy_ic_s_b_2
/3;

1156 
mempo_fo
.
ish_cou
 = 
nsc_posy_ic_s_b_2
/10;

1157 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

1158 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

1159 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

1163 
tv
 = 
	`mempo__po
("nsc_repository_table_2pool",

1164 &
mempo_fo
,

1165 &(
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
)

1168 if(
tv
 !
MEMPOOL_SUCCESS
)

1170 
tv
 = 
OF_FAILURE
;

1174 
tv
 = 
	`mchash_b_
(
nsc_no_of_posy_b_2_bucks_g
,

1175 
nsc_posy_s_b_2_max
,

1176 
nsc__b_2_posy_y_rcu
,

1177 &(
vn_nsc_fo_p
->
nsc_posy_b_2_p
)

1180 if(
tv
 !
MCHASHTBL_SUCCESS
)

1182 
tv
 = 
OF_FAILURE
;

1188 
	`nsc_g_posy_b_3_mempoޒs
(&
upkt_out_posy_s_max
,&
upkt_out_posy_ic_s
);

1189 
nsc_no_of_posy_b_3_bucks_g
 = (
upkt_out_posy_s_max
 / 5) + 1;

1191 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

1192 
mempo_fo
.
block_size
 = (
upkt_out_posy_y
);

1193 
mempo_fo
.
max_blocks
 = 
upkt_out_posy_s_max
;

1194 
mempo_fo
.
ic_blocks
 = 
upkt_out_posy_ic_s
;

1195 
mempo_fo
.
thshd_m
 = 
upkt_out_posy_ic_s
/10;

1196 
mempo_fo
.
thshd_max
 = 
upkt_out_posy_ic_s
/3;

1197 
mempo_fo
.
ish_cou
 = 
upkt_out_posy_ic_s
/10;

1198 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

1199 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

1200 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

1202 
tv
 = 
	`mempo__po
("nsc_repository_table_3pool",

1203 &
mempo_fo
,

1204 &(
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
)

1207 if(
tv
 !
MEMPOOL_SUCCESS
)

1209 
tv
 = 
OF_FAILURE
;

1213 
tv
 = 
	`mchash_b_
(
nsc_no_of_posy_b_3_bucks_g
,

1214 
upkt_out_posy_s_max
,

1215 
nsc__b_3_posy_y_rcu
,

1216 &(
vn_nsc_fo_p
->
nsc_posy_b_3_p
)

1219 if(
tv
 !
MCHASHTBL_SUCCESS
)

1221 
tv
 = 
OF_FAILURE
;

1227 if(
tv
 !
OF_SUCCESS
)

1229 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc__bd_mempo_g
);

1230 
	`mchash_b_de
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
);

1232 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
);

1233 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_1_p
);

1235 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
);

1236 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_2_p
);

1238 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
);

1239 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_3_p
);

1241 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1242 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC - initialization of VNesources is unsuccessful");

1243  
OF_FAILURE
;

1246 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1247 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC - initialization of VNesources is successful");

1248  
OF_SUCCESS
;

1249 
	}
}

1251 
t32_t
 
	$nsc_de_vn_sours
(
m_vtu_twk
* 
vn_y_p
)

1253 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1254 
t32_t
 
tv
 = 
FALSE
;

1256 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1258 
tv
 = 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc__bd_mempo_g
);

1259 
tv
 = 
	`mchash_b_de
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
);

1261 
tv
 = 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
);

1262 
tv
 = 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
);

1263 
tv
 = 
	`mempo_de_po
(
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
);

1265 
tv
 = 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_1_p
);

1266 
tv
 = 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_2_p
);

1267 
tv
 = 
	`mchash_b_de
(
vn_nsc_fo_p
->
nsc_posy_b_3_p
);

1269  
tv
;

1270 
	}
}

1272 
t32_t
 
	$nsc_
()

1274 
t32_t
 
tv
 = 
OF_SUCCESS
;

1278 
tv
 = 
	`m_vn_gi_iti
("nmp1",&
vn_nsc_fo_offt_g
);

1279 if(
tv
 =
CRM_SUCCESS
)

1281 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Applicationegistration with VN infrastructure is successful");

1285 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Applicationegistration with VN infrastructure is unsuccessful");

1289 
tv
 = 
	`nsc_gi_nm_nifitis
();

1290 if(
tv
 =
OF_SUCCESS
)

1292 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Applicationegistration with NSRMotifications infrastructure is successful");

1296 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Applicationegistration with NSRMotification infrastructure is unsuccessful");

1297 
tv
 = 
	`m_vn_uegi_iti
("nsrmapp1");

1302  
tv
;

1303 
	}
}

1305 
t32_t
 
	$nsc_un
()

1307 
t32_t
 
tv
;

1309 
tv
 = 
	`m_vn_uegi_iti
("nsrmapp1");

1310 if(
tv
 =
CRM_SUCCESS
)

1312 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Application deregistration with VN infrastructure is successful");

1316 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSC Application deregistration with VN infrastructure is unsuccessful");

1318  
tv
;

1319 
	}
}

	@tsc_nsc_iface.c

23 
	~"cڌr.h
"

24 
	~"tsc_cڌr.h
"

25 
	~"mi.h
"

26 
	~"m_vn_i.h
"

27 
	~"m_pt_i.h
"

28 
	~"tsc_nsc_i.h
"

29 
	~"tsc_nvm_modus.h
"

30 
	~"nm.h
"

31 
	~"nmldef.h
"

32 
	~"tsc_ofv1_3_ug.h
"

34 
ut32_t
 
vn_nsc_fo_offt_g
;

35 
tsc_nvm_modu_r
 
tsc_nvm_modus
[
SUPPORTED_NW_TYPE_MAX
 + 1];

37 
ut32_t
 
vn_nsc_fo_offt_g
;

38 
ut32_t
 
nsc_no_of_posy_b_1_bucks_g
;

39 
ut32_t
 
nsc_no_of_posy_b_2_bucks_g
;

40 
ut32_t
 
nsc_no_of_posy_b_3_bucks_g
;

42 
nsc_t_posy_y
(
nscha_posy_y
* 
nscha_posy_y_p
);

43 
t32_t
 
nm__diy_rvi_vms__cha
(
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
,
ut8_t
 
_ty
);

44 
t32_t
 
tsc_nsc_nd_ive_ow
(
nscha_posy_y
* 
nscha_posy_y_f_p
,

45 
t_l_ows_membs
* 
tsc_l_ows_p
,

46 
nwrvi_
 *
nw_rvi_p
,

47 
nscha_posy_y
** 
posy_y_1_p
);

49 
t32_t
 
tsc_nsc_nd_ive_ow_b_3
(
nscha_posy_y
* 
nscha_posy_y_f_p
,

50 
nwrvi_
 *
nw_rvi_p
,

51 
ut8_t
 
u_dmac
);

63 
t32_t
 
	$nsc_g_l2_nschag_fo
(
nscha_posy_y
* 
nscha_posy_y_p
,

64 
o_ck_
* 
pkt_
,

65 
ut8_t
 
pkt_ig
)

68 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

69 
m_vtu_twk
* 
vn_y_p
;

70 
m_pt
* 
d_m_pt_p
;

72 
ut64_t
 
vn_hd
,
m_pt_hd
;

73 
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
;

74 
nwrvi_
* 
nwrvi__p
;

75 
nw_rvis_to_y
 *
nw_rvis_p
;

76 
nw_rvis_to_y
 *
nw_rvis_cdy_p
;

77 
ut8_t
 
_ty
,
ii
,
pt_ty
;

78 
ut8_t
 
nsc_nw_funi_found
;

79 
ut8_t
 
no_of_nwrvi_s
;

80 
ut8_t
 
nwrvi__dex
;

82 
t32_t
 
tv
 = 
OF_FAILURE
;

83 
ut8_t
 
cy_ig_mac_b
;

85 
cy_ig_mac_b
 = 
FALSE
;

86 if((
pkt_ig
 =
VM_NS
&& (
nscha_posy_y_p
->
vn_id_pkt
 != 0))

87 
cy_ig_mac_b
 = 
TRUE
;

90 
tv
 = 
	`nsc_g_bd_y
(
pkt_
,

91 &
nscha_posy_y_p
->

,

92 
nscha_posy_y_p
->
nw_ty
,

93 
nscha_posy_y_p
->
nid
,

94 &
_bd_y_p
,

95 &
_ty
,

96 
cy_ig_mac_b
);

98 if(
tv
 =
OF_FAILURE
)

100 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nsc_get_cnbind_entry()eturned OF_FAILURE");

101  
OF_FAILURE
;

104 if(
tv
 =
NSC_CONNECTION_BIND_ENTRY_CREATED
)

106 
nscha_posy_y_p
->

.
_ty
 = selector_type;

107 
nscha_posy_y_p
->

.
bd_node_p
 = 
_bd_y_p
;

108 if(
nscha_posy_y_p
->

.
_ty
 == 1)

110 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"A mchg PRIMARY SELECTOR ifound. se܁y 1:PRIMARY 2:SECONDARY = %d",
nscha_posy_y_p
->

.
_ty
);

114 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"A mchg SECONDARY SELECTOR ifound. se܁y 1:PRIMARY 2:SECONDARY = %d",
nscha_posy_y_p
->

.
_ty
);

117 
tv
 = 
	`nsc_lookup_l2_nschag_fo
(
pkt_
,

118 
nscha_posy_y_p
->
nw_ty
,

119 
nscha_posy_y_p
->
nid
,

120 
_bd_y_p
);

122 if(
tv
 =
OF_FAILURE
)

126 if(
_bd_y_p
 !
NULL
)

128 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"releasing cn_bind_entryo mempoolsscookup failed");

129 
	`CNTLR_RCU_READ_LOCK_TAKE
();

131 
tv
 = 
tsc_nvm_modus
[
nscha_posy_y_p
->
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
scha_posy_y_p->
nid
,&
vn_hd
);

132 if(
tv
 =
OF_SUCCESS
)

133 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

135 if(
tv
 =
OF_SUCCESS
)

138 
_bd_y_p
->
nwrvi_fo
.
no_of_nwrvi_s
 = 0;

139 if(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
 !
NULL
)

140 
	`
(
_bd_y_p
->
nwrvi_fo
.
nw_rvis_p
);

142 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

143 
	`mempo_a_mem_block
(
vn_nsc_fo_p
->
nsc__bd_mempo_g
,

144 (
uch8_t
 *)
_bd_y_p
,

145 
_bd_y_p
->
hp_b
);

147 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"cn_bind_entry iseleasedo mempoolsscookup failed");

149 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

151  
OF_FAILURE
;

154 
	`CNTLR_RCU_READ_LOCK_TAKE
();

156 
tv
 = 
tsc_nvm_modus
[
nscha_posy_y_p
->
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
scha_posy_y_p->
nid
,&
vn_hd
);

157 if(
tv
 =
OF_SUCCESS
)

158 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

160 if(
tv
 =
OF_SUCCESS
)

162 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

163 
tv
 = 
	`nsc_add_s
(
vn_nsc_fo_p
->
l2_ci_to_nsfo_bd_b_p
,vn_nsc_fo_p->
nsc__bd_mempo_g
 ,
_bd_y_p
);

165 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

166 if(
tv
 =
OF_FAILURE
)

167  
tv
;

170 
nscha_posy_y_p
->

.
dex
 = 
_bd_y_p
->
_1
.index;

171 
nscha_posy_y_p
->

.
magic
 = 
_bd_y_p
->
_1
.magic;

172 
nscha_posy_y_p
->

.
_n
 = 
_bd_y_p
->
_1
.safe_reference;

174 
nscha_posy_y_p
->

.
h__p
 = &(
_bd_y_p
->
_2
);

175 
nscha_posy_y_p
->

.
h__p
->
dex
 = 
_bd_y_p
->
_2
.index;

176 
nscha_posy_y_p
->

.
h__p
->
magic
 = 
_bd_y_p
->
_2
.magic;

177 
nscha_posy_y_p
->

.
h__p
->
_n
 = 
_bd_y_p
->
_2
.safe_reference;

178 
nscha_posy_y_p
->
vm_d_rvi1_n__me_swch
 = 0;

179 
nscha_posy_y_p
->
ns_cha_b
 = 
FALSE
;

180 
nscha_posy_y_p
->
me_nf_b
 = 
FALSE
;

181 
nscha_posy_y_p
->
ns_pt_b
 = 
FALSE
;

183 if((
_bd_y_p
->
nsc_cfig_us
 =
NSC_NWSERVICES_CONFIGURED
))

187 
nscha_posy_y_p
->
ns_cha_b
 = 
TRUE
;

188 
nscha_posy_y_p
->
nw_pt_b
 = 
FALSE
;

190 
no_of_nwrvi_s
 = 
_bd_y_p
->
nwrvi_fo
.no_of_nwservice_instances;

191 
nw_rvis_p
 = (
nw_rvis_to_y
 *)
_bd_y_p
->
nwrvi_fo
.nw_services_p;

192 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"no_of_nwrvi_%d",
no_of_nwrvi_s
);

195 if(
_ty
 =
SELECTOR_SECONDARY
)

197 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"selector is secondary selector.");

198 
nw_rvis_cdy_p
 = (
nw_rvis_to_y
*)(
nw_rvis_p
 + 
no_of_nwrvi_s
 - 1);

199 
nw_rvis_p
 = 
nw_rvis_cdy_p
;

203 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"selector isrimary selector.");

207 
nsc_nw_funi_found
 = 0;

209 
	`CNTLR_RCU_READ_LOCK_TAKE
();

211 
nwrvi__dex
 = 0;wrvi__dex < 
no_of_nwrvi_s
;wservice_instance_index++)

213 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

214 if(
nwrvi__dex
 >0)

216 if(
_ty
 =
SELECTOR_PRIMARY
)

218 
nw_rvis_p
++;

219 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Incrementingw_servcies_p");

223 
nw_rvis_p
--;

226 
tv
 = 
	`nm_g_nwrvi__byhd
(
nw_rvis_p
->
nscha_obje_hd
,

227 
nw_rvis_p
->
nwrvi_obje_hd
,

228 
nw_rvis_p
->
nwrvi__hd
,

229 &
nwrvi__p
);

231 if(
tv
 =
OF_FAILURE
)

233 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo gethe service instance.Getheext service instance");

237 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"twk svi inam%s",
nwrvi__p
->
me_p
);

238 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_ig = %d",
pkt_ig
);

240 if(
pkt_ig
 =
VM_NS
)

242 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Incomingetwork function found for VM_NS");

243 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

245 if(
nsc_nw_funi_found
 == 0)

247 if((
_ty
 =
SELECTOR_PRIMARY
&& (
nwrvi__p
->
vn_id_out
 =
nscha_posy_y_p
->
vn_id_pkt
))

249 
nsc_nw_funi_found
 = 1;

252 if((
_ty
 =
SELECTOR_SECONDARY
&& (
nwrvi__p
->
vn_id_
 =
nscha_posy_y_p
->
vn_id_pkt
))

254 
nsc_nw_funi_found
 = 1;

257 if(
nsc_nw_funi_found
 == 1)

259 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"outgoingetwork function found for VM_NS");

260 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

262 
nsc_nw_funi_found
 = 2;

263 
nscha_posy_y_p
->
me_nf_b
 = 
TRUE
;

264 
nscha_posy_y_p
->
xt_vn_id
 = 
nwrvi__p
->
vn_id_
;

265 if(
_ty
 =
SELECTOR_SECONDARY
)

267 
nscha_posy_y_p
->
xt_vn_id
 = 
nwrvi__p
->
vn_id_out
;

269 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

271 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn_id_ = %d",
nscha_posy_y_p
->
xt_vn_id
);

272 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn__out%d",
nscha_posy_y_p
->
mch_vn_id
);

277 if(
pkt_ig
 =
VM_APPLN
)

279 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Targetetwork function found for VM_APPLN ");

280 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

281 
nsc_nw_funi_found
 = 1;

282 
nscha_posy_y_p
->
me_nf_b
 = 
TRUE
;

283 
nscha_posy_y_p
->
xt_vn_id
 = 
nwrvi__p
->
vn_id_
;

284 if(
_ty
 =
SELECTOR_SECONDARY
)

286 
	`tf
("\r\n VM_APPLN SEC");

287 
nscha_posy_y_p
->
xt_vn_id
 = 
nwrvi__p
->
vn_id_out
;

291 
	`tf
("\r\n VM_APPLN PRI");

293 
nscha_posy_y_p
->
mch_vn_id
 = 0;

295 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn_id_ = %d",
nscha_posy_y_p
->
xt_vn_id
);

296 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn__out%d",
nscha_posy_y_p
->
mch_vn_id
);

300 if((
pkt_ig
 =
NW_UNICAST_SIDE
)||kt_ig =
NW_BROADCAST_SIDE
))

302 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Packet iseceived from NW");

303 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nscha_posy_y_p->vn_id_pk%d",
nscha_posy_y_p
->
vn_id_pkt
);

304 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__p->vn_id_nwrvi__p->vn_id_ = %d",
nwrvi__p
->
vn_id_
);

306 if(
nscha_posy_y_p
->
vn_id_pkt
 =
nwrvi__p
->
vn_id_
)

308 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Targetetwork function found for NW");

309 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

310 
nsc_nw_funi_found
 = 1;

311 
nscha_posy_y_p
->
me_nf_b
 = 
TRUE
;

313 
nscha_posy_y_p
->
xt_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

314 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

316 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn_id_ = %d",
nscha_posy_y_p
->
xt_vn_id
);

317 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn__out%d",
nscha_posy_y_p
->
mch_vn_id
);

322 if(
nscha_posy_y_p
->
vn_id_pkt
 =
nwrvi__p
->
vn_id_out
)

324 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Targetetwork function found for NW");

325 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwrvi__dex = %d",
nwrvi__dex
);

326 
nsc_nw_funi_found
 = 1;

327 
nscha_posy_y_p
->
me_nf_b
 = 
TRUE
;

329 
nscha_posy_y_p
->
xt_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

330 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

332 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn_id_ = %d",
nscha_posy_y_p
->
xt_vn_id
);

333 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn__out%d",
nscha_posy_y_p
->
mch_vn_id
);

337 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Look forext service function if it matches withheeceivedacket.");

341 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

343 
nscha_posy_y_p
->

.
_ty
 = selector_type;

345 if(
pkt_ig
 =
VM_NS
)

347 if(
nsc_nw_funi_found
 == 1)

349 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"No moreetwork functionsresent inheschain: VM_NS");

351 
nscha_posy_y_p
->
me_nf_b
 = 
FALSE
;

352 
nscha_posy_y_p
->
ns_pt_b
 = 
TRUE
;

353 
nscha_posy_y_p
->
xt_vn_id
 = 0;

354 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

355 
nscha_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

359 
	`CNTLR_RCU_READ_LOCK_TAKE
();

362 
	`tf
("\r\n crashing dst mac = " );

363 
ii
 = 0;ii<6;ii++)

365 
	`tf
("%x",
nscha_posy_y_p
->

.
d_mac
[
ii
]);

367 
tv
 = 
tsc_nvm_modus
[
nscha_posy_y_p
->
nw_ty
].
	`nvm_modu_g_vmpt_by_dmac_nid
scha_posy_y_p->

.
d_mac
,

368 
nscha_posy_y_p
->
nid
,

369 &
m_pt_hd
);

370 if(
tv
 !
OF_SUCCESS
)

372 
tv
 = 
OF_FAILURE
;

373 
	`tf
("\r\n MET 01");

376 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
d_m_pt_p
);

377 if(
tv
 =
OF_SUCCESS
)

379 
nscha_posy_y_p
->
out_pt_no
 = 
d_m_pt_p
->
pt_id
;

380 
nscha_posy_y_p
->
me_swch_
 = 
d_m_pt_p
->
swch_
;

381 
pt_ty
 = 
d_m_pt_p
->
m_pt_ty
;

382 
nscha_posy_y_p
->
nw_pt_b
 = 
FALSE
;

386 
tv
 = 
OF_FAILURE
;

387 
	`tf
("\r\n MET 02");

394 if((
pt_ty
 =
VM_GUEST_PORT
)

396 (
	`rcmp
((
nscha_posy_y_p
->
lol_swch_me_p
),(
d_m_pt_p
->
swch_me
)))

404 
tv
 = 
tsc_nvm_modus
[
nscha_posy_y_p
->
nw_ty
].
	`nvm_modu_g_uni_nwpt
scha_posy_y_p->
lol_swch_me_p
,

405 
nscha_posy_y_p
->
rvipt
,

406 &(
nscha_posy_y_p
->
out_pt_no
)

409 if(
tv
 !
OF_SUCCESS
)

411 
tv
 = 
OF_FAILURE
;

412 
	`tf
("\r\n MET 03");

415 
nscha_posy_y_p
->
ns_pt_b
 = 
TRUE
;

416 
nscha_posy_y_p
->
nw_pt_b
 = 
TRUE
;

420 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

422 if(
tv
 =
OF_FAILURE
)

424 
	`tf
("\r\n MET 04");

425  
OF_FAILURE
;

428 if(
nsc_nw_funi_found
 == 0)

430 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"No matchingetwork function found inheschain: VM_NS");

431 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"This message willotppear in general.VM-NS is usingon servicing chain vlan idnd may be configurationacket");

432 
nscha_posy_y_p
->
me_nf_b
 = 
FALSE
;

433 
nscha_posy_y_p
->
xt_vn_id
 = 0;

434 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

435 
nscha_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

437 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn_id_ = %d",
nscha_posy_y_p
->
xt_vn_id
);

438 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"vn__out%d",
nscha_posy_y_p
->
mch_vn_id
);

439 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"xt_b_id%d",
nscha_posy_y_p
->
xt_b_id
);

442 if((
pkt_ig
 =
VM_APPLN
&& (
nsc_nw_funi_found
 == 0))

444 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"No matchingetwork function found:VM_APPLN ");

445 
nscha_posy_y_p
->
ns_cha_b
 = 
FALSE
;

446 
nscha_posy_y_p
->
xt_vn_id
 = 0;

447 
nscha_posy_y_p
->
mch_vn_id
 = 0;

448 
nscha_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

450 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Service Chaininguleot found, sendacketoable 3");

453 if(((
pkt_ig
 =
NW_UNICAST_SIDE
)||kt_ig =
NW_BROADCAST_SIDE
)&& (
nsc_nw_funi_found
 == 0))

455 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"No matchingetwork function found:NW");

456 
nscha_posy_y_p
->
ns_cha_b
 = 
TRUE
;

457 
nscha_posy_y_p
->
me_nf_b
 = 
FALSE
;

458 
nscha_posy_y_p
->
xt_vn_id
 = 0;

459 
nscha_posy_y_p
->
mch_vn_id
 =scha_posy_y_p->
vn_id_pkt
;

460 
nscha_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

462 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Service Chaininguleot found, sendacketoable 3");

466 if((
_bd_y_p
->
nsc_cfig_us
 =
NSC_NWSERVICES_NOT_CONFIGURED
|| (_bd_y_p->nsc_cfig_u=
NSC_SERVICE_CHAINING_NONE_CONFIGURED_FOR_VN
))

468 
nscha_posy_y_p
->

.
_ty
 = selector_type;

469 
nscha_posy_y_p
->
ns_cha_b
 = 
FALSE
;

470 
nscha_posy_y_p
->
xt_vn_id
 = 0;

471 
nscha_posy_y_p
->
mch_vn_id
 = 0;

472 
nscha_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

474 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"w_service chainingotnabled forhis connection.sendacketo its destination VM viaable 3");

476 if(
nscha_posy_y_p
->
me_nf_b
 =
TRUE
)

478 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"moreetwork functions inhes chain");

479 if(
	`rcmp
(
nscha_posy_y_p
->
lol_swch_me_p
,
nwrvi__p
->
swch_me
))

481 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Theext NW-Service VM inhes chain is innother computeode");

482 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lo swcham%s",
nscha_posy_y_p
->
lol_swch_me_p
);

483 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mِswcham%s",
nwrvi__p
->
swch_me
);

484 
nscha_posy_y_p
->
vm_d_rvi1_n__me_swch
 = 1;

486 
	`CNTLR_RCU_READ_LOCK_TAKE
();

488 
tv
 = 
	`dm_g_swch_da_
(
nwrvi__p
->
swch_me
,&(
nscha_posy_y_p
->
me_swch_
));

489 if(
tv
 !
DPRM_SUCCESS
)

491 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

492 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

493  
OF_FAILURE
;

496 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Callingvm_module_get_unicast_nwport");

497 
tv
 = 
tsc_nvm_modus
[
nscha_posy_y_p
->
nw_ty
].
	`nvm_modu_g_uni_nwpt
scha_posy_y_p->
lol_swch_me_p
,

498 
nscha_posy_y_p
->
rvipt
,

499 &(
nscha_posy_y_p
->
out_pt_no
));

500 if(
tv
 !
OF_SUCCESS
)

502 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unicastwportot found");

503 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

504  
OF_FAILURE
;

506 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

508 
nscha_posy_y_p
->
nw_pt_b
 = 
TRUE
;

509 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"w sidunip܈numb = %d",
nscha_posy_y_p
->
out_pt_no
);

513 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Theext NW-Service VM inhes chain is inhe same computeode");

514 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lo swcham%s",
nscha_posy_y_p
->
lol_swch_me_p
);

515 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mِswcham%s",
nwrvi__p
->
swch_me
);

517 
nscha_posy_y_p
->
nw_pt_b
 = 
FALSE
;

518 
nscha_posy_y_p
->
out_pt_no
 = 
nwrvi__p
->
pt_id
;

519 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"p܈numb = %d",
nscha_posy_y_p
->
out_pt_no
);

522 if(
_ty
 =
SELECTOR_PRIMARY
)

524 
ii
=0; ii<6; ii++)

526 
nscha_posy_y_p
->
lol__mac
[
ii
] = 
_bd_y_p
->local_in_mac[ii];

527 
nscha_posy_y_p
->
lol_out_mac
[
ii
] = 
_bd_y_p
->local_out_mac[ii];

530 if(
_ty
 =
SELECTOR_SECONDARY
)

532 
ii
=0; ii<6; ii++)

534 
nscha_posy_y_p
->
lol__mac
[
ii
] = 
_bd_y_p
->
lol_out_mac
[ii];

535 
nscha_posy_y_p
->
lol_out_mac
[
ii
] = 
_bd_y_p
->
lol__mac
[ii];

539 
ii
=0;ii<6;ii++)

541 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
nscha_posy_y_p
->
lol_out_mac
[
ii
]);

542 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
nscha_posy_y_p
->
lol__mac
[
ii
]);

545 
nscha_posy_y_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

546 
nscha_posy_y_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

548 if((
pkt_ig
 =
VM_APPLN
&& (
nscha_posy_y_p
->
me_nf_b
 =
TRUE
&& (nscha_posy_y_p->
nw_pt_b
 =
FALSE
))

550 
nscha_posy_y_p
->
cy_lol_mac_addss_b
 = 
TRUE
;

553 if((
pkt_ig
 =
VM_NS
&& (
nscha_posy_y_p
->
me_nf_b
 =
TRUE
))

555 if(
nscha_posy_y_p
->
nw_pt_b
 =
TRUE
)

557 
nscha_posy_y_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

561 if((
pkt_ig
 =
VM_NS
&& (
nscha_posy_y_p
->
me_nf_b
 =
FALSE
))

563 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Set match fieldssocal macddresses foracketseceived fromocal service VM");

564 
nscha_posy_y_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

567 if(((
pkt_ig
 =
NW_UNICAST_SIDE
)||kt_ig =
NW_BROADCAST_SIDE
)&& (
nscha_posy_y_p
->
me_nf_b
 =
TRUE
&& (nscha_posy_y_p->
nw_pt_b
 =
FALSE
))

569 
nscha_posy_y_p
->
cy_lol_mac_addss_b
 = 
TRUE
;

573  
OF_SUCCESS
;

574 
	}
}

578 
	$nsc_t_posy_y
(
nscha_posy_y
* 
nscha_posy_y_p
)

580 
ut8_t
 
dex
;

582 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"*********Packet matching selector details:****************");

584 if(
nscha_posy_y_p
->

.
_ty
 =
SELECTOR_PRIMARY
)

586 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"selector_type = %s"," PRIMARY");

590 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"selector_type = %s"," SECONDARY");

593 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_ = %x",
nscha_posy_y_p
->

.
c_
);

594 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_ = %x",
nscha_posy_y_p
->

.
d_
);

595 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_p܈%d",
nscha_posy_y_p
->

.
c_pt
);

596 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_p܈%d",
nscha_posy_y_p
->

.
d_pt
);

597 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"oc = %d",
nscha_posy_y_p
->

.
oc
);

599 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_high = %x",
nscha_posy_y_p
->

.
c_mac_high
);

600 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"c_mac_low = %x",
nscha_posy_y_p
->

.
c_mac_low
);

601 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_high = %x",
nscha_posy_y_p
->

.
d_mac_high
);

602 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"d_mac_low = %x",
nscha_posy_y_p
->

.
d_mac_low
);

603 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Source mac Address = ");

605 
dex
 = 0;index < 6;index++)

606 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," %02x",
nscha_posy_y_p
->

.
c_mac
[
dex
]);

607 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Destination mac Address = ");

608 
dex
 = 0;index < 6;index++)

609 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," %02x",
nscha_posy_y_p
->

.
d_mac
[
dex
]);

611 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ht_ty = %d",
nscha_posy_y_p
->

.
ht_ty
);

613 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_pk%d",
nscha_posy_y_p
->

.
vn_id_pkt
);

614 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"hashkey = %d",
nscha_posy_y_p
->

.
hashkey
);

616 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"***Service Chaining Information:***");

617 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"****************************");

619 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Swch Nam%s",
nscha_posy_y_p
->
lol_swch_me_p
);

620 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"DP hd = %x",
nscha_posy_y_p
->
dp_hd
);

622 if(
nscha_posy_y_p
->
nw_ty
 =
VXLAN_TYPE
)

624 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw-type = %s","VXLAN_TYPE");

626 if(
nscha_posy_y_p
->
nw_ty
 =
NVGRE_TYPE
)

628 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw-type = %s","NVGRE_TYPE");

631 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nid = %x",
nscha_posy_y_p
->
nid
);

632 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"_pt_id = %d",
nscha_posy_y_p
->
_pt_id
);

634 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mad = %x",
nscha_posy_y_p
->
mada
);

635 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mada_mask = %x",
nscha_posy_y_p
->
mada_mask
);

637 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_ig = %d",
nscha_posy_y_p
->
pkt_ig
);

638 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw_ty = %d",
nscha_posy_y_p
->
nw_ty
);

641 if(
nscha_posy_y_p
->
pkt_ig
 == 0)

643 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_origin = %s"," VM_APPLN");

645 i(
nscha_posy_y_p
->
pkt_ig
 == 1)

647 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_origin = %s"," VM_NS");

651 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pkt_origin = %s"," NW ");

653 if(
nscha_posy_y_p
->
ns_cha_b
 == 1)

655 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ns_chain_b = %s"," TRUE");

659 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ns_chain_b = %s"," FALSE");

661 if(
nscha_posy_y_p
->
me_nf_b
 == 1)

663 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"more_nf_b = %s"," TRUE");

667 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"more_nf_b = %s"," FALSE");

669 if(
nscha_posy_y_p
->
rvi_chag_ty
 == 0)

671 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"service_chaining_type = %s"," NONE");

673 if(
nscha_posy_y_p
->
rvi_chag_ty
 == 1)

675 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"service_chaining_type = %s"," L2");

679 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"service_chaining_type = %s"," L3");

682 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_id_pk = %d",
nscha_posy_y_p
->
vn_id_pkt
);

683 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mch_vn_id = %d",
nscha_posy_y_p
->
mch_vn_id
);

684 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_vn_id = %d",
nscha_posy_y_p
->
xt_vn_id
);

685 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"out_pt_n = %d",
nscha_posy_y_p
->
out_pt_no
);

686 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"xt_b_id = %d",
nscha_posy_y_p
->
xt_b_id
);

688 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ow_mod_iܙy = %d",
nscha_posy_y_p
->
ow_mod_iܙy
);

689 
	}
}

692 
t32_t
 
	$tsc_nd_l_ows_to_l_ts
(
nscha_posy_y
* 
nscha_posy_y_p
)

694 
ut8_t
 
nw_ty
,
no_of_nwrvi_s_1
,
no_of_nwrvi_s_2
;

695 
ut8_t
 
u_dmac
;

696 
ut16_t
 
rvipt
;

697 
ut32_t
 
no_of_nwbr_pts
;

698 
ut32_t
 
tv
 = 
OF_SUCCESS
;

700 
nw_rvis_to_y
 *
nw_rvis_p
;

701 
nw_rvis_to_y
 *
f_rvi_l_1_p
,*
f_rvi_l_2_p
;

702 
nw_rvis_to_y
 *
xt_rvi_l_1_p
,*
xt_rvi_l_2_p
;

703 
nwrvi_
 *
f_nwrvi_l_1__p
,*
xt_nwrvi_l_1__p
;

704 
nwrvi_
 *
f_nwrvi_l_2__p
,*
xt_nwrvi_l_2__p
;

705 
l2_ci_to_nsfo_bd_node
* 
_bd_y_p
;

706 
nscha_posy_y
* 
posy_y_1_p
;

707 
t_l_ows_membs
 
l_ows
;

708 
t_l_ows_membs
* 
tsc_l_ows_p
;

710 
tsc_l_ows_p
 = &
l_ows
;

714 
	`CNTLR_RCU_READ_LOCK_TAKE
();

716 if((
nscha_posy_y_p
->
sk_this_y
 =1|| (nscha_posy_y_p->
vm_d_rvi1_n__me_swch
 == 2))

718 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

719 
	`tf
("\r\n PPH-50");

720  
OF_SUCCESS
;

722 
_bd_y_p
 = 
nscha_posy_y_p
->

.
bd_node_p
;

724 
nw_ty
 = 
nscha_posy_y_p
->nw_type;

725 
rvipt
 = 
nscha_posy_y_p
->serviceport;

727 if(
_bd_y_p
 =
NULL
)

729 
	`tf
("\r\n cn_bind_entry is NULL");

730 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

731 
	`tf
("\r\n PPH-52");

732  
OF_SUCCESS
;

735 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"_bd_y = %x",
_bd_y_p
);

736 
no_of_nwrvi_s_1
 = (
_bd_y_p
->
nwrvi_fo
).
no_of_nwrvi_s
;

737 
no_of_nwrvi_s_2
 = 
no_of_nwrvi_s_1
;

738 
nw_rvis_p
 = (
nw_rvis_to_y
 *)(
_bd_y_p
->
nwrvi_fo
.nw_services_p);

739 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"no_of_nwrvi_%d",
no_of_nwrvi_s_1
);

741 
	`tf
("\r\nNS%d",
no_of_nwrvi_s_1
);

742 if(
no_of_nwrvi_s_1
 == 0)

744 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

745 
	`tf
("\r\n PPH-53");

746  
OF_FAILURE
;

748 
f_rvi_l_1_p
 = 
nw_rvis_p
;

749 
f_rvi_l_2_p
 = (
nw_rvis_to_y
*)(
nw_rvis_p
 + (
no_of_nwrvi_s_1
 - 1));

751 if(
nscha_posy_y_p
->
vm_d_rvi1_n__me_swch
 == 1)

753 
	`tf
("NOT-SSW");

754 
nscha_posy_y_p
->
vm_d_rvi1_n__me_swch
 = 2;

756 
tv
 = 
	`nm_g_nwrvi__byhd
(
f_rvi_l_1_p
->
nscha_obje_hd
,

757 
f_rvi_l_1_p
->
nwrvi_obje_hd
,

758 
f_rvi_l_1_p
->
nwrvi__hd
,

759 &
f_nwrvi_l_1__p
);

761 if(
tv
 =
OF_FAILURE
)

763 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo gethe first service instance forrimary selector.");

764 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

765 
	`tf
("\r\n PPH-01");

766  
tv
;

770 
tv
 = 
	`dm_g_swch_da_
(
nscha_posy_y_p
->
lol_swch_me_p
,&(
tsc_l_ows_p
->
me_
));

771 if(
tv
 !
DPRM_SUCCESS
)

773 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

774 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

775 
	`tf
("\r\n PPH-02");

776  
OF_FAILURE
;

778 
no_of_nwbr_pts
 = 1;

779 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_brd_nwpts
(
f_nwrvi_l_1__p
->
swch_me
,

780 
rvipt
,

782 &
no_of_nwbr_pts
,

783 &(
tsc_l_ows_p
->
pt_id
),

784 
tsc_l_ows_p
->
me_


787 if(
tv
 !
OF_SUCCESS
)

789 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"vxlan broadcastortsot found");

790 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

791 
	`tf
("\r\n PPH-03");

792  
OF_FAILURE
;

794 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

795 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

796 
tsc_l_ows_p
->
pkt_ig
 = 
NW_BROADCAST_SIDE
;

797 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_1__p
->
syem_br_f
;

798 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_1__p
->
vn_id_
;

799 
tsc_l_ows_p
->
xt_vn_id
 = 
f_nwrvi_l_1__p
->
vn_id_
;

800 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_1__p
->
vn_id_
;

801 
tsc_l_ows_p
->
out_pt_no
 = 
f_nwrvi_l_1__p
->
pt_id
;

802 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
TRUE
;

803 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

804 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

807 
tv
 = 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

808 
tsc_l_ows_p
,

809 
f_nwrvi_l_1__p
,

810 &
posy_y_1_p
);

812 if(
tv
 =
OF_SUCCESS
)

813 
nscha_posy_y_p
 = 
posy_y_1_p
;

818 
tv
 = 
	`nm_g_nwrvi__byhd
(
f_rvi_l_1_p
->
nscha_obje_hd
,

819 
f_rvi_l_1_p
->
nwrvi_obje_hd
,

820 
f_rvi_l_1_p
->
nwrvi__hd
,

821 &
f_nwrvi_l_1__p
);

823 if(
tv
 =
OF_FAILURE
)

825 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo gethe first service instance forrimary selector.");

826 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

827 
	`tf
("\r\n PPH-04");

828  
tv
;

830 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"fwk svi inam%s",
f_nwrvi_l_1__p
->
me_p
);

834 if(--
no_of_nwrvi_s_1
)

836 
xt_rvi_l_1_p
 = 
f_rvi_l_1_p
 + 1;

840 
xt_rvi_l_1_p
 = 
NULL
;

844 if(
xt_rvi_l_1_p
)

846 
tv
 = 
	`nm_g_nwrvi__byhd
(
xt_rvi_l_1_p
->
nscha_obje_hd
,

847 
xt_rvi_l_1_p
->
nwrvi_obje_hd
,

848 
xt_rvi_l_1_p
->
nwrvi__hd
,

849 &
xt_nwrvi_l_1__p
);

851 if(
tv
 =
OF_FAILURE
)

853 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo getheext service instance.");

854 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

855 
	`tf
("\r\n PPH-05");

856  
tv
;

859 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"xtwk svi inam%s",
xt_nwrvi_l_1__p
->
me_p
);

861 if(
	`rcmp
(
f_nwrvi_l_1__p
->
swch_me
,
xt_nwrvi_l_1__p
->switch_name))

866 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

867 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

868 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

869 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_1__p
->
syem_br_f
;

870 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_1__p
->
pt_id
;

871 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

872 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

873 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

874 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

875 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

876 
tsc_l_ows_p
->
nw_pt_b
 = 
TRUE
;

877 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
f_nwrvi_l_1__p
->
swch_me
,

878 
rvipt
,

879 &(
tsc_l_ows_p
->
out_pt_no
));

880 if(
tv
 =
OF_FAILURE
)

882 
	`tf
("unableo obtain unicastort forroactive flowushing");

883 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"unableo obtain unicastort forroactive flowushing");

884 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

885 
	`tf
("\r\n PPH-06");

886  
OF_FAILURE
;

889 
tv
 = 
	`dm_g_swch_da_
(
xt_nwrvi_l_1__p
->
swch_me
,&(
tsc_l_ows_p
->
me_
));

890 if(
tv
 !
DPRM_SUCCESS
)

892 
	`tf
("Invalidemote switchame. unableo getemoteip forroactiveushing");

893 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

894 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

895 
	`tf
("\r\n PPH-07");

896  
OF_FAILURE
;

900 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

901 
tsc_l_ows_p
,

902 
f_nwrvi_l_1__p
,

903 &
posy_y_1_p
);

908 
tv
 = 
	`dm_g_swch_da_
(
f_nwrvi_l_1__p
->
swch_me
,&(
tsc_l_ows_p
->
me_
));

909 if(
tv
 !
DPRM_SUCCESS
)

911 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

912 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

913 
	`tf
("\r\n PPH-08");

914  
OF_FAILURE
;

916 
no_of_nwbr_pts
 = 1;

917 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_brd_nwpts
(
xt_nwrvi_l_1__p
->
swch_me
,

918 
rvipt
,

920 &
no_of_nwbr_pts
,

921 &(
tsc_l_ows_p
->
pt_id
),

922 (
tsc_l_ows_p
->
me_
)

925 if(
tv
 !
OF_SUCCESS
)

927 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"vxlan broadcastortsot found");

928 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

929 
	`tf
("\r\n PPH-09");

930  
OF_FAILURE
;

933 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

934 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

935 
tsc_l_ows_p
->
pkt_ig
 = 
NW_BROADCAST_SIDE
;

936 
tsc_l_ows_p
->
dp_hd
 = 
xt_nwrvi_l_1__p
->
syem_br_f
;

937 
tsc_l_ows_p
->
mch_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

938 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

939 
tsc_l_ows_p
->
vn_id_pkt
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

940 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_1__p
->
pt_id
;

941 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
TRUE
;

942 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

943 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

946 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

947 
tsc_l_ows_p
,

948 
xt_nwrvi_l_1__p
,

949 &
posy_y_1_p
);

956 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

957 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

958 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

959 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_1__p
->
syem_br_f
;

960 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_1__p
->
pt_id
;

961 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

962 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

963 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

964 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_1__p
->
pt_id
;

965 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

966 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

967 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

970 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

971 
tsc_l_ows_p
,

972 
f_nwrvi_l_1__p
,

973 &
posy_y_1_p
);

975 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

976 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

977 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

978 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_1__p
->
syem_br_f
;

979 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_1__p
->
pt_id
;

980 
tsc_l_ows_p
->
mch_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

981 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

982 
tsc_l_ows_p
->
vn_id_pkt
 = 
xt_nwrvi_l_1__p
->
vn_id_
;

983 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_1__p
->
pt_id
;

984 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

985 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

986 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

990 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

991 
tsc_l_ows_p
,

992 
xt_nwrvi_l_1__p
,

993 &
posy_y_1_p
);

996 
f_nwrvi_l_1__p
 = 
xt_nwrvi_l_1__p
;

997 
f_rvi_l_1_p
 = 
xt_rvi_l_1_p
;

1003 if(
xt_rvi_l_1_p
 =
NULL
)

1007 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_PRIMARY
;

1008 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

1009 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

1010 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_1__p
->
syem_br_f
;

1011 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_1__p
->
pt_id
;

1012 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

1013 
tsc_l_ows_p
->
xt_vn_id
 = 0;

1014 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_1__p
->
vn_id_out
;

1015 
tsc_l_ows_p
->
out_pt_no
 = 0;

1016 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

1017 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

1018 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

1021 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1022 
tsc_l_ows_p
,

1023 
f_nwrvi_l_1__p
,

1024 &
posy_y_1_p
);

1032 
u_dmac
 = 
FALSE
;

1033 
	`tsc_nsc_nd_ive_ow_b_3
(
nscha_posy_y_p
,

1034 
f_nwrvi_l_1__p
,

1035 
u_dmac
);

1039 
tv
 = 
	`nm_g_nwrvi__byhd
(
f_rvi_l_2_p
->
nscha_obje_hd
,

1040 
f_rvi_l_2_p
->
nwrvi_obje_hd
,

1041 
f_rvi_l_2_p
->
nwrvi__hd
,

1042 &
f_nwrvi_l_2__p
);

1043 if(
tv
 =
OF_FAILURE
)

1045 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo gethe first service instance for secondary selector.");

1046 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1047 
	`tf
("\r\n PPH-10");

1048  
tv
;

1050 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"fwk svi inam%s",
f_nwrvi_l_2__p
->
me_p
);

1054 if(--
no_of_nwrvi_s_2
)

1056 
xt_rvi_l_2_p
 = 
f_rvi_l_2_p
 - 1;

1060 
xt_rvi_l_2_p
 = 
NULL
;

1064 if(
xt_rvi_l_2_p
)

1067 
tv
 = 
	`nm_g_nwrvi__byhd
(
xt_rvi_l_2_p
->
nscha_obje_hd
,

1068 
xt_rvi_l_2_p
->
nwrvi_obje_hd
,

1069 
xt_rvi_l_2_p
->
nwrvi__hd
,

1070 &
xt_nwrvi_l_2__p
);

1072 if(
tv
 =
OF_FAILURE
)

1074 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Failedo getheext service instance.");

1075 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1076 
	`tf
("\r\n PPH-11");

1077  
tv
;

1079 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"xtwk svi inam%s",
xt_nwrvi_l_2__p
->
me_p
);

1081 if(
	`rcmp
(
f_nwrvi_l_2__p
->
swch_me
,
xt_nwrvi_l_2__p
->switch_name))

1087 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_SECONDARY
;

1088 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

1089 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

1090 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_2__p
->
syem_br_f
;

1091 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_2__p
->
pt_id
;

1092 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1093 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1094 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1095 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

1096 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

1097 
tsc_l_ows_p
->
nw_pt_b
 = 
TRUE
;

1099 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
f_nwrvi_l_2__p
->
swch_me
,

1100 
rvipt
,

1101 &(
tsc_l_ows_p
->
out_pt_no
));

1102 if(
tv
 =
OF_FAILURE
)

1104 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"unableo obtain unicastort forroactive flowushing");

1105 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1106 
	`tf
("\r\n PPH-12");

1107  
OF_FAILURE
;

1110 
tv
 = 
	`dm_g_swch_da_
(
xt_nwrvi_l_2__p
->
swch_me
,&(
tsc_l_ows_p
->
me_
));

1111 if(
tv
 !
DPRM_SUCCESS
)

1113 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

1114 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1115 
	`tf
("\r\n PPH-13");

1116  
OF_FAILURE
;

1120 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1121 
tsc_l_ows_p
,

1122 
f_nwrvi_l_2__p
,

1123 &
posy_y_1_p
);

1126 
tv
 = 
	`dm_g_swch_da_
(
xt_nwrvi_l_2__p
->
swch_me
,&(
tsc_l_ows_p
->
me_
));

1127 if(
tv
 !
DPRM_SUCCESS
)

1129 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Invalidemote switchame");

1130 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1131 
	`tf
("\r\n PPH-14");

1132  
OF_FAILURE
;

1134 
no_of_nwbr_pts
 = 1;

1135 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_brd_nwpts
(
f_nwrvi_l_2__p
->
swch_me
,

1136 
rvipt
,

1138 &
no_of_nwbr_pts
,

1139 &(
tsc_l_ows_p
->
pt_id
),

1140 (
tsc_l_ows_p
->
me_
)

1143 if(
tv
 !
OF_SUCCESS
)

1145 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"vxlan broadcastortsot found");

1146 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1147 
	`tf
("\r\n PPH-15");

1148  
OF_FAILURE
;

1151 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_SECONDARY
;

1152 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

1153 
tsc_l_ows_p
->
pkt_ig
 = 
NW_BROADCAST_SIDE
;

1154 
tsc_l_ows_p
->
dp_hd
 = 
xt_nwrvi_l_2__p
->
syem_br_f
;

1155 
tsc_l_ows_p
->
mch_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1156 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1157 
tsc_l_ows_p
->
vn_id_pkt
 = 
xt_nwrvi_l_2__p
->
vn_id_out
 ;

1158 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_2__p
->
pt_id
;

1159 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
TRUE
;

1160 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

1161 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

1164 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1165 
tsc_l_ows_p
,

1166 
xt_nwrvi_l_2__p
,

1167 &
posy_y_1_p
);

1176 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_SECONDARY
;

1177 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

1178 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

1179 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_2__p
->
syem_br_f
;

1180 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_2__p
->
pt_id
;

1181 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1182 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1183 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1184 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_2__p
->
pt_id
;

1185 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

1186 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

1187 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

1190 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1191 
tsc_l_ows_p
,

1192 
f_nwrvi_l_2__p
,

1193 &
posy_y_1_p
);

1195 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_SECONDARY
;

1196 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

1197 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

1198 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_2__p
->
syem_br_f
;

1199 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_2__p
->
pt_id
;

1200 
tsc_l_ows_p
->
mch_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1201 
tsc_l_ows_p
->
xt_vn_id
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1202 
tsc_l_ows_p
->
vn_id_pkt
 = 
xt_nwrvi_l_2__p
->
vn_id_out
;

1203 
tsc_l_ows_p
->
out_pt_no
 = 
xt_nwrvi_l_2__p
->
pt_id
;

1204 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

1205 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
FALSE
;

1206 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

1209 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1210 
tsc_l_ows_p
,

1211 
xt_nwrvi_l_2__p
,

1212 &
posy_y_1_p
);

1215 
f_nwrvi_l_2__p
 = 
xt_nwrvi_l_2__p
;

1216 
f_rvi_l_2_p
 = 
xt_rvi_l_2_p
;

1222 if(
xt_rvi_l_2_p
 =
NULL
)

1227 
tsc_l_ows_p
->
_ty
 = 
SELECTOR_SECONDARY
;

1228 
tsc_l_ows_p
->
b_no
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

1229 
tsc_l_ows_p
->
pkt_ig
 = 
VM_NS
;

1230 
tsc_l_ows_p
->
dp_hd
 = 
f_nwrvi_l_2__p
->
syem_br_f
;

1231 
tsc_l_ows_p
->
pt_id
 = 
f_nwrvi_l_2__p
->
pt_id
;

1232 
tsc_l_ows_p
->
mch_vn_id
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1233 
tsc_l_ows_p
->
xt_vn_id
 = 0;

1234 
tsc_l_ows_p
->
vn_id_pkt
 = 
f_nwrvi_l_2__p
->
vn_id_
;

1235 
tsc_l_ows_p
->
out_pt_no
 = 0;

1236 
tsc_l_ows_p
->
cy_lol_mac_addss_b
 = 
FALSE
;

1237 
tsc_l_ows_p
->
cy_ig_mac_addss_b
 = 
TRUE
;

1238 
tsc_l_ows_p
->
nw_pt_b
 = 
FALSE
;

1242 
	`tsc_nsc_nd_ive_ow
(
nscha_posy_y_p
,

1243 
tsc_l_ows_p
,

1244 
f_nwrvi_l_2__p
,

1245 &
posy_y_1_p
);

1249 
u_dmac
 = 
TRUE
;

1250 
	`tsc_nsc_nd_ive_ow_b_3
(
nscha_posy_y_p
,

1251 
f_nwrvi_l_2__p
,

1252 
u_dmac
);

1254 
u_dmac
 = 
FALSE
;

1256 
	`tsc_nsc_nd_ive_ow_b_3
(
nscha_posy_y_p
,

1257 
f_nwrvi_l_2__p
,

1258 
u_dmac
);

1261 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1262  
tv
;

1263 
	}
}

1265 
t32_t
 
	$tsc_nsc_nd_ive_ow
(
nscha_posy_y
* 
nscha_posy_y_f_p
,

1266 
t_l_ows_membs
* 
tsc_ow_p
,

1267 
nwrvi_
 *
nw_rvi_p
,

1268 
nscha_posy_y
** 
posy_y_1_p
)

1270 
ut8_t
 
nw_ty
,
pt_ty
,
hp_b
;

1271 
ut8_t
 
us
 = 
FALSE
;

1272 
ut32_t
 
nid
,
hashkey
,
hashmask
,
offt
,
dex
,
magic
,
ii
;

1273 
t32_t
 
tv
 = 
OF_SUCCESS
;

1274 
nscha_posy_y
 *
nsc_posy_y_p
,*
nsc_posy_sn_node_p
;

1276 
ut64_t
 
vn_hd
,
m_pt_hd
;

1277 
mchash_b
* 
nsc_posy_b_p
;

1278 * 
nsc_posy_mempo_g
;

1280 
uch8_t
* 
hashobj_p
 = 
NULL
;

1281 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1282 
m_vtu_twk
* 
vn_y_p
;

1283 
m_pt
* 
d_m_pt_p
;

1285 
nw_ty
 = (
nscha_posy_y_f_p
->nw_type);

1286 
nid
 = (
nscha_posy_y_f_p
->nid);

1290 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1291 if(
tv
 !
OF_SUCCESS
)

1293 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

1294 
	`tf
("\r\n PPH-16");

1295  
OF_FAILURE
;

1298 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1299 if(
tv
 !
OF_SUCCESS
)

1301 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1302 
	`tf
("\r\n PPH-17");

1303  
OF_FAILURE
;

1306 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1308 if(
tsc_ow_p
->
b_no
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

1309 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_mempo_g
;

1310 if(
tsc_ow_p
->
b_no
 =
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
)

1311 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_mempo_g
;

1313 
tv
 = 
	`mempo_g_mem_block
(
nsc_posy_mempo_g
,(
uch8_t
 **)&
nsc_posy_y_p
,&
hp_b
);

1314 if(
tv
 !
MEMPOOL_SUCCESS
)

1316 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memory blockllocation forscepositoryntry failed");

1317 
	`tf
("\r\n PPH-19");

1318  
OF_FAILURE
;

1320 
nsc_posy_y_p
->
hp_b
 = heap_b;

1322 
nsc_posy_y_p
->
nw_ty
 =w_type;

1323 
nsc_posy_y_p
->
nid
 =id;

1325 
nsc_posy_y_p
->

.
ht_ty
 = 
nscha_posy_y_f_p
->selector.ethernet_type;

1326 
nsc_posy_y_p
->

.
oc
 = 
nscha_posy_y_f_p
->selector.protocol;

1328 if(
tsc_ow_p
->
_ty
 =
SELECTOR_PRIMARY
)

1330 
nsc_posy_y_p
->

.
_ty
 = 
SELECTOR_PRIMARY
;

1331 
nsc_posy_y_p
->

.
c_
 = 
nscha_posy_y_f_p
->selector.src_ip;

1332 
nsc_posy_y_p
->

.
d_
 = 
nscha_posy_y_f_p
->selector.dst_ip;

1334 if(
nsc_posy_y_p
->

.
oc
 =
OF_IPPROTO_ICMP
)

1336 
nsc_posy_y_p
->

.
icmp_ty
 = 8;

1337 
nsc_posy_y_p
->

.
icmp_code
 = 0;

1338 
nsc_posy_y_p
->

.
c_pt
 = 8;

1339 
nsc_posy_y_p
->

.
d_pt
 = 0;

1343 
nsc_posy_y_p
->

.
c_pt
 = 
nscha_posy_y_f_p
->selector.src_port;

1344 
nsc_posy_y_p
->

.
d_pt
 = 
nscha_posy_y_f_p
->selector.dst_port;

1347 i(
tsc_ow_p
->
_ty
 =
SELECTOR_SECONDARY
)

1349 
nsc_posy_y_p
->

.
_ty
 = 
SELECTOR_SECONDARY
;

1350 
nsc_posy_y_p
->

.
c_
 = 
nscha_posy_y_f_p
->.
d_
;

1351 
nsc_posy_y_p
->

.
d_
 = 
nscha_posy_y_f_p
->.
c_
;

1353 if(
nsc_posy_y_p
->

.
oc
 =
OF_IPPROTO_ICMP
)

1355 
nsc_posy_y_p
->

.
icmp_ty
 = 0;

1356 
nsc_posy_y_p
->

.
icmp_code
 = 0;

1357 
nsc_posy_y_p
->

.
c_pt
 = 0;

1358 
nsc_posy_y_p
->

.
d_pt
 = 0;

1362 
nsc_posy_y_p
->

.
c_pt
 = 
nscha_posy_y_f_p
->.
d_pt
;

1363 
nsc_posy_y_p
->

.
d_pt
 = 
nscha_posy_y_f_p
->.
c_pt
;

1367 if(
tsc_ow_p
->
b_no
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

1369 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_1_p
;

1370 
hashmask
 = 
nsc_no_of_posy_b_1_bucks_g
;

1374 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_2_p
;

1375 
hashmask
 = 
nsc_no_of_posy_b_2_bucks_g
;

1378 
hashkey
 = 
	`nsc_compu_hash_posy_b_1_2
(
nsc_posy_y_p
->

.
c_
,

1379 
nsc_posy_y_p
->

.
d_
,

1380 
nsc_posy_y_p
->

.
c_pt
,

1381 
nsc_posy_y_p
->

.
d_pt
,

1382 
nsc_posy_y_p
->

.
oc
,

1383 
nsc_posy_y_p
->

.
ht_ty
,

1384 
tsc_ow_p
->
pt_id
,

1385 
tsc_ow_p
->
dp_hd
,

1386 
tsc_ow_p
->
vn_id_pkt
,

1387 
hashmask
);

1389 
nsc_posy_y_p
->

.
hashkey
 = hashkey;

1391 
offt
 = 
NSC_NSCHAIN_REPOSITORY_NODE_OFFSET
;

1392 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_sn_node_p
,
nscha_posy_y
 *, 
offt
)

1394 if(
nsc_posy_sn_node_p
->
sk_this_y
 == 1)

1397 if((
nsc_posy_y_p
->

.
c_
 !
nsc_posy_sn_node_p
->selector.src_ip ) ||

1398 (
nsc_posy_y_p
->

.
d_
 !
nsc_posy_sn_node_p
->selector.dst_ip ) ||

1399 (
nsc_posy_y_p
->

.
oc
 !
nsc_posy_sn_node_p
->selector.protocol) ||

1400 (
nsc_posy_y_p
->

.
c_pt
 !
nsc_posy_sn_node_p
->selector.src_port) ||

1401 (
nsc_posy_y_p
->

.
d_pt
 !
nsc_posy_sn_node_p
->selector.dst_port)

1403 (
nsc_posy_y_p
->

.
ht_ty
 !
nsc_posy_sn_node_p
->selector.ethernet_type)

1405 ((
tsc_ow_p
->
pt_id
 !
nsc_posy_sn_node_p
->
_pt_id
))

1407 ((
tsc_ow_p
->
dp_hd
 !
nsc_posy_sn_node_p
->dp_handle))

1409 ((
tsc_ow_p
->
vn_id_pkt
 !
nsc_posy_sn_node_p
->vlan_id_pkt))

1412 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"T1 or T2scepositoryntry islreadyxisting,skippingroactiveush");

1414 
	`tf
("z");

1415 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1416 (
uch8_t
 *)
nsc_posy_y_p
,

1417 
nsc_posy_y_p
->
hp_b


1419 *
posy_y_1_p
 = 
nsc_posy_sn_node_p
;

1420  
OF_SUCCESS
;

1422 
nsc_posy_y_p
->
rvi_chag_ty
 = 
nscha_posy_y_f_p
->service_chaining_type;

1423 
nsc_posy_y_p
->

.
dex
 = 
nscha_posy_y_f_p
->selector.index;

1424 
nsc_posy_y_p
->

.
magic
 = 
nscha_posy_y_f_p
->selector.magic;

1425 
nsc_posy_y_p
->

.
_n
 = 
nscha_posy_y_f_p
->selector.safe_reference;

1427 if(
tsc_ow_p
->
_ty
 =
SELECTOR_PRIMARY
)

1429 
nsc_posy_y_p
->

.
h__p
 = (
nscha_posy_y_f_p
->selector.other_selector_p);

1430 
ii
=0; ii<6; ii++)

1432 
nsc_posy_y_p
->
lol__mac
[
ii
] = 
nscha_posy_y_f_p
->local_in_mac[ii];

1433 
nsc_posy_y_p
->
lol_out_mac
[
ii
] = 
nscha_posy_y_f_p
->local_out_mac[ii];

1434 
nsc_posy_y_p
->

.
d_mac
[
ii
] = 
nscha_posy_y_f_p
->selector.dst_mac[ii];

1435 
nsc_posy_y_p
->

.
c_mac
[
ii
] = 
nscha_posy_y_f_p
->selector.src_mac[ii];

1437 
nsc_posy_y_p
->

.
d_mac_high
 = 
nscha_posy_y_f_p
->selector.dst_mac_high;

1438 
nsc_posy_y_p
->

.
d_mac_low
 = 
nscha_posy_y_f_p
->selector.dst_mac_low;

1439 
nsc_posy_y_p
->

.
c_mac_high
 = 
nscha_posy_y_f_p
->selector.src_mac_high;

1440 
nsc_posy_y_p
->

.
c_mac_low
 = 
nscha_posy_y_f_p
->selector.src_mac_low;

1442 if(
tsc_ow_p
->
_ty
 =
SELECTOR_SECONDARY
)

1444 
nsc_posy_y_p
->

.
h__p
 = (&(
nscha_posy_y_f_p
->selector));

1445 
ii
=0; ii<6; ii++)

1447 
nsc_posy_y_p
->
lol__mac
[
ii
] = 
nscha_posy_y_f_p
->
lol_out_mac
[ii];

1448 
nsc_posy_y_p
->
lol_out_mac
[
ii
] = 
nscha_posy_y_f_p
->
lol__mac
[ii];

1449 
nsc_posy_y_p
->

.
d_mac
[
ii
] = 
nscha_posy_y_f_p
->.
c_mac
[ii];

1450 
nsc_posy_y_p
->

.
c_mac
[
ii
] = 
nscha_posy_y_f_p
->.
d_mac
[ii];

1452 
nsc_posy_y_p
->

.
d_mac_high
 = 
nscha_posy_y_f_p
->.
c_mac_high
;

1453 
nsc_posy_y_p
->

.
d_mac_low
 = 
nscha_posy_y_f_p
->.
c_mac_low
;

1454 
nsc_posy_y_p
->

.
c_mac_high
 = 
nscha_posy_y_f_p
->.
d_mac_high
;

1455 
nsc_posy_y_p
->

.
c_mac_low
 = 
nscha_posy_y_f_p
->.
d_mac_low
;

1458 
nsc_posy_y_p
->

.
bd_node_p
 = 
nscha_posy_y_f_p
->selector.cnbind_node_p;

1459 
	`ry
(
nsc_posy_y_p
->
lol_swch_me_p
,
nw_rvi_p
->
swch_me
);

1461 
nsc_posy_y_p
->
_pt_id
 = 
tsc_ow_p
->
pt_id
;

1462 
nsc_posy_y_p
->
mada
 = (
nscha_posy_y_f_p
->metadata & 0xF0FFFFFFFFFFFFFF);

1463 
nsc_posy_y_p
->
rvipt
 = (
ut16_t
)((
nscha_posy_y_f_p
->
mada
>> 
SERVICE_PORT_OFFSET
);

1464 
nsc_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

1465 
nsc_posy_y_p
->
pkt_ig
 = 
tsc_ow_p
->pkt_origin;

1466 
nsc_posy_y_p
->
dp_hd
 = 
tsc_ow_p
->dp_handle;

1468 
nsc_posy_y_p
->
ow_mod_iܙy
 = 2;

1469 
nsc_posy_y_p
->
sk_this_y
 = 0;

1471 
nsc_posy_y_p
->
xt_vn_id
 = 
tsc_ow_p
->next_vlan_id;

1472 
nsc_posy_y_p
->
mch_vn_id
 = 
tsc_ow_p
->match_vlan_id;

1473 
nsc_posy_y_p
->
vn_id_pkt
 = 
tsc_ow_p
->vlan_id_pkt;

1474 
nsc_posy_y_p
->

.
vn_id_pkt
 = 
tsc_ow_p
->vlan_id_pkt;

1475 
nsc_posy_y_p
->
cy_lol_mac_addss_b
 = 
tsc_ow_p
->copy_local_mac_addresses_b;

1476 
nsc_posy_y_p
->
cy_ig_mac_addss_b
 = 
tsc_ow_p
->copy_original_mac_addresses_b;

1478 if(
tsc_ow_p
->
out_pt_no
 != 0)

1480 
nsc_posy_y_p
->
ns_cha_b
 = 
TRUE
;

1481 
nsc_posy_y_p
->
me_nf_b
 = 
TRUE
;

1482 
nsc_posy_y_p
->
xt_b_id
 = 0;

1484 
nsc_posy_y_p
->
out_pt_no
 = 
tsc_ow_p
->out_port_no;

1485 
nsc_posy_y_p
->
nw_pt_b
 = 
tsc_ow_p
->nw_port_b;

1486 if(
nsc_posy_y_p
->
nw_pt_b
 =
TRUE
)

1487 
nsc_posy_y_p
->
me_swch_
 = 
tsc_ow_p
->
me_
;

1489 
nsc_posy_y_p
->
me_swch_
 = 0;

1490 
nsc_posy_y_p
->
ns_pt_b
 = 
FALSE
;

1495 
nsc_posy_y_p
->
ns_cha_b
 = 
TRUE
;

1496 
nsc_posy_y_p
->
me_nf_b
 = 
FALSE
;

1497 
nsc_posy_y_p
->
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

1502 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vmpt_by_dmac_nid
(
nsc_posy_y_p
->

.
d_mac
,

1503 
nid
,&
m_pt_hd
);

1505 if(
tv
 !
OF_SUCCESS
)

1507 
tv
 = 
OF_FAILURE
;

1508 
	`tf
("\r\n PPH-24E");

1511 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
d_m_pt_p
);

1512 if(
tv
 =
OF_SUCCESS
)

1514 
nsc_posy_y_p
->
out_pt_no
 = 
d_m_pt_p
->
pt_id
;

1516 
nsc_posy_y_p
->
me_swch_
 = 
d_m_pt_p
->
swch_
;

1518 
pt_ty
 = 
d_m_pt_p
->
m_pt_ty
;

1519 
nsc_posy_y_p
->
ns_pt_b
 = 
TRUE
;

1520 
nsc_posy_y_p
->
nw_pt_b
 = 
FALSE
;

1524 
tv
 = 
OF_FAILURE
;

1525 
	`tf
("\r\n PPH-24F");

1532 if((
pt_ty
 =
VM_GUEST_PORT
)

1534 (
	`rcmp
((
nsc_posy_y_p
->
lol_swch_me_p
),

1535 (
d_m_pt_p
->
swch_me
)))

1543 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
nsc_posy_y_p
->
lol_swch_me_p
,

1544 
nsc_posy_y_p
->
rvipt
,

1545 &(
nsc_posy_y_p
->
out_pt_no
)

1548 if(
tv
 !
OF_SUCCESS
)

1550 
tv
 = 
OF_FAILURE
;

1551 
	`tf
("\r\n PPH-24G");

1554 
nsc_posy_y_p
->
ns_pt_b
 = 
TRUE
;

1555 
nsc_posy_y_p
->
nw_pt_b
 = 
TRUE
;

1559 if(
tv
 =
OF_FAILURE
)

1561 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1562 (
uch8_t
 *)
nsc_posy_y_p
,

1563 
nsc_posy_y_p
->
hp_b
);

1564 
	`tf
("\r\n PPH-24A");

1565  
OF_FAILURE
;

1569 
hashobj_p
 = (
uch8_t
 *)(
nsc_posy_y_p
+ 
offt
;

1571 
	`MCHASH_APPEND_NODE
(
nsc_posy_b_p
,
hashkey
,
nsc_posy_y_p
,
dex
,
magic
,
hashobj_p
,
us
);

1572 if(
us
 =
FALSE
)

1574 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoppendepositoryntry");

1575 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1576 (
uch8_t
 *)
nsc_posy_y_p
,

1577 
nsc_posy_y_p
->
hp_b


1579 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"PF-Failedoppendepositoryntrynd freeheepositoryntry memory");

1580 
	`tf
("\r\n PPH-20");

1581  
OF_FAILURE
;

1583 
nsc_posy_y_p
->
magic
 = magic;

1584 
nsc_posy_y_p
->
dex
 = index;

1586 
nsc_posy_y_p
->
_n
 = 
magic
;

1587 (
nsc_posy_y_p
->
_n
((sc_posy_y_p->_n<< 32| (
dex
));

1589 
	`CNTLR_LOCK_TAKE
(
nsc_posy_y_p
->

.
bd_node_p
->
bd_node_lock
);

1590 ++(
nsc_posy_y_p
->

.
bd_node_p
->
no_of_ow_s_dedud
);

1592 
	`CNTLR_LOCK_RELEASE
(
nsc_posy_y_p
->

.
bd_node_p
->
bd_node_lock
);

1594 *
posy_y_1_p
 = 
nsc_posy_y_p
;

1596 if(
tsc_ow_p
->
b_no
 =
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
)

1598 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_1
(
tsc_ow_p
->
dp_hd
,
nsc_posy_y_p
);

1599 if(
tv
 =
OF_FAILURE
)

1601 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo send Flow Mod messageo Table 1");

1602 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Deletingheschainepositoryntrydded justs failedo sendhe flowntryo switch");

1603 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedodd Flow Mod messageo Table 1roactively ");

1604 
	`tsc_de_nscha_posy_y
(
nsc_posy_y_p
,
nw_ty
,
nid
,
tsc_ow_p
->
b_no
);

1608 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Successfully sent Flow Mod messageo Table 1roactively ");

1611 if(
tsc_ow_p
->
b_no
 =
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
)

1613 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_2
(
tsc_ow_p
->
dp_hd
,
nsc_posy_y_p
);

1614 if(
tv
 =
OF_FAILURE
)

1616 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo send Flow Mod messageo Table 2");

1617 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Deletingheschainepositoryntrydded justs failedo sendhe flowntryo switch");

1618 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedodd Flow Mod messageo Table 2roactively ");

1619 
	`tsc_de_nscha_posy_y
(
nsc_posy_y_p
,
nw_ty
,
nid
,
tsc_ow_p
->
b_no
);

1623 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Successfully sent Flow Mod messageo Table 2roactively ");

1626 
tv
 = 
OF_SUCCESS
;

1627  
tv
;

1628 
	}
}

1629 
t32_t
 
	$tsc_nsc_nd_ive_ow_b_3
(
nscha_posy_y
* 
nscha_posy_y_f_p
,

1630 
nwrvi_
 *
nw_rvi_p
,

1631 
ut8_t
 
u_dmac
 )

1633 
ut64_t
 
m_pt_hd
,
vn_hd
,
dp_hd
,
mada
;

1634 
ut32_t
 
offt
,
dex
,
magic
,
hashkey
,
hashmask
;

1635 
ut32_t
 
d_mac_high
,
d_mac_low
,
nid
;

1636 
ut16_t
 
rvipt
;

1637 
ut8_t
 
hp_b
,
nw_ty
;

1638 
uch8_t
 *
hashobj_p
 = 
NULL
;

1639 
t32_t
 
tv
 = 
OF_SUCCESS
;

1640 
t32_t
 
us
 = 
OF_SUCCESS
;

1642 
mchash_b
* 
nsc_posy_b_p
;

1643 * 
nsc_posy_mempo_g
;

1644 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

1645 
m_vtu_twk
* 
vn_y_p
;

1646 
upkt_out_posy_y
* 
upkt_out_posy_y_p
 = 
NULL
;

1647 
upkt_out_posy_y
* 
upkt_out_posy_sn_node_p
 = 
NULL
;

1648 
m_pt
* 
d_m_pt_p
;

1650 
dp_hd
 = 
nw_rvi_p
->
syem_br_f
;

1652 
nw_ty
 = 
nscha_posy_y_f_p
->nw_type;

1653 
nid
 = 
nscha_posy_y_f_p
->nid;

1655 
mada
 = (
nscha_posy_y_f_p
->metadata & 0xF0FFFFFFFFFFFFFF);

1656 
rvipt
 = (
ut16_t
)((
nscha_posy_y_f_p
->
mada
>> 
SERVICE_PORT_OFFSET
);

1658 if(
u_dmac
 =
TRUE
)

1660 
d_mac_high
 = 
nscha_posy_y_f_p
->

.dst_mac_high;

1661 
d_mac_low
 = 
nscha_posy_y_f_p
->

.dst_mac_low;

1665 
d_mac_high
 = 
nscha_posy_y_f_p
->

.
c_mac_high
;

1666 
d_mac_low
 = 
nscha_posy_y_f_p
->

.
c_mac_low
;

1669 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vnhd_by_nid
(
nid
,&
vn_hd
);

1670 if(
tv
 !
OF_SUCCESS
)

1672 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vnhandle");

1673 
	`tf
("\r\n PPH-21");

1674  
OF_FAILURE
;

1677 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

1678 if(
tv
 !
OF_SUCCESS
)

1680 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo get vn by handle");

1681 
	`tf
("\r\n PPH-22");

1682  
OF_FAILURE
;

1685 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

1687 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1689 
nsc_posy_b_p
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_p
;

1690 
nsc_posy_mempo_g
 = 
vn_nsc_fo_p
->
nsc_posy_b_3_mempo_g
;

1692 
hashmask
 = 
nsc_no_of_posy_b_3_bucks_g
;

1693 
hashkey
 = 
	`nsc_compu_hash_posy_b_3
(
rvipt
,

1694 
d_mac_high
,

1695 
d_mac_low
,

1696 
dp_hd
,

1697 
hashmask
);

1698 
	`MCHASH_BUCKET_SCAN
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_sn_node_p
,
upkt_out_posy_y
 *, 
offt
)

1700 if((
rvipt
 !
upkt_out_posy_sn_node_p
->serviceport) ||

1701 (
dp_hd
 !
upkt_out_posy_sn_node_p
->dp_handle) ||

1702 (
d_mac_high
 !
upkt_out_posy_sn_node_p
->dst_mac_high) ||

1703 (
d_mac_low
 !
upkt_out_posy_sn_node_p
->dst_mac_low)

1707 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"table_3 ucastpkt_outportepositoryntry found,skippingroactiveush");

1710  
OF_SUCCESS
;

1715 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"getew mem block for ucastpkt outportepositoryntry");

1716 
tv
 = 
	`mempo_g_mem_block
(
nsc_posy_mempo_g
,(
uch8_t
 **)&
upkt_out_posy_y_p
,&
hp_b
);

1717 if(
tv
 !
MEMPOOL_SUCCESS
)

1719 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Memory blockllocation for ucastpkt outportepositoryntry failed");

1720 
	`tf
("\r\n PPH-23");

1721  
OF_FAILURE
;

1726 
	`ry
(
upkt_out_posy_y_p
->
lol_swch_me_p
,
nw_rvi_p
->
swch_me
);

1727 
upkt_out_posy_y_p
->
nw_ty
 =w_type;

1728 
upkt_out_posy_y_p
->
dp_hd
 = dp_handle;

1729 
upkt_out_posy_y_p
->
d_mac_high
 = dst_mac_high;

1730 
upkt_out_posy_y_p
->
d_mac_low
 = dst_mac_low;

1732 
upkt_out_posy_y_p
->
nid
 =id;

1733 
upkt_out_posy_y_p
->
rvipt
 = serviceport;

1734 
upkt_out_posy_y_p
->
id_time
 = 300;

1736 
upkt_out_posy_y_p
->
mada
 = (metadata & 0xF0FFFFFFFFFFFFFF);

1737 
upkt_out_posy_y_p
->
mada_mask
 = 0xF0FFFFFFFFFFFFFF;

1738 
upkt_out_posy_y_p
->
tun_id
 = (
mada
 & 0x0000000000FFFFFF);

1739 
upkt_out_posy_y_p
->
nw_pt_b
 = 
FALSE
;

1742 if(
u_dmac
 =
TRUE
)

1743 
	`memy
(
upkt_out_posy_y_p
->
d_mac
,
nscha_posy_y_f_p
->

.dst_mac,6);

1745 
	`memy
(
upkt_out_posy_y_p
->
d_mac
,
nscha_posy_y_f_p
->

.
c_mac
,6);

1750 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_vmpt_by_dmac_nid
(
upkt_out_posy_y_p
->
d_mac
,

1751 
upkt_out_posy_y_p
->
nid
,

1752 &
m_pt_hd
);

1754 if(
tv
 !
OF_SUCCESS
)

1756 
tv
 = 
OF_FAILURE
;

1760 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
d_m_pt_p
);

1762 if(
tv
 =
OF_SUCCESS
)

1764 
upkt_out_posy_y_p
->
out_pt_no
 = 
d_m_pt_p
->
pt_id
;

1766 
upkt_out_posy_y_p
->
tun_de_
 = 
d_m_pt_p
->
swch_
;

1768 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"tun_de_ = %x",
d_m_pt_p
 ->
swch_
);

1769 
	`ry
(
upkt_out_posy_y_p
->
me_swch_me_p
,
d_m_pt_p
->
swch_me
);

1771 
upkt_out_posy_y_p
->
pt_ty
 = 
d_m_pt_p
->
m_pt_ty
;

1775 
tv
 = 
OF_FAILURE
;

1783 if((
upkt_out_posy_y_p
->
pt_ty
 =
VM_GUEST_PORT
)

1785 (
	`rcmp
((
upkt_out_posy_y_p
->
lol_swch_me_p
),

1786 (
upkt_out_posy_y_p
->
me_swch_me_p
)))

1794 
tv
 = 
tsc_nvm_modus
[
nw_ty
].
	`nvm_modu_g_uni_nwpt
(
upkt_out_posy_y_p
->
lol_swch_me_p
,

1795 
rvipt
,

1796 &(
upkt_out_posy_y_p
->
out_pt_no
)

1799 if(
tv
 !
OF_SUCCESS
)

1801 
tv
 = 
OF_FAILURE
;

1804 
upkt_out_posy_y_p
->
nw_pt_b
 = 
TRUE
;

1808 if(
tv
 =
OF_FAILURE
)

1810 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1811 (
uch8_t
 *)
upkt_out_posy_y_p
,

1812 
upkt_out_posy_y_p
->
hp_b


1814 
	`tf
("\r\n PPH-24");

1815  
OF_FAILURE
;

1818 
upkt_out_posy_y_p
->
iܙy
 = 2;

1820 
offt
 = 
NSC_UCASTPKT_REPOSITORY_NODE_OFFSET
;

1821 
hashobj_p
 = (
uch8_t
 *)(
upkt_out_posy_y_p
+ 
offt
;

1823 
	`MCHASH_APPEND_NODE
(
nsc_posy_b_p
,
hashkey
,
upkt_out_posy_y_p
,
dex
,
magic
,
hashobj_p
,
us
);

1824 if(
us
 =
FALSE
)

1826 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddable 3epositoryntry");

1827 
tv
 = 
NSC_FAILED_TO_ADD_REPOSITORY_ENTRY
;

1828 
tv
 = 
	`mempo_a_mem_block
(
nsc_posy_mempo_g
,

1829 (
uch8_t
 *)
upkt_out_posy_y_p
,

1830 
upkt_out_posy_y_p
->
hp_b


1832 
	`tf
("\r\n PPH-25");

1833  
tv
;

1836 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_3 Successfullyppended ucastpkt outportepositoryntryo hashable");

1837 
upkt_out_posy_y_p
->
magic
 = magic;

1838 
upkt_out_posy_y_p
->
dex
 = index;

1840 
upkt_out_posy_y_p
->
_n
 = 
magic
;

1841 (
upkt_out_posy_y_p
->
_n
(((upkt_out_posy_y_p->_n<< 32| (
dex
));

1843 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_3
(
dp_hd
,
upkt_out_posy_y_p
);

1845 if(
tv
 =
OF_FAILURE
)

1847 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Failedo send Flow Mod messageo Table 3roactively ");

1851 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Successfully sent Flow Mod messageo Table 3roactively ");

1853  
OF_SUCCESS
;

1854 
	}
}

	@tsc_nsc_notify.c

22 
	~"cڌr.h
"

23 
	~"dobhash.h
"

24 
	~"ϵcmn.h
"

25 
	~"dm.h
"

26 
	~"mi.h
"

27 
	~"m_vm_i.h
"

28 
	~"m_vn_i.h
"

29 
	~"m_pt_i.h
"

30 
	~"tsc_cڌr.h
"

31 
	~"nm.h
"

33 
ut8_t
 
nmdb_cut_e_g
;

34 
ut32_t
 
vn_nsc_fo_offt_g
;

36 
	$nsc_l2_rvi_m_nifitis_add_cbk
(
ut8_t
 
nifiti_ty
,

37 
ut64_t
 
nm_hd
,

38 
nm_l2nw_rvi_m_nifiti_da
 
nifiti_da
,

39 *
back_g1
,

40 *
back_g2
)

42 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

43 
m_vtu_twk
* 
vn_y_p
;

44 
t32_t
 
tv
;

46 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"receivedotification callback - L2 service mapecord isdded");

48 
tv
 = 
	`m_g_vn_byhd
(
nifiti_da
.
add_d
.
vn_hd
,&
vn_y_p
);

49 if(
tv
 !
CRM_SUCCESS
)

51 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "VN doesn'txist ");

55 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

57 
vn_nsc_fo_p
->
rvi_chag_ty
 = 
SERVICE_CHAINING_L2
;

58 
vn_nsc_fo_p
->
vn_nmdb_lookup_e
 = 0;

59 
vn_nsc_fo_p
->
f_rvi_m_cd
 = 
nifiti_da
.
add_d
.
l2nw_rvi_m_hd
;

60 
vn_nsc_fo_p
->
f_nschat_obje
 = 
nifiti_da
.
add_d
.
nschat_obje_hd
;

61 
	}
}

63 
	$nsc_l2_rvi_m_nifitis_d_cbk
(
ut8_t
 
nifiti_ty
,

64 
ut64_t
 
nm_hd
,

65 
nm_l2nw_rvi_m_nifiti_da
 
nifiti_da
,

66 *
back_g1
,

67 *
back_g2
)

69 
vn_rvi_chag_fo
* 
vn_nsc_fo_p
;

70 
m_vtu_twk
* 
vn_y_p
;

71 
t32_t
 
tv
;

73 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"receivedotification callback - L2 service mapecord is deleted");

75 
tv
 = 
	`m_g_vn_byhd
(
nifiti_da
.
add_d
.
vn_hd
,&
vn_y_p
);

76 if(
tv
 !
CRM_SUCCESS
)

78 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "VN doesn'txist ");

82 
vn_nsc_fo_p
 = (
vn_rvi_chag_fo
 *)(*(
tsddr_t
*)((
ut8_t
 *)
vn_y_p
 + 
vn_nsc_fo_offt_g
));

84 
vn_nsc_fo_p
->
rvi_chag_ty
 = 0;

85 
vn_nsc_fo_p
->
vn_nmdb_lookup_e
 = 0;

86 
vn_nsc_fo_p
->
f_rvi_m_cd
 = 0;

87 
vn_nsc_fo_p
->
f_nschat_obje
 = 0;

88 
	}
}

90 
	$nsc_l2_nwrvi_obje_unched_cbk
(
ut8_t
 
nifiti_ty
,

91 
ut64_t
 
nwrvi_obje_f
,

92 
nm_nwrvi_obje_nifiti_da
 
nifiti_da
,

93 *
back_g1
,

94 *
back_g2
)

96 
m_pt
* 
pt_fo_p
 = 
NULL
;

97 
t32_t
 
tv
 = 
OF_SUCCESS
;

99 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nsc_l2_nwservice_object_launched_cbk is called");

101 
	`CNTLR_RCU_READ_LOCK_TAKE
();

102 
tv
 = 
	`m_g_pt_byhd
(
nifiti_da
.
unch
.
pt_hd
,&
pt_fo_p
);

103 
pt_fo_p
->
vn_id_
 = 
nifiti_da
.
unch
.vlan_id_in;

104 
pt_fo_p
->
vn_id_out
 = 
nifiti_da
.
unch
.vlan_id_out;

106 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
, "swcham%s",
pt_fo_p
->
swch_me
);

107 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
, "vn_id_ = %d",
nifiti_da
.
unch
.
vn_id_
);

108 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
, "vn_id_ou%d",
nifiti_da
.
unch
.
vn_id_out
);

109 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
, "pt_id = %d",
pt_fo_p
->
pt_id
);

111 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

113 if(
tv
 =
CRM_SUCCESS
)

115 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "Beforedding VM_NSortso classificationable");

116 
	`tsc_add_vmpt_ows_to_assify_b
(
pt_fo_p
->
f_vn
,

117 
pt_fo_p
->
swch_me
,

118 
pt_fo_p
->
m_pt_ty
,

119 
pt_fo_p
->
pt_id
,

120 
nifiti_da
.
unch
.
vn_id_
,

121 
nifiti_da
.
unch
.
vn_id_out
,

122 
pt_fo_p
->
syem_br_f
);

123 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_DEBUG
, "Afterdding VM_NSortso classificationable");

127 
	`OF_LOG_MSG
(
OF_LOG_NSRM
, 
OF_LOG_ERROR
, "Failedo gethe VM_NS Port");

133 
	}
}

135 
	$nsc_l2_nwrvi_obje_de_unched_cbk
(
ut8_t
 
nifiti_ty
,

136 
ut64_t
 
nwrvi_obje_f
,

137 
nm_nwrvi_obje_nifiti_da
 
nifiti_da
,

138 *
back_g1
,

139 *
back_g2
)

141 
m_pt
* 
pt_fo_p
 = 
NULL
;

142 
t32_t
 
tv
 = 
OF_SUCCESS
;

145  
OF_SUCCESS
;

146 
	}
}

148 
	$nm_nwrvi_obje_nifitis_cbk
(
ut8_t
 
nifiti_ty
,

149 
ut64_t
 
f
,

150 
nm_nwrvi_obje_nifiti_da
 
nifiti_da
,

151 *
back_g1
,

152 *
back_g2
)

154 if((
nifiti_ty
 !
NSRM_NWSERVICE_OBJECT_LAUNCHED
&& (nifiti_ty =
NSRM_NWSERVICE_OBJECT_DE_LAUNCHED
))

156 
nmdb_cut_e_g
 = (nsrmdb_current_state_g + 1);

157 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nmdb_cut_e_g = %d",
nmdb_cut_e_g
);

159 
	}
}

162 
	$nm_nscha_obje_nifitis_cbk
(
ut8_t
 
nifiti_ty
,

163 
ut64_t
 
f
,

164 
nm_nscha_obje_nifiti_da
 
nifiti_da
,

165 *
back_g1
,

166 *
back_g2
)

168 
nmdb_cut_e_g
 = (nsrmdb_current_state_g + 1);

169 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nmdb_cut_e_g = %d",
nmdb_cut_e_g
);

170 
	}
}

172 
	$nm_nschat_obje_nifitis_cbk
(
ut8_t
 
nifiti_ty
,

173 
ut64_t
 
f
,

174 
nm_nschat_obje_nifiti_da
 
nifiti_da
,

175 *
back_g1
,

176 *
back_g2
)

178 
nmdb_cut_e_g
 = (nsrmdb_current_state_g + 1);

179 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nmdb_cut_e_g = %d",
nmdb_cut_e_g
);

180 
	}
}

182 
	$nm_i_ru_nifitis_cbk
(
ut8_t
 
nifiti_ty
,

183 
ut64_t
 
f
,

184 
nm_nscha_i_ru_nifiti_da
 
nifiti_da
,

185 *
back_g1
,

186 *
back_g2
)

188 
nmdb_cut_e_g
 = (nsrmdb_current_state_g + 1);

189 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nmdb_cut_e_g = %d",
nmdb_cut_e_g
);

190 
	}
}

192 
	$nm_byss_ru_nifitis_cbk
(
ut8_t
 
nifiti_ty
,

193 
ut64_t
 
f
,

194 
nm_nwrvi_byss_ru_nifiti_da
 
nifiti_da
,

195 *
back_g1
,

196 *
back_g2
)

198 
nmdb_cut_e_g
 = (nsrmdb_current_state_g + 1);

199 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"nmdb_cut_e_g = %d",
nmdb_cut_e_g
);

200 
	}
}

204 
TBD


205 
Provide
 
cy
 
Alitis
 
like
 
Onack
 
to
 
ive
 
nifitis
 
om
 
Tffic
 
rg
 
	gmodu
.

206 
They
 
wh
 
the
 
back
 
	gfuncis
.

208 
TSA
 
nifs
 
whev
 
the
 
tٮ
 
affic
 
hs
 
eh
h
cfigud
 
u
 

 
low
 
	gthshds
.
It
 
may
h 
brg
 
up


209 
w
 
rvi
 
VMs
 

 
shutdown
 
some
 svi 
	gVMs
.

211 
	gA
. 
Tٮ
 
numb
 
of
 
	gcis
.

212 
	gB
. 
Tٮ
 
numb
 
of
 
bys
 o
	gafffic
. (
This
 
eds
 
sut
 
om
 
	gSwches
).

216 
t32_t
 
	$nsc_gi_nm_nifitis
()

218 
t32_t
 
tv
;

219 
ut32_t
 
back_g1
 = 1;

220 
ut32_t
 
back_g2
 = 1;

224 
back_g1
 = 1;

225 
back_g2
 = 1;

227 
tv
 = 
	`nm_gi_l2nw_rvi_m_nifitis
(
NSRM_L2NW_SERVICE_MAP_ADDED
,

228 
nsc_l2_rvi_m_nifitis_add_cbk
,

229 (*)&
back_g1
,

230 (*)&
back_g2
);

231 if(
tv
 =
NSRM_FAILURE
)

235 
tv
 = 
	`nm_gi_l2nw_rvi_m_nifitis
(
NSRM_L2NW_SERVICE_MAP_DELETED
,

236 
nsc_l2_rvi_m_nifitis_d_cbk
,

237 (*)&
back_g1
,

238 (*)&
back_g2
);

239 if(
tv
 =
NSRM_FAILURE
)

242 
tv
 = 
	`nm_gi_nwrvi_obje_nifitis
(
NSRM_NWSERVICE_OBJECT_LAUNCHED
,

243 
nsc_l2_nwrvi_obje_unched_cbk
,

244 (*)&
back_g1
,

245 (*)&
back_g2
);

247 if(
tv
 =
NSRM_FAILURE
)

251 
tv
 = 
	`nm_gi_nwrvi_obje_nifitis
(
NSRM_NWSERVICE_OBJECT_DE_LAUNCHED
,

252 
nsc_l2_nwrvi_obje_de_unched_cbk
,

253 (*)&
back_g1
,

254 (*)&
back_g2
);

256 if(
tv
 =
NSRM_FAILURE
)

259 
tv
 = 
	`nm_gi_nwrvi_obje_nifitis
(
NSRM_NWSERVICE_OBJECT_ALL
,

260 
nm_nwrvi_obje_nifitis_cbk
,

261 (*)&
back_g1
,

262 (*)&
back_g2
);

264 if(
tv
 !
NSRM_SUCCESS
)

267 
tv
 = 
	`nm_gi_nscha_obje_nifitis
(
NSRM_NSCHAIN_OBJECT_ALL
,

268 
nm_nscha_obje_nifitis_cbk
,

269 (*)&
back_g1
,

270 (*)&
back_g2
);

272 if(
tv
 !
NSRM_SUCCESS
)

276 
tv
 = 
	`nm_gi_nschat_obje_nifitis
(
NSRM_NSCHAIN_SET_OBJECT_ALL
,

277 
nm_nschat_obje_nifitis_cbk
,

278 (*)&
back_g1
,

279 (*)&
back_g2
);

281 if(
tv
 !
NSRM_SUCCESS
)

285 
tv
 = 
	`nm_gi_nscha_i_ru_nifitis
(
NSRM_NSCHAIN_SELECTION_RULE_ALL
,

286 
nm_i_ru_nifitis_cbk
,

287 (*)&
back_g1
,

288 (*)&
back_g2
);

290 if(
tv
 !
NSRM_SUCCESS
)

294 
tv
 = 
	`nm_gi_nwrvi_byss_ru_nifitis
(
NSRM_NWSERVICE_BYPASS_RULE_ALL
,

295 
nm_byss_ru_nifitis_cbk
,

296 (*)&
back_g1
,

297 (*)&
back_g2
);

299 if(
tv
 !
NSRM_SUCCESS
)

303  
tv
;

304 
	}
}

	@tsc_nvm_modules.c

22 
	~"cڌr.h
"

23 
	~"mi.h
"

24 
	~"m_vn_i.h
"

25 
	~"m_pt_i.h
"

26 
	~"tsc_cڌr.h
"

27 
	~"tsc_nvm_modus.h
"

28 
	~"tsc_vxn_vws.h
"

30 
tsc_nvm_modu_r
 
	gtsc_nvm_vxn_modu_r
 =

32 
tsc_nvm_vxn_
,

33 
tsc_nvm_vxn__vmpt_vws
,

34 
tsc_nvm_vxn_de_vmpt_vws
,

35 
tsc_nvm_vxn__nwpt_vws
,

36 
tsc_nvm_vxn_de_nwpt_vws
,

37 
tsc_vxn_g_uni_nwpt_by_swme_
,

38 
tsc_vxn_g_me_s_by_swme_nid_
,

39 
tsc_vxn_g_brd_nwpts_by_swme_nid_
,

40 
tsc_vxn_g_vmpt_by_dmac_nid
,

41 
tsc_vxn_g_vmpts_by_swme_nid
,

42 
tsc_vxn_add_vn_to_nid_vw
,

43 
tsc_vxn_de_vn_om_nid_vw
,

44 
tsc_vxn_g_vnhd_by_nid
,

45 
tsc_nvm_vxn_cڡru_mada


48 
t32_t
 
	$tsc_nvm_modu_
()

50 
t32_t
 
tv
 = 
OF_SUCCESS
;

51 
tsc_nvm_modu_fo
 
nvm_modu_fo
;

53 
	`ry
(
nvm_modu_fo
.
nvm_modu_me
,"VXLAN");

54 
nvm_modu_fo
.
nw_ty
 = 
VXLAN_TYPE
;

56 
tv
 = 
	`tsc_gi_nvm_modu
(&
nvm_modu_fo
,&
tsc_nvm_vxn_modu_r
);

57 if(
tv
 =
OF_SUCCESS
)

59 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"VXLAN NVM moduleegistration successful.");

61 if(
tv
 !
OF_SUCCESS
)

63 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"VXLAN NVM moduleegistration failed");

65  
tv
;

66 
	}
}

	@tsc_nvm_vxlan.c

21 
	~"cڌr.h
"

22 
	~"mi.h
"

23 
	~"m_vn_i.h
"

24 
	~"m_pt_i.h
"

25 
	~"tsc_cڌr.h
"

26 
	~"tsc_nvm_vxn.h
"

27 
	~"tsc_vxn_vws.h
"

28 
	~"tsc_ofv1_3_ug.h
"

30 
tsc_vxn_swme_vmpt_daba_vw
 
swme_vmpt_vw
;

32 
t32_t
 
	$tsc_nvm_vxn_
()

34 
t32_t
 
tv
,
us
 = 
OF_SUCCESS
;

38 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Entered VXLAN NVM moduleo initialize");

40 
tv
 = 
	`tsc_vxn_vn_nid_vw_
(
TSC_VXN_TUNNID_VIEW_OF_VN
);

41 if(
tv
 !
OF_SUCCESS
)

43 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedo initializeunid view of vn");

44 
us
 = 
OF_FAILURE
;

49 
tv
 = 
	`tsc_vxn_vmpt_ptmac_vw_
(
TSC_VXN_DSTMAC_VIEW_OF_VMPORTS
);

50 if(
tv
 !
OF_SUCCESS
)

52 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedo initialize dmac view of vmports");

53 
us
 = 
OF_FAILURE
;

57 
tv
 = 
	`tsc_vxn_vmpt_swme_vw_
(
TSC_VXN_SWNAME_VIEW_OF_VMPORTS
);

58 if(
tv
 !
OF_SUCCESS
)

60 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedo initialize swname view of vmports");

61 
us
 = 
OF_FAILURE
;

65 
tv
 = 
	`tsc_vxn_uni_nwpt_swme_vw_
(
TSC_VXN_SWNAME_VIEW_OF_UNICAST_NWPORTS
);

66 if(
tv
 !
OF_SUCCESS
)

68 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedo initialize swname view ofw_unicastorts");

69 
us
 = 
OF_FAILURE
;

72 
tv
 = 
	`tsc_vxn_brd_nwpt_swme_vw_
(
TSC_VXN_SWNAME_VIEW_OF_BROADCAST_NWPORTS
);

73 if(
tv
 !
OF_SUCCESS
)

75 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Failedo initialize swname view ofw_broadcastorts");

76 
us
 = 
OF_FAILURE
;

81 if(
us
 !
OF_SUCCESS
)

83 
	`tsc_vxn_vn_nid_vw_un
();

84 
	`tsc_vxn_vmpt_ptmac_vw_un
();

85 
	`tsc_vxn_vmpt_swme_vw_un
();

86 
	`tsc_vxn_uni_nwpt_swme_vw_un
();

87 
	`tsc_vxn_brd_nwpt_swme_vw_un
();

91 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Successfully initialized VXLAN NVM module");

93  
us
;

94 
	}
}

96 
t32_t
 
	$tsc_nvm_vxn__vmpt_vws
(
ut64_t
 
m_pt_hd
,

97 
ut8_t
 
m_pt_ty
,

98 
ut64_t
 
vn_hd
)

100 
m_vtu_twk
* 
vn_y_p
;

101 
m_vxn_nw
 
vxn_nw
;

103 
t32_t
 
tv
;

104 
t32_t
 
us
 = 
OF_SUCCESS
;

106 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

108 if(
tv
 !
CRM_SUCCESS
)

110 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unableo fetch vn_entry");

111  
OF_FAILURE
;

114 
vxn_nw
 = 
vn_y_p
->
nw_ms
.vxlan_nw;

119 
tv
 = 
	`tsc_vxn_add_vmpt_to_ptmac_vw
(
m_pt_hd
,
vxn_nw
.
nid
);

121 if(
tv
 !
OF_SUCCESS
)

123 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedodd vmsideortoheortmac view");

124 
us
 = 
OF_FAILURE
;

127 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Added vmsideortoheortmac view");

130 
tv
 = 
	`tsc_vxn_add_vmpt_to_swme_vw
(
m_pt_hd
,
vxn_nw
.
nid
);

132 if(
tv
 !
OF_SUCCESS
)

134 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedodd vmsideortohe switch view");

135 
us
 = 
OF_FAILURE
;

138 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Added vmsideortohe switch view");

141  
us
;

142 
	}
}

144 
t32_t
 
	$tsc_nvm_vxn_de_vmpt_vws
(
ut64_t
 
m_pt_hd
,

145 
ut8_t
 
m_pt_ty
,

146 
ut64_t
 
vn_hd
)

148 
m_vtu_twk
* 
vn_y_p
;

149 
m_vxn_nw
 
vxn_nw
;

151 
t32_t
 
tv
;

152 
t32_t
 
us
 = 
OF_SUCCESS
;

154 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

156 if(
tv
 !
CRM_SUCCESS
)

158 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unableo fetch vn_entry");

159  
OF_FAILURE
;

162 
vxn_nw
 = 
vn_y_p
->
nw_ms
.vxlan_nw;

167 
tv
 = 
	`tsc_vxn_d_vmpt_om_ptmac_vw
(
m_pt_hd
,
vxn_nw
.
nid
);

169 if(
tv
 !
OF_SUCCESS
)

171 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo delete vmsideort fromheortmac view");

172 
us
 = 
OF_FAILURE
;

175 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Deleted vmsideort fromheortmac view");

178 
tv
 = 
	`tsc_vxn_d_vmpt_om_swme_vw
(
m_pt_hd
,
vxn_nw
.
nid
);

179 if(
tv
 !
OF_SUCCESS
)

181 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
,"Failedo delete vmsideort fromhe switch view");

182 
us
 = 
OF_FAILURE
;

185 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Deleted vmsideort fromhe switch view");

188  
us
;

189 
	}
}

190 
t32_t
 
	$tsc_nvm_vxn__nwpt_vws
(
ut64_t
 
m_pt_hd
,

191 
ut8_t
 
m_pt_ty
,

192 * 
swme_p
)

194 
t32_t
 
tv
;

195 
m_vxn_nw
 
vxn_nw
;

196 
m_pt
* 
m_pt_node_p
;

199 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "mwp܈hd %x", 
m_pt_hd
);

202 
	`CNTLR_RCU_READ_LOCK_TAKE
();

204 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_node_p
);

205 if(
tv
 !
OF_SUCCESS
)

207 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Invalid crmort handle");

208 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

209  
OF_FAILURE
;

212 
vxn_nw
 = (
m_pt_node_p
->
nw_ms
.vxlan_nw);

214 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nw svi܈=%x", (
m_pt_node_p
->
nw_ms
).
vxn_nw
.
rvi_pt
);

215 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "swcham=%s",
swme_p
);

217 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

219 if(
m_pt_ty
 =
NW_UNICAST_PORT
)

221 
tv
 = 
	`tsc_vxn_add_uni_nwpt_to_swme_vw
(
m_pt_hd
,

222 
vxn_nw
.
rvi_pt
);

223 if(
tv
 !
OF_SUCCESS
)

225 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddw unicastortohe view");

226  
OF_FAILURE
;

228 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Successfullyddedhew unicastortohe view");

230 if(
m_pt_ty
 =
NW_BROADCAST_PORT
)

232 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " vn = %x", 
vxn_nw
.
nid
);

233 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "eme_ = %x", 
vxn_nw
.
me_
);

235 
tv
 = 
	`tsc_vxn_add_brd_nwpt_to_swme_vw
(
m_pt_hd
,

236 
vxn_nw
.
rvi_pt
,

238 
vxn_nw
.
me_
);

239 if(
tv
 !
OF_SUCCESS
)

241 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedoddw broadcastortohe view");

242  
OF_FAILURE
;

244 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Successfullyddedhew broadcastortohe view");

248 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unsupported Networkortype");

249  
OF_FAILURE
;

251  
OF_SUCCESS
;

252 
	}
}

254 
t32_t
 
	$tsc_nvm_vxn_de_nwpt_vws
(
ut64_t
 
m_pt_hd
,

255 
ut8_t
 
m_pt_ty
,

256 * 
swme_p
)

258 
t32_t
 
tv
;

259 
m_vxn_nw
* 
vxn_nw_p
 = 
NULL
;

260 
m_pt
* 
m_pt_node_p
;

262 
tv
 = 
	`m_g_pt_byhd
(
m_pt_hd
,&
m_pt_node_p
);

263 if(
tv
 !
OF_SUCCESS
)

265 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Invalid crmort handle");

266  
OF_FAILURE
;

269 
vxn_nw_p
 = &(
m_pt_node_p
->
nw_ms
.
vxn_nw
);

271 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nw svi܈=%d", 
vxn_nw_p
->
rvi_pt
);

272 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "swcham=%s",
swme_p
);

274 if(
m_pt_ty
 =
NW_UNICAST_PORT
)

276 
tv
 = 
	`tsc_vxn_d_uni_nwpt_om_swme_vw
(
m_pt_hd
,

277 
vxn_nw_p
->
rvi_pt
);

279 if(
tv
 !
OF_SUCCESS
)

281 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo delete unicastwport from views");

282  
OF_FAILURE
;

284 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Successfully deletedhe unicastwport from views");

286 if(
m_pt_ty
 =
NW_BROADCAST_PORT
)

288 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " vn%x", 
vxn_nw_p
->
nid
);

289 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "eme_ = %x", 
vxn_nw_p
->
me_
);

291 
tv
 = 
	`tsc_vxn_d_brd_nwpt_om_swme_vw
(
m_pt_hd
,

292 
vxn_nw_p
->
rvi_pt
,

294 
vxn_nw_p
->
me_
);

295 if(
tv
 !
OF_SUCCESS
)

297 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo delete broadcastwport from views");

298  
OF_FAILURE
;

300 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Successfully deletedhe broadcastwport from views");

304 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unsupported Networkortype");

305  
OF_FAILURE
;

307  
OF_SUCCESS
;

308 
	}
}

310 
	$tsc_nvm_vxn_cڡru_mada
(
tsc_ofv_ug_i
* 
tsc_ms_p
,
ut64_t
 
vn_hd
,
m_pt
* 
m_pt_p
)

312 
ut64_t
 
mada
;

313 
m_vtu_twk
* 
vn_y_p
;

314 
m_vxn_nw
* 
vxn_nw_p
 = 
NULL
;

315 
t32_t
 
tv
 = 
OF_SUCCESS
;

317 if(
m_pt_p
 =
NULL
)

319 
tv
 = 
	`m_g_vn_byhd
(
vn_hd
,&
vn_y_p
);

320 if(
tv
 =
CRM_SUCCESS
)

322 
vxn_nw_p
 = &
vn_y_p
->
nw_ms
.
vxn_nw
;

326 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Unableo fetch vn_entry");

331 
vxn_nw_p
 = &(
m_pt_p
->
nw_ms
.
vxn_nw
);

334 
tsc_ms_p
->
rvipt
 = 
vxn_nw_p
->
rvi_pt
;

335 
tsc_ms_p
->
vni
 = 
vxn_nw_p
->
nid
;

336 
tsc_ms_p
->
nw_ty
 = 
VXLAN_TYPE
;

338 
mada
 = 0;

339 
mada
 = (((
ut64_t
)(
vxn_nw_p
->
rvi_pt
)<< 
SERVICE_PORT_OFFSET
);

340 
mada
 = mad| (
vxn_nw_p
->
nid
)

341 | (((
ut64_t
)(
tsc_ms_p
->
nw_ty
)<< 
NW_TYPE_OFFSET
);

343 
tsc_ms_p
->
mada
 = metadata;

345 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Cڡrued mad%x",
tsc_ms_p
->
mada
);

346 
	}
}

351 
t32_t
 
	$tsc_vxn_add_nwpt_ows
(* 
swme_p
,

352 
m_vxn_nw
* 
vxn_nw_p
,

353 
ut8_t
 
nwpt_ty
,

354 
ut32_t
 
pt_id
,

355 
ut64_t
 
dp_hd
)

357 
ut32_t
 
hashkey
;

358 
tsc_vxn_swme_vmpt_vw_node
 *
vw_node_y_p
 = 
NULL
;

359 
m_pt
 *
pt_fo_p
 = 
NULL
;

360 
m_vtu_twk
* 
vn_y_p
;

361 
ut64_t
 
mada
;

363 
uch8_t
 
offt
;

364 
tsc_ofv_ug_i
* 
tsc_ms_p
;

365 
t32_t
 
us
 = 
OF_SUCCESS
;

367 
	`CNTLR_RCU_READ_LOCK_TAKE
();

369 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swme_p
,
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

370 
offt
 = 
TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
;

371 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"entered 1");

372 
	`MCHASH_BUCKET_SCAN
(
swme_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
,

373 
tsc_vxn_swme_vmpt_vw_node
 *, 
offt
)

375 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"swcham%s",
vw_node_y_p
->
swme
);

376 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"swcham%s",
swme_p
);

378 if(!
	`rcmp
(
vw_node_y_p
->
swme
, 
swme_p
))

380 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"entered 2");

381 
us
 = 
	`m_g_pt_byhd
(
vw_node_y_p
->
pt_hd
, &
pt_fo_p
);

382 if(
us
 =
OF_SUCCESS
)

384 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"entered 3");

386 
us
 = 
	`m_g_vn_byhd
(
pt_fo_p
->
f_vn
,&
vn_y_p
);

387 if(
us
 =
OF_SUCCESS
)

389 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"entered 4")

390 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_y_p->nw_ty = %d",
vn_y_p
->
nw_ty
);

391 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_entry_p->nw_params.vxlan_nw.nid = %x",

392 
vn_y_p
->
nw_ms
.
vxn_nw
.
nid
);

393 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vn_entry_p->nw_params.vxlan_nw.service_port = %d",

394 
vn_y_p
->
nw_ms
.
vxn_nw
.
rvi_pt
);

395 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vxn_nw_p->rvi_p܈%d",
vxn_nw_p
->
rvi_pt
);

398 if((
vn_y_p
->
nw_ty
 =
VXLAN_TYPE
) &&

399 (
vn_y_p
->
nw_ms
.
vxn_nw
.
rvi_pt
 =
vxn_nw_p
->service_port))

401 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"entered 5")

403 
tsc_ms_p
 = (
tsc_ofv_ug_i
 *
	`mloc
( (tsc_ofver_plugin_iface));

404 
	`ry
(
tsc_ms_p
->
lol_swch_me
,
swme_p
);

406 
tsc_ms_p
->
rvipt
 = 
vxn_nw_p
->
rvi_pt
;

407 
tsc_ms_p
->
vni
 = 
vxn_nw_p
->
nid
;

408 
tsc_ms_p
->
nw_ty
 = 
VXLAN_TYPE
;

410 
mada
 = 0;

411 
mada
 = (((
ut64_t
)(
vxn_nw_p
->
rvi_pt
)<< 
SERVICE_PORT_OFFSET
);

412 
mada
 = mad| (
vxn_nw_p
->
nid
)

413 | (((
ut64_t
)(
tsc_ms_p
->
nw_ty
)<< 
NW_TYPE_OFFSET
);

415 
tsc_ms_p
->
mada
 = metadata;

417 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Cڡrued mad%x",
tsc_ms_p
->
mada
);

419 
tsc_ms_p
->
mada
 = (tsc_params_p->metadata |

420 (((
ut64_t
)(
nwpt_ty
)<< 
PKT_ORIGIN_OFFSET
));

421 
tsc_ms_p
->
mada_mask
 = 0xffffffffffffffff;

423 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mad%x",
tsc_ms_p
->
mada
);

425 
tsc_ms_p
->
pkt_ig_e
 = 
nwpt_ty
;

426 
tsc_ms_p
->
dp_hd
 = dp_handle;

427 
tsc_ms_p
->
_pt_id
 = 
pt_id
;

430 if(
pt_fo_p
->
m_pt_ty
 =
VMNS_PORT
)

432 
tsc_ms_p
->
vn_id_
 = 
pt_fo_p
->vlan_id_in;

433 
tsc_ms_p
->
vn_id_out
 = 
pt_fo_p
->vlan_id_out;

438 
tsc_ms_p
->
vn_id_
 = 0;

439 
tsc_ms_p
->
vn_id_out
 = 0;

443 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vm܈ty = %d",
pt_fo_p
->
m_pt_ty
);

444 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"vm܈id = %d",
pt_fo_p
->
pt_id
);

445 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwp܈ty = %d",
nwpt_ty
);

446 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nw܈id = %d",
pt_id
);

448 
us
 = 
	`tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
dp_hd
,
tsc_ms_p
,
OFPFC_ADD
);

454 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

455  
OF_SUCCESS
;

456 
	}
}

	@tsc_ofv1_3_plugin.c

24 
	~"cڌr.h
"

25 
	~"of_uts.h
"

26 
	~"of_muɝt.h
"

27 
	~"of_msgi.h
"

28 
	~"l_queue.h
"

29 
	~"r_s.h
"

30 
	~"r_.h
"

31 
	~"r_evt.h
"

32 
	~"dmldef.h
"

34 
	~"mi.h
"

35 
	~"tsc_cڌr.h
"

36 
	~"tsc_ofv1_3_ug.h
"

37 
	~"tsc_olug_v1_3_ldef.h
"

38 
	~"nica_tun_ext.h
"

39 
	~"of_uts.h
"

42 
	#TSC_L2_SERVICE_CHAINING_ENABLE
 1

	)

44 
	#TSC_APP_PKT_IN_PRIORITY
 2

	)

45 
	#TSC_APP_PKT_FLOW_IN_PRIORITY
 104

	)

47 
	#TSC_PKT_UNICAST
 1

	)

48 
	#TSC_PKT_BROADCAST
 2

	)

50 
	#TSC_PKT_UNICAST_VM_APPLN
 3

	)

51 
	#TSC_PKT_UNICAST_VMNS_NW
 4

	)

52 
	#TSC_PKT_UNICAST_ARP
 5

	)

53 
	#TSC_PKT_UNICAST_DNS_UDP
 6

	)

54 
	#TSC_PKT_UNICAST_DHCP_UDP
 7

	)

55 
	#TSC_PKT_UNICAST_DHCP_UDP_67
 8

	)

58 
ut8_t
 
	gu_mac_addr_chk
[6] = {00,00,00,00,00,00};

59 
ut8_t
 
	gu_mac_mask
[6] = {01,00,00,00,00,00};

60 
ut8_t
 
	gb_mac_addr_chk
[6] = {0xff,0xff,0xff,0xff,0xff,0xff};

61 
ut8_t
 
	gb_mac_mask
[6] = {0xff,0xff,0xff,0xff,0xff,0xff};

63 
ut16_t
 
	gags
;

65 
t32_t


66 
tsc_olug_v1_3_add_b_miss_y
(
ut64_t
 
dh_hd
,
ut8_t
 
b_id
);

68 
t32_t
 
tsc_olug_v1_3_d_b_miss_y
(
ut64_t
 
dh_hd
,
ut8_t
 
b_id
);

70 
t32_t
 
tsc_d_wmod_1_3_msg_b_0
(
ut64_t
 
dp_hd
,

71 
ut16_t
 
msg_n
,

72 
ut32_t
 *
put_pt_id_p
,

73 
ut8_t
 
pkt_ty


76 
t32_t
 
tsc_add_wmod_1_3_msg_b_0
(
ut64_t
 
dp_hd
,

77 
ut16_t
 
msg_n
,

78 
ut16_t
 
ow_iܙy
,

79 
ut32_t
 *
put_pt_id_p
,

80 
ut8_t
 
pkt_ty
,

81 
ut16_t
 *
vn_id_p
,

82 
ut8_t
 
vn_mask_q
,

83 
ut16_t
 *
vn_id_mask_p
,

84 
ut64_t
 
mada
,

85 
ut64_t
 
mada_mask
,

86 
ut8_t
 
go_b_id


99 
t32_t
 
	$tsc_olug_v1_3_
(
ut64_t
 
doma_hd
)

101 
t32_t
 
us
;

106 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_CLASSIFY_TABLE_ID_0
,

107 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

108 
tsc_olug_v1_3_b_0_miss_y_pkt_rcvd
,

109 (*)()
TSC_APP_CLASSIFY_TABLE_ID_0
,
NULL
);

113 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
,

114 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

115 
tsc_olug_v1_3_b_1_miss_y_pkt_rcvd
,

116 (*)()
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
,
NULL
);

117 if(
us
 =
OF_FAILURE
)

119 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of OUTBOUND NS CHAIN TABLE 1");

123 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
,

124 
OF_ASYNC_MSG_FLOW_REMOVED_EVENT
,
TSC_APP_PKT_FLOW_IN_PRIORITY
,

125 
tsc_olug_v1_3_nscha_b_1_ow_y_moved_rcvd
,

126 (*)()
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
,
NULL
);

127 if(
us
 =
OF_FAILURE
)

129 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of OUTBOUND NS CHAIN TABLE 1");

133 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
,

134 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

135 
tsc_olug_v1_3_b_2_miss_y_pkt_rcvd
,

136 (*)()
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
,
NULL
);

137 if(
us
 =
OF_FAILURE
)

139 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of INBOUND NS CHAIN TABLE 2");

143 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
,

144 
OF_ASYNC_MSG_FLOW_REMOVED_EVENT
,
TSC_APP_PKT_FLOW_IN_PRIORITY
,

145 
tsc_olug_v1_3_nscha_b_2_ow_y_moved_rcvd
,

146 (*)()
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
,
NULL
);

147 if(
us
 =
OF_FAILURE
)

149 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of INBOUND NS CHAIN TABLE 2");

153 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_UNICAST_TABLE_ID_3
,

154 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

155 
tsc_olug_v1_3_b_3_miss_y_pkt_rcvd
,

156 (*)()
TSC_APP_UNICAST_TABLE_ID_3
,
NULL
);

157 if(
us
 =
OF_FAILURE
)

159 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of VM UNICAST OUTBOUNDable");

163 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_UNICAST_TABLE_ID_3
,

164 
OF_ASYNC_MSG_FLOW_REMOVED_EVENT
,
TSC_APP_PKT_FLOW_IN_PRIORITY
,

165 
tsc_olug_v1_3_fc_b_ow_y_moved_rcvd
,

166 (*)()
TSC_APP_UNICAST_TABLE_ID_3
,
NULL
);

167 if(
us
 =
OF_FAILURE
)

169 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of VM UNICAST OUTBOUNDable");

173 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
,

174 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

175 
tsc_olug_v1_3_b_4_miss_y_pkt_rcvd
,

176 (*)()
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
,
NULL
);

177 if(
us
 =
OF_FAILURE
)

179 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of VM BROADCAST OUTBOUNDable");

183 
us
 = 
	`of_gi_asynchrous_mesge_hook
(
doma_hd
, 
TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
,

184 
OF_ASYNC_MSG_PACKET_IN_EVENT
,
TSC_APP_PKT_IN_PRIORITY
,

185 
tsc_olug_v1_3_b_5_miss_y_pkt_rcvd
,

186 (*)()
TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
,
NULL
);

187 if(
us
 =
OF_FAILURE
)

189 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_INFO
,"registering sampleppso Asyc message of NW UNICAST INBOUNDable");

195 if(
us
 =
OF_FAILURE
)

198  
us
;

201 
us
 = 
	`r_gi_asynchrous_evt_hook
(
doma_hd
,
DP_READY_EVENT
,1,

202 
tsc_olug_v1_3_dp_ady_evt
,
NULL
,NULL);

203 if(
us
 =
OF_FAILURE
)

205 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Register DP Readyvent cbk failed");

208 
us
 = 
	`r_gi_asynchrous_evt_hook
(
doma_hd
,
DP_DETACH_EVENT
,1,

209 
tsc_olug_v1_3_dp_dach_evt
,
NULL
,NULL);

210 if(
us
 =
OF_FAILURE
)

212 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Register DP Detachvent cbk failed");

213  
OF_FAILURE
;

216  
us
;

217 
	}
}

227 
t32_t


228 
	$tsc_olug_v1_3_dp_ady_evt
(
ut64_t
 
cڌr_hd
,

229 
ut64_t
 
doma_hd
,

230 
ut64_t
 
dh_hd
,

231 *
cbk_g1
,

232 *
cbk_g2
)

234 
ut8_t
 
b_id
;

235 
dm_dh_y
 *
pdh_fo
;

236 
t32_t
 
us
 = 
OF_SUCCESS
;

240 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"DATA PATH READY EVENT RECEIVED");

241 if(
	`g_dh_byhd
(
dh_hd
, &
pdh_fo
!
DPRM_SUCCESS
)

243 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_WARN
, "NDP Ery wh giv dh_hd=%u",
dh_hd
);

244 
us
 = 
OF_FAILURE
;

248 
b_id
 = 1;able_id < 6;able_id++)

250 if(
	`tsc_olug_v1_3_add_b_miss_y
(
dh_hd
,
b_id
!
OF_SUCCESS
)

252 
us
 = 
OF_FAILURE
;

253 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Addg mised f܁ab %d ",
b_id
);

258  
us
;

259 
	}
}

270 
t32_t
 
	$tsc_olug_v1_3_add_b_miss_y
(
ut64_t
 
dh_hd
,
ut8_t
 
b_id
)

272 
of_msg
 *
msg
;

273 
ut16_t
 
msg_n
,
rui_n
,
ai_n
,
ags
;

274 
ut8_t
* 
_t_loc
 = 
NULL
;

275 
ut16_t
 
mch_fd_n
=0;

276 
ut8_t
* 
mch_t_loc
 = 
NULL
;

277 
ut8_t
* 
ai_t_loc
 = 
NULL
;

278 
t32_t
 
tv
 = 
OF_SUCCESS
;

279 
t32_t
 
us
 = 
OF_SUCCESS
;

280 * 
cn_fo_p
;

282 
msg_n
 = (
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

283 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+
OFU_OUTPUT_ACTION_LEN
);

287 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

288 if(
msg
 =
NULL
)

290 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

291 
us
 = 
OF_FAILURE
;

294 
ags
 = 0;

295 
ags
 |
OFPFF_RESET_COUNTS
;

296 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dh_hd
,
b_id
,

298 
OFPFC_ADD
,

301 
OFP_NO_BUFFER
,
ags
,

304 &
cn_fo_p


307 if(
tv
 !
OFU_ADD_FLOW_ENTRY_TO_TABLE_SUCCESS
)

309 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg misyab = %d",
tv
);

310 
us
 = 
OF_FAILURE
;

312 
	`ofu_t_g_mch_fld_vues
(
msg
);

313 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc
,&
mch_fd_n
);

315 
	`ofu_t_pushg_ruis
(
msg
, 
mch_fd_n
);

316 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

317 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

319 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

320 
us
 = 
OF_FAILURE
;

324 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,
OFPP_CONTROLLER
, 
OFPCML_NO_BUFFER
);

325 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

327 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg ouuaiڃ = %d",
tv
);

328 
us
 = 
OF_FAILURE
;

331 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

332 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

333 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc
,&
rui_n
);

335 
tv
=
	`of__nd_que_mesge
(
msg
,
dh_hd
,
cn_fo_p
,
NULL
,NULL);

336 if(
tv
 !
OF_SUCCESS
)

338 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg misy؏b = %d %d",
tv
,
b_id
);

339 
us
 = 
OF_FAILURE
;

343  
us
;

344 
	}
}

356 
t32_t
 
	$tsc_olug_v1_3_nd_ow_mod_assify_b_nwpts
(
ut64_t
 
dp_hd
,

357 
tsc_ofv_ug_i
* 
tsc_ms_p
,

358 
ut8_t
 
ow_mod_ݔi
)

360 
t32_t
 
tv
;

361 
t32_t
 
us
 = 
OF_SUCCESS
;

362 
ut16_t
 
msg_n
;

363 
ut16_t
 
vn_id
,
vn_id_mask
;

364 
ut8_t
 
vn_mask_q
;

365 
ut8_t
 
xt_b_id
;

369 
msg_n
 = 
FLMOD_MSG_LEN_NW_PORT_OF_1_3
;

371 
vn_id
 = 0x0000;

372 
vn_id_mask
 = 0x0000;

373 
vn_mask_q
 = 
FALSE
;

374 
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

376 if(
ow_mod_ݔi
 =
OFPFC_ADD
)

378 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

379 
msg_n
,

381 &(
tsc_ms_p
->
_pt_id
),

382 
TSC_PKT_UNICAST
,

383 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

384 
tsc_ms_p
->
mada
,

385 
tsc_ms_p
->
mada_mask
,

386 
xt_b_id
);

387 if(
tv
 !
OF_SUCCESS
)

389 
us
 = 
OF_FAILURE
;

394 
vn_id
 = 0x1000;

395 
vn_id_mask
 = 0x1000;

396 
vn_mask_q
 = 
TRUE
;

399 #ifde
TSC_L2_SERVICE_CHAINING_ENABLE


400 
xt_b_id
 = 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
;

403 if(
tsc_ms_p
->
vn_id_
 != 0)

405 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

406 
msg_n
,

408 &(
tsc_ms_p
->
_pt_id
),

409 
TSC_PKT_UNICAST_VMNS_NW
,

410 &(
tsc_ms_p
->
vn_id_
),
vn_mask_q
,&
vn_id_mask
,

411 
tsc_ms_p
->
mada
,

412 
tsc_ms_p
->
mada_mask
,

413 
xt_b_id
);

414 if(
tv
 !
OF_SUCCESS
)

416 
us
 = 
OF_FAILURE
;

421 if(
tsc_ms_p
->
vn_id_out
 != 0)

423 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

424 
msg_n
,

426 &(
tsc_ms_p
->
_pt_id
),

427 
TSC_PKT_UNICAST_VMNS_NW
,

428 &(
tsc_ms_p
->
vn_id_out
),
vn_mask_q
,&
vn_id_mask
,

429 
tsc_ms_p
->
mada
,

430 
tsc_ms_p
->
mada_mask
,

431 
xt_b_id
);

432 if(
tv
 !
OF_SUCCESS
)

434 
us
 = 
OF_FAILURE
;

439 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

440 
msg_n
,

442 &(
tsc_ms_p
->
_pt_id
),

443 
TSC_PKT_UNICAST_ARP
,

444 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

445 
tsc_ms_p
->
mada
,

446 
tsc_ms_p
->
mada_mask
,

447 
TSC_APP_UNICAST_TABLE_ID_3
);

448 if(
tv
 !
OF_SUCCESS
)

450 
us
 = 
OF_FAILURE
;

454 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

455 
msg_n
,

457 &(
tsc_ms_p
->
_pt_id
),

458 
TSC_PKT_UNICAST_DNS_UDP
,

459 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

460 
tsc_ms_p
->
mada
,

461 
tsc_ms_p
->
mada_mask
,

462 
TSC_APP_UNICAST_TABLE_ID_3
);

463 if(
tv
 !
OF_SUCCESS
)

465 
us
 = 
OF_FAILURE
;

469 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

470 
msg_n
,

472 &(
tsc_ms_p
->
_pt_id
),

473 
TSC_PKT_UNICAST_DHCP_UDP
,

474 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

475 
tsc_ms_p
->
mada
,

476 
tsc_ms_p
->
mada_mask
,

477 
TSC_APP_UNICAST_TABLE_ID_3
);

478 if(
tv
 !
OF_SUCCESS
)

480 
us
 = 
OF_FAILURE
;

484 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

485 
msg_n
,

487 &(
tsc_ms_p
->
_pt_id
),

488 
TSC_PKT_UNICAST_DHCP_UDP_67
,

489 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

490 
tsc_ms_p
->
mada
,

491 
tsc_ms_p
->
mada_mask
,

492 
TSC_APP_UNICAST_TABLE_ID_3
);

493 if(
tv
 !
OF_SUCCESS
)

495 
us
 = 
OF_FAILURE
;

499 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

500 
msg_n
,

502 &(
tsc_ms_p
->
_pt_id
),

503 
TSC_PKT_BROADCAST
,

504 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

505 
tsc_ms_p
->
mada
,

506 
tsc_ms_p
->
mada_mask
,

507 
TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
);

508 if(
tv
 !
OF_SUCCESS
)

510 
us
 = 
OF_FAILURE
;

514 if(
ow_mod_ݔi
 =
OFPFC_DELETE
)

516 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

517 
msg_n
,

518 &(
tsc_ms_p
->
_pt_id
),

519 
TSC_PKT_UNICAST


521 if(
tv
 !
OF_SUCCESS
)

523 
us
 = 
OF_FAILURE
;

527 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

528 
msg_n
,

529 &(
tsc_ms_p
->
_pt_id
),

530 
TSC_PKT_BROADCAST


532 if(
tv
 !
OF_SUCCESS
)

534 
us
 = 
OF_FAILURE
;

539 
us
 = 
OF_FAILURE
;

541 if(
us
 =
OF_FAILURE
)

545  
us
;

546 
	}
}

558 
t32_t
 
	$tsc_olug_v1_3_nd_ow_mod_assify_b_vmpts
(
ut64_t
 
dp_hd
,

559 
tsc_ofv_ug_i
* 
tsc_ms_p
,

560 
ut8_t
 
ow_mod_ݔi
)

562 
ut16_t
 
msg_n
;

563 
ut16_t
 
vn_id
,
vn_id_mask
;

564 
ut8_t
 
vn_mask_q
;

565 
t32_t
 
tv
;

566 
t32_t
 
us
 = 
OF_SUCCESS
;

567 
ut8_t
 
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

569 if(
tsc_ms_p
->
pkt_ig_e
 =
VM_PORT
)

573 
msg_n
 = 
FLMOD_MSG_LEN_VM_PORT_OF_1_3
;

575 
vn_id
 = 0x1000;

576 
vn_id_mask
 = 0x1000;

577 
vn_mask_q
 = 
TRUE
;

579 #ifde
TSC_L2_SERVICE_CHAINING_ENABLE


580 
xt_b_id
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

583 if(
ow_mod_ݔi
 =
OFPFC_ADD
)

585 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," vm܈id = %d ",
tsc_ms_p
->
_pt_id
);

586 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

587 
msg_n
,

589 &(
tsc_ms_p
->
_pt_id
),

590 
TSC_PKT_UNICAST
,

591 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

592 
tsc_ms_p
->
mada
,

593 
tsc_ms_p
->
mada_mask
,

594 
xt_b_id
);

596 if(
tv
 !
OF_SUCCESS
)

598 
us
 = 
OF_FAILURE
;

602 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," vm܈id = %d ",
tsc_ms_p
->
_pt_id
);

603 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," vm܈dhd = %x ",
dp_hd
);

605 
vn_id
 = 0x0000;

606 
vn_id_mask
 = 0x0000;

607 
vn_mask_q
 = 
FALSE
;

609 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

610 
msg_n
,

612 &(
tsc_ms_p
->
_pt_id
),

613 
TSC_PKT_UNICAST
,

614 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

615 
tsc_ms_p
->
mada
,

616 
tsc_ms_p
->
mada_mask
,

617 
xt_b_id
);

619 if(
tv
 !
OF_SUCCESS
)

621 
us
 = 
OF_FAILURE
;

625 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

626 
msg_n
,

628 &(
tsc_ms_p
->
_pt_id
),

629 
TSC_PKT_UNICAST_ARP
,

630 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

631 
tsc_ms_p
->
mada
,

632 
tsc_ms_p
->
mada_mask
,

633 
TSC_APP_UNICAST_TABLE_ID_3
);

634 if(
tv
 !
OF_SUCCESS
)

636 
us
 = 
OF_FAILURE
;

640 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," vm܈id = %d ",
tsc_ms_p
->
_pt_id
);

642 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

643 
msg_n
,

645 &(
tsc_ms_p
->
_pt_id
),

646 
TSC_PKT_UNICAST_DNS_UDP
,

647 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

648 
tsc_ms_p
->
mada
,

649 
tsc_ms_p
->
mada_mask
,

650 
TSC_APP_UNICAST_TABLE_ID_3
);

651 if(
tv
 !
OF_SUCCESS
)

653 
us
 = 
OF_FAILURE
;

658 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

659 
msg_n
,

661 &(
tsc_ms_p
->
_pt_id
),

662 
TSC_PKT_UNICAST_DHCP_UDP
,

663 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

664 
tsc_ms_p
->
mada
,

665 
tsc_ms_p
->
mada_mask
,

666 
TSC_APP_UNICAST_TABLE_ID_3
);

667 if(
tv
 !
OF_SUCCESS
)

669 
us
 = 
OF_FAILURE
;

673 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

674 
msg_n
,

676 &(
tsc_ms_p
->
_pt_id
),

677 
TSC_PKT_UNICAST_DHCP_UDP_67
,

678 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

679 
tsc_ms_p
->
mada
,

680 
tsc_ms_p
->
mada_mask
,

681 
TSC_APP_UNICAST_TABLE_ID_3
);

682 if(
tv
 !
OF_SUCCESS
)

684 
us
 = 
OF_FAILURE
;

688 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," vm܈id = %d ",
tsc_ms_p
->
_pt_id
);

690 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

691 
msg_n
,

693 &(
tsc_ms_p
->
_pt_id
),

694 
TSC_PKT_BROADCAST
,

695 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

696 
tsc_ms_p
->
mada
,

697 
tsc_ms_p
->
mada_mask
,

698 
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
);

699 if(
tv
 !
OF_SUCCESS
)

701 
us
 = 
OF_FAILURE
;

705 if(
ow_mod_ݔi
 =
OFPFC_DELETE
)

707 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

708 
msg_n
,

709 &(
tsc_ms_p
->
_pt_id
),

710 
TSC_PKT_UNICAST


712 if(
tv
 !
OF_SUCCESS
)

714 
us
 = 
OF_FAILURE
;

718 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

719 
msg_n
,

720 &(
tsc_ms_p
->
_pt_id
),

721 
TSC_PKT_BROADCAST


723 if(
tv
 !
OF_SUCCESS
)

725 
us
 = 
OF_FAILURE
;

730 
us
 = 
OF_FAILURE
;

733 if(
tsc_ms_p
->
pkt_ig_e
 =
VMNS_PORT
)

737 
msg_n
 = 
FLMOD_MSG_LEN_VM_NS_PORT_OF_1_3
;

739 
vn_id
 = 0x0000;

740 
vn_id_mask
 = 0x0000;

741 
vn_mask_q
 = 
FALSE
;

742 
xt_b_id
 = 
TSC_APP_UNICAST_TABLE_ID_3
;

744 if(
ow_mod_ݔi
 =
OFPFC_ADD
)

746 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

747 
msg_n
,

749 &(
tsc_ms_p
->
_pt_id
),

750 
TSC_PKT_UNICAST
,

751 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

752 
tsc_ms_p
->
mada
,

753 
tsc_ms_p
->
mada_mask
,

754 
xt_b_id
);

756 if(
tv
 !
OF_SUCCESS
)

758 
us
 = 
OF_FAILURE
;

763 
vn_id
 = 0x1000;

764 
vn_id_mask
 = 0x0000;

765 
vn_mask_q
 = 
FALSE
;

768 #ifde
TSC_L2_SERVICE_CHAINING_ENABLE


769 
xt_b_id
 = 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
;

772 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

773 
msg_n
,

775 &(
tsc_ms_p
->
_pt_id
),

776 
TSC_PKT_UNICAST_VMNS_NW
,

777 &(
tsc_ms_p
->
vn_id_out
),
vn_mask_q
,&
vn_id_mask
,

778 
tsc_ms_p
->
mada
,

779 
tsc_ms_p
->
mada_mask
,

780 
xt_b_id
);

781 if(
tv
 !
OF_SUCCESS
)

783 
us
 = 
OF_FAILURE
;

787 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

788 
msg_n
,

790 &(
tsc_ms_p
->
_pt_id
),

791 
TSC_PKT_UNICAST_VMNS_NW
,

792 &(
tsc_ms_p
->
vn_id_
),
vn_mask_q
,&
vn_id_mask
,

793 
tsc_ms_p
->
mada
,

794 
tsc_ms_p
->
mada_mask
,

795 
xt_b_id
);

796 if(
tv
 !
OF_SUCCESS
)

798 
us
 = 
OF_FAILURE
;

802 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

803 
msg_n
,

805 &(
tsc_ms_p
->
_pt_id
),

806 
TSC_PKT_UNICAST_ARP
,

807 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

808 
tsc_ms_p
->
mada
,

809 
tsc_ms_p
->
mada_mask
,

810 
TSC_APP_UNICAST_TABLE_ID_3
);

811 if(
tv
 !
OF_SUCCESS
)

813 
us
 = 
OF_FAILURE
;

817 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

818 
msg_n
,

820 &(
tsc_ms_p
->
_pt_id
),

821 
TSC_PKT_UNICAST_DNS_UDP
,

822 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

823 
tsc_ms_p
->
mada
,

824 
tsc_ms_p
->
mada_mask
,

825 
TSC_APP_UNICAST_TABLE_ID_3
);

826 if(
tv
 !
OF_SUCCESS
)

828 
us
 = 
OF_FAILURE
;

832 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

833 
msg_n
,

835 &(
tsc_ms_p
->
_pt_id
),

836 
TSC_PKT_UNICAST_DHCP_UDP
,

837 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

838 
tsc_ms_p
->
mada
,

839 
tsc_ms_p
->
mada_mask
,

840 
TSC_APP_UNICAST_TABLE_ID_3
);

841 if(
tv
 !
OF_SUCCESS
)

843 
us
 = 
OF_FAILURE
;

847 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

848 
msg_n
,

850 &(
tsc_ms_p
->
_pt_id
),

851 
TSC_PKT_UNICAST_DHCP_UDP_67
,

852 &
vn_id
,
vn_mask_q
,&
vn_id_mask
,

853 
tsc_ms_p
->
mada
,

854 
tsc_ms_p
->
mada_mask
,

855 
TSC_APP_UNICAST_TABLE_ID_3
);

856 if(
tv
 !
OF_SUCCESS
)

858 
us
 = 
OF_FAILURE
;

864 
tv
 = 
	`tsc_add_wmod_1_3_msg_b_0
(
dp_hd
,

865 
msg_n
,

867 &(
tsc_ms_p
->
_pt_id
),

868 
TSC_PKT_BROADCAST
,

869 &(
tsc_ms_p
->
vn_id_out
),
vn_mask_q
,&
vn_id_mask
,

870 
tsc_ms_p
->
mada
,

871 
tsc_ms_p
->
mada_mask
,

872 
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
);

873 if(
tv
 !
OF_SUCCESS
)

875 
us
 = 
OF_FAILURE
;

879 if(
ow_mod_ݔi
 =
OFPFC_DELETE
)

881 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

882 
msg_n
,

883 &(
tsc_ms_p
->
_pt_id
),

884 
TSC_PKT_UNICAST


886 if(
tv
 !
OF_SUCCESS
)

888 
us
 = 
OF_FAILURE
;

892 
tv
 = 
	`tsc_d_wmod_1_3_msg_b_0
(
dp_hd
,

893 
msg_n
,

894 &(
tsc_ms_p
->
_pt_id
),

895 
TSC_PKT_BROADCAST


897 if(
tv
 !
OF_SUCCESS
)

899 
us
 = 
OF_FAILURE
;

904 
us
 = 
OF_FAILURE
;

908 
us
 = 
OF_FAILURE
;

910 if(
us
 =
OF_FAILURE
)

914  
us
;

915 
	}
}

926 
t32_t
 
	$tsc_olug_v1_3_d_ows_om_b_4_5
(
ut64_t
 
dp_hd
,
tsc_ofv_ug_i
* 
tsc_ms_p
,
ut8_t
 
b_id
)

928 
of_msg
 *
msg
;

929 
ut16_t
 
ags
;

930 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

931 
ut16_t
 
mch_fd_n
 = 0,
msg_n
;

932 * 
cn_fo_p
;

933 
t32_t
 
tv
;

934 
t32_t
 
us
 = 
OF_SUCCESS
;

937 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

938 
OFU_META_DATA_FIELD_LEN
+

939 
OFU_ETH_TYPE_FIELD_LEN
+

940 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

941 
OFU_GOTO_TABLE_INSTRUCTION_LEN


946 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

947 if(
msg
 =
NULL
)

949 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

950 
us
 = 
OF_FAILURE
;

953 
ags
 = 0;

955 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

956 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

957 
dp_hd
,

958 
b_id
,

959 
ags
,

962 
OFPP_NONE
,

963 
OFPP_NONE
,

964 &
cn_fo_p
);

966 if(
tv
 =
OF_FAILURE
)

968 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 4 = %d",
tv
);

969 
us
 = 
OF_FAILURE
;

973 
	`ofu_t_g_mch_fld_vues
(
msg
);

978 
tv
 = 
	`of_t_ma_da
(
msg
,&(
tsc_ms_p
->
mada
),
TRUE
,&sc_ms_p->
mada_mask
));

979 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

981 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

982 
us
 = 
OF_FAILURE
;

987 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

990 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

991 if(
tv
 !
OF_SUCCESS
)

993 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D Flow Mod mesgtTab 4 = %d",
tv
);

994 
us
 = 
OF_FAILURE
;

997 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Sent Del Flow Mod messageo Table 4 successfully");

1000  
us
;

1001 
	}
}

1003 
t32_t
 
	$tsc_olug_v1_3_d_b_1_2_bd_ow_s
(
nscha_posy_y
* 
nscha_posy_node_p
,

1004 
ut8_t
 
b_id
)

1006 
of_msg
 *
msg
;

1007 
ut16_t
 
ags
;

1008 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1009 
ut16_t
 
mch_fd_n
 = 0,
msg_n
;

1010 * 
cn_fo_p
;

1011 
ut16_t
 
h_ty
 = 0x0800;

1012 
t32_t
 
tv
;

1013 
t32_t
 
us
 = 
OF_SUCCESS
;

1015 
msg_n
 = (
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

1016 
OFU_IN_PORT_FIELD_LEN
+

1017 
OFU_ETH_TYPE_FIELD_LEN
+

1018 
OFU_IPV4_SRC_MASK_LEN
+

1019 
OFU_IPV4_DST_MASK_LEN
+

1020 
OFU_IP_PROTO_FIELD_LEN
+

1021 
OFU_TCP_SRC_FIELD_LEN
+

1022 
OFU_TCP_DST_FIELD_LEN
+

1023 
OFU_OUTPUT_ACTION_LEN
+

1024 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

1025 
OFU_GOTO_TABLE_INSTRUCTION_LEN


1030 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1031 if(
msg
 =
NULL
)

1033 
	`tf
("\r\Faedخlomsg f d_ow_mod_msg f Tab = %d",
b_id
);

1034 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1035 
us
 = 
OF_FAILURE
;

1038 
ags
 = 0;

1039 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

1041 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

1042 
nscha_posy_node_p
->
dp_hd
,

1043 
b_id
,

1044 
ags
,

1047 
OFPP_NONE
,

1048 
OFPP_NONE
,

1049 &
cn_fo_p
);

1051 if(
tv
 =
OF_FAILURE
)

1053 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 1 o2 = %d",
tv
);

1054 
	`tf
("\r\Faed d_ow_y_msg f Tab = %d",
b_id
);

1055 
us
 = 
OF_FAILURE
;

1059 
	`ofu_t_g_mch_fld_vues
(
msg
);

1061 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

1062 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1064 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

1065 
us
 = 
OF_FAILURE
;

1070 
tv
 = 
	`of_t_v4_dei
(
msg
,&
nscha_posy_node_p
->

.
d_
,
FALSE
,0);

1071 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1073 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set destination ip match field");

1074 
us
 = 
OF_FAILURE
;

1078 
tv
 = 
	`of_t_v4_sour
(
msg
,&
nscha_posy_node_p
->

.
c_
,
FALSE
,0);

1079 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1081 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set source ip match field");

1082 
us
 = 
OF_FAILURE
;

1086 
tv
 = 
	`of_t_oc
(
msg
,&
nscha_posy_node_p
->

.
oc
);

1087 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1089 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

1090 
us
 = 
OF_FAILURE
;

1094 if(
nscha_posy_node_p
->

.
oc
 =
OF_IPPROTO_TCP
)

1096 
tv
 = 
	`of_t_t_sour_pt
(
msg
,&
nscha_posy_node_p
->

.
c_pt
);

1097 if(
tv
 =
OF_FAILURE
)

1099 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

1100 
us
 = 
OF_FAILURE
;

1103 
tv
 = 
	`of_t_t_dei_pt
(
msg
,&
nscha_posy_node_p
->

.
d_pt
);

1104 if(
tv
 =
OF_FAILURE
)

1106 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp destinationort match field ");

1107 
us
 = 
OF_FAILURE
;

1111 i(
nscha_posy_node_p
->

.
oc
 =
OF_IPPROTO_UDP
)

1113 
tv
 = 
	`of_t_udp_sour_pt
(
msg
,&
nscha_posy_node_p
->

.
c_pt
);

1114 if(
tv
 =
OF_FAILURE
)

1116 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

1117 
us
 = 
OF_FAILURE
;

1121 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
nscha_posy_node_p
->

.
d_pt
);

1122 if(
tv
 =
OF_FAILURE
)

1124 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

1125 
us
 = 
OF_FAILURE
;

1129 if(
nscha_posy_node_p
->

.
oc
 =
OF_IPPROTO_ICMP
)

1131 
tv
 = 
	`of_t_icmpv4_ty
(
msg
,&(
nscha_posy_node_p
->

.
icmp_ty
));

1132 if(
tv
 =
OF_FAILURE
)

1134 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmpype match field");

1135 
us
 = 
OF_FAILURE
;

1138 
tv
 = 
	`of_t_icmpv4_code
(
msg
,&(
nscha_posy_node_p
->

.
icmp_code
));

1139 if(
tv
 =
OF_FAILURE
)

1141 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmp code match field");

1142 
us
 = 
OF_FAILURE
;

1148 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

1150 
tv
 = 
	`of__nd_que_mesge
(
msg
,
nscha_posy_node_p
->
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1151 if(
tv
 !
OF_SUCCESS
)

1153 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D Flow Mod mesgtTab = %d",
b_id
);

1154 
	`tf
("\r\Faedأnd D Flow Mod mesgtTab = %d",
b_id
);

1155 
us
 = 
OF_FAILURE
;

1158 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," SD Flow Mod mesgtTab sucssfuy = %d",
b_id
);

1162  
us
;

1163 
	}
}

1174 
t32_t
 
	$tsc_olug_v1_3_d_ows_om_b_1_2
(
ut64_t
 
dp_hd
,
ut32_t
 *
pt_id_p
,
ut8_t
 
b_id
)

1176 
of_msg
 *
msg
;

1177 
ut16_t
 
ags
;

1178 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1179 
ut16_t
 
mch_fd_n
 = 0,
msg_n
;

1180 * 
cn_fo_p
;

1181 
t32_t
 
tv
;

1182 
t32_t
 
us
 = 
OF_SUCCESS
;

1184 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

1185 
OFU_IN_PORT_FIELD_LEN
+

1186 
OFU_ETH_TYPE_FIELD_LEN
+

1187 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

1188 
OFU_GOTO_TABLE_INSTRUCTION_LEN


1193 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1194 if(
msg
 =
NULL
)

1196 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1197 
us
 = 
OF_FAILURE
;

1200 
ags
 = 0;

1202 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

1203 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

1204 
dp_hd
,

1205 
b_id
,

1206 
ags
,

1209 
OFPP_NONE
,

1210 
OFPP_NONE
,

1211 &
cn_fo_p
);

1213 if(
tv
 =
OF_FAILURE
)

1215 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 1 o2 = %d",
tv
);

1216 
us
 = 
OF_FAILURE
;

1220 
	`ofu_t_g_mch_fld_vues
(
msg
);

1222 
tv
 = 
	`of_t__pt
(
msg
,
pt_id_p
);

1223 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1225 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S܈mch fld faed,%d",
tv
);

1226 
us
 = 
OF_FAILURE
;

1231 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

1235 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ab_1_2t_id = %x",*
pt_id_p
);

1237 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ab_1_2 dp_hd = %x",
dp_hd
);

1238 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1239 if(
tv
 !
OF_SUCCESS
)

1241 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D Flow Mod mesgtTab = %d",
b_id
);

1242 
us
 = 
OF_FAILURE
;

1245 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," SD Flow Mod mesgtTab sucssfuy = %d",
b_id
);

1248  
us
;

1249 
	}
}

1260 
t32_t
 
	$tsc_olug_v1_3_d_ows_om_b_3
(
ut64_t
 
dp_hd
,
ut8_t
 *
pt_maddr
)

1262 
of_msg
 *
msg
;

1263 
ut16_t
 
ags
;

1264 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1265 
ut16_t
 
mch_fd_n
 = 0,
msg_n
;

1266 * 
cn_fo_p
;

1267 
t32_t
 
tv
;

1268 
t32_t
 
us
 = 
OF_SUCCESS
;

1269 
ut8_t
 
ii
;

1271 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

1272 
OFU_META_DATA_FIELD_LEN
+

1273 
OFU_ETH_TYPE_FIELD_LEN
+

1274 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

1275 
OFU_GOTO_TABLE_INSTRUCTION_LEN


1279 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1280 if(
msg
 =
NULL
)

1282 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1283 
us
 = 
OF_FAILURE
;

1286 
ags
 = 0;

1288 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

1289 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

1290 
dp_hd
,

1291 
TSC_APP_UNICAST_TABLE_ID_3
,

1292 
ags
,

1295 
OFPP_NONE
,

1296 
OFPP_NONE
,

1297 &
cn_fo_p
);

1299 if(
tv
 =
OF_FAILURE
)

1301 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 3 = %d",
tv
);

1302 
us
 = 
OF_FAILURE
;

1306 
	`ofu_t_g_mch_fld_vues
(
msg
);

1308 
tv
 = 
	`of_t_dei_mac
(
msg
,
pt_maddr
,
FALSE
,0);

1309 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1311 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S Dei mafld faed,%d",
tv
);

1312 
us
 = 
OF_FAILURE
;

1317 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

1319 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Sending Del Flow Mod messageo Table 3");

1321 
ii
=0;ii<6;ii++)

1323 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ab_3 MAC Adds%x",
pt_maddr
[
ii
]);

1326 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ab_3 dp_hd = %x",
dp_hd
);

1329 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1330 if(
tv
 !
OF_SUCCESS
)

1332 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D Flow Mod mesgtTab 3 = %d",
tv
);

1333 
us
 = 
OF_FAILURE
;

1336 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Sent Del Flow Mod messageo Table 3 successfully.");

1340  
us
;

1341 
	}
}

1345 
t32_t
 
	$tsc_d_owmod_1_3_l_ows__a_b
(
ut64_t
 
dp_hd
,
ut8_t
 
b_id
)

1347 
of_msg
 *
msg
;

1348 
ut16_t
 
ags
,
msg_n
;

1349 * 
cn_fo_p
;

1350 
t32_t
 
tv
;

1351 
t32_t
 
us
 = 
OF_SUCCESS
;

1355 
msg_n
 = (
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

1356 
OFU_META_DATA_FIELD_LEN
+

1357 
OFU_ETH_TYPE_FIELD_LEN
+

1358 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

1359 
OFU_GOTO_TABLE_INSTRUCTION_LEN


1362 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1363 if(
msg
 =
NULL
)

1365 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1366 
us
 = 
OF_FAILURE
;

1370 
ags
 = 0;

1372 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

1373 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

1374 
dp_hd
,

1375 
b_id
,

1376 
ags
,

1379 
OFPP_NONE
,

1380 
OFPP_NONE
,

1381 &
cn_fo_p
);

1383 if(
tv
 =
OF_FAILURE
)

1385 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 0 = %d",
tv
);

1386 
us
 = 
OF_FAILURE
;

1391 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1392 if(
tv
 !
OF_SUCCESS
)

1394 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D A FlowMod mesgtTab = %d",
b_id
);

1395 
us
 = 
OF_FAILURE
;

1398 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," SD A Flow Mod mesgtTab = %d",
b_id
);

1401  
us
;

1402 
	}
}

1413 
t32_t
 
	$tsc_d_wmod_1_3_msg_b_0
(
ut64_t
 
dp_hd
,

1414 
ut16_t
 
msg_n
,

1415 
ut32_t
 *
put_pt_id_p
,

1416 
ut8_t
 
pkt_ty


1419 
of_msg
 *
msg
;

1420 
ut16_t
 
ags
;

1421 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1422 
ut16_t
 
mch_fd_n
 = 0;

1423 * 
cn_fo_p
;

1424 
t32_t
 
tv
;

1425 
t32_t
 
us
 = 
OF_SUCCESS
;

1429 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1430 if(
msg
 =
NULL
)

1432 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1433 
us
 = 
OF_FAILURE
;

1436 
ags
 = 0;

1438 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

1439 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,

1440 
dp_hd
,

1441 
TSC_APP_CLASSIFY_TABLE_ID_0
,

1442 
ags
,

1445 
OFPP_NONE
,

1446 
OFPP_NONE
,

1447 &
cn_fo_p
);

1449 if(
tv
 =
OF_FAILURE
)

1451 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E dg flowry ib 0 = %d",
tv
);

1452 
us
 = 
OF_FAILURE
;

1456 
	`ofu_t_g_mch_fld_vues
(
msg
);

1460 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"ow mod d -܈id i%d",*
put_pt_id_p
);

1462 
tv
 = 
	`of_t__pt
(
msg
,
put_pt_id_p
);

1463 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1465 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S ip܈fld faed,%d",
tv
);

1466 
us
 = 
OF_FAILURE
;

1470 if(
pkt_ty
 =
TSC_PKT_UNICAST
)

1473 
tv
 = 
	`of_t_dei_mac
(
msg
,
u_mac_addr_chk
,
TRUE
,
u_mac_mask
);

1478 
tv
 = 
	`of_t_dei_mac
(
msg
,
b_mac_addr_chk
,
TRUE
,
b_mac_mask
);

1481 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1483 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S Dei mafld faed,%d",
tv
);

1484 
us
 = 
OF_FAILURE
;

1489 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

1492 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1493 if(
tv
 !
OF_SUCCESS
)

1495 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 0 = %d",
tv
);

1496 
us
 = 
OF_FAILURE
;

1499 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Sent Del Flow Mod messageo Table 0 successfully.")

1503  
us
;

1504 
	}
}

1516 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_0
(
ut64_t
 
dp_hd
,

1517 
ut16_t
 
msg_n
,

1518 
ut16_t
 
ow_iܙy
,

1519 
ut32_t
 *
put_pt_id_p
,

1520 
ut8_t
 
pkt_ty
,

1521 
ut16_t
 *
vn_id_p
,

1522 
ut8_t
 
vn_mask_q
,

1523 
ut16_t
 *
vn_id_mask_p
,

1524 
ut64_t
 
mada
,

1525 
ut64_t
 
mada_mask
,

1526 
ut8_t
 
go_b_id


1530 
ut16_t
 
ht_ty
;

1532 
of_msg
 *
msg
;

1533 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1534 
ut8_t
* 
_t_loc_p
 = 
NULL
;

1535 
ut16_t
 
mch_fd_n
 = 0;

1536 
ut16_t
 
rui_n
;

1537 *
cn_fo_p
;

1538 
ut64_t
 
tu_id
;

1539 
ut8_t
 
nwpt_ty
;

1540 
t32_t
 
tv
;

1541 
t32_t
 
us
 = 
OF_SUCCESS
;

1543 
ut16_t
 
h_ty
 = 0x0800;

1544 
ut8_t
 
oc_udp
;

1545 
ut16_t
 
dnt
,
dhpt
;

1549 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1550 if(
msg
 =
NULL
)

1552 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1553 
us
 = 
OF_FAILURE
;

1557 
ags
 = 0;

1558 
ags
 |
OFPFF_RESET_COUNTS
;

1561 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

1562 
TSC_APP_CLASSIFY_TABLE_ID_0
,

1563 
ow_iܙy
,

1564 
OFPFC_ADD
,

1567 
OFP_NO_BUFFER
,

1568 
ags
,

1571 &
cn_fo_p


1574 if(
tv
 =
OF_FAILURE
)

1576 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg flowry ib 0 = %d",
tv
);

1577 
us
 = 
OF_FAILURE
;

1581 
	`ofu_t_g_mch_fld_vues
(
msg
);

1585 
tv
 = 
	`of_t__pt
(
msg
,
put_pt_id_p
);

1586 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1588 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S ip܈fld faed,%d",
tv
);

1589 
us
 = 
OF_FAILURE
;

1593 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pt_id = %d",*
put_pt_id_p
);

1594 if((
pkt_ty
 =
TSC_PKT_UNICAST
|| (pkt_ty =
TSC_PKT_UNICAST_VMNS_NW
) ||

1595 (
pkt_ty
 =
TSC_PKT_UNICAST_ARP
|| (pkt_ty =
TSC_PKT_UNICAST_DNS_UDP
) ||

1596 (
pkt_ty
 =
TSC_PKT_UNICAST_DHCP_UDP
)|| (pkt_ty =
TSC_PKT_UNICAST_DHCP_UDP_67
))

1598 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"NSSM");

1600 
tv
 = 
	`of_t_dei_mac
(
msg
,
u_mac_addr_chk
,
TRUE
,
u_mac_mask
);

1605 
tv
 = 
	`of_t_dei_mac
(
msg
,
b_mac_addr_chk
,
TRUE
,
b_mac_mask
);

1608 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1610 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S Dei mafld faed,%d",
tv
);

1611 
us
 = 
OF_FAILURE
;

1617 if(
pkt_ty
 =
TSC_PKT_UNICAST_VMNS_NW
&& (*
vn_id_p
 != 0))

1619 *
vn_id_p
 = (*vlan_id_p | 0x1000);

1621 
	`of_t_vn_id
(
msg
,
vn_id_p
,
FALSE
,0 );

1622 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1624 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S vid fld faed,%d",
tv
);

1625 
us
 = 
OF_FAILURE
;

1630 if(
pkt_ty
 =
TSC_PKT_UNICAST_ARP
)

1632 
ht_ty
 = 0x806;

1633 
tv
 = 
	`of_t_h_ty
(
msg
,&
ht_ty
);

1635 if(
tv
 =
OF_FAILURE
)

1637 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo settherype match field ");

1638 
us
 = 
OF_FAILURE
;

1642 if(
pkt_ty
 =
TSC_PKT_UNICAST_DNS_UDP
)

1644 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

1645 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1647 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

1648 
us
 = 
OF_FAILURE
;

1651 
oc_udp
 = 
OF_IPPROTO_UDP
;

1653 
tv
 = 
	`of_t_oc
(
msg
,&
oc_udp
);

1654 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1656 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

1657 
us
 = 
OF_FAILURE
;

1660 
dnt
 = 53;

1661 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
dnt
);

1662 if(
tv
 =
OF_FAILURE
)

1664 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

1665 
us
 = 
OF_FAILURE
;

1670 if(
pkt_ty
 =
TSC_PKT_UNICAST_DHCP_UDP
)

1672 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

1673 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1675 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

1676 
us
 = 
OF_FAILURE
;

1679 
oc_udp
 = 
OF_IPPROTO_UDP
;

1681 
tv
 = 
	`of_t_oc
(
msg
,&
oc_udp
);

1682 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1684 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

1685 
us
 = 
OF_FAILURE
;

1688 
dhpt
 = 68;

1689 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
dhpt
);

1690 if(
tv
 =
OF_FAILURE
)

1692 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

1693 
us
 = 
OF_FAILURE
;

1698 if(
pkt_ty
 =
TSC_PKT_UNICAST_DHCP_UDP_67
)

1700 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

1701 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1703 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

1704 
us
 = 
OF_FAILURE
;

1707 
oc_udp
 = 
OF_IPPROTO_UDP
;

1709 
tv
 = 
	`of_t_oc
(
msg
,&
oc_udp
);

1710 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1712 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

1713 
us
 = 
OF_FAILURE
;

1716 
dhpt
 = 67;

1717 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
dhpt
);

1718 if(
tv
 =
OF_FAILURE
)

1720 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

1721 
us
 = 
OF_FAILURE
;

1728 
nwpt_ty
 = ((
mada
 >> 
PKT_ORIGIN_OFFSET
) & 0x0f);

1730 if((
nwpt_ty
 =
NW_UNICAST_PORT
|| (nwpt_ty =
NW_BROADCAST_PORT
))

1732 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"pt_id = %d",*
put_pt_id_p
);

1733 
tu_id
 = (
mada
 & 0xffffffff);

1735 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Tu-ID = %lx",
tu_id
);

1736 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"nwpt_ty = %d",
nwpt_ty
);

1738 
tv
 = 
	`of_t_logil_pt_ma_da
(
msg
,&
tu_id
,
FALSE
,0);

1740 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1742 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF Su id fld faed,%d",
tv
);

1743 
us
 = 
OF_FAILURE
;

1749 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

1750 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

1752 
tv
 = 
	`ofu_push_wre_ma_da_rui
(
msg
,
mada
,
mada_mask
);

1753 i(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

1755 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF wrmdrui faed,%d",
tv
);

1756 
us
 = 
OF_FAILURE
;

1761 
tv
 = 
	`ofu_push_go_to_b_rui
(
msg
,
go_b_id
);

1762 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

1764 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"gt؏b inrui faed = %d",
tv
);

1765 
us
 = 
OF_FAILURE
;

1768 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

1770 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

1771 if(
tv
 !
OF_SUCCESS
)

1773 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 0 = %d",
tv
);

1774 
us
 = 
OF_FAILURE
;

1777 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Sent Flow Mod messageo Table 0 successfully.")

1780 if(
us
 =
OF_FAILURE
)

1782 if(
msg
 !
NULL
)

1783 
msg
->
desc
.
	`_cbk
(msg);

1786  
us
;

1787 
	}
}

1789 
t32_t


1790 
	$tsc_olug_v1_3_b_0_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

1791 
ut64_t
 
doma_hd
,

1792 
ut64_t
 
dh_hd
,

1793 
of_msg
 *
msg
,

1794 
o_ck_
 *
pkt_
,

1795 * 
cbk_g1
,

1796 * 
cbk_g2
)

1798  
OF_SUCCESS
;

1799 
	}
}

1802 
t32_t


1803 
	$tsc_olug_v1_3_b_1_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

1804 
ut64_t
 
doma_hd
,

1805 
ut64_t
 
dh_hd
,

1806 
of_msg
 *
msg
,

1807 
o_ck_
 *
pkt_
,

1808 * 
cbk_g1
,

1809 * 
cbk_g2
)

1811 
ut32_t
 
_pt_id
;

1812 
ut64_t
 
mada
;

1814 
t32_t
 
tv
;

1815 
t32_t
 
us
 = 
OF_SUCCESS
;

1817 
	`tf
("\r\nT1-MP");

1818 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Table_1 missacketeceived");

1823 
tv
 = 
	`ofu_g__pt_fld
(
msg
,(*)
pkt_
->
mch_flds
,

1824 
pkt_
->
mch_flds_ngth
,

1825 &
_pt_id


1828 if(
tv
 !
OFU_IN_PORT_FIELD_PRESENT
)

1830 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg i܈",
__FUNCTION__
,
_pt_id
);

1831 
us
 = 
OF_FAILURE
;

1834 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN IN PORT =%d",
_pt_id
);

1837 
tv
 = 
	`ofu_g_mada_fld
(
msg
,(*)
pkt_
->
mch_flds
,

1838 
pkt_
->
mch_flds_ngth
,

1839 &
mada


1842 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

1844 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"failedo get metadata");

1845 
us
 = 
OF_FAILURE
;

1848 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA =%x",
mada
);

1850 
tv
 = 
	`tsc_outbound_ns_cha_b_1_miss_y_pkt_rcvd
(
dh_hd
,

1851 
pkt_
,

1852 
_pt_id
,

1853 
mada
);

1854 if(
tv
 =
OF_FAILURE
)

1856 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:b 1rossg faed ",
__FUNCTION__
);

1857 
us
 = 
OF_FAILURE
;

1862 if(
us
 =
OF_FAILURE
)

1864 if(
msg
 !
NULL
)

1865 
msg
->
desc
.
	`_cbk
(msg);

1866  
OF_ASYNC_MSG_CONSUMED
;

1869  
us
;

1870 
	}
}

1871 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_1
(
ut64_t
 
dp_hd
,

1872 
nscha_posy_y
* 
out_bound_nscha_posy_y_p


1875 
of_msg
 *
msg
;

1876 
ut16_t
 
msg_n
;

1877 
ut8_t
* 
ai_t_loc
 = 
NULL
;

1878 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

1879 
ut8_t
* 
_t_loc_p
 = 
NULL
;

1880 
ut16_t
 
mch_fd_n
 = 0;

1881 
ut16_t
 
ai_n
;

1882 
ut16_t
 
rui_n
;

1883 * 
cn_fo_p
;

1884 
ut64_t
 
tu_id
;

1885 
t32_t
 
tv
;

1886 
ut8_t
 
ii
;

1887 
t32_t
 
us
 = 
OF_SUCCESS
;

1888 
ut16_t
 
h_ty
 = 0x0800;

1892 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

1893 
OFU_IN_PORT_FIELD_LEN
+

1894 
OFU_META_DATA_FIELD_LEN
+

1895 
OFU_VLAN_VID_FIELD_LEN
+

1896 
OFU_ARP_OP_FIELD_LEN
+

1897 
OFU_ETH_TYPE_FIELD_LEN
+

1898 
OFU_IPV4_SRC_MASK_LEN
+

1899 
OFU_IPV4_DST_MASK_LEN
+

1900 
OFU_IP_PROTO_FIELD_LEN
+

1901 
OFU_TCP_SRC_FIELD_LEN
+

1902 
OFU_TCP_DST_FIELD_LEN
+

1903 
OFU_SET_FIELD_WITH_TUNNEL_ID_FIELD_ACTION_LEN
+

1904 
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN
+

1905 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

1906 
OFU_POP_VLAN_HEADER_ACTION_LEN
+

1907 
OFU_PUSH_VLAN_HEADER_ACTION_LEN
+

1908 
OFU_OUTPUT_ACTION_LEN
+

1909 
OFU_GOTO_TABLE_INSTRUCTION_LEN


1915 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," msg_%d",
msg_n
);

1917 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

1918 if(
msg
 =
NULL
)

1920 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

1921 
tv
 = 
OF_FAILURE
;

1925 
ags
 = 0;

1926 
ags
 |
OFPFF_RESET_COUNTS
;

1927 
ags
 |
OFPFF_SEND_FLOW_REM
;

1930 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

1931 
TSC_APP_OUTBOUND_NS_CHAIN_TABLE_ID_1
,

1932 
out_bound_nscha_posy_y_p
->
ow_mod_iܙy
,

1933 
OFPFC_ADD
,

1934 
out_bound_nscha_posy_y_p
->
_n
,

1936 
OFP_NO_BUFFER
,

1937 
ags
,

1940 &
cn_fo_p


1942 if(
tv
 =
OF_FAILURE
)

1944 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg flowry ib 1 = %d",
tv
);

1945 
us
 = 
OF_FAILURE
;

1949 
	`ofu_t_g_mch_fld_vues
(
msg
);

1952 
tv
 = 
	`of_t__pt
(
msg
,&(
out_bound_nscha_posy_y_p
->
_pt_id
));

1954 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1956 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S ip܈fld faed,%d",
tv
);

1957 
us
 = 
OF_FAILURE
;

1962 
tv
 = 
	`of_t_ma_da
(
msg
,&(
out_bound_nscha_posy_y_p
->
mada
),
TRUE
,

1963 &(
out_bound_nscha_posy_y_p
->
mada_mask
));

1965 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1967 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

1968 
us
 = 
OF_FAILURE
;

1973 if(
out_bound_nscha_posy_y_p
->
mch_vn_id
 != 0)

1976 
out_bound_nscha_posy_y_p
->
mch_vn_id
 = ((out_bound_nschain_repository_entry_p->match_vlan_id) | 0x1000);

1978 
tv
 = 
	`of_t_vn_id
(
msg
,&(
out_bound_nscha_posy_y_p
->
mch_vn_id
),
FALSE
,0);

1980 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1982 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S vid fld faed,%d",
tv
);

1983 
us
 = 
OF_FAILURE
;

1989 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

1991 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

1993 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

1994 
us
 = 
OF_FAILURE
;

1999 
tv
 = 
	`of_t_v4_dei
(
msg
,&
out_bound_nscha_posy_y_p
->

.
d_
,
FALSE
,0);

2001 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2003 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set destination ip match field");

2004 
us
 = 
OF_FAILURE
;

2009 
tv
 = 
	`of_t_v4_sour
(
msg
,&
out_bound_nscha_posy_y_p
->

.
c_
,
FALSE
,0);

2011 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2013 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set source ip match field");

2014 
us
 = 
OF_FAILURE
;

2019 
tv
 = 
	`of_t_oc
(
msg
,&
out_bound_nscha_posy_y_p
->

.
oc
);

2021 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2023 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

2024 
us
 = 
OF_FAILURE
;

2028 if(
out_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_TCP
)

2030 
tv
 = 
	`of_t_t_sour_pt
(
msg
,&
out_bound_nscha_posy_y_p
->

.
c_pt
);

2032 if(
tv
 =
OF_FAILURE
)

2034 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

2035 
us
 = 
OF_FAILURE
;

2039 
tv
 = 
	`of_t_t_dei_pt
(
msg
,&
out_bound_nscha_posy_y_p
->

.
d_pt
);

2041 if(
tv
 =
OF_FAILURE
)

2043 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp destinationort match field ");

2044 
us
 = 
OF_FAILURE
;

2049 i(
out_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_UDP
)

2051 
tv
 = 
	`of_t_udp_sour_pt
(
msg
,&
out_bound_nscha_posy_y_p
->

.
c_pt
);

2053 if(
tv
 =
OF_FAILURE
)

2055 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

2056 
us
 = 
OF_FAILURE
;

2061 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
out_bound_nscha_posy_y_p
->

.
d_pt
);

2063 if(
tv
 =
OF_FAILURE
)

2065 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

2066 
us
 = 
OF_FAILURE
;

2071 if(
out_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_ICMP
)

2073 
tv
 = 
	`of_t_icmpv4_ty
(
msg
,&(
out_bound_nscha_posy_y_p
->

.
icmp_ty
));

2075 if(
tv
 =
OF_FAILURE
)

2077 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmpype match field");

2078 
us
 = 
OF_FAILURE
;

2083 
tv
 = 
	`of_t_icmpv4_code
(
msg
,&(
out_bound_nscha_posy_y_p
->

.
icmp_code
));

2085 if(
tv
 =
OF_FAILURE
)

2087 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmp code match field");

2088 
us
 = 
OF_FAILURE
;

2095 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

2097 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

2099 if(
out_bound_nscha_posy_y_p
->
ns_cha_b
 =
TRUE
)

2101 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

2102 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

2104 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

2105 
us
 = 
OF_FAILURE
;

2109 if(
out_bound_nscha_posy_y_p
->
cy_lol_mac_addss_b
 =
TRUE
)

2111 
ii
=0;ii<6;ii++)

2113 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
out_bound_nscha_posy_y_p
->
lol_out_mac
[
ii
]);

2114 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"lol_ma%x",
out_bound_nscha_posy_y_p
->
lol__mac
[
ii
]);

2116 
tv
 = 
	`ofu_push_t_dei_mac__t_fld_ai
(
msg
, (&
out_bound_nscha_posy_y_p
->
lol_out_mac
[0]));

2118 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2120 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"E igodei maadds%d",
tv
);

2121 
us
 = 
OF_FAILURE
;

2126 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Setocal destination macddress");

2128 
tv
 = 
	`ofu_push_t_sour_mac__t_fld_ai
(
msg
, &
out_bound_nscha_posy_y_p
->
lol__mac
[0]);

2130 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2132 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E igosour maadds%d",
tv
);

2133 
us
 = 
OF_FAILURE
;

2138 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Setocal source macddress");

2141 if(
out_bound_nscha_posy_y_p
->
cy_ig_mac_addss_b
 =
TRUE
)

2143 
tv
 = 
	`ofu_push_t_dei_mac__t_fld_ai
(
msg
, &
out_bound_nscha_posy_y_p
->

.
d_mac
[0]);

2145 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2147 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig orig dei maadds%d",
tv
);

2148 
us
 = 
OF_FAILURE
;

2152 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Set original destination macddress");

2154 
tv
 = 
	`ofu_push_t_sour_mac__t_fld_ai
(
msg
, &
out_bound_nscha_posy_y_p
->

.
c_mac
[0]);

2156 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2158 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig orig sour maadds%d",
tv
);

2159 
us
 = 
OF_FAILURE
;

2163 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Set original source macddress");

2167 if(
out_bound_nscha_posy_y_p
->
me_nf_b
 =
TRUE
)

2169 if(
out_bound_nscha_posy_y_p
->
pkt_ig
 =
VM_NS
)

2171 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," Packet origin is VM_NS");

2173 
tv
 = 
	`ofu_push_p_vn_hd_ai
(
msg
);

2175 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2177 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ip v%d",
tv
);

2178 
us
 = 
OF_FAILURE
;

2183 
tv
 = 
	`ofu_push_push_vn_hd_ai
(
msg
,0x8100);

2185 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2187 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ipush vhd = %d",
tv
);

2188 
us
 = 
OF_FAILURE
;

2192 
out_bound_nscha_posy_y_p
->
xt_vn_id
 = ((out_bound_nschain_repository_entry_p->next_vlan_id) | 0x1000);

2194 
tv
 = 
	`ofu_push_t_vn_id__t_fld_ai
(
msg
,&(
out_bound_nscha_posy_y_p
->
xt_vn_id
));

2196 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2198 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ipush vg = %d",
tv
);

2199 
us
 = 
OF_FAILURE
;

2204 if(
out_bound_nscha_posy_y_p
->
nw_pt_b
 =
TRUE
)

2206 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Addgude itow:tun_de i%x",
out_bound_nscha_posy_y_p
->
me_swch_
);

2207 
tv
 = 
	`ofu_push_t_v4_tun_d_addr__t_fld_ai
(
msg
,&(
out_bound_nscha_posy_y_p
->
me_swch_
));

2209 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2211 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig TuDe IP = %d",
tv
);

2212 
us
 = 
OF_FAILURE
;

2217 
tu_id
 = (
out_bound_nscha_posy_y_p
->
mada
 & 0xffffffff);

2218 
tv
 = 
	`ofu_push_t_logil_pt_ma_da__t_fld_ai
(
msg
,&
tu_id
 );

2220 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2222 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iguid = %d",
tv
);

2223 
us
 = 
OF_FAILURE
;

2229 if((
out_bound_nscha_posy_y_p
->
ns_cha_b
 =
TRUE
&& (out_bound_nscha_posy_y_p->
me_nf_b
 =
FALSE
 ))

2231 if(
out_bound_nscha_posy_y_p
->
pkt_ig
 =
VM_NS
)

2233 
tv
 = 
	`ofu_push_p_vn_hd_ai
(
msg
);

2235 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2237 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ip v%d",
tv
);

2238 
us
 = 
OF_FAILURE
;

2245 if((
out_bound_nscha_posy_y_p
->
me_nf_b
 =
TRUE
|| (out_bound_nscha_posy_y_p->
ns_pt_b
 == TRUE))

2247 
	`ofu_push_ouut_ai
(
msg
,
out_bound_nscha_posy_y_p
->
out_pt_no
,
OFPCML_NO_BUFFER
);

2250 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2252 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg ouutp܈aiڃ = %d",
tv
);

2253 
us
 = 
OF_FAILURE
;

2259 if(
out_bound_nscha_posy_y_p
->
ns_cha_b
 =
TRUE
)

2261 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

2262 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

2266 if((
out_bound_nscha_posy_y_p
->
me_nf_b
 =
FALSE
&& (out_bound_nscha_posy_y_p->
ns_pt_b
 == FALSE))

2268 
tv
 = 
	`ofu_push_go_to_b_rui
(
msg
,
out_bound_nscha_posy_y_p
->
xt_b_id
);

2270 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

2272 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"gt؏b inrui faed = %d",
tv
);

2273 
us
 = 
OF_FAILURE
;

2280 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

2283 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

2284 if(
tv
 !
OF_SUCCESS
)

2286 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 1 = %d",
tv
);

2287 
us
 = 
OF_FAILURE
;

2292 if(
us
 =
OF_FAILURE
)

2294 if(
msg
 !
NULL
)

2295 
msg
->
desc
.
	`_cbk
(msg);

2298  
us
;

2299 
	}
}

2302 
t32_t


2303 
	$tsc_olug_v1_3_b_2_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

2304 
ut64_t
 
doma_hd
,

2305 
ut64_t
 
dh_hd
,

2306 
of_msg
 *
msg
,

2307 
o_ck_
 *
pkt_
,

2308 * 
cbk_g1
,

2309 * 
cbk_g2
)

2311 
ut32_t
 
_pt_id
;

2312 
ut64_t
 
mada
;

2314 
t32_t
 
tv
;

2315 
t32_t
 
us
 = 
OF_SUCCESS
;

2317 
	`tf
("\r\nT2-MP");

2322 
tv
 = 
	`ofu_g__pt_fld
(
msg
, 
pkt_
->
mch_flds
,

2323 
pkt_
->
mch_flds_ngth
,

2324 &
_pt_id


2327 if(
tv
 !
OFU_IN_PORT_FIELD_PRESENT
)

2329 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg i܈",
__FUNCTION__
,
_pt_id
);

2330 
us
 = 
OF_FAILURE
;

2333 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN IN PORT =%d",
_pt_id
);

2336 
tv
 = 
	`ofu_g_mada_fld
(
msg
, 
pkt_
->
mch_flds
,

2337 
pkt_
->
mch_flds_ngth
,

2338 &
mada


2341 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

2343 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg mad",
__FUNCTION__
,
mada
);

2344 
us
 = 
OF_FAILURE
;

2347 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA = %x",
mada
);

2349 
tv
 = 
	`tsc_bound_ns_cha_b_2_miss_y_pkt_rcvd
(
dh_hd
,
pkt_
,
_pt_id
,
mada
);

2350 if(
tv
 =
OF_FAILURE
)

2352 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"table 2rocessing failed ");

2353 
us
 = 
OF_FAILURE
;

2358 if(
us
 =
OF_FAILURE
)

2360 if(
msg
 !
NULL
)

2361 
msg
->
desc
.
	`_cbk
(msg);

2362  
OF_ASYNC_MSG_CONSUMED
;

2365  
us
;

2366 
	}
}

2368 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_2
(
ut64_t
 
dp_hd
,

2369 
nscha_posy_y
* 
_bound_nscha_posy_y_p


2372 
of_msg
 *
msg
;

2373 
ut16_t
 
msg_n
;

2375 
ut8_t
* 
ai_t_loc
 = 
NULL
;

2376 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

2377 
ut8_t
* 
_t_loc_p
 = 
NULL
;

2378 
ut16_t
 
mch_fd_n
 = 0;

2379 
ut16_t
 
ai_n
;

2380 
ut16_t
 
rui_n
;

2381 * 
cn_fo_p
;

2382 
ut64_t
 
tu_id
;

2383 
t32_t
 
tv
;

2384 
t32_t
 
us
 = 
OF_SUCCESS
;

2386 
ut16_t
 
h_ty
 = 0x0800;

2390 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

2391 
OFU_IN_PORT_FIELD_LEN
+

2392 
OFU_META_DATA_FIELD_LEN
+

2393 
OFU_VLAN_VID_FIELD_LEN
+

2394 
OFU_ETH_TYPE_FIELD_LEN
+

2395 
OFU_IPV4_SRC_MASK_LEN
+

2396 
OFU_IPV4_DST_MASK_LEN
+

2397 
OFU_IP_PROTO_FIELD_LEN
+

2398 
OFU_TCP_SRC_FIELD_LEN
+

2399 
OFU_TCP_DST_FIELD_LEN
+

2400 
OFU_TCP_DST_FIELD_LEN
+

2401 
OFU_TCP_DST_FIELD_LEN
+

2402 
OFU_TCP_DST_FIELD_LEN
+

2403 
OFU_TCP_DST_FIELD_LEN
+

2404 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

2405 
OFU_POP_VLAN_HEADER_ACTION_LEN
+

2406 
OFU_PUSH_VLAN_HEADER_ACTION_LEN
+

2407 
OFU_OUTPUT_ACTION_LEN
+

2408 
OFU_GOTO_TABLE_INSTRUCTION_LEN


2412 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"ow_mod_iܙy = %d",
_bound_nscha_posy_y_p
->
ow_mod_iܙy
);

2414 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

2415 if(
msg
 =
NULL
)

2417 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

2418 
tv
 = 
OF_FAILURE
;

2422 
ags
 = 0;

2423 
ags
 |
OFPFF_RESET_COUNTS
;

2425 
ags
 |
OFPFF_SEND_FLOW_REM
;

2427 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

2428 
TSC_APP_INBOUND_NS_CHAIN_TABLE_ID_2
,

2429 
_bound_nscha_posy_y_p
->
ow_mod_iܙy
,

2430 
OFPFC_ADD
,

2431 
_bound_nscha_posy_y_p
->
_n
,

2433 
OFP_NO_BUFFER
,

2434 
ags
,

2437 &
cn_fo_p


2439 if(
tv
 =
OF_FAILURE
)

2441 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg flowry ib 2 = %d",
tv
);

2442 
us
 = 
OF_FAILURE
;

2446 
	`ofu_t_g_mch_fld_vues
(
msg
);

2449 
tv
 = 
	`of_t__pt
(
msg
,&(
_bound_nscha_posy_y_p
->
_pt_id
));

2451 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2453 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S ip܈fld faed,%d",
tv
);

2454 
us
 = 
OF_FAILURE
;

2460 
tv
 = 
	`of_t_ma_da
(
msg
,&(
_bound_nscha_posy_y_p
->
mada
),
TRUE
,

2461 &(
_bound_nscha_posy_y_p
->
mada_mask
));

2463 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2465 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

2466 
us
 = 
OF_FAILURE
;

2471 if(
_bound_nscha_posy_y_p
->
mch_vn_id
 != 0)

2474 
_bound_nscha_posy_y_p
->
mch_vn_id
 = (in_bound_nschain_repository_entry_p->match_vlan_id) | 0x1000;

2476 
tv
 = 
	`of_t_vn_id
(
msg
,&(
_bound_nscha_posy_y_p
->
mch_vn_id
),
FALSE
,0);

2478 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2480 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S vid fld faed,%d",
tv
);

2481 
us
 = 
OF_FAILURE
;

2487 
tv
 = 
	`of_t_h_ty
(
msg
,&
h_ty
);

2489 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2491 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S IPv4 srfld faed,%d",
tv
);

2492 
us
 = 
OF_FAILURE
;

2498 
tv
 = 
	`of_t_v4_dei
(
msg
,&
_bound_nscha_posy_y_p
->

.
d_
,
FALSE
,0);

2500 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2502 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set destination ip match field");

2503 
us
 = 
OF_FAILURE
;

2508 
tv
 = 
	`of_t_v4_sour
(
msg
,&
_bound_nscha_posy_y_p
->

.
c_
,
FALSE
,0);

2510 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2512 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set source ip match field");

2513 
us
 = 
OF_FAILURE
;

2518 
tv
 = 
	`of_t_oc
(
msg
,&
_bound_nscha_posy_y_p
->

.
oc
);

2520 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2522 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set iprotocol match field ");

2523 
us
 = 
OF_FAILURE
;

2528 if(
_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_TCP
)

2530 
tv
 = 
	`of_t_t_sour_pt
(
msg
,&
_bound_nscha_posy_y_p
->

.
c_pt
);

2532 if(
tv
 =
OF_FAILURE
)

2534 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

2535 
us
 = 
OF_FAILURE
;

2539 
tv
 = 
	`of_t_t_dei_pt
(
msg
,&
_bound_nscha_posy_y_p
->

.
d_pt
);

2541 if(
tv
 =
OF_FAILURE
)

2543 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp destinationort match field ");

2544 
us
 = 
OF_FAILURE
;

2549 if(
_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_UDP
)

2551 
tv
 = 
	`of_t_udp_sour_pt
(
msg
,&
_bound_nscha_posy_y_p
->

.
c_pt
);

2553 if(
tv
 =
OF_FAILURE
)

2555 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo setcp sourceort match field ");

2556 
us
 = 
OF_FAILURE
;

2561 
tv
 = 
	`of_t_udp_dei_pt
(
msg
,&
_bound_nscha_posy_y_p
->

.
d_pt
);

2563 if(
tv
 =
OF_FAILURE
)

2565 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set udp destinationort match field ");

2566 
us
 = 
OF_FAILURE
;

2571 if(
_bound_nscha_posy_y_p
->

.
oc
 =
OF_IPPROTO_ICMP
)

2573 
tv
 = 
	`of_t_icmpv4_ty
(
msg
,&(
_bound_nscha_posy_y_p
->

.
icmp_ty
));

2575 if(
tv
 =
OF_FAILURE
)

2577 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmpype match field");

2578 
us
 = 
OF_FAILURE
;

2582 
tv
 = 
	`of_t_icmpv4_code
(
msg
,&(
_bound_nscha_posy_y_p
->

.
icmp_code
));

2584 if(
tv
 =
OF_FAILURE
)

2586 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Failedo set icmp code match field");

2587 
us
 = 
OF_FAILURE
;

2594 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

2596 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

2598 if(
_bound_nscha_posy_y_p
->
ns_cha_b
 =
TRUE
)

2600 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

2601 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

2603 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

2604 
us
 = 
OF_FAILURE
;

2608 if(
_bound_nscha_posy_y_p
->
cy_lol_mac_addss_b
 =
TRUE
)

2610 
tv
 = 
	`ofu_push_t_dei_mac__t_fld_ai
(
msg
, &
_bound_nscha_posy_y_p
->
lol_out_mac
[0]);

2612 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2614 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"E igodei maadds%d",
tv
);

2615 
us
 = 
OF_FAILURE
;

2619 
tv
 = 
	`ofu_push_t_sour_mac__t_fld_ai
(
msg
, &
_bound_nscha_posy_y_p
->
lol__mac
[0]);

2621 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2623 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E igosour maadds%d",
tv
);

2624 
us
 = 
OF_FAILURE
;

2630 if(
_bound_nscha_posy_y_p
->
cy_ig_mac_addss_b
 =
TRUE
)

2632 
tv
 = 
	`ofu_push_t_dei_mac__t_fld_ai
(
msg
, &
_bound_nscha_posy_y_p
->

.
d_mac
[0]);

2634 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2636 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig orig dei maadds%d",
tv
);

2637 
us
 = 
OF_FAILURE
;

2641 
tv
 = 
	`ofu_push_t_sour_mac__t_fld_ai
(
msg
, &
_bound_nscha_posy_y_p
->

.
c_mac
[0]);

2643 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2645 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig orig sour maadds%d",
tv
);

2646 
us
 = 
OF_FAILURE
;

2653 if(
_bound_nscha_posy_y_p
->
me_nf_b
 =
TRUE
)

2655 if(
_bound_nscha_posy_y_p
->
nw_pt_b
 =
TRUE
)

2657 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Addgude itow:tun_de i%x",
_bound_nscha_posy_y_p
->
me_swch_
);

2658 
tv
 = 
	`ofu_push_t_v4_tun_d_addr__t_fld_ai
(
msg
,&(
_bound_nscha_posy_y_p
->
me_swch_
));

2660 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2662 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig TuDe IP = %d",
tv
);

2663 
us
 = 
OF_FAILURE
;

2668 
tu_id
 = (
_bound_nscha_posy_y_p
->
mada
 & 0xffffffff);

2669 
tv
 = 
	`ofu_push_t_logil_pt_ma_da__t_fld_ai
(
msg
,&
tu_id
 );

2671 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2673 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iguid = %d",
tv
);

2674 
us
 = 
OF_FAILURE
;

2680 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,
_bound_nscha_posy_y_p
->
out_pt_no
,
OFPCML_NO_BUFFER
);

2682 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2684 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg ouutp܈aiڃ = %d",
tv
);

2685 
us
 = 
OF_FAILURE
;

2691 if(
_bound_nscha_posy_y_p
->
ns_cha_b
 =
TRUE
)

2693 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

2694 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

2697 if(
_bound_nscha_posy_y_p
->
me_nf_b
 =
FALSE
)

2702 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Table 2 No service chainingequired.");

2704 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Tab_idأndhck = %d",
_bound_nscha_posy_y_p
->
xt_b_id
);

2706 
tv
 = 
	`ofu_push_go_to_b_rui
(
msg
,
_bound_nscha_posy_y_p
->
xt_b_id
);

2708 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

2710 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"gt؏b inrui faed = %d",
tv
);

2711 
us
 = 
OF_FAILURE
;

2717 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

2720 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

2721 if(
tv
 !
OF_SUCCESS
)

2723 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 2 = %d",
tv
);

2724 
us
 = 
OF_FAILURE
;

2729 if(
us
 =
OF_FAILURE
)

2731 if(
msg
 !
NULL
)

2732 
msg
->
desc
.
	`_cbk
(msg);

2734  
us
;

2735 
	}
}

2738 
t32_t


2739 
	$tsc_olug_v1_3_b_3_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

2740 
ut64_t
 
doma_hd
,

2741 
ut64_t
 
dh_hd
,

2742 
of_msg
 *
msg
,

2743 
o_ck_
 *
pkt_
,

2744 * 
cbk_g1
,

2745 * 
cbk_g2
)

2747 
ut32_t
 
_pt_id
;

2748 
ut64_t
 
mada
;

2749 
ut32_t
 
tun_c_
 = 0;

2751 
t32_t
 
tv
;

2752 
t32_t
 
us
 = 
OF_SUCCESS
;

2754 
	`tf
("\r\nT3_MP");

2755 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Table_3 Missacket iseceived");

2760 
tv
 = 
	`ofu_g__pt_fld
(
msg
, 
pkt_
->
mch_flds
,

2761 
pkt_
->
mch_flds_ngth
,

2762 &
_pt_id


2765 if(
tv
 !
OFU_IN_PORT_FIELD_PRESENT
)

2767 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg i܈",
__FUNCTION__
,
_pt_id
);

2768 
us
 = 
OF_FAILURE
;

2771 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN IN PORT =%d",
_pt_id
);

2774 
tv
 = 
	`ofu_g_mada_fld
(
msg
, 
pkt_
->
mch_flds
,

2775 
pkt_
->
mch_flds_ngth
,

2776 &
mada


2779 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

2781 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg mad",
__FUNCTION__
,
mada
);

2782 
us
 = 
OF_FAILURE
;

2785 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA =%x",
mada
);

2787 
tv
 = 
	`tsc_uni_b_3_miss_y_pkt_rcvd
(
dh_hd
,
pkt_
,
mada
,
_pt_id
,
tun_c_
);

2788 if(
tv
 =
OF_FAILURE
)

2790 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table 3rocessing failed ");

2791 
us
 = 
OF_FAILURE
;

2796 if(
us
 =
OF_FAILURE
)

2798 if(
msg
 !
NULL
)

2799 
msg
->
desc
.
	`_cbk
(msg);

2800  
OF_ASYNC_MSG_CONSUMED
;

2803  
us
;

2804 
	}
}

2806 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_3
(
ut64_t
 
dp_hd
,

2807 
upkt_out_posy_y
* 
upkt_out_posy_y_p


2810 
of_msg
 *
msg
;

2811 
ut16_t
 
msg_n
;

2813 
ut8_t
* 
ai_t_loc
 = 
NULL
;

2814 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

2815 
ut8_t
* 
_t_loc_p
 = 
NULL
;

2816 
ut16_t
 
mch_fd_n
 = 0;

2817 
ut16_t
 
ai_n
;

2818 
ut16_t
 
rui_n
;

2819 * 
cn_fo_p
;

2820 
t32_t
 
tv
;

2821 
t32_t
 
us
 = 
OF_SUCCESS
;

2825 
msg_n
 = (
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

2826 
OFU_META_DATA_MASK_LEN
+

2827 
OFU_ETH_TYPE_FIELD_LEN
+

2828 
OFU_ETH_DST_MAC_ADDR_FIELD_LEN
+

2829 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

2830 
OFU_OUTPUT_ACTION_LEN
+

2831 
OFU_SET_FIELD_WITH_TUNNEL_ID_FIELD_ACTION_LEN
+

2832 
OFU_SET_FIELD_WITH_IPV4_DST_FIELD_ACTION_LEN


2835 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

2836 if(
msg
 =
NULL
)

2838 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

2839 
us
 = 
OF_FAILURE
;

2840 
	`tf
("\r\n TABLE_3 OF messagellocrror");

2844 
	`memt
(
msg
->
desc
.
t_of_da
,0,msg->desc.
bufr_n
);

2846 
ags
 = 0;

2847 
ags
 |
OFPFF_RESET_COUNTS
;

2848 
ags
 |
OFPFF_SEND_FLOW_REM
;

2851 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

2852 
TSC_APP_UNICAST_TABLE_ID_3
,

2853 
upkt_out_posy_y_p
->
iܙy
,

2854 
OFPFC_ADD
,

2855 
upkt_out_posy_y_p
->
_n
,

2857 
OFP_NO_BUFFER
,

2858 
ags
,

2860 
upkt_out_posy_y_p
->
id_time
,

2861 &
cn_fo_p


2863 if(
tv
 =
OF_FAILURE
)

2865 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg flowry ib 3 = %d",
tv
);

2866 
us
 = 
OF_FAILURE
;

2867 
	`tf
("\r\n TABLE_3 Error in of_create_add_flow_entry_msg");

2871 
	`ofu_t_g_mch_fld_vues
(
msg
);

2874 
tv
 = 
	`of_t_ma_da
(
msg
,&(
upkt_out_posy_y_p
->
mada
),
TRUE
,

2875 &(
upkt_out_posy_y_p
->
mada_mask
));

2877 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2879 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

2880 
us
 = 
OF_FAILURE
;

2886 
tv
 = 
	`of_t_dei_mac
(
msg
,
upkt_out_posy_y_p
->
d_mac
,
FALSE
,
NULL
);

2888 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

2890 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S Dei mafld faed,%d",
tv
);

2891 
us
 = 
OF_FAILURE
;

2897 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

2899 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

2901 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

2902 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

2904 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

2905 
us
 = 
OF_FAILURE
;

2909 if(
upkt_out_posy_y_p
->
nw_pt_b
 =
TRUE
)

2911 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_DEBUG
,"Addgude itow:tun_de i%x",
upkt_out_posy_y_p
->
tun_de_
);

2912 
tv
 = 
	`ofu_push_t_v4_tun_d_addr__t_fld_ai
(
msg
,

2913 &(
upkt_out_posy_y_p
->
tun_de_
));

2915 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2917 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E ig TuDe IP = %d",
tv
);

2918 
us
 = 
OF_FAILURE
;

2923 
tv
 = 
	`ofu_push_t_logil_pt_ma_da__t_fld_ai
(
msg
,

2924 &(
upkt_out_posy_y_p
->
tun_id
));

2926 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2928 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iguid = %d",
tv
);

2929 
us
 = 
OF_FAILURE
;

2935 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Tab 3܈n%d",
upkt_out_posy_y_p
->
out_pt_no
);

2936 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,
upkt_out_posy_y_p
->
out_pt_no
,
OFPCML_NO_BUFFER
);

2938 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

2940 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg ouutp܈aiڃ = %d",
tv
);

2941 
us
 = 
OF_FAILURE
;

2946 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

2947 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

2948 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

2950 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

2951 if(
tv
 !
OF_SUCCESS
)

2953 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 3 = %d",
tv
);

2954 
us
 = 
OF_FAILURE
;

2955 
	`tf
("\r\n TABLE_3 Error Sending Flow Mod messageo Table 3");

2960 if(
us
 =
OF_FAILURE
)

2962 if(
msg
 !
NULL
)

2963 
msg
->
desc
.
	`_cbk
(msg);

2966  
us
;

2967 
	}
}

2969 
t32_t
 
	$tsc_nd_pktout_1_3_msg
(
ut64_t
 
dh_hd
,
ut32_t
 
_pt
,
o_ck_
 *
pkt_
)

2971 
ut8_t
* 
ai_t_loc
=
NULL
;

2972 
ut16_t
 
ai_n
;

2973 
ut16_t
 
msg_n
;

2974 
of_msg
 *
msg
;

2975 
ut8_t
* 
pkt_da
 = 
pkt_
->
ck
;

2976 * 
cn_fo_p
;

2980 
t32_t
 
tv
;

2981 
t32_t
 
us
 = 
OF_SUCCESS
;

2983 
msg_n
 = (
OFU_PACKET_OUT_MESSAGE_LEN
+16+
OFU_OUTPUT_ACTION_LEN
+
pkt_
->
ck_ngth
);

2987 
msg
 = 
	`ofu_loc_mesge
(
OFPT_PACKET_OUT
, 
msg_n
);

2989 if(
msg
 =
NULL
)

2991 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:%d OF mesglor \r\n",
__FUNCTION__
,
__LINE__
);

2992 
us
 = 
OF_FAILURE
;

2996 
tv
 = 
	`of_ame_pktout_msg
(
msg
,
dh_hd
,
TRUE
,
OFP_NO_BUFFER
,

2997 
_pt
,0,&
cn_fo_p
);

2999 if(
tv
 !
OF_SUCCESS
)

3001 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," Error in framingkt out");

3002 
us
 = 
OF_FAILURE
;

3005 
	`ofu_t_pushg_ais
(
msg
);

3007 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,
OFPP_TABLE
,
OFPCML_NO_BUFFER
);

3009 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

3011 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:%d Error indding outputctionrr = %d\r\n",

3012 
__FUNCTION__
,
__LINE__
,
tv
);

3013 
us
 = 
OF_FAILURE
;

3017 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

3018 ((
o_ck_out
*)(
msg
->
desc
.
t_of_da
))->
ais_n
=
	`hts
(
ai_n
);

3020 
tv
 = 
	`of_add_da_to_pkt_d_nd_to_dp
(
msg
,
dh_hd
,
cn_fo_p
,

3021 
pkt_
->
ck_ngth
,
pkt_da
,
NULL
,NULL);

3022 if(
tv
 !
OF_SUCCESS
)

3024 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E indgack = %d",
tv
);

3025 
us
 = 
OF_FAILURE
;

3030 if((
us
 =
OF_FAILURE
&& (
msg
 !
NULL
))

3031 
msg
->
desc
.
	`_cbk
(msg);

3033  
us
;

3034 
	}
}

3036 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_4
(
ut64_t
 
dp_hd
,

3037 
vmpts_posy_y
* 
vmpts_posy_y_p
,

3038 
nwpts_brd_posy_y
* 
nwpts_brd_posy_y_p


3041 
of_msg
 *
msg
;

3042 
ut16_t
 
msg_n
;

3044 
ut8_t
* 
ai_t_loc
 = 
NULL
;

3045 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

3046 
ut8_t
* 
_t_loc_p
 = 
NULL
;

3047 
ut16_t
 
mch_fd_n
 = 0;

3048 
ut8_t
 
no_of_pts
;

3049 
ut16_t
 
ai_n
;

3050 
ut16_t
 
rui_n
;

3051 
ut8_t
 
b_4_y_iܙy
 = 1;

3052 *
cn_fo_p
;

3053 
ut64_t
 
tun_id
;

3055 
t32_t
 
tv
;

3056 
t32_t
 
us
 = 
OF_SUCCESS
;

3060 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

3061 
OFU_META_DATA_MASK_LEN
+

3062 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

3063 
OFU_SET_FIELD_WITH_TUNNEL_ID_FIELD_ACTION_LEN
+

3064 ((
OFU_OUTPUT_ACTION_LEN
* (
vmpts_posy_y_p
->
no_of_vmside_pts
))+

3065 ((
OFU_OUTPUT_ACTION_LEN
* (
nwpts_brd_posy_y_p
->
no_of_nwside_br_pts
))

3068 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

3069 if(
msg
 =
NULL
)

3071 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

3072 
us
 = 
OF_FAILURE
;

3076 
ags
 = 0;

3077 
ags
 |
OFPFF_RESET_COUNTS
;

3080 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

3081 
TSC_APP_BROADCAST_OUTBOUND_TABLE_ID_4
,

3082 
b_4_y_iܙy
,

3083 
OFPFC_ADD
,

3086 
OFP_NO_BUFFER
,

3087 
ags
,

3090 &
cn_fo_p


3092 if(
tv
 =
OF_FAILURE
)

3094 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg flowry ib 4 = %d",
tv
);

3095 
us
 = 
OF_FAILURE
;

3099 
	`ofu_t_g_mch_fld_vues
(
msg
);

3102 
tv
 = 
	`of_t_ma_da
(
msg
,&(
nwpts_brd_posy_y_p
->
mada
),
TRUE
,

3103 &(
nwpts_brd_posy_y_p
->
mada_mask
));

3104 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

3106 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

3107 
us
 = 
OF_FAILURE
;

3112 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

3114 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

3116 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

3117 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

3119 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

3120 
us
 = 
OF_FAILURE
;

3124 
tun_id
 = (
nwpts_brd_posy_y_p
->
mada
 & 0xffffffff);

3125 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Tab 4un_id = %x",
tun_id
);

3127 
tv
 = 
	`ofu_push_t_logil_pt_ma_da__t_fld_ai
(
msg
,&
tun_id
);

3128 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

3130 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E igab 4uid = %d",
tv
);

3131 
us
 = 
OF_FAILURE
;

3135 
no_of_pts
 = 0;o_of_pt< (
vmpts_posy_y_p
->
no_of_vmside_pts
));no_of_ports++)

3137 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,

3138 
vmpts_posy_y_p
->
vmside_pts_p
[
no_of_pts
],
OFPCML_NO_BUFFER
);

3139 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

3141 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E܇ddg ouutlop܈aiڃ = %d",
tv
);

3142 
us
 = 
OF_FAILURE
;

3147 
no_of_pts
 = 0;o_of_pt< (
nwpts_brd_posy_y_p
->
no_of_nwside_br_pts
));

3148 
no_of_pts
++)

3150 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,

3151 
nwpts_brd_posy_y_p
->
nwside_br_pts_p
[
no_of_pts
],
OFPCML_NO_BUFFER
);

3152 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

3154 
	`OF_LOG_MSG
(
OF_LOG_TSC
,
OF_LOG_ERROR
," E iaddg ouutnw bp܈aiڃ = %d",
tv
);

3155 
us
 = 
OF_FAILURE
;

3160 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

3161 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

3162 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

3164 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

3165 if(
tv
 !
OF_SUCCESS
)

3167 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 4 = %d",
tv
);

3168 
us
 = 
OF_FAILURE
;

3173 if(
us
 =
OF_FAILURE
)

3175 if(
msg
 !
NULL
)

3176 
msg
->
desc
.
	`_cbk
(msg);

3179  
us
;

3180 
	}
}

3182 
t32_t


3183 
	$tsc_olug_v1_3_b_4_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

3184 
ut64_t
 
doma_hd
,

3185 
ut64_t
 
dh_hd
,

3186 
of_msg
 *
msg
,

3187 
o_ck_
 *
pkt_
,

3188 * 
cbk_g1
,

3189 * 
cbk_g2
)

3191 
ut32_t
 
_pt_id
;

3192 
ut64_t
 
mada
;

3194 
t32_t
 
tv
;

3195 
t32_t
 
us
 = 
OF_SUCCESS
;

3197 
	`tf
("\r\nT4-MP");

3202 
tv
 = 
	`ofu_g__pt_fld
(
msg
, 
pkt_
->
mch_flds
,

3203 
pkt_
->
mch_flds_ngth
,

3204 &
_pt_id


3207 if(
tv
 !
OFU_IN_PORT_FIELD_PRESENT
)

3209 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg i܈",
__FUNCTION__
,
_pt_id
);

3210 
us
 = 
OF_FAILURE
;

3213 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN IN PORT =%d",
_pt_id
);

3216 
tv
 = 
	`ofu_g_mada_fld
(
msg
,
pkt_
->
mch_flds
,

3217 
pkt_
->
mch_flds_ngth
,

3218 &
mada


3221 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

3223 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg mad",
__FUNCTION__
);

3224 
us
 = 
OF_FAILURE
;

3227 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA2 =%x",
mada
);

3229 
tv
 = 
	`tsc_brd_outbound_b_4_miss_y_pkt_rcvd
(
dh_hd
,
pkt_
,
mada
,
_pt_id
);

3230 if(
tv
 =
OF_FAILURE
)

3232 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:b 4rossg faed ",
__FUNCTION__
);

3233 
us
 = 
OF_FAILURE
;

3238 if(
us
 =
OF_FAILURE
)

3240 if(
msg
 !
NULL
)

3241 
msg
->
desc
.
	`_cbk
(msg);

3242  
OF_ASYNC_MSG_CONSUMED
;

3245  
us
;

3246 
	}
}

3248 
t32_t
 
	$tsc_add_wmod_1_3_msg_b_5
(
ut64_t
 
dp_hd
,

3249 
vmpts_posy_y
* 
vmpts_posy_y_p


3252 
of_msg
 *
msg
;

3253 
ut16_t
 
msg_n
;

3255 
ut8_t
* 
ai_t_loc
 = 
NULL
;

3256 
ut8_t
* 
mch_t_loc_p
 = 
NULL
;

3257 
ut8_t
* 
_t_loc_p
 = 
NULL
;

3258 
ut16_t
 
mch_fd_n
 = 0;

3259 
ut8_t
 
no_of_pts
;

3260 
ut16_t
 
ai_n
;

3261 
ut16_t
 
rui_n
;

3262 
ut8_t
 
b_5_y_iܙy
 = 1;

3263 * 
cn_fo_p
;

3265 
t32_t
 
tv
;

3266 
t32_t
 
us
 = 
OF_SUCCESS
;

3270 
msg_n
 = ( 
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16+

3271 
OFU_META_DATA_MASK_LEN
+

3272 
OFU_APPLY_ACTION_INSTRUCTION_LEN
+

3273 (
OFU_OUTPUT_ACTION_LEN
 * 
vmpts_posy_y_p
->
no_of_vmside_pts
)

3276 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

3277 if(
msg
 =
NULL
)

3279 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror - Table 5 ");

3280 
us
 = 
OF_FAILURE
;

3284 
ags
 = 0;

3285 
ags
 |
OFPFF_RESET_COUNTS
;

3288 
tv
 = 
	`of__add_ow_y_msg
(
msg
,
dp_hd
,

3289 
TSC_APP_BROADCAST_INBOUND_TABLE_ID_5
,

3290 
b_5_y_iܙy
,

3291 
OFPFC_ADD
,

3294 
OFP_NO_BUFFER
,

3295 
ags
,

3298 &
cn_fo_p


3300 if(
tv
 =
OF_FAILURE
)

3302 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E itg flowry -ab 5 = %d",
tv
);

3303 
us
 = 
OF_FAILURE
;

3307 
	`ofu_t_g_mch_fld_vues
(
msg
);

3310 
tv
 = 
	`of_t_ma_da
(
msg
,&(
vmpts_posy_y_p
->
mada
),
TRUE
,

3311 &(
vmpts_posy_y_p
->
mada_mask
));

3313 if(
tv
 !
OFU_SET_FIELD_SUCCESS
)

3315 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF S iMadfld faed,%d",
tv
);

3316 
us
 = 
OF_FAILURE
;

3321 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc_p
,&
mch_fd_n
);

3323 
	`ofu_t_pushg_ruis
(
msg
,
mch_fd_n
);

3325 
tv
 = 
	`ofu_t_pushg_y_ai_rui
(
msg
);

3326 if(
tv
 !
OFU_INSTRUCTION_PUSH_SUCCESS
)

3328 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddglyi inruiڃ = %d",
tv
);

3329 
us
 = 
OF_FAILURE
;

3333 
no_of_pts
 = 0;o_of_pt< (
vmpts_posy_y_p
->
no_of_vmside_pts
));o_of_ports++)

3335 
tv
 = 
	`ofu_push_ouut_ai
(
msg
,
vmpts_posy_y_p
->
vmside_pts_p
[
no_of_pts
],
OFPCML_NO_BUFFER
);

3336 if(
tv
 !
OFU_ACTION_PUSH_SUCCESS
)

3338 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E iaddg ouutp܈aiڃ = %d",
tv
);

3339 
us
 = 
OF_FAILURE
;

3343 
	`ofu_d_pushg_ais
(
msg
,
ai_t_loc
,&
ai_n
);

3344 ((
o_rui_ais
*)(
msg
->
desc
.
r2
))->
n
 = 
	`hts
(
ai_n
);

3346 
	`ofu_d_pushg_ruis
(
msg
,
_t_loc_p
,&
rui_n
);

3348 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dp_hd
,
cn_fo_p
,
NULL
,NULL);

3349 if(
tv
 !
OF_SUCCESS
)

3351 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg Flow Mod mesgtTab 5 = %d",
tv
);

3352 
us
 = 
OF_FAILURE
;

3356 if(
us
 =
OF_FAILURE
)

3358 if(
msg
 !
NULL
)

3359 
msg
->
desc
.
	`_cbk
(msg);

3362  
us
;

3363 
	}
}

3365 
t32_t


3366 
	$tsc_olug_v1_3_b_5_miss_y_pkt_rcvd
(
t64_t
 
cڌr_hd
,

3367 
ut64_t
 
doma_hd
,

3368 
ut64_t
 
dh_hd
,

3369 
of_msg
 *
msg
,

3370 
o_ck_
 *
pkt_
,

3371 * 
cbk_g1
,

3372 * 
cbk_g2
)

3374 
ut32_t
 
_pt_id
;

3375 
ut64_t
 
mada
;

3376 
ut8_t
 
nw_ty
;

3377 
ut32_t
 
tun_c_
;

3379 
t32_t
 
tv
;

3380 
t32_t
 
us
 = 
OF_SUCCESS
;

3385 
tv
 = 
	`ofu_g__pt_fld
(
msg
, 
pkt_
->
mch_flds
,

3386 
pkt_
->
mch_flds_ngth
,

3387 &
_pt_id


3390 if(
tv
 !
OFU_IN_PORT_FIELD_PRESENT
)

3392 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg i܈",
__FUNCTION__
,
_pt_id
);

3393 
us
 = 
OF_FAILURE
;

3396 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN IN PORT =%d",
_pt_id
);

3399 
tv
 = 
	`ofu_g_mada_fld
(
msg
,

3400 (*)
pkt_
->
mch_flds
,

3401 
pkt_
->
mch_flds_ngth
,&
mada
);

3403 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

3405 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:edg mad",
__FUNCTION__
,
mada
);

3406 
us
 = 
OF_FAILURE
;

3409 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " PKT-IN METADATA =%x",
mada
);

3411 
nw_ty
 = (
ut8_t
((
mada
 >> 
NW_TYPE_OFFSET
) & 0x0f));

3413 if(
nw_ty
 =
VXLAN_TYPE
)

3416 
tv
 = 
	`ofu_g_tun_c_fld
(
msg
, 
pkt_
->
mch_flds
,

3417 
pkt_
->
mch_flds_ngth
, &
tun_c_
);

3418 if(
tv
 !
OFU_TUN_SRC_FIELD_PRESENT
)

3420 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:failedo getunnel source ip");

3421 
us
 = 
OF_FAILURE
;

3424 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Tu Sour IP = %x",
tun_c_
);

3427 
tv
 = 
	`tsc_brd_bound_b_5_miss_y_pkt_rcvd
(
dh_hd
,
pkt_
,
mada
,
_pt_id
,
tun_c_
);

3428 if(
tv
 =
OF_FAILURE
)

3430 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"%s:b 5rossg faed ",
__FUNCTION__
);

3431 
us
 = 
OF_FAILURE
;

3436 if(
us
 =
OF_FAILURE
)

3438 if(
msg
 !
NULL
)

3439 
msg
->
desc
.
	`_cbk
(msg);

3440  
OF_ASYNC_MSG_CONSUMED
;

3443  
us
;

3444 
	}
}

3446 
t32_t
 
	$tsc_olug_v1_3_nscha_b_1_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

3447 
ut64_t
 
doma_hd
,

3448 
ut64_t
 
dp_hd
,

3449 
of_msg
 *
msg
,

3450 
o_ow_moved
 *
ow
,

3451 * 
cbk_g1
,

3452 * 
cbk_g2
)

3454 
ut64_t
 
mada
;

3455 
t32_t
 
tv
;

3457 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_1 flowemovedventeceived");

3458 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"owemoved mesgived f܁ab = %x",
ow
->
b_id
);

3459 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"owemoved mesgcook = %x",
ow
->
cook
);

3462 
tv
 = 
	`ofu_g_mada_fld
(
msg
,
ow
->
mch_flds
,ow->
mch_fld_n
,&
mada
);

3464 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

3466 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"failedo get metadata");

3467  
OF_FAILURE
;

3469 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mad%x",
mada
);

3471 
	`tsc_ow_y_mov_msg_cvd_nscha_bs
(
dp_hd
,
mada
,

3472 
ow
->
cook
,ow->
as
,ow->
b_id
);

3473  
OF_SUCCESS
;

3474 
	}
}

3476 
t32_t
 
	$tsc_olug_v1_3_nscha_b_2_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

3477 
ut64_t
 
doma_hd
,

3478 
ut64_t
 
dp_hd
,

3479 
of_msg
 *
msg
,

3480 
o_ow_moved
 *
ow
,

3481 * 
cbk_g1
,

3482 * 
cbk_g2
)

3484 
ut64_t
 
mada
;

3485 
t32_t
 
tv
;

3487 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"table_2 flowemovedventeceived");

3488 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"owemoved mesgived f܁ab = %x",
ow
->
b_id
);

3489 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"owemoved mesgcook = %x",
ow
->
cook
);

3492 
tv
 = 
	`ofu_g_mada_fld
(
msg
,
ow
->
mch_flds
,ow->
mch_fld_n
,&
mada
);

3494 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

3496 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"failedo get metadata");

3497  
OF_FAILURE
;

3499 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mad%x",
mada
);

3501 
	`tsc_ow_y_mov_msg_cvd_nscha_bs
(
dp_hd
,
mada
,

3502 
ow
->
cook
,ow->
as
,ow->
b_id
);

3503  
OF_SUCCESS
;

3504 
	}
}

3506 
t32_t
 
	$tsc_olug_v1_3_fc_b_ow_y_moved_rcvd
(
t64_t
 
cڌr_hd
,

3507 
ut64_t
 
doma_hd
,

3508 
ut64_t
 
dp_hd
,

3509 
of_msg
 *
msg
,

3510 
o_ow_moved
 *
ow
,

3511 * 
cbk_g1
,

3512 * 
cbk_g2
)

3514 
t32_t
 
tv
;

3515 
ut64_t
 
mada
;

3517 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"flowemovedventeceived forforable_3 ");

3518 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"owemoved mesgived f܁ab = %x",
ow
->
b_id
);

3521 
tv
 = 
	`ofu_g_mada_fld
(
msg
,
ow
->
mch_flds
,ow->
mch_fld_n
,&
mada
);

3523 if(
tv
 !
OFU_IN_META_DATA_PRESENT
)

3525 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"failedo get metadata");

3526  
OF_FAILURE
;

3528 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"mad%x",
mada
);

3530 
	`tsc_ow_y_mov_msg_cvd_b_3
(
dp_hd
,
mada
,

3531 
ow
->
cook
,ow->
as
);

3533  
OF_SUCCESS
;

3534 
	}
}

3535 
t32_t


3536 
	$tsc_olug_v1_3_dp_dach_evt
(
ut64_t
 
cڌr_hd
,

3537 
ut64_t
 
doma_hd
,

3538 
ut64_t
 
dh_hd
,

3539 *
cbk_g1
,

3540 *
cbk_g2
)

3542 
ut8_t
 
b_id
;

3543 
dm_dh_y
 *
pdh_fo
;

3544 
t32_t
 
us
 = 
OF_SUCCESS
;

3548 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"DATA PATH DETACH EVENT RECEIVED");

3549 if(
	`g_dh_byhd
(
dh_hd
, &
pdh_fo
!
DPRM_SUCCESS
)

3551 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_WARN
, "NDP Ery wh giv dh_hd=%u",
dh_hd
);

3552 
us
 = 
OF_FAILURE
;

3556 
b_id
 = 1;able_id < 6;able_id++)

3558 if(
	`tsc_olug_v1_3_d_b_miss_y
(
dh_hd
,
b_id
!
OF_SUCCESS
)

3560 
us
 = 
OF_FAILURE
;

3561 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"Addg mised f܁ab %d ",
b_id
);

3566  
us
;

3567 
	}
}

3571 
t32_t
 
	$tsc_olug_v1_3_d_b_miss_y
(
ut64_t
 
dh_hd
,
ut8_t
 
b_id
)

3573 
of_msg
 *
msg
;

3574 
ut16_t
 
msg_n
,
ags
;

3575 
ut16_t
 
mch_fd_n
=0;

3576 
ut8_t
* 
mch_t_loc
 = 
NULL
;

3577 
t32_t
 
tv
 = 
OF_SUCCESS
;

3578 
t32_t
 
us
 = 
OF_SUCCESS
;

3579 * 
cn_fo_p
;

3581 
msg_n
 = (
OFU_ADD_OR_MODIFY_OR_DELETE_FLOW_ENTRY_MESSAGE_LEN
+16);

3585 
msg
 = 
	`ofu_loc_mesge
(
OFPT_FLOW_MOD
, 
msg_n
);

3586 if(
msg
 =
NULL
)

3588 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
,"OF messagellocrror ");

3589 
us
 = 
OF_FAILURE
;

3592 
ags
 = 0;

3593 
ags
 |
OFPFF_SEND_FLOW_REM
;

3594 
tv
 = 
	`of__de_ow_s_msg_of_b
(
msg
,
dh_hd
,
b_id
,

3595 
ags
,

3598 
OFPP_NONE
,

3599 
OFPP_NONE
,

3600 &
cn_fo_p


3603 if(
tv
 !
OFU_DELETE_FLOW_ENTRY_TO_TABLE_SUCCESS
)

3605 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E idg misyab = %d",
tv
);

3606 
us
 = 
OF_FAILURE
;

3609 
	`ofu_t_g_mch_fld_vues
(
msg
);

3610 
	`ofu_d_g_mch_fld_vues
(
msg
,
mch_t_loc
,&
mch_fd_n
);

3613 
tv
 = 
	`of__nd_que_mesge
(
msg
,
dh_hd
,
cn_fo_p
,
NULL
,NULL);

3614 if(
tv
 !
OF_SUCCESS
)

3616 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
," E Sdg D Flow Mod mesgtmisTab = %d",
tv
);

3617 
us
 = 
OF_FAILURE
;

3621 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Missntries deleted");

3623  
us
;

3624 
	}
}

	@tsc_vxn_views_api.c

26 
	~"cڌr.h
"

27 
	~"r_l.h
"

28 
	~"l_queue.h
"

29 
	~"of_uts.h
"

30 
	~"of_msgi.h
"

31 
	~"of_muɝt.h
"

32 
	~"r_s.h
"

33 
	~"r_.h
"

34 
	~"r_evt.h
"

35 
	~"mi.h
"

36 
	~"m_vn_i.h
"

37 
	~"m_vn_i.h
"

38 
	~"m_pt_i.h
"

39 
	~"mldef.h
"

40 
	~"tsc_vxn_vws.h
"

41 
	~"dmldef.h
"

43 
tsc_vxn_dmac_vmpt_daba_vw
 
dmac_vmpt_vw
;

44 
tsc_vxn_swme_vmpt_daba_vw
 
swme_vmpt_vw
;

45 
tsc_vxn_swme_uni_nwpt_daba_vw
 
swme_uni_nwpt_vw
;

46 
tsc_vxn_swme_brd_nwpt_daba_vw
 
swme_brd_nwpt_vw
;

47 
tsc_vxn_nid_vn_daba_vw
 
nid_vn_vw
;

49 
ut32_t
 
tsc_vxn_g_hashv_bymac
(
ut8_t
 *
mac_p
,ut32_
no_of_bucks
);

58 
t32_t
 
	$tsc_vxn_add_vmpt_to_ptmac_vw
(
ut64_t
 
m_pt_hd
,
ut32_t
 
nid
)

60 
ut32_t
 
dex
,
magic
;

61 
t32_t
 
us
 = 
CRM_SUCCESS
;

62 
ut32_t
 
hashkey
;

63 
ut8_t
 
us_b
,
ii
;

64 
uch8_t
* 
hashobj_p
=
NULL
;

65 
tsc_vxn_dmac_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

66 
tsc_vxn_dmac_vmpt_vw_node
 *
vw_node_sn_p
=
NULL
;

67 
m_pt
* 
pt_fo_p
 = 
NULL
;

68 
m_pt
* 
pt_sn_fo_p
 = 
NULL
;

70 
uch8_t
 
hp_b
;

72 
	`CNTLR_RCU_READ_LOCK_TAKE
();

74 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

75 if(
us
 !
CRM_SUCCESS
)

77 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

78 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

79  
CRM_FAILURE
;

82 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nid = %x",
nid
);

83 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Addg܊am%s",
pt_fo_p
->
pt_me
);

85 
hashkey
 = 
	`tsc_vxn_g_hashv_bymac
(
pt_fo_p
->
vmInfo
.
vm_pt_mac
, 
dmac_vmpt_vw
.
no_of_vw_node_bucks_g
);

86 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

87 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܊am%s",
pt_fo_p
->
pt_me
);

89 
	`MCHASH_BUCKET_SCAN
(
dmac_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_sn_p
, 
tsc_vxn_dmac_vmpt_vw_node
*, 
TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
)

91 if((
nid
 =
vw_node_sn_p
->nid&& (
	`memcmp
(
pt_fo_p
->
vmInfo
.
vm_pt_mac
, vw_node_sn_p->
d_mac
,6) == 0))

93 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "vw_node_sn_p->nid = %x",
vw_node_sn_p
->
nid
);

96 
us
 = 
	`m_g_pt_byhd
(
vw_node_sn_p
->
pt_hd
, &
pt_sn_fo_p
);

97 if(
us
 =
CRM_SUCCESS
)

99 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "snodp܊am%s",
pt_sn_fo_p
->
pt_me
);

100 if((
	`rcmp
(
pt_fo_p
->
pt_me
, 
pt_sn_fo_p
->port_name) == 0))

102 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Port viewlreadydded");

103 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

104  
CRM_SUCCESS
;

108 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Duplicate viewode ");

110 
ii
 = 0;ii < 6;ii++)

111 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," %02x",
pt_fo_p
->
vmInfo
.
vm_pt_mac
[
ii
]);

112 
ii
 = 0;ii < 6;ii++)

113 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," %02x",
vw_node_sn_p
->
d_mac
[
ii
]);

114 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

115  
CRM_FAILURE
;

124 
us
 = 
	`mempo_g_mem_block
(
dmac_vmpt_vw
.
db_vwmempo_p
, (
uch8_t
**)&
vw_node_y_p
,&
hp_b
);

125 if(
us
 !
MEMPOOL_SUCCESS
)

127 
us
 = 
CRM_FAILURE
;

130 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "pt_me:%s",
pt_fo_p
->
pt_me
);

131 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "tuid:%x",
nid
);

132 
ii
 = 0;ii < 6;ii++)

133 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," %02x",
pt_fo_p
->
vmInfo
.
vm_pt_mac
[
ii
]);

135 
	`memy
(
vw_node_y_p
->
d_mac
,(
pt_fo_p
->
vmInfo
.
vm_pt_mac
),6);

136 
vw_node_y_p
->
nid
 =id;

137 
vw_node_y_p
->
pt_hd
 = 
m_pt_hd
;

138 
hashobj_p
 = (
uch8_t
 *)
vw_node_y_p
 + 
TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
;

139 
	`MCHASH_APPEND_NODE
(
dmac_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
dex
, 
magic
, 
hashobj_p
, 
us_b
);

141 if(
FALSE
 =
us_b
)

143 
us
 = 
CRM_FAILURE
;

146 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "entered");

147 
vw_node_y_p
->
magic
 = magic;

148 
vw_node_y_p
->
dex
 = index;

149 
vw_node_y_p
->
hp_b
=heap_b;

150 
us
 = 
CRM_SUCCESS
;

152 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " viewodedded");

155 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

156  
us
;

157 
	}
}

163 
t32_t
 
	$tsc_vxn_d_vmpt_om_ptmac_vw
(
ut64_t
 
m_pt_hd
, 
ut32_t
 
nid
)

165 
t32_t
 
us
=
CRM_SUCCESS
;

166 
ut32_t
 
hashkey
;

167 
ut8_t
 
us_b
;

168 
ut8_t
 *
pt_mac_p
=
NULL
;

169 
tsc_vxn_dmac_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

170 
m_pt
 *
pt_fo_p
=
NULL
;

171 
uch8_t
 
offt
;

173 
	`CNTLR_RCU_READ_LOCK_TAKE
();

176 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

177 if(
us
!=
CRM_SUCCESS
)

179 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

182 
pt_mac_p
 = 
pt_fo_p
->
vmInfo
.
vm_pt_mac
;

183 
hashkey
 = 
	`tsc_vxn_g_hashv_bymac
(
pt_mac_p
, 
dmac_vmpt_vw
.
no_of_vw_node_bucks_g
);

184 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

185 
offt
 = 
TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
;

186 
	`MCHASH_BUCKET_SCAN
(
dmac_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_dmac_vmpt_vw_node
 *, 
offt
)

188 if((
vw_node_y_p
->
nid
=id)&&(!
	`memcmp
((vw_node_y_p->
d_mac
), (
pt_fo_p
->
vmInfo
.
vm_pt_mac
),6)))

190 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode foundo delete");

191 
	`MCHASH_DELETE_NODE_BY_REF
(
dmac_vmpt_vw
.
db_vwtbl_p
, 
vw_node_y_p
->
dex
, vw_node_y_p->
magic
,
tsc_vxn_dmac_vmpt_vw_node
 *,
offt
,
us_b
);

192 if(
us_b
 =
TRUE
)

194 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode deleted successfully fromhe view db");

195 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

196  
CRM_SUCCESS
;

200 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

201  
CRM_FAILURE
;

207 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewodeot foundo delete");

208 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

209  
CRM_FAILURE
;

210 
	}
}

217 
t32_t
 
	$tsc_vxn_g_vmpt_by_dmac_nid
(
ut8_t
* 
d_mac_p
,

218 
ut32_t
 
nid
,

219 
ut64_t
* 
m_pt_hd_p
)

221 
ut32_t
 
hashkey
;

222 
tsc_vxn_dmac_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

223 
uch8_t
 
offt
;

225 if(
d_mac_p
 =
NULL
)

227 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Invalidarameters");

228  
CRM_FAILURE
;

230 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " %x:%x:%x:%x:%x:%x",
d_mac_p
[0],dst_mac_p[1],dst_mac_p[2],dst_mac_p[3],dst_mac_p[4],dst_mac_p[5]);

232 
	`CNTLR_RCU_READ_LOCK_TAKE
();

234 
hashkey
 = 
	`tsc_vxn_g_hashv_bymac
(
d_mac_p
, 
dmac_vmpt_vw
.
no_of_vw_node_bucks_g
);

235 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

237 
offt
 = 
TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
;

238 
	`MCHASH_BUCKET_SCAN
(
dmac_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_dmac_vmpt_vw_node
 *, 
offt
)

240 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, " %x:%x:%x:%x:%x:%x",
d_mac_p
[0],dst_mac_p[1],dst_mac_p[2],dst_mac_p[3],dst_mac_p[4],dst_mac_p[5]);

241 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "%x",
nid
);

242 if((
vw_node_y_p
->
nid
=nid)&&(!
	`memcmp
((vw_node_y_p->
d_mac
),(
d_mac_p
),6)))

244 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copy crmort handle");

245 *
m_pt_hd_p
 = 
vw_node_y_p
->
pt_hd
;

246 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

247  
CRM_SUCCESS
;

250 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "no viewode");

251 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

252  
CRM_FAILURE
;

253 
	}
}

261 
t32_t
 
	$tsc_vxn_add_vmpt_to_swme_vw
(
ut64_t
 
m_pt_hd
,
ut32_t
 
nid
)

263 
ut32_t
 
dex
,
magic
;

264 
t32_t
 
us
=
CRM_SUCCESS
;

265 
ut32_t
 
hashkey
;

266 
ut8_t
 
us_b
;

267 
uch8_t
 *
hashobj_p
=
NULL
;

268 
tsc_vxn_swme_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

269 
m_pt
 *
pt_fo_p
=
NULL
;

270 
uch8_t
 
hp_b
;

272 
	`CNTLR_RCU_READ_LOCK_TAKE
();

275 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

276 if(
us
!=
CRM_SUCCESS
)

278 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

284 
us
 = 
	`mempo_g_mem_block
(
swme_vmpt_vw
.
db_vwmempo_p
, (
uch8_t
**)&
vw_node_y_p
,&
hp_b
);

285 if(
us
 !
MEMPOOL_SUCCESS
)

287 
us
 = 
CRM_FAILURE
;

290 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

291 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

293 
	`ry
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
);

294 
vw_node_y_p
->
nid
 =id;

295 
vw_node_y_p
->
pt_hd
 = 
m_pt_hd
;

296 
hashobj_p
 = (
uch8_t
 *)
vw_node_y_p
 + 
TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
;

297 
	`MCHASH_APPEND_NODE
(
swme_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
dex
, 
magic
, 
hashobj_p
, 
us_b
);

298 if(
FALSE
 =
us_b
)

300 
us
 = 
CRM_FAILURE
;

303 
vw_node_y_p
->
magic
 = magic;

304 
vw_node_y_p
->
dex
 = index;

305 
vw_node_y_p
->
hp_b
=heap_b;

306 
us
 = 
CRM_SUCCESS
;

308 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

309  
us
;

310 
	}
}

316 
t32_t
 
	$tsc_vxn_d_vmpt_om_swme_vw
(
ut64_t
 
m_pt_hd
, 
ut32_t
 
nid
)

318 
t32_t
 
us
=
CRM_SUCCESS
;

319 
ut32_t
 
hashkey
;

320 
ut8_t
 
us_b
;

321 
tsc_vxn_swme_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

322 
m_pt
 *
pt_fo_p
=
NULL
;

323 
uch8_t
 
offt
;

325 
	`CNTLR_RCU_READ_LOCK_TAKE
();

328 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

329 if(
us
!=
CRM_SUCCESS
)

331 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

334 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

335 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

336 
offt
 = 
TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
;

337 
	`MCHASH_BUCKET_SCAN
(
swme_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_vmpt_vw_node
 *, 
offt
)

339 if((!
	`rcmp
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
))&&(vw_node_y_p->
nid
==id))

341 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode foundo delete");

342 
	`MCHASH_DELETE_NODE_BY_REF
(
swme_vmpt_vw
.
db_vwtbl_p
, 
vw_node_y_p
->
dex
, vw_node_y_p->
magic
,
tsc_vxn_swme_vmpt_vw_node
 *,
offt
,
us_b
);

343 if(
us_b
 =
TRUE
)

345 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode deleted successfully fromhe view db");

346 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

347  
CRM_SUCCESS
;

351 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

352  
CRM_FAILURE
;

358 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewodeot foundo delete");

359 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

360  
CRM_FAILURE
;

361 
	}
}

368 
t32_t
 
	$tsc_vxn_g_vmpts_by_swme_nid
(*
swch_me_p
,

369 
ut32_t
 
nid
,

370 
ut32_t
* 
no_of_vmside_pts_p
,

371 
ut32_t
* 
vmside_pts_p
)

373 
t32_t
 
us
=
OF_SUCCESS
;

374 
ut32_t
 
hashkey
;

375 
tsc_vxn_swme_vmpt_vw_node
 *
vw_node_y_p
=
NULL
;

376 
m_pt
 *
pt_fo_p
=
NULL
;

377 
uch8_t
 
offt
;

378 
ut8_t
 
dex
=0,
no_of_vmside_pts
=0;

380 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "swch_me_p:%s,no_of_vmside_pts:%d,vmside_pts_p:%x",
swch_me_p
,*
no_of_vmside_pts_p
,
vmside_pts_p
);

382 if((
swch_me_p
 =
NULL
)||((*
no_of_vmside_pts_p
)==0)||(
vmside_pts_p
==NULL))

384 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Invalidarameters");

385  
CRM_FAILURE
;

388 
	`CNTLR_RCU_READ_LOCK_TAKE
();

389 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swch_me_p
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

390 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

391 
offt
 = 
TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
;

392 
	`MCHASH_BUCKET_SCAN
(
swme_vmpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_vmpt_vw_node
 *, 
offt
)

394 if(!
	`rcmp
(
vw_node_y_p
->
swme
, 
swch_me_p
)&&(vw_node_y_p->
nid
==id))

396 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copy crmort info");

397 
us
 = 
	`m_g_pt_byhd
(
vw_node_y_p
->
pt_hd
, &
pt_fo_p
);

398 if(
us
!=
CRM_SUCCESS
)

400 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

403 if((
no_of_vmside_pts
<=(*
no_of_vmside_pts_p
)&& (
pt_fo_p
->
m_pt_ty
 !
VM_GUEST_PORT
))

405 
no_of_vmside_pts
++;

406 
vmside_pts_p
[
dex
]=
pt_fo_p
->
pt_id
;

407 
dex
++;

413 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "pt_me:%s,pt_ty:%d,vm_me:%s,max:%s,br_me:%s",
pt_fo_p
->
pt_me
,pt_fo_p->
m_pt_ty
,pt_fo_p->
vmInfo
.
vm_me
,pt_fo_p->vmInfo.
vm_pt_mac
,pt_fo_p->
br1_me
);

416 if(
no_of_vmside_pts
>0)

418 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "novwodefound:%d",
no_of_vmside_pts
);

419 *
no_of_vmside_pts_p
 = 
no_of_vmside_pts
;

420 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

421  
CRM_SUCCESS
;

423 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "no viewode");

424 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

425  
CRM_FAILURE
;

426 
	}
}

434 
t32_t
 
	$tsc_vxn_add_uni_nwpt_to_swme_vw
(
ut64_t
 
m_pt_hd
, 
ut16_t
 
rvi_pt
)

436 
ut32_t
 
dex
,
magic
;

437 
t32_t
 
us
=
CRM_SUCCESS
;

438 
ut32_t
 
hashkey
;

439 
ut8_t
 
us_b
 = 
FALSE
;

440 
uch8_t
 *
hashobj_p
=
NULL
;

441 
tsc_vxn_swme_uni_nwpt_vw_node
 *
vw_node_y_p
=
NULL
;

442 
tsc_vxn_swme_uni_nwpt_vw_node
 *
vw_node_sn_p
=
NULL
;

443 
m_pt
* 
pt_fo_p
 = 
NULL
;

444 
m_pt
* 
pt_sn_fo_p
 = 
NULL
;

445 
uch8_t
 
hp_b
;

447 
	`CNTLR_RCU_READ_LOCK_TAKE
();

450 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

451 if(
us
!=
CRM_SUCCESS
)

453 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

457 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_uni_nwpt_vw
.
no_of_vw_node_bucks_g
);

458 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

459 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܊am%s",
pt_fo_p
->
pt_me
);

462 
	`MCHASH_BUCKET_SCAN
(
swme_uni_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_sn_p
, 
tsc_vxn_swme_uni_nwpt_vw_node
*, 
TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
)

464 if((
rvi_pt
 =(
vw_node_sn_p
->service_port)) &&

465 (!
	`rcmp
(
pt_fo_p
->
swch_me
,
vw_node_sn_p
->
swme
))

468 
us
 = 
	`m_g_pt_byhd
(
vw_node_sn_p
->
pt_hd
, &
pt_sn_fo_p
);

469 if(
us
 =
CRM_SUCCESS
)

471 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "snodp܊am%s",
pt_sn_fo_p
->
pt_me
);

472 if((
	`rcmp
(
pt_fo_p
->
pt_me
, 
pt_sn_fo_p
->port_name) == 0))

474 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Port viewlreadydded");

475 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

476  
CRM_SUCCESS
;

480 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Duplicate viewode ");

481 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈swcham%s",
pt_fo_p
->
swch_me
);

482 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈sswcham%s",
pt_sn_fo_p
->
swch_me
);

483 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "rvi܈%d",
rvi_pt
);

484 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈srvi܈%d",
vw_node_sn_p
->
rvi_pt
);

485 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

486  
CRM_FAILURE
;

493 
us
 = 
	`mempo_g_mem_block
(
swme_uni_nwpt_vw
.
db_vwmempo_p
, (
uch8_t
**)&
vw_node_y_p
,&
hp_b
);

494 if(
us
 !
MEMPOOL_SUCCESS
)

496 
us
 = 
CRM_FAILURE
;

500 
	`ry
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
);

501 
vw_node_y_p
->
rvi_pt
 = service_port;

502 
vw_node_y_p
->
pt_hd
 = 
m_pt_hd
;

503 
hashobj_p
 = (
uch8_t
 *)
vw_node_y_p
 + 
TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

504 
	`MCHASH_APPEND_NODE
(
swme_uni_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
dex
, 
magic
, 
hashobj_p
, 
us_b
);

506 if(
us_b
 =
FALSE
)

508 
us
 = 
CRM_FAILURE
;

511 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "unicastortddedo sw view");

512 
vw_node_y_p
->
magic
 = magic;

513 
vw_node_y_p
->
dex
 = index;

514 
vw_node_y_p
->
hp_b
=heap_b;

515 
us
 = 
CRM_SUCCESS
;

518 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

519  
us
;

520 
	}
}

526 
t32_t
 
	$tsc_vxn_d_uni_nwpt_om_swme_vw
(
ut64_t
 
m_pt_hd
, 
ut16_t
 
rvi_pt
)

528 
t32_t
 
us
=
CRM_SUCCESS
;

529 
ut32_t
 
hashkey
;

530 
ut8_t
 
us_b
;

531 
tsc_vxn_swme_uni_nwpt_vw_node
 *
vw_node_y_p
=
NULL
;

532 
m_pt
 *
pt_fo_p
=
NULL
;

533 
uch8_t
 
offt
;

535 
	`CNTLR_RCU_READ_LOCK_TAKE
();

538 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

539 if(
us
!=
CRM_SUCCESS
)

541 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

544 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_uni_nwpt_vw
.
no_of_vw_node_bucks_g
);

545 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

546 
offt
 = 
TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

547 
	`MCHASH_BUCKET_SCAN
(
swme_uni_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_uni_nwpt_vw_node
 *, 
offt
)

549 if((
vw_node_y_p
->
rvi_pt
== service_port)&&

550 (!
	`rcmp
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
)))

552 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode foundo delete");

553 
	`MCHASH_DELETE_NODE_BY_REF
(
swme_uni_nwpt_vw
.
db_vwtbl_p
, 
vw_node_y_p
->
dex
, vw_node_y_p->
magic
,
tsc_vxn_uni_nwpt_vw_node
 *,
offt
,
us_b
);

554 if(
us_b
 =
TRUE
)

556 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode deleted successfully fromhe view db");

557 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

558  
CRM_SUCCESS
;

562 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

563  
CRM_FAILURE
;

569 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewodeot foundo delete");

570 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

571  
CRM_FAILURE
;

572 
	}
}

579 
t32_t
 
	$tsc_vxn_g_uni_nwpt_by_swme_
(* 
swch_me_p
, 
ut16_t
 
rvipt
, 
ut32_t
* 
out_pt_no_p
)

581 
t32_t
 
us
 = 
OF_SUCCESS
;

582 
ut32_t
 
hashkey
;

583 
tsc_vxn_swme_uni_nwpt_vw_node
* 
vw_node_y_p
 = 
NULL
;

584 
m_pt
* 
pt_fo_p
 = 
NULL
;

585 
uch8_t
 
offt
;

589 if((
swch_me_p
 =
NULL
)||(
out_pt_no_p
==NULL))

591 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Invalidarameters");

592  
CRM_FAILURE
;

596 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swch_me_p
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

597 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

598 
offt
 = 
TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

599 
	`MCHASH_BUCKET_SCAN
(
swme_uni_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_uni_nwpt_vw_node
 *, 
offt
)

601 if((
vw_node_y_p
->
rvi_pt
 =
rvipt
)&&

602 (!
	`rcmp
(
vw_node_y_p
->
swme
, 
swch_me_p
)))

604 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copy crmort info");

605 
us
 = 
	`m_g_pt_byhd
(
vw_node_y_p
->
pt_hd
, &
pt_fo_p
);

606 if(
us
!=
CRM_SUCCESS
)

608 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

611 (*
out_pt_no_p
)=
pt_fo_p
->
pt_id
;

612 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "pt_me:%s,pt_ty:%d,vm_me:%s,max:%s,br_me:%s,ptd:%d",
pt_fo_p
->
pt_me
,pt_fo_p->
m_pt_ty
,pt_fo_p->
vmInfo
.
vm_me
,pt_fo_p->vmInfo.
vm_pt_mac
,pt_fo_p->
br1_me
,pt_fo_p->
pt_id
);

615  
CRM_SUCCESS
;

618 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "no viewode");

620  
CRM_FAILURE
;

621 
	}
}

629 
t32_t
 
	$tsc_vxn_add_brd_nwpt_to_swme_vw
(
ut64_t
 
m_pt_hd
,

630 
ut16_t
 
rvi_pt
,

631 
ut32_t
 
nid
,

632 
ut32_t
 
me_
)

635 
ut32_t
 
dex
,
magic
;

636 
t32_t
 
us
=
CRM_SUCCESS
;

637 
ut32_t
 
hashkey
;

638 
ut8_t
 
us_b
 = 
FALSE
;

639 
uch8_t
 *
hashobj_p
=
NULL
;

640 
tsc_vxn_swme_brd_nwpt_vw_node
 *
vw_node_y_p
=
NULL
;

641 
tsc_vxn_swme_brd_nwpt_vw_node
 *
vw_node_sn_p
=
NULL
;

642 
m_pt
* 
pt_fo_p
=
NULL
;

643 
m_pt
* 
pt_sn_fo_p
=
NULL
;

644 
uch8_t
 
hp_b
;

646 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "entered");

647 
	`CNTLR_RCU_READ_LOCK_TAKE
();

650 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

651 if(
us
!=
CRM_SUCCESS
)

653 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

657 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_brd_nwpt_vw
.
no_of_vw_node_bucks_g
);

658 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

661 
	`MCHASH_BUCKET_SCAN
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_sn_p
, 
tsc_vxn_swme_brd_nwpt_vw_node
*, 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
)

663 if((
rvi_pt
 =(
vw_node_sn_p
->
rvipt
)) &&

664 (
nid
 =
vw_node_sn_p
->nid)&&

665 (
me_
 =
vw_node_sn_p
->remote_ip)&&

666 (!
	`rcmp
(
pt_fo_p
->
swch_me
,
vw_node_sn_p
->
swme
))

669 
us
 = 
	`m_g_pt_byhd
(
vw_node_sn_p
->
pt_hd
, &
pt_sn_fo_p
);

670 if(
us
 =
CRM_SUCCESS
)

672 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "snodp܊am%s",
pt_sn_fo_p
->
pt_me
);

673 if((
	`rcmp
(
pt_fo_p
->
pt_me
, 
pt_sn_fo_p
->port_name) == 0))

675 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Port viewlreadydded");

676 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

677  
CRM_SUCCESS
;

681 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Duplicate viewode ");

682 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈swcham%s",
pt_fo_p
->
swch_me
);

683 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈sswcham%s",
pt_sn_fo_p
->
swch_me
);

684 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈rvi܈%d",
rvi_pt
);

685 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈srvi܈%d",
vw_node_sn_p
->
rvipt
);

686 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nid = %d",
nid
);

687 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈snid = %d",
vw_node_sn_p
->
nid
);

688 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈me_ = %d",
me_
);

689 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "p܈sme_ = %d",
vw_node_sn_p
->
me_
);

690 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

691  
CRM_FAILURE
;

694 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Duplicate viewode ");

695 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

696  
CRM_FAILURE
;

701 
us
 = 
	`mempo_g_mem_block
(
swme_brd_nwpt_vw
.
db_vwmempo_p
, (
uch8_t
**)&
vw_node_y_p
,&
hp_b
);

702 if(
us
 !
MEMPOOL_SUCCESS
)

704 
us
 = 
CRM_FAILURE
;

708 
	`ry
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
);

709 
vw_node_y_p
->
nid
=id;

710 
vw_node_y_p
->
rvipt
 = 
rvi_pt
;

711 
vw_node_y_p
->
me_
 =emote_ip;

712 
vw_node_y_p
->
pt_hd
 = 
m_pt_hd
;

713 
hashobj_p
 = (
uch8_t
 *)
vw_node_y_p
 + 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

714 
	`MCHASH_APPEND_NODE
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
dex
, 
magic
, 
hashobj_p
, 
us_b
);

715 if(
us_b
 =
FALSE
)

717 
us
 = 
CRM_FAILURE
;

720 
vw_node_y_p
->
magic
 = magic;

721 
vw_node_y_p
->
dex
 = index;

722 
vw_node_y_p
->
hp_b
=heap_b;

723 
us
 = 
CRM_SUCCESS
;

725 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

726  
us
;

727 
	}
}

733 
t32_t
 
	$tsc_vxn_d_brd_nwpt_om_swme_vw
(
ut64_t
 
m_pt_hd
,
ut16_t
 
rvi_pt
,
ut32_t
 
nid
,ut32_
me_
)

735 
t32_t
 
us
=
CRM_SUCCESS
;

736 
ut32_t
 
hashkey
;

737 
ut8_t
 
us_b
;

738 
tsc_vxn_swme_brd_nwpt_vw_node
 *
vw_node_y_p
=
NULL
;

739 
m_pt
 *
pt_fo_p
=
NULL
;

740 
uch8_t
 
offt
;

742 
	`CNTLR_RCU_READ_LOCK_TAKE
();

745 
us
 = 
	`m_g_pt_byhd
(
m_pt_hd
, &
pt_fo_p
);

746 if(
us
!=
CRM_SUCCESS
)

748 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

751 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
pt_fo_p
->
swch_me
, 
swme_brd_nwpt_vw
.
no_of_vw_node_bucks_g
);

752 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

753 
offt
 = 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

754 
	`MCHASH_BUCKET_SCAN
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_brd_nwpt_vw_node
 *, 
offt
)

756 if((
vw_node_y_p
->
rvipt
=
rvi_pt
) &&

757 (
vw_node_y_p
->
me_
 ==emote_ip)&&

758 (
vw_node_y_p
->
nid
 ==id)&&

759 (!
	`rcmp
(
vw_node_y_p
->
swme
, 
pt_fo_p
->
swch_me
)))

761 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode foundo delete");

762 
	`MCHASH_DELETE_NODE_BY_REF
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
vw_node_y_p
->
dex
, vw_node_y_p->
magic
,
tsc_vxn_brd_nwpt_vw_node
 *,
offt
,
us_b
);

763 if(
us_b
 =
TRUE
)

765 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode deleted successfully fromhe view db");

766 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

767  
CRM_SUCCESS
;

771 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

772  
CRM_FAILURE
;

778 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewodeot foundo delete");

779 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

780  
CRM_FAILURE
;

781 
	}
}

788 
t32_t
 
	$tsc_vxn_g_me_s_by_swme_nid_
(* 
swch_me_p
,
ut32_t
 
rvi_pt
,

789 
ut32_t
 
nid
,

790 
ut32_t
* 
no_of_me_s_p
,

791 
ut32_t
* 
me_s_p
)

793 
ut32_t
 
hashkey
;

794 
tsc_vxn_swme_brd_nwpt_vw_node
 *
vw_node_y_p
 = 
NULL
;

795 
uch8_t
 
offt
;

796 
ut8_t
 
dex
=0,
no_of_me_s
 = 0;

799 if(
swch_me_p
 =
NULL
)

801 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Invalid Switch Name");

802  
CRM_FAILURE
;

805 if(
me_s_p
 =
NULL
)

807 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Invalidemote_ips_p");

808  
CRM_FAILURE
;

811 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swch_me_p
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

812 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

813 
offt
 = 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

815 
	`MCHASH_BUCKET_SCAN
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_brd_nwpt_vw_node
 *, 
offt
)

817 if((!
	`rcmp
(
vw_node_y_p
->
swme
, 
swch_me_p
))&&

818 (
vw_node_y_p
->
rvipt
 =
rvi_pt
)&&

819 (
vw_node_y_p
->
nid
 ==id))

821 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copyemote_ip info");

822 if(
no_of_me_s
 <(*
no_of_me_s_p
))

824 
no_of_me_s
++;

825 
me_s_p
[
dex
] = 
vw_node_y_p
->
me_
;

826 
dex
++;

834 if(
no_of_me_s
 > 0)

836 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "novwodefound:%d",
no_of_me_s
);

837 *
no_of_me_s_p
 = 
no_of_me_s
;

838  
CRM_SUCCESS
;

840 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "no viewode");

841  
CRM_FAILURE
;

842 
	}
}

850 
t32_t
 
	$tsc_vxn_g_brd_nwpts_by_swme_nid_
(* 
swch_me_p
,
ut32_t
 
rvi_pt
,

851 
ut32_t
 
nid
,

852 
ut32_t
* 
no_of_nwside_br_pts_p
,

853 
ut32_t
* 
nwside_br_pts_p
,

854 
ut32_t
 
me_
)

856 
t32_t
 
us
=
OF_SUCCESS
;

857 
ut32_t
 
hashkey
;

858 
tsc_vxn_swme_brd_nwpt_vw_node
 *
vw_node_y_p
 = 
NULL
;

859 
m_pt
 *
pt_fo_p
 = 
NULL
;

860 
uch8_t
 
offt
;

861 
ut8_t
 
dex
=0,
no_of_nwside_br_pts
=0;

865 if(
swch_me_p
 =
NULL
)

867 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Invalid Switch Name");

868  
CRM_FAILURE
;

871 if(
nwside_br_pts_p
 =
NULL
)

873 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_ERROR
, "Invalidwside_br_ports");

874  
CRM_FAILURE
;

881 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swch_me_p
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

882 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

883 
offt
 = 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

885 if(
me_
 == 0)

887 
	`MCHASH_BUCKET_SCAN
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_brd_nwpt_vw_node
 *, 
offt
)

889 if((!
	`rcmp
(
vw_node_y_p
->
swme
, 
swch_me_p
))&&

890 (
vw_node_y_p
->
rvipt
 =
rvi_pt
)&&

891 (
vw_node_y_p
->
nid
 ==id))

893 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copy crmort info");

894 
us
 = 
	`m_g_pt_byhd
(
vw_node_y_p
->
pt_hd
, &
pt_fo_p
);

895 if(
us
!=
CRM_SUCCESS
)

897 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

900 if(
no_of_nwside_br_pts
 <(*
no_of_nwside_br_pts_p
))

902 
no_of_nwside_br_pts
++;

903 
nwside_br_pts_p
[
dex
] = 
pt_fo_p
->
pt_id
;

904 
dex
++;

910 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "pt_me:%s,pt_ty:%d,vm_me:%s,max:%s,br_me:%s,ptd:%d",
pt_fo_p
->
pt_me
,pt_fo_p->
m_pt_ty
,pt_fo_p->
vmInfo
.
vm_me
,pt_fo_p->vmInfo.
vm_pt_mac
,pt_fo_p->
br1_me
,pt_fo_p->
pt_id
);

916 
hashkey
 = 
	`tsc_vxn_g_hashv_byme
(
swch_me_p
, 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
);

917 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

918 
offt
 = 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

920 
	`MCHASH_BUCKET_SCAN
(
swme_brd_nwpt_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_swme_brd_nwpt_vw_node
 *, 
offt
)

922 if((!
	`rcmp
(
vw_node_y_p
->
swme
, 
swch_me_p
))&&

923 (
vw_node_y_p
->
rvipt
 =
rvi_pt
)&&

924 (
vw_node_y_p
->
nid
 ==id)&&

925 (
vw_node_y_p
->
me_
 ==emote_ip))

927 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode found . copy crmort info");

928 
us
 = 
	`m_g_pt_byhd
(
vw_node_y_p
->
pt_hd
, &
pt_fo_p
);

929 if(
us
!=
CRM_SUCCESS
)

931 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "Failedo get crmort information");

934 if(
no_of_nwside_br_pts
 <(*
no_of_nwside_br_pts_p
))

936 
no_of_nwside_br_pts
++;

937 
nwside_br_pts_p
[
dex
] = 
pt_fo_p
->
pt_id
;

938 
dex
++;

944 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "pt_me:%s,pt_ty:%d,vm_me:%s,max:%s,br_me:%s,ptd:%d",
pt_fo_p
->
pt_me
,pt_fo_p->
m_pt_ty
,pt_fo_p->
vmInfo
.
vm_me
,pt_fo_p->vmInfo.
vm_pt_mac
,pt_fo_p->
br1_me
,pt_fo_p->
pt_id
);

948 if(
no_of_nwside_br_pts
 > 0)

950 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "novwodefound:%d",
no_of_nwside_br_pts
);

951 *
no_of_nwside_br_pts_p
 = 
no_of_nwside_br_pts
;

952  
CRM_SUCCESS
;

954 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "no viewode");

955  
CRM_FAILURE
;

956 
	}
}

958 
ut32_t
 
	$tsc_vxn_g_hashv_bymac
(
ut8_t
 *
mac_p
,
ut32_t
 
no_of_bucks
)

960 
ut32_t
 
hashkey
,
m1
,
m2
,
m3
,
m4
;

962 
m1
 = (
ut32_t
)(
mac_p
[0]);

963 
m2
 = (
ut32_t
)(
mac_p
[1]);

964 
m3
 = (
ut32_t
)(*((ut32_*)(&
mac_p
[2])));

965 
m4
 = 1;

966 
	`DPRM_COMPUTE_HASH
(
m1
,
m2
,
m3
,
m4
,
no_of_bucks
,
hashkey
);

967  
hashkey
;

968 
	}
}

969 
ut32_t
 
	$tsc_vxn_g_hashv_byme
(* 
me_p
,
ut32_t
 
no_of_bucks
)

971 
ut32_t
 
hashkey
,
m1
,
m2
,
m3
,
m4
;

972 
me_hash
[16];

973 
	`memt
(
me_hash
,0,16);

974 
	`y
(
me_hash
,
me_p
,16);

975 
m1
 = *(
ut32_t
 *)(
me_hash
 +0);

976 
m2
 = *(
ut32_t
 *)(
me_hash
 +4);

977 
m3
 = *(
ut32_t
 *)(
me_hash
 +8);

978 
m4
 = *(
ut32_t
 *)(
me_hash
 +12);

979 
	`CRM_COMPUTE_HASH
(
m1
,
m2
,
m3
,
m4
,
no_of_bucks
,
hashkey
);

980  
hashkey
;

981 
	}
}

982 
ut32_t
 
	$tsc_vxn_g_hashv_by_nid
(
ut32_t
 
nid
,ut32_
no_of_bucks
)

984 
ut32_t
 
hashkey
,
m1
,
m2
,
m3
,
m4
;

986 
m1
 = 
nid
;

987 
m2
 = 
nid
;

988 
m3
 = 1;

989 
m4
 = 1;

990 
	`DPRM_COMPUTE_HASH
(
m1
,
m2
,
m3
,
m4
,
no_of_bucks
,
hashkey
);

991  
hashkey
;

992 
	}
}

999 
t32_t
 
	$tsc_vxn_add_vn_to_nid_vw
(
ut64_t
 
m_vn_hd
,
ut32_t
 
nid
)

1001 
ut32_t
 
dex
,
magic
;

1002 
t32_t
 
us
=
CRM_SUCCESS
;

1003 
ut32_t
 
hashkey
;

1004 
ut8_t
 
us_b
;

1005 
uch8_t
 *
hashobj_p
=
NULL
;

1006 
tsc_vxn_nid_vn_vw_node
 *
vw_node_y_p
=
NULL
;

1007 
uch8_t
 
hp_b
;

1010 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Entereddd vnoid view");

1011 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1014 
us
 = 
	`mempo_g_mem_block
(
nid_vn_vw
.
db_vwmempo_p
, (
uch8_t
**)&
vw_node_y_p
,&
hp_b
);

1015 if(
us
 !
MEMPOOL_SUCCESS
)

1017 
us
 = 
CRM_FAILURE
;

1020 
hashkey
 = 
	`tsc_vxn_g_hashv_by_nid
(
nid
,
nid_vn_vw
.
no_of_vw_node_bucks_g
);

1021 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

1023 
vw_node_y_p
->
nid
 =id;

1024 
vw_node_y_p
->
vn_hd
 = 
m_vn_hd
;

1025 
hashobj_p
 = (
uch8_t
 *)
vw_node_y_p
 + 
TSC_VXN_TUNID_VN_VIEW_NODE_TBL_OFFSET
;

1026 
	`MCHASH_APPEND_NODE
(
nid_vn_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
dex
, 
magic
, 
hashobj_p
, 
us_b
);

1027 if(
FALSE
 =
us_b
)

1029 
us
 = 
CRM_FAILURE
;

1032 
vw_node_y_p
->
magic
 = magic;

1033 
vw_node_y_p
->
dex
 = index;

1034 
vw_node_y_p
->
hp_b
=heap_b;

1036 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
,"Successfullydded vnoid view");

1037 
us
 = 
CRM_SUCCESS
;

1040 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1041  
us
;

1042 
	}
}

1048 
t32_t
 
	$tsc_vxn_de_vn_om_nid_vw
(
ut64_t
 
m_vn_hd
, 
ut32_t
 
nid
)

1050 
ut32_t
 
hashkey
;

1051 
ut8_t
 
us_b
;

1052 
tsc_vxn_nid_vn_vw_node
 *
vw_node_y_p
=
NULL
;

1053 
uch8_t
 
offt
;

1055 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "entered");

1057 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1061 
hashkey
 = 
	`tsc_vxn_g_hashv_by_nid
(
nid
,
nid_vn_vw
.
no_of_vw_node_bucks_g
);

1063 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

1064 
offt
 = 
TSC_VXN_TUNID_VN_VIEW_NODE_TBL_OFFSET
;

1065 
	`MCHASH_BUCKET_SCAN
(
nid_vn_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_nid_vn_vw_node
 *, 
offt
)

1067 if(
vw_node_y_p
->
nid
 ==id)

1069 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode foundo delete");

1070 
	`MCHASH_DELETE_NODE_BY_REF
(
nid_vn_vw
.
db_vwtbl_p
, 
vw_node_y_p
->
dex
, vw_node_y_p->
magic
,
tsc_vxn_nid_vn_vw_node
 *,
offt
,
us_b
);

1071 if(
us_b
 =
TRUE
)

1073 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewode deleted successfully fromhe view db");

1074 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1075  
CRM_SUCCESS
;

1079 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1080  
CRM_FAILURE
;

1086 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "viewodeot foundo delete");

1087 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1088  
CRM_FAILURE
;

1089 
	}
}

1094 
t32_t
 
	$tsc_vxn_g_vnhd_by_nid
(
ut32_t
 
nid
,
ut64_t
* 
vn_hd_p
)

1096 
ut32_t
 
hashkey
;

1097 
tsc_vxn_nid_vn_vw_node
 *
vw_node_y_p
 = 
NULL
;

1098 
uch8_t
 
offt
;

1102 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1104 
hashkey
 = 
	`tsc_vxn_g_hashv_by_nid
(
nid
,
nid_vn_vw
.
no_of_vw_node_bucks_g
);

1106 
offt
 = 
TSC_VXN_TUNID_VN_VIEW_NODE_TBL_OFFSET
;

1108 
	`MCHASH_BUCKET_SCAN
(
nid_vn_vw
.
db_vwtbl_p
, 
hashkey
, 
vw_node_y_p
, 
tsc_vxn_nid_vn_vw_node
 *, 
offt
)

1110 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "%x",
nid
);

1111 if(
vw_node_y_p
->
nid
 ==id)

1113 *
vn_hd_p
 = 
vw_node_y_p
->
vn_hd
;

1114 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1115  
CRM_SUCCESS
;

1118 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "nvxn-vvwodfound f܂id = %x",
nid
);

1119 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1120  
CRM_FAILURE
;

1121 
	}
}

	@tsc_vxn_views_init.c

26 
	~"cڌr.h
"

27 
	~"r_l.h
"

28 
	~"l_queue.h
"

29 
	~"of_uts.h
"

30 
	~"of_msgi.h
"

31 
	~"of_muɝt.h
"

32 
	~"r_s.h
"

33 
	~"r_.h
"

34 
	~"r_evt.h
"

35 
	~"mi.h
"

36 
	~"m_vn_i.h
"

37 
	~"m_pt_i.h
"

38 
	~"tsc_vxn_vws.h
"

40 
tsc_vxn_dmac_vmpt_daba_vw
 
	gdmac_vmpt_vw
;

41 
tsc_vxn_swme_vmpt_daba_vw
 
	gswme_vmpt_vw
;

42 
tsc_vxn_swme_uni_nwpt_daba_vw
 
	gswme_uni_nwpt_vw
;

43 
tsc_vxn_swme_brd_nwpt_daba_vw
 
	gswme_brd_nwpt_vw
;

44 
tsc_vxn_nid_vn_daba_vw
 
	gnid_vn_vw
;

46 
	$tsc_vxn_dmac_vmpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
)

48 
t32_t
 
t_v
;

49 
ut32_t
 
offt
;

50 
tsc_vxn_dmac_vmpt_vw_node
 *
db_vw_node_fo_p
 = (tsc_vxn_dmac_vmpt_vw_node*)
db_vw_node_y_p
;

52 if(
db_vw_node_y_p
)

54 
offt
 = 
TSC_VXN_DMAC_VMPORT_VIEW_NODE_TBL_OFFSET
;

55 
db_vw_node_fo_p
 = (
tsc_vxn_dmac_vmpt_vw_node
*)(((*)
db_vw_node_y_p
-
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
)-
offt
);

56 
t_v
 = 
	`mempo_a_mem_block
(
dmac_vmpt_vw
.
db_vwmempo_p
,(
uch8_t
*)
db_vw_node_fo_p
,db_vw_node_fo_p->
hp_b
);

57 if(
t_v
 =
MEMPOOL_SUCCESS
)

59 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "memory blockeleased succussfully!.");

62 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "failedoelease memory block");

66 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," NULLassed for deletion.");

68 
	}
}

70 
	$tsc_vxn_swme_vmpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
)

72 
t32_t
 
t_v
;

73 
ut32_t
 
offt
;

74 
tsc_vxn_swme_vmpt_vw_node
 *
db_vw_node_fo_p
 = (tsc_vxn_swme_vmpt_vw_node*)
db_vw_node_y_p
;

76 if(
db_vw_node_y_p
)

78 
offt
 = 
TSC_VXN_SWNAME_VMPORT_VIEW_NODE_TBL_OFFSET
;

79 
db_vw_node_fo_p
 = (
tsc_vxn_swme_vmpt_vw_node
*)(((*)
db_vw_node_y_p
-
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
)-
offt
);

80 
t_v
 = 
	`mempo_a_mem_block
(
swme_vmpt_vw
.
db_vwmempo_p
,(
uch8_t
*)
db_vw_node_fo_p
,db_vw_node_fo_p->
hp_b
);

81 if(
t_v
 =
MEMPOOL_SUCCESS
)

83 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "memory blockeleased succussfully!.");

86 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "failedoelease memory block");

90 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," NULLassed for deletion.");

92 
	}
}

94 
	$tsc_vxn_swme_uni_nwpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
)

96 
t32_t
 
t_v
;

97 
ut32_t
 
offt
;

98 
tsc_vxn_swme_uni_nwpt_vw_node
 *
db_vw_node_fo_p
 = (tsc_vxn_swme_uni_nwpt_vw_node*)
db_vw_node_y_p
;

100 if(
db_vw_node_y_p
)

102 
offt
 = 
TSC_VXN_SWNAME_UNICAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

103 
db_vw_node_fo_p
 = (
tsc_vxn_swme_uni_nwpt_vw_node
*)(((*)
db_vw_node_y_p
-
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
)-
offt
);

104 
t_v
 = 
	`mempo_a_mem_block
(
swme_uni_nwpt_vw
.
db_vwmempo_p
,(
uch8_t
*)
db_vw_node_fo_p
,db_vw_node_fo_p->
hp_b
);

105 if(
t_v
 =
MEMPOOL_SUCCESS
)

107 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "memory blockeleased succussfully!.");

110 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "failedoelease memory block");

114 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," NULLassed for deletion.");

116 
	}
}

118 
	$tsc_vxn_swme_brd_nwpt__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
)

120 
t32_t
 
t_v
;

121 
ut32_t
 
offt
;

122 
tsc_vxn_swme_brd_nwpt_vw_node
 *
db_vw_node_fo_p
=(tsc_vxn_swme_brd_nwpt_vw_node*)
db_vw_node_y_p
;

124 if(
db_vw_node_y_p
)

126 
offt
 = 
TSC_VXN_SWNAME_BROADCAST_NWPORT_VIEW_NODE_TBL_OFFSET
;

128 
db_vw_node_fo_p
 = (
tsc_vxn_swme_brd_nwpt_vw_node
*)(((*)
db_vw_node_y_p
-
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
)-
offt
);

130 
t_v
 = 
	`mempo_a_mem_block
(
swme_brd_nwpt_vw
.
db_vwmempo_p
,(
uch8_t
*)
db_vw_node_fo_p
,db_vw_node_fo_p->
hp_b
);

132 if(
t_v
 =
MEMPOOL_SUCCESS
)

134 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "memory blockeleased succussfully!.");

137 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "failedoelease memory block");

141 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," NULLassed for deletion.");

143 
	}
}

145 
	$tsc_vxn_nid_vn__vw_node_rcu
(
rcu_hd
 *
db_vw_node_y_p
)

147 
t32_t
 
t_v
;

148 
ut32_t
 
offt
;

150 
tsc_vxn_nid_vn_vw_node
 *
db_vw_node_fo_p
=(tsc_vxn_nid_vn_vw_node*)
db_vw_node_y_p
;

151 if(
db_vw_node_y_p
)

153 
offt
 = 
TSC_VXN_TUNID_VN_VIEW_NODE_TBL_OFFSET
;

154 
db_vw_node_fo_p
 = (
tsc_vxn_nid_vn_vw_node
*)(((*)
db_vw_node_y_p
-
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
)-
offt
);

155 
t_v
 = 
	`mempo_a_mem_block
(
nid_vn_vw
.
db_vwmempo_p
,(
uch8_t
*)
db_vw_node_fo_p
,db_vw_node_fo_p->
hp_b
);

156 if(
t_v
 =
MEMPOOL_SUCCESS
)

158 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "memory blockeleased succussfully!.");

162 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
, "failedoelease memory block");

167 
	`OF_LOG_MSG
(
OF_LOG_TSC
, 
OF_LOG_DEBUG
," NULLassed for deletion.");

169 
	}
}

171 
	$tsc_vxn_g_vw_node_mempoޒs
(
ut32_t
* 
vw_node_s_max
,ut32_t* 
vw_node_ic_s
)

173 *
vw_node_s_max
 = 
TSC_VXN_MAX_VIEW_NODE_ENTRIES
;

174 *
vw_node_ic_s
 = 
TSC_VXN_MAX_VIEW_STATIC_NODE_ENTRIES
;

175 
	}
}

183 
t32_t
 
	$tsc_vxn_vmpt_ptmac_vw_
(*
vw_me_p
)

185 
t32_t
 
t_vue
;

186 
ut32_t
 
vw_node_s_max
,
vw_node_ic_s
;

187 
mempo_ms
 
mempo_fo
 = {};

190 
	`tsc_vxn_g_vw_node_mempoޒs
(&
vw_node_s_max
, &
vw_node_ic_s
);

193 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

194 
mempo_fo
.
block_size
 = (
tsc_vxn_dmac_vmpt_vw_node
);

195 
mempo_fo
.
max_blocks
 = 
vw_node_s_max
;

196 
mempo_fo
.
ic_blocks
 = 
vw_node_ic_s
;

197 
mempo_fo
.
thshd_m
 = 
vw_node_ic_s
/10;

198 
mempo_fo
.
thshd_max
 = 
vw_node_ic_s
/3;

199 
mempo_fo
.
ish_cou
 = 
vw_node_ic_s
/10;

200 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

201 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

202 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

205 
t_vue
 = 
	`mempo__po
("tsc_vxn_dmac_vmport_db_view_pool",

206 &
mempo_fo
,

207 &(
dmac_vmpt_vw
.
db_vwmempo_p
)

209 if(
t_vue
 !
MEMPOOL_SUCCESS
)

210  
CRM_FAILURE
;

212 
t_vue
 = 
	`mchash_b_
(((
vw_node_s_max
/5)+1),

213 
vw_node_s_max
,

214 
tsc_vxn_dmac_vmpt__vw_node_rcu
,

215 &(
dmac_vmpt_vw
.
db_vwtbl_p
));

216 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

217  
CRM_FAILURE
;

219 
dmac_vmpt_vw
.
no_of_vw_node_bucks_g
 = (
vw_node_s_max
/5) + 1;

220 
	`ry
(
dmac_vmpt_vw
.
vw
,
vw_me_p
);

221  
CRM_SUCCESS
;

222 
	}
}

224 
t32_t
 
	$tsc_vxn_vmpt_ptmac_vw_un
()

226 
t32_t
 
t_vue
;

228 
t_vue
 = 
	`mchash_b_de
(
dmac_vmpt_vw
.
db_vwtbl_p
);

229 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

230  
t_vue
;

232 
t_vue
 = 
	`mempo_de_po
(
dmac_vmpt_vw
.
db_vwmempo_p
);

233 if(
t_vue
 !
MEMPOOL_SUCCESS
)

234  
t_vue
;

236  
CRM_SUCCESS
;

237 
	}
}

245 
t32_t
 
	$tsc_vxn_vmpt_swme_vw_
(*
vw_me_p
)

247 
t32_t
 
t_vue
;

248 
ut32_t
 
vw_node_s_max
,
vw_node_ic_s
;

249 
mempo_ms
 
mempo_fo
 = {};

251 
	`tsc_vxn_g_vw_node_mempoޒs
(&
vw_node_s_max
, &
vw_node_ic_s
);

253 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

254 
mempo_fo
.
block_size
 = (
tsc_vxn_swme_vmpt_vw_node
);

255 
mempo_fo
.
max_blocks
 = 
vw_node_s_max
;

256 
mempo_fo
.
ic_blocks
 = 
vw_node_ic_s
;

257 
mempo_fo
.
thshd_m
 = 
vw_node_ic_s
/10;

258 
mempo_fo
.
thshd_max
 = 
vw_node_ic_s
/3;

259 
mempo_fo
.
ish_cou
 = 
vw_node_ic_s
/10;

260 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

261 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

262 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

265 
t_vue
 = 
	`mempo__po
("tsc_vxn_swname_vmport_db_view_pool",

266 &
mempo_fo
,

267 &(
swme_vmpt_vw
.
db_vwmempo_p
)

269 if(
t_vue
 !
MEMPOOL_SUCCESS
)

270  
CRM_FAILURE
;

272 
t_vue
 = 
	`mchash_b_
(((
vw_node_s_max
/5)+1),

273 
vw_node_s_max
,

274 
tsc_vxn_swme_vmpt__vw_node_rcu
,

275 &(
swme_vmpt_vw
.
db_vwtbl_p
));

276 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

277  
CRM_FAILURE
;

279 
swme_vmpt_vw
.
no_of_vw_node_bucks_g
 = (
vw_node_s_max
/5) + 1;

280 
	`ry
(
swme_vmpt_vw
.
vw
,
vw_me_p
);

281  
CRM_SUCCESS
;

282 
	}
}

284 
t32_t
 
	$tsc_vxn_vmpt_swme_vw_un
()

286 
t32_t
 
t_vue
;

287 
t_vue
 = 
	`mchash_b_de
(
swme_vmpt_vw
.
db_vwtbl_p
);

288 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

289  
t_vue
;

291 
t_vue
 = 
	`mempo_de_po
(
swme_vmpt_vw
.
db_vwmempo_p
);

292 if(
t_vue
 !
MEMPOOL_SUCCESS
)

293  
t_vue
;

295  
CRM_SUCCESS
;

296 
	}
}

305 
t32_t
 
	$tsc_vxn_uni_nwpt_swme_vw_
(*
vw_me_p
)

307 
t32_t
 
t_vue
;

308 
ut32_t
 
vw_node_s_max
,
vw_node_ic_s
;

309 
mempo_ms
 
mempo_fo
 = {};

311 
	`tsc_vxn_g_vw_node_mempoޒs
(&
vw_node_s_max
, &
vw_node_ic_s
);

312 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

313 
mempo_fo
.
block_size
 = (
tsc_vxn_swme_uni_nwpt_vw_node
);

314 
mempo_fo
.
max_blocks
 = 
vw_node_s_max
;

315 
mempo_fo
.
ic_blocks
 = 
vw_node_ic_s
;

316 
mempo_fo
.
thshd_m
 = 
vw_node_ic_s
/10;

317 
mempo_fo
.
thshd_max
 = 
vw_node_ic_s
/3;

318 
mempo_fo
.
ish_cou
 = 
vw_node_ic_s
/10;

319 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

320 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

321 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

324 
t_vue
 = 
	`mempo__po
("tsc_vxn_swname_unicast_nwport_db_view_pool",

325 &
mempo_fo
,

326 &(
swme_uni_nwpt_vw
.
db_vwmempo_p
)

328 if(
t_vue
 !
MEMPOOL_SUCCESS
)

329  
CRM_FAILURE
;

331 
t_vue
 = 
	`mchash_b_
(((
vw_node_s_max
/5)+1),

332 
vw_node_s_max
,

333 
tsc_vxn_swme_uni_nwpt__vw_node_rcu
,

334 &(
swme_uni_nwpt_vw
.
db_vwtbl_p
));

335 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

336  
CRM_FAILURE
;

338 
swme_uni_nwpt_vw
.
no_of_vw_node_bucks_g
 = (
vw_node_s_max
/5) + 1;

339 
	`ry
(
swme_uni_nwpt_vw
.
vw
,
vw_me_p
);

340  
CRM_SUCCESS
;

341 
	}
}

343 
t32_t
 
	$tsc_vxn_uni_nwpt_swme_vw_un
()

345 
t32_t
 
t_vue
;

347 
t_vue
 = 
	`mchash_b_de
(
swme_uni_nwpt_vw
.
db_vwtbl_p
);

348 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

349  
t_vue
;

351 
t_vue
 = 
	`mempo_de_po
(
swme_uni_nwpt_vw
.
db_vwmempo_p
);

352 if(
t_vue
 !
MEMPOOL_SUCCESS
)

353  
t_vue
;

354  
CRM_SUCCESS
;

355 
	}
}

364 
t32_t
 
	$tsc_vxn_brd_nwpt_swme_vw_
(*
vw_me_p
)

366 
t32_t
 
t_vue
;

367 
ut32_t
 
vw_node_s_max
,
vw_node_ic_s
;

368 
mempo_ms
 
mempo_fo
 = {};

371 
	`tsc_vxn_g_vw_node_mempoޒs
(&
vw_node_s_max
, &
vw_node_ic_s
);

373 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

374 
mempo_fo
.
block_size
 = (
tsc_vxn_swme_brd_nwpt_vw_node
);

375 
mempo_fo
.
max_blocks
 = 
vw_node_s_max
;

376 
mempo_fo
.
ic_blocks
 = 
vw_node_ic_s
;

377 
mempo_fo
.
thshd_m
 = 
vw_node_ic_s
/10;

378 
mempo_fo
.
thshd_max
 = 
vw_node_ic_s
/3;

379 
mempo_fo
.
ish_cou
 = 
vw_node_ic_s
/10;

380 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

381 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

382 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

385 
t_vue
 = 
	`mempo__po
("tsc_vxn_swname_broadcast_nwport_db_view_pool",

386 &
mempo_fo
,

387 &(
swme_brd_nwpt_vw
.
db_vwmempo_p
)

389 if(
t_vue
 !
MEMPOOL_SUCCESS
)

390  
CRM_FAILURE
;

392 
t_vue
 = 
	`mchash_b_
(((
vw_node_s_max
/5)+1),

393 
vw_node_s_max
,

394 
tsc_vxn_swme_brd_nwpt__vw_node_rcu
,

395 &(
swme_brd_nwpt_vw
.
db_vwtbl_p
));

396 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

397  
CRM_FAILURE
;

399 
swme_brd_nwpt_vw
.
no_of_vw_node_bucks_g
 = (
vw_node_s_max
/5) + 1;

400 
	`ry
(
swme_brd_nwpt_vw
.
vw
,
vw_me_p
);

401  
CRM_SUCCESS
;

402 
	}
}

404 
t32_t
 
	$tsc_vxn_brd_nwpt_swme_vw_un
()

406 
t32_t
 
t_vue
;

408 
t_vue
 = 
	`mchash_b_de
(
swme_brd_nwpt_vw
.
db_vwtbl_p
);

409 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

410  
t_vue
;

412 
t_vue
 = 
	`mempo_de_po
(
swme_brd_nwpt_vw
.
db_vwmempo_p
);

413 if(
t_vue
 !
MEMPOOL_SUCCESS
)

414  
t_vue
;

415  
CRM_SUCCESS
;

416 
	}
}

425 
t32_t
 
	$tsc_vxn_vn_nid_vw_
(*
vw_me_p
)

427 
t32_t
 
t_vue
;

428 
ut32_t
 
vw_node_s_max
,
vw_node_ic_s
;

429 
mempo_ms
 
mempo_fo
 = {};

431 
	`tsc_vxn_g_vw_node_mempoޒs
(&
vw_node_s_max
, &
vw_node_ic_s
);

433 
mempo_fo
.
mempo_ty
 = 
MEMPOOL_TYPE_HEAP
;

434 
mempo_fo
.
block_size
 = (
tsc_vxn_nid_vn_vw_node
);

435 
mempo_fo
.
max_blocks
 = 
vw_node_s_max
;

436 
mempo_fo
.
ic_blocks
 = 
vw_node_ic_s
;

437 
mempo_fo
.
thshd_m
 = 
vw_node_ic_s
/10;

438 
mempo_fo
.
thshd_max
 = 
vw_node_ic_s
/3;

439 
mempo_fo
.
ish_cou
 = 
vw_node_ic_s
/10;

440 
mempo_fo
.
b_memt_n_qued
 = 
FALSE
;

441 
mempo_fo
.
b_li_r_thad_qued
 = 
FALSE
;

442 
mempo_fo
.
noof_blocks_to_move_to_thad_li
 = 0;

445 
t_vue
 = 
	`mempo__po
("tsc_vxn_nid_vn_db_view_pool",

446 &
mempo_fo
,

447 &(
nid_vn_vw
.
db_vwmempo_p
)

449 if(
t_vue
 !
MEMPOOL_SUCCESS
)

450  
CRM_FAILURE
;

452 
t_vue
 = 
	`mchash_b_
(((
vw_node_s_max
/5)+1),

453 
vw_node_s_max
,

454 
tsc_vxn_nid_vn__vw_node_rcu
,

455 &(
nid_vn_vw
.
db_vwtbl_p
));

456 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

457  
CRM_FAILURE
;

459 
nid_vn_vw
.
no_of_vw_node_bucks_g
 = (
vw_node_s_max
/5) + 1;

460 
	`ry
(
nid_vn_vw
.
vw
,
vw_me_p
);

461  
CRM_SUCCESS
;

462 
	}
}

464 
t32_t
 
	$tsc_vxn_vn_nid_vw_un
()

466 
t32_t
 
t_vue
;

468 
t_vue
 = 
	`mchash_b_de
(
nid_vn_vw
.
db_vwtbl_p
);

469 if(
t_vue
 !
MCHASHTBL_SUCCESS
)

470  
t_vue
;

472 
t_vue
 = 
	`mempo_de_po
(
nid_vn_vw
.
db_vwmempo_p
);

473 if(
t_vue
 !
MEMPOOL_SUCCESS
)

474  
t_vue
;

476  
CRM_SUCCESS
;

477 
	}
}

	@
1
.
1
/usr/include
24
490
include/dobhash.h
include/nicira_tun_ext.h
include/tsc_controller.h
include/tsc_nsc_core.h
include/tsc_nsc_iface.h
include/tsc_nvm_modules.h
include/tsc_nvm_vxlan.h
include/tsc_ofplugin_v1_3_ldef.h
include/tsc_ofv1_3_plugin.h
include/tsc_vxn_views.h
list_repository.c
list_selectors.c
nicira_tun_ext.c
tsc_controller.c
tsc_init.c
tsc_nsc_cnbind.c
tsc_nsc_core.c
tsc_nsc_iface.c
tsc_nsc_notify.c
tsc_nvm_modules.c
tsc_nvm_vxlan.c
tsc_ofv1_3_plugin.c
tsc_vxn_views_api.c
tsc_vxn_views_init.c
